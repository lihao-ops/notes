遇到的问题
===







跨域问题
---



### 一、前言



#### 1.什么是跨域问题？

想象一下你在玩一个迷宫游戏，你只能在自己的房间里做事情，但是不能去邻居的房间。同样的道理，网页也是如此，一个网页通常只能和同一个地方（同一个域名）的信息交流，而不能和其他域名的网页直接交流。



#### 2.为什么会有跨域问题？

这是为了保护你的信息安全。想象一下，如果你在一个购物网站输入了密码和信用卡信息，这些信息应该只能被那个网站访问到，而不是其他不相关的网站。



#### 3.跨域问题的案例：

假设你在一个网站上看到一个嵌入的广告，但是这个广告是从另一个不同的网站加载的。现在，当这个广告网站尝试读取你在原始网站上的一些信息（比如 cookie），浏览器会因为安全原因阻止它，这就是跨域问题。



#### 4.Java 中的处理方案：

如果你在 Java 中开发网站，并且需要处理跨域问题，可以使用 CORS（跨域资源共享）来解决。就好像是你和邻居商量好了可以去对方家玩一会儿。

在 Java 中，你可以使用 Spring 框架提供的 `@CrossOrigin` 注解或者配置 CORS 过滤器来允许特定的域名访问你的网站资源。这就像是给邻居一个通行证，让他们可以来你家玩一下，但其他人不行。





#### 5.结论：

跨域问题是为了保护网站上的信息安全而设置的规则。通过合理地配置 CORS，我们可以允许某些特定的网站与我们的网站进行交流，这样可以更安全地处理跨域请求。就像是你和邻居商量好了互相可以来彼此家玩耍一样。











### 二、遇到的案例





#### 案例一、options

##### 1.产生的原因

发现浏览器页面中更新一直显示无权限，但接口调试无异常，直接显示403。

>页面调试图

![image-20240106193258992](https://notes-1307435281.cos.ap-shanghai.myqcloud.com/note/master/202401061932079.png)



>后台服务日志信息

![image-20240106193212871](https://notes-1307435281.cos.ap-shanghai.myqcloud.com/note/master/202401061932129.png)









##### 2.发现过程

最终重复在前端页面调试对比出现的日志中发现

![image-20240106193415295](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20240106193415295.png)



在网络请求中，OPTIONS 是一种预检请求，用于确定对特定资源所支持的请求方法。当浏览器或客户端尝试与服务器进行跨域资源共享（CORS）时，**会发出 OPTIONS 请求来检查服务器是否允许特定的请求**。

在你提到的情况中，可能存在跨域请求或者客户端发送了一个 OPTIONS 请求以确定是否能够发送一个真正的请求（例如，POST、GET 等）。请求原本为 pat（可能是某种请求方法，例如 PATCH），但实际发送的请求却是 OPTIONS。

这可能是因为浏览器在发送实际请求之前首先发送了一个 OPTIONS 预检请求，以确认服务器是否允许使用 pat 这种请求方法。如果服务器允许该请求方法，则浏览器会随后发送实际的 pat 请求。









##### 3.处理解决

> 确定为跨域问题后，查看服务关于跨域配置如下：

```java
@Configuration
public class WebMvcConfig implements WebMvcConfigurer {
    /**
     * 跨域配置
     */
    @Override
    public void addCorsMappings(CorsRegistry registry) {
        registry.addMapping("/**")
                .allowedOriginPatterns("*")
                .allowedMethods("GET", "POST", "PUT", "DELETE")
                .allowCredentials(true);
    }
}
```

其中发现并不支持options请求跨域请求，那么在这里加上即可

`.allowedMethods("GET", "POST", "PUT", "DELETE", "OPTIONS")` 这样的配置用于设置 CORS（跨域资源共享）策略，允许服务器接受特定的请求方法。通过将 OPTIONS 添加到 `.allowedMethods()` 中，表明服务器允许接受 OPTIONS 请求方法，从而支持跨域请求的预检。

这样的设置告诉浏览器，服务器支持这些请求方法，包括 OPTIONS。这对于跨域请求的处理非常重要，因为浏览器在发起跨域请求时会先发送 OPTIONS 请求，检查服务器是否允许实际的请求方法。

当浏览器发出 OPTIONS 预检请求时，服务器若配置了 `.allowedMethods("OPTIONS")` 或包含 OPTIONS 在内的其他请求方法列表，就可以正确响应跨域请求，并允许浏览器发送实际的请求。



```java
@Configuration
public class WebMvcConfig implements WebMvcConfigurer {
    /**
     * 跨域配置
     */
    @Override
    public void addCorsMappings(CorsRegistry registry) {
        registry.addMapping("/**")
                .allowedOriginPatterns("*")
                .allowedMethods("GET", "POST", "PUT", "DELETE","OPTIONS")
                .allowCredentials(true);
    }
}
```





>随后部署再调试

发现问题已经圆满解决了











