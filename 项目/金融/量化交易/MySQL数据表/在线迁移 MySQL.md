

# Âú®Á∫øËøÅÁßª MySQL Ë°®





## Ê∏©Êï∞ÊçÆË°®



Êää‰∏Ä‰∏™ÂéÜÊó∂Êï∞Âë®ÁîöËá≥Êï∞ÊúàÁöÑÂ§ßÂûãÈ°πÁõÆÔºå‰ªé**ÁóõÁÇπÔºàSituationÔºâ**„ÄÅ**ÊñπÊ°àÔºàTaskÔºâ**„ÄÅ**ÊâßË°åÔºàActionÔºâ**Âà∞**ÊàêÊûúÔºàResultÔºâ**ÂÆåÊï¥Âú∞‰∏≤ËÅîËµ∑Êù•„ÄÇ



### Èù¢ËØïË°®Ëø∞

‚ÄúÈù¢ËØïÂÆò‰Ω†Â•Ω„ÄÇÂú®ÊàëË¥üË¥£ÁöÑË°åÊÉÖÁ≥ªÁªü‰∏≠ÔºåÊàë‰∏ªÂØº‰∫Ü‰∏ÄÊ¨°Â§ßËßÑÊ®°ÁöÑÊï∞ÊçÆÊû∂ÊûÑÂçáÁ∫ß„ÄÇ

**ÔºàÂÖàËØ¥ÁóõÁÇπÔºâ** Êàë‰ª¨ÈÅáÂà∞‰∫Ü‰∏Ä‰∏™ÂæàÂÖ∏ÂûãÁöÑÊµ∑ÈáèÊï∞ÊçÆÁóõÁÇπÔºöÂéüÂßãÁöÑÂéÜÂè≤Ë°åÊÉÖË°®ÊúâÂá†ÂçÅ‰∫øÊï∞ÊçÆÔºåËôΩÁÑ∂Â∑≤ÁªèÊåâÊúàÂàÜ‰∫ÜË°®Ôºå‰ΩÜ‰ªª‰ΩïË∑®ÊúàÁöÑÂéÜÂè≤ÂõûÊµãÔºåSQL ÈÉΩÈúÄË¶Å `UNION ALL` ‰∏ÄÂ†ÜË°®ÔºåÈùûÂ∏∏‰ΩéÊïàÔºåÊàë‰ª¨ÂÜÖÈÉ®ÊàèÁß∞‚ÄúUnion ÁãÇÈ≠î‚Äù„ÄÇËÄå‰∏îÔºåÊóßÁöÑËÅîÂêà‰∏ªÈîÆËÆæËÆ°Âú®È´òÂπ∂ÂèëÂÜôÂÖ•‰∏ãÔºåÂØºËá¥‰∫Ü‰∏•ÈáçÁöÑ**È°µÂàÜË£Ç**ÂíåÁ£ÅÁõòÁ¢éÁâáÔºåIO ÊÄßËÉΩÂú®ÊåÅÁª≠‰∏ãÈôç„ÄÇ

**ÔºàÂÜçËØ¥ÊñπÊ°àÔºâ** ÊàëÁöÑÊñπÊ°àÊòØÂÅö‰∏ÄÊ¨°ÂΩªÂ∫ïÁöÑ**ÂÜ∑ÁÉ≠ÂàÜÁ¶ª**„ÄÇÊàëËÆæËÆ°‰∫Ü‰∏Ä‰∏™Êñ∞ÁöÑÊ∏©Êï∞ÊçÆË°®Ôºà`tb_warm`ÔºâÔºåÊ†∏ÂøÉÊîπÂä®Êúâ‰∏âÁÇπÔºö

1. **Áî® `RANGE` ÂàÜÂå∫**ÔºöÊåâÊúàÂàÜÂå∫ÔºåËøôÊ†∑‰∏öÂä°Â±ÇÂú®ÈÄªËæë‰∏äÊòØÊü•‰∏ÄÂº†Ë°®ÔºåÂΩªÂ∫ïÊ∂àÁÅ≠‰∫Ü Union„ÄÇ
2. **Êîπ‰∏ªÈîÆ**ÔºöÊàëÊääÁâ©ÁêÜ‰∏ªÈîÆ‰ªé‰∏öÂä°ËÅîÂêà‰∏ªÈîÆÔºåÊîπÊàê‰∫Ü `BIGINT` Ëá™Â¢û ID„ÄÇËøôÊ†∑ `pt-archiver` ÂÜôÂÖ•Êó∂Â∞±ÂèòÊàê‰∫ÜÁ∫ØÁ≤πÁöÑ**È°∫Â∫èËøΩÂä†ÂÜô (Sequential Append)**Ôºå‰ªéÊ†πÊú¨‰∏äËß£ÂÜ≥‰∫ÜÈ°µÂàÜË£Ç„ÄÇ
3. **‰∏äÂéãÁº©**ÔºöÂõ†‰∏∫ÊòØÊ∏©Êï∞ÊçÆÔºåËÆøÈóÆÈ¢ëÁéá‰ΩéÔºåÊàëÂºÄÂêØ‰∫Ü `InnoDB` ÈÄèÊòéÂéãÁº©„ÄÇ

**ÔºàÁÑ∂ÂêéËØ¥ÊâßË°åÔºåËøôÊòØÊúÄÂÖ≥ÈîÆÁöÑÔºâ** ÊúÄÂ§ßÁöÑÊåëÊàòÊòØ**Âú®Á∫øËøÅÁßª**Ôºå‰∏öÂä°ÊòØ 24/7 ‰∏çËÉΩÂÅúÁöÑ„ÄÇÊàëÈááÁî®ÁöÑÊòØ**‚ÄòÂèåÂÜô + Â≠òÈáèÂõûÂ°´‚Äô**ÁöÑÊñπÊ°àÔºö

1. ÊàëÂÖà‰∏äÁ∫ø‰∫ÜÂèåÂÜôÊúçÂä°ÔºåËøôÈáåÊúâ‰∏™ÁªÜËäÇÔºöÊâÄÊúâ `UPDATE` Êìç‰ΩúÈÉΩÊîπÂÜô‰∏∫ `INSERT ... ON DUPLICATE KEY UPDATE`Ôºå‰øùËØÅÊñ∞Ë°®Êï∞ÊçÆÊ∞∏ËøúÊòØÊúÄÊñ∞ÁöÑ„ÄÇ
2. ÁÑ∂ÂêéÔºåÊàëÁî® `pt-archiver` Â∑•ÂÖ∑Ë∑ëÂ≠òÈáèÂõûÂ°´„ÄÇËøôÈáåÊúÄÂÖ≥ÈîÆÁöÑÈÖçÁΩÆÊòØÂä†‰∫Ü **`--ignore`** ÂèÇÊï∞„ÄÇ
3. Ôºà**Èù¢ËØïÂÆòËøΩÈóÆ‰∏∫‰ªÄ‰πàÔºü**ÔºâËøôÊòØ‰∏∫‰∫ÜËß£ÂÜ≥Á´ûÊÄÅÊù°‰ª∂ÔºöÂ¶ÇÊûú `pt-archiver` ÊãøÁùÄÊóßÊï∞ÊçÆÔºàÊØîÂ¶Ç `val=100`ÔºâÂéªÊèíÔºåËÄåÂèåÂÜôÂ∑≤ÁªèÊääÊñ∞Êï∞ÊçÆÔºà`val=200`ÔºâÂÜôËøõÂéª‰∫ÜÔºå`INSERT IGNORE` ‰ºöÂõ†‰∏∫‰∏ªÈîÆÂÜ≤Á™ÅËÄå**Ëá™Âä®ÂøΩÁï•**ËøôÊ¨°ÊóßÊï∞ÊçÆÁöÑÂÜôÂÖ•ÔºåÂÆåÁæé‰øùËØÅ‰∫ÜÊñ∞Êï∞ÊçÆ‰∏çË¢´Ë¶ÜÁõñÂõûÊªö„ÄÇ

**ÔºàÊúÄÂêéËØ¥ÊàêÊûúÔºåÁî®Êï∞ÊçÆÁ†∏Ôºâ** ËøÅÁßªÂè™ÊòØÁ¨¨‰∏ÄÊ≠•ÔºåÈ™åËØÅÊâçÊòØÈó≠ÁéØ„ÄÇ

1. **‰∏ÄËá¥ÊÄß**ÔºöÊàëÁî® `CompletableFuture` ÂÜô‰∫Ü‰∏Ä‰∏™ **24 Á∫øÁ®ãÂπ∂Âèë**ÁöÑÊ†°È™åÂ∑•ÂÖ∑ÔºåÊåâÊúàÂàÜÁâáÂéªË∑ë„ÄÇÊ†°È™åÈÄüÂ∫¶ËææÂà∞‰∫Ü **25‰∏áË°å/Áßí**Ôºå4.6 ‰∫øÊï∞ÊçÆÂÖ®Â≠óÊÆµÊØîÂØπ‰∏ãÊù•ÔºåÊï∞ÊçÆ 100% ‰∏ÄËá¥„ÄÇ
2. **Áâ©ÁêÜÂÅ•Â∫∑Â∫¶**ÔºöËøÅÁßªÂêéÔºåÊñ∞Ë°®ÁöÑ**Á£ÅÁõòÁ¢éÁâáÁéáÊòØ 0.00%**„ÄÇ
3. **ÊàêÊú¨ÂíåÊÄßËÉΩÔºàÈáçÁÇπÔºâ**Ôºö
   - **Á©∫Èó¥**ÔºöÊúÄÁªàÁ£ÅÁõòÂç†Áî®‰ªé 53.4 GB ÈôçÂà∞‰∫Ü 22.6 GBÔºåÂÆûÊâìÂÆûÂú∞**ËäÇÁúÅ‰∫Ü 57.7% ÁöÑÂ≠òÂÇ®ÊàêÊú¨**„ÄÇ
   - **ÊÄßËÉΩ**ÔºöÊàëÂÅö‰∫Ü OAT Âü∫ÂáÜÊµãËØïÔºåÁ≤æÂáÜÈáèÂåñ‰∫ÜÂéãÁº©ÁöÑ‰ª£‰ª∑ÔºöÂú®Êï∞ÊçÆ**ÂÖ®ÂëΩ‰∏≠ÂÜÖÂ≠ò**ÔºàÁÉ≠ËØªÔºâÊó∂ÔºåCPU Ëß£Âéã‰ºöÂ∏¶Êù• **10-15ms** ÁöÑÈ¢ùÂ§ñÂª∂Ëøü„ÄÇ‰ΩÜÂú®ÁúüÂÆûÁöÑ**ÂÜ∑ËØª**ÔºàÁ£ÅÁõòI/OÔºâÂú∫ÊôØ‰∏ãÔºåËøô‰∏™ I/O Êî∂ÁõäËøúÂ§ß‰∫é CPU ÊàêÊú¨ÔºåÊâÄ‰ª•Ëøô‰∏™ÊùÉË°°ÔºàTrade-offÔºâÊòØÈùûÂ∏∏ÂÄºÂæóÁöÑ„ÄÇ

ÊúÄÂêéÔºåÊï¥‰∏™ÂàáÊµÅÊòØÈù† Nacos ÂºÄÂÖ≥ÊéßÂà∂ÁöÑÔºåÈÖçÂêà Micrometer ÂØπÊñ∞ÊóßÊü•ËØ¢ P99 Âª∂ËøüÁöÑ**ÂàÜÁ¶ªÁõëÊéß**ÔºåÂèØ‰ª•ÈöèÊó∂‰∏ÄÈîÆÂõûÊªöÔºåÊï¥‰∏™ËøáÁ®ãÂØπ‰∏öÂä°ÂÆåÂÖ®ÈÄèÊòé„ÄÇ‚Äù



### Êµ∑ÈáèÊ∏©Êï∞ÊçÆËøÅÁßªÂ§çÁõòÊä•Âëä





#### 1. ÁóõÁÇπ‰∏éËÉåÊôØ (The Problem)



- **ÂéüÂßãÊû∂ÊûÑ**ÔºöÂçï‰∏ÄÁÉ≠Êï∞ÊçÆË°®Ôºà`tb_quotation_history`ÔºâÊï∞ÊçÆÈáèËææÊï∞ÂçÅ‰∫øÔºåÂ∑≤ÊåâÊúàÂàÜÊãÜ‰∏∫ `tb_quotation_history_trend_YYYYMM`ÔºàÁ∫¶ 3000-4000‰∏áË°å/ÊúàÔºâ„ÄÇ
- **Ê†∏ÂøÉÁóõÁÇπ**Ôºö
  1. **Êü•ËØ¢Âú∞Áã± (UNION Hell)**ÔºöÂéÜÂè≤Êï∞ÊçÆÔºàÊ∏©Êï∞ÊçÆÔºâÊü•ËØ¢ËôΩ‰ΩéÈ¢ëÔºå‰ΩÜ‰∏çÂèØÊàñÁº∫„ÄÇ‰ªª‰ΩïË∑®ÊúàÂõûÊµãÈÉΩÈúÄË¶Å`UNION ALL`Â§öÂº†ÂàÜË°®ÔºåË¢´ÊàèÁß∞‰∏∫‚ÄúUnionÁãÇÈ≠î‚Äù„ÄÇ
  2. **ÊÄßËÉΩÁì∂È¢à**ÔºöÈ´òÂπ∂ÂèëÂÜôÂÖ•ÂØºËá¥ÊóßË°®ÔºàËÅîÂêà‰∏ªÈîÆÔºâ‰∫ßÁîü‰∏•ÈáçÁöÑ**È°µÂàÜË£Ç**Âíå**Á£ÅÁõòÁ¢éÁâá**ÔºåIO ÊÄßËÉΩ‰∏ãÈôç„ÄÇ
  3. **ËøêÁª¥Âõ∞Èöæ**ÔºöË°®ÁªìÊûÑÁÆ°ÁêÜ„ÄÅÁ¥¢ÂºïÁª¥Êä§„ÄÅÂ§á‰ªΩÊÅ¢Â§çÊàêÊú¨ÊûÅÈ´ò„ÄÇ



#### 2. Êû∂ÊûÑÈÄâÂûã (The Solution)



- **ÁõÆÊ†á**ÔºöÂÆûÁé∞ÂÜ∑ÁÉ≠ÂàÜÁ¶ªÔºå‰ºòÂåñÊ∏©Êï∞ÊçÆÂ≠òÂÇ®ÔºåÊèêÂçáÊü•ËØ¢ÊÄßËÉΩ„ÄÇ
- **Êñ∞Êû∂ÊûÑ**Ôºö`tb_quotation_history_warm`ÔºàÊ∏©Êï∞ÊçÆË°®Ôºâ
  - **ÂàÜÂå∫ (Partitioning)**ÔºöÈááÁî® `RANGE COLUMNS(trade_date)` ÊåâÊúàÂàÜÂå∫Ôºå‰ΩøË∑®ÊúàÊü•ËØ¢Âú®ÈÄªËæë‰∏äÂèò‰∏∫ÂçïË°®Êìç‰Ωú„ÄÇ
  - **‰∏ªÈîÆ (Primary Key)**Ôºö‰ΩøÁî® `BIGINT AUTO_INCREMENT` ‰Ωú‰∏∫**Áâ©ÁêÜ‰∏ªÈîÆ**„ÄÇËøô‰ΩøÂæó B+ Ê†ë**Áâ©ÁêÜÂ≠òÂÇ®ÊúâÂ∫è**ÔºåÂΩªÂ∫ïËß£ÂÜ≥‰∫ÜÈ°µÂàÜË£ÇÈóÆÈ¢ò„ÄÇ
  - **ÂéãÁº© (Compression)**ÔºöÊ∏©Êï∞ÊçÆËÆøÈóÆÈ¢ëÁéá‰ΩéÔºåÈááÁî® `ROW_FORMAT=COMPRESSED` ËøõË°åÈÄèÊòéÂéãÁº©ÔºåÁâ∫Áâ≤Â∞ëÈáè CPU Êç¢ÂèñÂ§ßÈáèÂ≠òÂÇ®Á©∫Èó¥„ÄÇ
  - **Á¥¢Âºï (Indexing)**Ôºö‰øùÁïô `uniq_windcode_tradedate` ‰Ωú‰∏∫‰∏öÂä°ÂîØ‰∏ÄÁ¥¢ÂºïÔºå‰øùÈöú K Á∫øÊü•ËØ¢ÊÄßËÉΩ„ÄÇ



#### 3. ËøÅÁßªÊâßË°å (The Action: Migration)



- **Ê†∏ÂøÉÁ∫¶Êùü**Ôºö‰∏öÂä° 24/7 ËøêË°åÔºåÂøÖÈ°ª**Âú®Á∫øËøÅÁßª (Online)**Ôºå‰∏•Á¶Å‰ΩøÁî®Â§ß‰∫ãÂä°ÊàñÈîÅË°®Êìç‰Ωú„ÄÇ
- **Â∑•ÂÖ∑ÈÄâÂûã**Ôºö
  - **ÊîæÂºÉ `gh-ost`**ÔºöÂÆÉ‰∏ªË¶ÅÁî®‰∫é `ALTER TABLE`ÔºàË°®ÁªìÊûÑÂèòÊõ¥ÔºâÔºå‰ºöÂàõÂª∫‚ÄúÂΩ±Â≠êË°®‚Äù„ÄÇ
  - **ÈÄâÁî® `pt-archiver`**ÔºöÂÆåÁæéÂ•ëÂêà `INSERT ... SELECT` È£éÊ†ºÁöÑË°®Êï∞ÊçÆËøÅÁßªÔºåÊîØÊåÅÁ≤æÁªÜÂåñÁöÑÊâπÊ¨°ÂíåÊµÅÊéß„ÄÇ
- **ËøÅÁßª‰∏âÊ≠•Ëµ∞**Ôºö
  1. **ÊúçÂä°ÂçáÁ∫ßÔºàÂèåÂÜôÔºâ**Ôºö‰∏äÁ∫øÊñ∞ÁâàÊúçÂä°ÔºåÂºÄÂêØ**ÂèåÂÜô**ÔºàDual WriteÔºâ„ÄÇÊâÄÊúâÂ¢ûÈáèÊï∞ÊçÆÂêåÊó∂ÂÜôÂÖ•ÊóßË°®ÂíåÊñ∞Ë°®Ôºà`tb_warm`Ôºâ„ÄÇ
  2. **Â≠òÈáèÂõûÂ°´ÔºàBackfillÔºâ**Ôºö`pt-archiver` ÂêØÂä®Ôºå**Â§öÁ™óÂè£Âπ∂Ë°å**Â§ÑÁêÜÔºà‰æãÂ¶ÇÔºå‰∏Ä‰∏™Á™óÂè£Ë¥üË¥£2020Âπ¥Ôºå‰∏Ä‰∏™Á™óÂè£Ë¥üË¥£2021Âπ¥Ôºâ„ÄÇ
     - **ÂÖ≥ÈîÆÈÖçÁΩÆ**Ôºö`--no-delete` (‰∏çÂà†Èô§Ê∫êÊï∞ÊçÆ) + `--ignore` (Ëß£ÂÜ≥ÂèåÂÜôÁ´ûÊÄÅÔºöÂ¶ÇÊûúÂõûÂ°´Êó∂ÂèëÁé∞‰∏ªÈîÆÂ∑≤Â≠òÂú®ÔºåËØ¥ÊòéÂèåÂÜôÂ∑≤ÂÜôÂÖ•Êñ∞Êï∞ÊçÆÔºåÊ≠§Êó∂**ÂøΩÁï•**ÊóßÊï∞ÊçÆÁöÑÊèíÂÖ•)„ÄÇ
  3. **Âπ≥ÊªëÂàáÊµÅÔºàCutoverÔºâ**ÔºöÂú®È™åËØÅÈÄöËøáÂêéÔºåÈÄöËøá Nacos ÈÖçÁΩÆ‰∏≠ÂøÉÔºå**Âä®ÊÄÅ„ÄÅÊó†ÈáçÂêØ**Âú∞Â∞ÜËØªÊµÅÈáè 100% ÂàáÊç¢Âà∞Êñ∞Ë°®„ÄÇ



#### 4. È™åËØÅ‰∏éÂÖúÂ∫ï (The Action: Validation & Rollback)



ËøôÊòØÊï¥‰∏™È°πÁõÆÊúÄÂÖ≥ÈîÆÁöÑÁéØËäÇÔºåÁ°Æ‰øù‚Äú‰∏áÊó†‰∏ÄÂ§±‚Äù„ÄÇ

1. **Êï∞ÊçÆ‰∏ÄËá¥ÊÄßÈ™åËØÅ**Ôºö
   - **Â∑•ÂÖ∑**ÔºöËá™Á†îÂ§öÁ∫øÁ®ãÊ†°È™åÂ∑•ÂÖ∑Ôºà`DataVerificationService`Ôºâ„ÄÇ
   - **Êû∂ÊûÑ**ÔºöÂà©Áî® `CompletableFuture` Âíå **IO ÂØÜÈõÜÂûãÁ∫øÁ®ãÊ±†**ÔºåÂπ∂Âèë 24 ‰∏™‰ªªÂä°ÔºàÊØè‰ªªÂä°Ë¥üË¥£‰∏Ä‰∏™ÊúàÔºâÔºåÂÆûÁé∞ **25‰∏áË°å/Áßí** ÁöÑÈ´òÈÄüÊØîÂØπ„ÄÇ
   - **‰øÆÂ§çÔºàÈáçÁÇπÔºâ**ÔºöÈ™åËØÅ‰∏≠ÂèëÁé∞ÁöÑÂ∞ëÈáè‚ÄúÂÉµÂ∞∏Êï∞ÊçÆ‚ÄùÔºàÂõ† `DELETE` Á´ûÊÄÅÂØºËá¥ÔºâÊàñ‰∏ç‰∏ÄËá¥Êï∞ÊçÆÔºå**Âπ∂Êú™ÈááÁî® `FOR UPDATE` ÈîÅË°®‰øÆÂ§ç**„ÄÇËÄåÊòØÈááÁî®‚Äú**ËØªÊó∂‰øÆÂ§ç (Read Repair)**‚ÄùÁ≠ñÁï•ÔºöËÆ∞ÂΩïÂ∑ÆÂºÇÊó•ÂøóÔºåÂºÇÊ≠•„ÄÅ‰Ωé‰ºòÂú∞‰ª•ÊóßË°®‰∏∫ÂáÜÔºå**ÈùûÈîÅÂÆö**Âú∞Êõ¥Êñ∞Êñ∞Ë°®Êï∞ÊçÆ„ÄÇ
2. **ÊÄßËÉΩ‰∏éÁ©∫Èó¥È™åÊî∂ (OAT)**Ôºö
   - **ÈùôÊÄÅÈ™åËØÅ**Ôºö`EXPLAIN` Êä•ÂëäÊòæÁ§∫ÔºåÊâÄÊúâÊü•ËØ¢ 100% ÂëΩ‰∏≠‰∫Ü**ÂàÜÂå∫Ââ™Êûù (Partition Pruning)**„ÄÇ
   - **Áâ©ÁêÜÈ™åËØÅ**Ôºö`information_schema` Êü•ËØ¢ËØÅÂÆûÔºåÊñ∞Ë°®Âõ†**È°∫Â∫èÂÜôÂÖ•**Ôºà`BIGINT` ‰∏ªÈîÆÔºâÔºå**Á£ÅÁõòÁ¢éÁâáÁéáÔºàFRAGMENT_RATIOÔºâ‰∏∫ 0.00%**„ÄÇ
   - **ÊàêÊú¨ÈáèÂåñ**ÔºöÈÄöËøá‚ÄúÁÉ≠ËØª‚ÄùÔºàÂÜÖÂ≠òÔºâÂíå‚ÄúÂÜ∑ËØª‚ÄùÔºàÁ£ÅÁõòÔºâÂØπÊØîÊµãËØïÔºåÁ≤æÂáÜÈáèÂåñ‰∫Ü `InnoDB` ÂéãÁº©ÁöÑÊàêÊú¨Ôºö**ÁÉ≠ËØªÂú∫ÊôØÔºàÂëΩ‰∏≠ÁºìÂ≠òÔºâ‰∏ãÔºåÊü•ËØ¢ÊÖ¢ 10-15ms**„ÄÇ
   - **Êî∂ÁõäÈáèÂåñ**ÔºöÁúüÂÆûÁöÑÂÜ∑ËØªÂú∫ÊôØÔºàÂëΩ‰∏≠Á£ÅÁõòÔºâ‰∏ãÔºåI/O ÊÄßËÉΩÊèêÂçáËøúË∂Ö 15ms ÁöÑ CPU ÂºÄÈîÄ„ÄÇ
3. **ÂõûÊªö‰∏éÁÜîÊñ≠È¢ÑÊ°à**Ôºö
   - **ÂõûÊªöÂºÄÂÖ≥**ÔºöNacos ÈÖçÁΩÆÂºÄÂÖ≥ÂèØÂÆûÁé∞ **1 ÂàÜÈíüÂÜÖ**ÊâãÂä®ÂàáÂõûÊóßË°®ËØª„ÄÇ
   - **ÁÜîÊñ≠ÁõëÊéß**Ôºö
     - **Ë¢´Âä®ÔºàÈªÑÈáëÊåáÊ†áÔºâ**Ôºö‰ΩøÁî® Micrometer ÂØπÊñ∞Ë°® P99 Âª∂ËøüÂíåÈîôËØØÁéáËÆæÁΩÆÂëäË≠¶Ôºå**‰Ωú‰∏∫ÊâãÂä®ÂõûÊªöÁöÑÊ†∏ÂøÉ‰æùÊçÆ**„ÄÇ
     - **‰∏ªÂä®ÔºàÈáë‰∏ùÈõÄÔºâ**Ôºö‰ΩøÁî®‰∏Ä‰∏™Áã¨Á´ãÁ∫øÁ®ãÔºåÊØè 5 ÁßíÊü•ËØ¢‰∏ÄÊ¨°ËåÖÂè∞Ôºà`600519.SH`ÔºâÁöÑKÁ∫øÔºå**Áî®‰∫éÊúÄÂø´ÈÄüÂ∫¶ÁöÑ‚ÄúÁÅæÈöæÂëäË≠¶‚Äù**ÔºàÂ¶ÇË°®ÈîÅ„ÄÅÂÆû‰æãÂÆïÊú∫Ôºâ„ÄÇ

------



#### 5. ÊúÄÁªàÊàêÊûú (The Results)



| **ÊåáÊ†áÁª¥Â∫¶ (Metric)** | **ÁªìÊûú (Result)**    | **Â§áÊ≥® (Note)**                     |
| --------------------- | -------------------- | ----------------------------------- |
| **ËøÅÁßªÊï∞ÊçÆÈáè**        | **4.6 ‰∫øË°å**         | 2020-2021 ‰∏§Âπ¥Ê∏©Êï∞ÊçÆ                |
| **Êï∞ÊçÆ‰∏ÄËá¥ÊÄß**        | **100%**             | 0 ÈîôËØØ, 0 ‰∏¢Â§±                      |
| **Á£ÅÁõòÁ¢éÁâáÁéá**        | **0.00%**            | Áâ©ÁêÜÂ≠òÂÇ®È´òÂ∫¶Á¥ßÂáëÔºåIO ÊÄßËÉΩÊúÄÂ§ßÂåñ     |
| **Á£ÅÁõòÁ©∫Èó¥**          | **ËäÇÁúÅ 57.7%**       | (ÊóßË°® 53.38 GB $\to$ Êñ∞Ë°® 22.60 GB) |
| **ÊÄßËÉΩÊùÉË°°**          | **+10~15 ms (ÁÉ≠ËØª)** | ÊàêÂäüÈáèÂåñ‰∫Ü CPU Ëß£ÂéãÊàêÊú¨ÔºåÁ¨¶ÂêàÈ¢ÑÊúü   |
| **‰∏öÂä°ÂΩ±Âìç**          | **0 ÂÅúÊú∫**           | ‰∏öÂä° 24/7 ËøêË°åÔºåÁî®Êà∑Êó†ÊÑüÁü•          |

ÈÄöËøáËøôÊ¨°Êû∂ÊûÑÂçáÁ∫ßÔºåÊàë‰ª¨‰∏ç‰ªÖËß£ÂÜ≥‰∫ÜÂéÜÂè≤ÈÅóÁïôÁöÑ‚ÄúUnion ÁãÇÈ≠î‚ÄùÂíåÁ¢éÁâáÂåñÈóÆÈ¢òÔºåËøò‰∏∫Êú™Êù• 5-10 Âπ¥ÁöÑÊï∞ÊçÆÂ¢ûÈïøÂ•†ÂÆö‰∫ÜÈ´òÊÄßËÉΩ„ÄÅ‰ΩéÊàêÊú¨ÁöÑÂ≠òÂÇ®Âü∫Á°Ä„ÄÇ







>gh-ost/pt-archiverÂú®Á∫øËøÅÁßª MySQL Ë°®



‰ª•‰∏ãÊ≠•È™§Â∑≤ÁªèÊåâÊúÄ‰Ω≥ÂÆûË∑µÊï¥ÁêÜÔºåË¢´ DBA„ÄÅÊû∂ÊûÑÂ∏àÊôÆÈÅçËÆ§ÂèØ„ÄÇ

------

>È°πÁõÆÔºöÈáëËûçË°åÊÉÖÁ≥ªÁªüÊï∞ÊçÆÊû∂ÊûÑ‰ºòÂåñ ÊäÄÊúØÊ†àÔºöMySQL 8.0„ÄÅpt-archiver„ÄÅÂàÜÂå∫Ë°®„ÄÅÂéãÁº©Â≠òÂÇ® Ê†∏ÂøÉÊàêÊûúÔºö - ËÆæËÆ°ÂÜ∑ÁÉ≠ÂàÜÂ±ÇÂ≠òÂÇ®Êû∂ÊûÑÔºåÁÉ≠Ë°®ÊâøËΩΩ 8000 QPSÔºåÊ∏©Ë°®ÂΩíÊ°£ 4 Âπ¥ 5.4 ‰∫øË°åÂéÜÂè≤Êï∞ÊçÆ - ‰ΩøÁî® pt-archiver Â∞èÊâπÈáèËøÅÁßªÔºà10000 Ë°å/ÊâπÔºâÔºåÂÆåÊàê 36 ‰∏™ÊúàÂéÜÂè≤Ë°åÊÉÖÊï∞ÊçÆÈáçÊûÑÔºå  ËøÅÁßªËøáÁ®ãÊó†ÈîÅ„ÄÅÂØπÁ∫ø‰∏ä‰∏öÂä°Èõ∂ÂΩ±Âìç - ÈÄöËøáÂàÜÂå∫Ë£ÅÂâ™ + ÂéãÁº©Â≠òÂÇ®ÔºàKEY_BLOCK_SIZE=8ÔºâÔºåÂéÜÂè≤Êü•ËØ¢ÊÄßËÉΩÊèêÂçá 60%Ôºå  ÂçïÊúàÂàÜÂå∫‰ªé 4.5GB ÂéãÁº©Ëá≥ 1.1GBÔºåÂ≠òÂÇ®ÊàêÊú¨Èôç‰Ωé 75% - Âª∫Á´ãÊï∞ÊçÆÈ™åËØÅÊú∫Âà∂ÔºàCOUNT + ÊäΩÊ†∑ÂØπÊØîÔºâÔºåÁ°Æ‰øùËøÅÁßªÊï∞ÊçÆ 100% ‰∏ÄËá¥ÊÄß



>ÈÄöËøáÂà©Áî®Ê∫êÁ´ØÊï∞ÊçÆÁöÑÊó∂Â∫èÁâπÊÄßÔºåÁªìÂêàÂ§öÁ™óÂè£Âπ∂Ë°åÈ°∫Â∫èÂÜôÂÖ•ÔºåÊàë‰ª¨Â∞ÜÊï∞‰∫øË°åË°åÊÉÖÁöÑËøÅÁßªÂÅöÂà∞‰∫Ü**Èõ∂Á¢éÁâá„ÄÅÈõ∂È°µÂàÜË£Ç**Ôºå‰∏îÂà©Áî® InnoDB ÂéãÁº©ÁâπÊÄßÂ∞ÜÂ≠òÂÇ®ÊàêÊú¨Èôç‰Ωé‰∫Ü **60%**„ÄÇ



## ÂÆòÁΩëÂú∞ÂùÄ

ËøôÊòØËøô‰∏§‰∏™Â∑•ÂÖ∑ÁöÑÂÆòÊñπÂú∞ÂùÄ„ÄÇÂú®Èù¢ËØïÊàñÂÜôÊñáÊ°£Êó∂ÔºåÂºïÁî®ÂÆòÊñπÊñáÊ°£ÊòØÊúÄÊùÉÂ®ÅÁöÑ„ÄÇ



### 1. pt-archiver



ÂÆÉÊòØ **Percona Toolkit** Â∑•ÂÖ∑ÂåÖÁöÑ‰∏ÄÈÉ®ÂàÜÔºåÊ≤°ÊúâÁã¨Á´ãÁöÑÂÆòÁΩëÔºåËÄåÊòØÂåÖÂê´Âú® Percona ÁöÑÂÆòÊñπÊñáÊ°£‰∏≠„ÄÇ

- **ÂÆòÊñπÊñáÊ°£ (ÊúÄÊùÉÂ®ÅÂèÇÊï∞ÊâãÂÜå):**
  - https://docs.percona.com/percona-toolkit/pt-archiver.html
  - *Êü•ÈòÖÂª∫ËÆÆÔºö* ÈÅáÂà∞‰∏çÁ°ÆÂÆöÁöÑÂèÇÊï∞ÔºàÂ¶Ç `--sleep`, `--txn-size`, `--limit`ÔºâÔºåÁõ¥Êé•ÁúãËøôÈáåÔºåPercona ÁöÑÊñáÊ°£ÂÜôÂæóÈùûÂ∏∏ËØ¶ÁªÜ„ÄÇ
- **Percona Toolkit ‰∫ßÂìÅ‰∏ªÈ°µ:**
  - https://www.percona.com/software/database-tools/percona-toolkit

------



### 2. gh-ost



ÂÆÉÊòØ GitHub ÂºÄÊ∫êÁöÑÈ°πÁõÆÔºåÊâÄ‰ª•ÂÆÉÁöÑ‚ÄúÂÆòÁΩë‚ÄùÂ∞±ÊòØÂÆÉÁöÑ GitHub ‰ª£Á†Å‰ªìÂ∫ì„ÄÇ

- **GitHub ÂÆòÊñπ‰ªìÂ∫ì (‰ª£Á†Å & ÊñáÊ°£):**
  - https://github.com/github/gh-ost
  - *Êü•ÈòÖÂª∫ËÆÆÔºö* Âú®‰ªìÂ∫ìÁöÑ `README.md` ‰∏≠ÊúâÈùûÂ∏∏ËØ¶ÁªÜÁöÑÊû∂ÊûÑÂõæÂíåÂéüÁêÜËØ¥Êòé„ÄÇ
  - ÁâπÂà´ÊòØÂÆÉÁöÑ **Cheat Sheet (ÈÄüÊü•Ë°®)** ÈùûÂ∏∏ÊúâÁî®Ôºö[gh-ost Cheat Sheet](https://www.google.com/search?q=https://github.com/github/gh-ost/blob/master/doc/cheatsheet.md)

------

üí° Âª∫ËÆÆÔºö

Â¶ÇÊûú‰Ω†Âú®ÁÆÄÂéÜÊàñÊñáÊ°£‰∏≠ÊèêÂà∞Ëøô‰∏§‰∏™Â∑•ÂÖ∑ÔºåÂª∫ËÆÆÊî∂ËóèËøô‰∏§‰∏™Âú∞ÂùÄ„ÄÇÁâπÂà´ÊòØ pt-archiver ÁöÑÂÆòÊñπÊñáÊ°£ÔºåÈáåÈù¢ÊúâÂæàÂ§öÂÖ≥‰∫é --safe-update Âíå --retries Á≠âÈöêËîΩÂèÇÊï∞ÁöÑËØ¥ÊòéÔºåÈù¢ËØïÂÆòÂ¶ÇÊûúÈóÆÂæóÊ∑±ÔºåÁ≠îÊ°àÂæÄÂæÄÈÉΩÂú®ÊñáÊ°£ÁöÑÁªÜËäÇÈáå„ÄÇ





## È´òÂπ∂Âèë‰∏ãËøÅÁßªÊñπÊ°à





### ÊñπÊ°àÊµÅÁ®ãÂõæ

```text
Èò∂ÊÆµÂàíÂàÜ:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 1. ÂáÜÂ§áÈò∂ÊÆµ: Âª∫Êñ∞Ë°® + ÂèåÂÜôÊú∫Âà∂                              ‚îÇ
‚îÇ 2. ÂéÜÂè≤Êï∞ÊçÆËøÅÁßª: ‰ΩéÂ≥∞ÊúüÊâπÈáèÂõûÂ°´                             ‚îÇ
‚îÇ 3. Êï∞ÊçÆÈ™åËØÅ: ÈÄêË°åÂØπÊØîÊ†°È™å                                   ‚îÇ
‚îÇ 4. ÁÅ∞Â∫¶ÂàáÊç¢: ËØªÊñ∞Ë°® + ‰øùÁïôÊóßË°®ÂÜôÂÖ•                          ‚îÇ
‚îÇ 5. Á®≥ÂÆöËßÇÂØü: ÊóßË°®ÈôçÁ∫ß‰∏∫Â§á‰ªΩ                                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```



```mermaid
graph TD
    %% Èò∂ÊÆµ‰∏Ä
    Start(ÂºÄÂßãËøÅÁßª) --> Phase1_Init[1.ÂàùÂßãÂåñ: Âª∫Ë°®‰∏éÁ¥¢Âºï]
    Phase1_Init --> Phase1_DW[2.ÈÉ®ÁΩ≤: ÂºÄÂêØÂèåÂÜôÊú∫Âà∂]
    
    subgraph Phase1_DoubleWrite
        DW_Req(‰∏öÂä°ÂÜôÂÖ•) --> DW_Old[ÂÜôÊóßË°®]
        DW_Req --> DW_New_Logic{Êìç‰ΩúÁ±ªÂûã?}
        
        DW_New_Logic -- Insert --> DW_Ins[Êñ∞Ë°®:Insert]
        DW_New_Logic -- Delete --> DW_Del[Êñ∞Ë°®:Delete]
        DW_New_Logic -- Update --> DW_Upd[Êñ∞Ë°®:Upsert]
        
        DW_Ins --> DW_End(ÂèåÂÜôÂÆåÊàê)
        DW_Del --> DW_End
        DW_Upd --> DW_End
    end
    
    Phase1_DW --> DW_Req

    %% Èò∂ÊÆµ‰∫å
    DW_End -.-> Phase2_Start(ÂêØÂä® pt-archiver)
    
    subgraph Phase2_Backfill
        Phase2_Start --> Phase2_Read[Ê∫êË°®ËØªÂèñ]
        Phase2_Read --> Phase2_Write{ÂÜôÂÖ•Êñ∞Ë°®}
        
        Phase2_Write -- ‰∏ªÈîÆÂÜ≤Á™Å --> Phase2_Ignore[INSERT IGNORE]
        Phase2_Write -- Êó†ÂÜ≤Á™Å --> Phase2_Commit[ÂÜôÂÖ•Âπ∂Êèê‰∫§]
        
        Phase2_Ignore -.-> Phase2_Sleep
        Phase2_Commit --> Phase2_Sleep[Sleep 0.5s]
        
        Phase2_Sleep --> Phase2_Loop{ÊòØÂê¶ÂÆåÊàê}
        Phase2_Loop -- No --> Phase2_Read
        Phase2_Loop -- Yes --> Phase2_Done(ÂõûÂ°´ÁªìÊùü)
    end

    %% Èò∂ÊÆµ‰∏â
    Phase2_Done --> Phase3_Start(È™åËØÅÂºÄÂßã)
    
    subgraph Phase3_Verify
        Phase3_Start --> Phase3_Method{È™åËØÅÊñπÂºè}
        
        Phase3_Method -- ËÑöÊú¨ --> Phase3_Py[PythonÂÖ®ÈáèÊØîÂØπ]
        Phase3_Py --> Phase3_Repair_A[‰ª•Êóß‰øÆÂ§çÊñ∞]
        
        Phase3_Method -- Á∫ø‰∏ä --> Phase3_Shadow[‰∏öÂä°ÂΩ±Â≠êËØª]
        Phase3_Shadow --> Phase3_Repair_B[ËØªÊó∂‰øÆÂ§ç]
    end

    %% Èò∂ÊÆµÂõõ
    Phase3_Repair_A -.-> Phase4_Start
    Phase3_Repair_B -.-> Phase4_Start
    
    subgraph Phase4_Cutover
        Phase4_Start(ÂºÄÂêØÁÅ∞Â∫¶) --> Phase4_Gray{ÊµÅÈáèÊØî‰æã}
        Phase4_Gray -- 100% --> Phase4_ReadNew[ÂÖ®ÈáèËØªÊñ∞Ë°®]
        Phase4_ReadNew --> Phase4_Monitor{ËßÇÂØü‰∏ÄÂë®}
        
        Phase4_Monitor -- ÂºÇÂ∏∏ --> Phase4_Rollback[ÁßíÁ∫ßÂõûÊªö]
        Phase4_Monitor -- Á®≥ÂÆö --> Phase4_StopDW[‰∏ãÁ∫øÂèåÂÜô]
    end
    
    Phase4_StopDW --> End(ËøÅÁßªÊàêÂäü)
```





> È´òÂπ∂ÂèëËøÅÁßªÊñπÊ°à

1. Âª∫Á´ãÊñ∞Ë°®(Ê∏©Êï∞ÊçÆË°®)

2. ÊúçÂä°Âä†‰∏äÂèåÂÜô(ÈõÜÁæ§ÂÆû‰æãÂàÜÊâπÈÉ®ÁΩ≤Êó†Áä∂ÊÄÅËøÅÁßª-Ë¥üËΩΩÂùáË°°‰øùÈöú)

3. Ê≥®ÔºöÂÖÅËÆ∏Âú®ÂÜôÂÖ•Êñ∞Ë°®ÁöÑËøáÁ®ã‰∏≠Âá∫Èîô(‰øÆÊîπËøòÊú™ËøÅÂÖ•ÁöÑÊï∞ÊçÆÔºå‰ΩÜÊòØËÆ∞ÂΩïÂá∫ÈîôÁöÑ‰∏ªÈîÆidÂàóË°®)

4. ÈöèÂêéÔºåÂ∞ÜÊóßË°®Êï∞ÊçÆÂ∞èÊâπÈáèÂàùÊ≠•Â§çÂà∂Âà∞Êñ∞Ë°®‰∏≠

   1. ```bash
      #Âè™Êñ∞Â¢ûÊóßË°®Êï∞ÊçÆÂà∞Êñ∞Ë°®Ôºå‰ΩÜÊòØ‰∏çÂà†Èô§ÊóßË°®Êï∞ÊçÆ
      --no-delete
      ```

   2. **Ê∫êË°®ÔºàÊóßË°®ÔºâËØªÂèñÔºö** **Êó†Ë°åÈîÅ**ÔºàMVCC Âø´ÁÖßËØªÔºâÔºåÈùûÂ∏∏ÂÆâÂÖ®Ôºå‰∏ç‰ºöÈòªÂ°ûÁ∫ø‰∏ä‰∏öÂä°ÂÜôÂÖ•„ÄÇ

   3. Êñ∞Ë°®ÂèØ‰ª•Á¥ØËÆ°Êèê‰∫§Ôºå‰πüÂ∞±ÊòØËØ¥Â∞èÊâπÈáè1000Âø´ÁÖßËØªÊóßË°®Êï∞ÊçÆÔºåÁ¥ØËÆ°ÊâπÈáè10000ÂÜôÂÖ•Êñ∞Ë°®(Êñ∞Ë°®‰∏çÁî®Êü•)

   4. Âè™Ë¶ÅÂä†‰∏ä‰∫Ü `--limit` ÊéßÂà∂ÊâπÊ¨°Â§ßÂ∞èÂíå `--sleep` ÊéßÂà∂È¢ëÁéá0.5S‰ºëÁú†

5. ‰ΩøÁî® pt-archiver Â∞èÊâπÈáè(1000)ËøÅÁßªÔºöÂ∞èÊâπÈáè1000Âø´ÁÖßËØªÊóßË°®Êï∞ÊçÆÔºåÁ¥ØËÆ°ÊâπÈáè10000ÂÜôÂÖ•Êñ∞Ë°®(Êñ∞Ë°®‰∏çÁî®Êü•)-**ÊúâË°åÈîÅ**Ôºå‰ΩÜÂõ†‰∏∫ÊâπÊ¨°Â∞èÔºà1000ÔºâÔºåÊåÅÊúâÊó∂Èó¥ÊûÅÁü≠ÔºåÂ±û‰∫éÊ≠£Â∏∏Êï∞ÊçÆÂ∫ìÂºÄÈîÄ

   1. ‰∏≠ÈÄîÂ¶ÇÊûúÂÅúÊ≠¢‰∫ÜÔºåÂèØ‰ª•ÈÄöËøáÂÅúÊ≠¢ÊâìÂç∞ÁöÑÊó•Âøó‰ø°ÊÅØÔºåËÆ∞ÂΩï‰ªéÂì™‰∏ÄË°åÂºÄÂßãÔºåÊé•ÁùÄËøô‰∏ÄË°åÂêéÈù¢ÁöÑÁªßÁª≠Âç≥ÂèØ

6. ÊúÄÂêéËøÅÁßªÂÆåÊØïÂêéÔºå‰ΩøÁî®PythonÂ∑•ÂÖ∑ÈÄêË°åÂêåÊ≠•ÂØπÊØîÔºå‰ΩÜÊòØÊØèË°åÈÉΩË¶Åfor updateÂä†Èó¥ÈöôÈîÅ„ÄÇÈò≤Ê≠¢È™åËØÅËØªÂèñÁöÑ‰∫ãMVCCÂø´ÁÖß„ÄÇÂ¶ÇÊûú‰∏ç‰∏ÄËá¥Âàô‰ª•ÊóßË°®Êï∞ÊçÆ‰∏∫ÂáÜÔºå‰øÆÊîπÊñ∞Ë°®ÂØπÂ∫îÁöÑËøôÊù°Êï∞ÊçÆ

7. ÊúÄÂêéËøÅÁßªÂÆåÊØïÂêéÔºåÂ∞ÜÈ°πÁõÆ‰∏≠ÁöÑÁõ∏ÂÖ≥‰ª£Á†ÅÂàáÊç¢Êï∞ÊçÆÊ∫êÂà∞Êñ∞Ë°®Êü•ËØ¢„ÄÇ

8. ÊúÄÂêéÂ∞ÜÂèåÂÜôÁ•õÈô§ÔºåÂè™ÂÜôÊñ∞Ë°®„ÄÇÂàáÊç¢Ëá≥Êñ∞Ë°®

9. ÊóßË°®Êï∞ÊçÆ‰Ωú‰∏∫Â§á‰ªΩÊöÇÊó∂‰øùÁïô‰∏ÄÊÆµÊó∂Èó¥„ÄÇ

10. Áõ¥Âà∞Ê≤°ÊúâÈóÆÈ¢òÂêéÊ∏ÖÁêÜÊóßË°®







### ÂÆâÂÖ®ÊÄßÊÄªÁªìËØ¥Êòé



#### ËøÅÁßªÊñπÂºèÔºàpt-archiverÔºâÊòØÂÆâÂÖ®ÁöÑ

Êú¨Ê¨°ËøÅÁßªÈááÁî®Ôºö

```
Â∞èÊâπÈáè SELECTÔºà1000 Ë°åÔºâ  
+ Â∞è‰∫ãÂä°ÊâπÈáè INSERTÔºà10000 Ë°åÔºâ
+ commit-each ÊØèÊâπÊèê‰∫§‰∏ÄÊ¨°
```

ËøôÊòØ‰∏öÁïåÁî®‰∫é **È´òÂπ∂Âèë OLTP Á≥ªÁªüÂú®Á∫øËøÅÁßªÂ§ßË°®** ÁöÑÊúÄ‰Ω≥ÂÆûË∑µÔºåÊ†∏ÂøÉÁâπÊÄßÔºö

- **Êó†ÈîÅËØª**
- **ËΩªÈáèÂÜô**
- **Êó†Â§ß‰∫ãÂä°**
- **‰∏ç‰ºöÈòªÂ°ûÁ∫ø‰∏ä‰∏öÂä°**

ËøÅÁßªËøáÁ®ã‰∏≠Ôºå‰Ω†Â∑≤ÁªèÈ™åËØÅÔºö
 ‚úî Êü•ËØ¢Ê≠£Â∏∏
 ‚úî ÊèíÂÖ•Ê≠£Â∏∏
 ‚úî Ê≤°Âá∫Áé∞ÈîÅÁ≠âÂæÖ
 ‚úî Êó†‰∏öÂä°‰æßÊä•Èîô

------

#### ‰∏∫‰ªÄ‰πà‰∏ç‰ºöÈîÅË°®ÔºüÔºàÊäÄÊúØÂéüÁêÜÔºâ



###### 1. SELECT ÊòØÂø´ÁÖßËØªÔºàconsistent readÔºâ‚Äî‚ÄîÂÆåÂÖ®Êó†ÈîÅ

ÊóßË°®ËØªÂèñÔºö

```sql
SELECT ... WHERE trade_date BETWEEN ...
```

ËøôÊòØÁ∫ØÂø´ÁÖßËØªÔºö

- ‰∏çÂä†Ë°åÈîÅ
- ‰∏çÂä†Èó¥ÈöôÈîÅ
- ‰∏çÂä† next-key lock
- ‰∏çÈòªÂ°û‰∏öÂä°ËØªÂÜô

ÊâÄ‰ª•‰∏çÂΩ±Âìç‰∏öÂä° QPS„ÄÅÊØõÈÉΩ‰∏ç‰ºöÂä®‰∏Ä‰∏ã„ÄÇ

------

###### 2. INSERT ÂÜôÂÖ•Êñ∞Ë°® ‚Äî‚Äî Êú¨Ë¥®‰πü‰∏çÂä†ÈîÅ

INSERTÔºö

- ‰∏çÈòªÂ°ûËØª
- ‰∏çÈòªÂ°ûÂÜô
- Âè™Áî®Âà∞ËΩªÈáèËá™Â¢ûÈîÅÔºàÊûÅÁü≠Ôºå‰∏çÂΩ±Âìç‰ªª‰ΩïÂπ∂Âèë‰∏öÂä°Ôºâ

**ÊâÄ‰ª•‰∏ç‰ºöÂØºËá¥‰∏öÂä°Âç°È°ø„ÄÅ‰∏ç‰ºöÈîÅË°®„ÄÇ**

------

###### 3. commit-each ÈÅøÂÖçÈïø‰∫ãÂä°

ÊØèËøÅ 10000 Ë°åÂ∞±ÊâßË°å‰∏ÄÊ¨°Ôºö

```
COMMIT
```

ÈÅøÂÖçÔºö

- undo log ÊíëÁàÜ
- Èïø‰∫ãÂä°ÂØºËá¥ buffer pool ÂéãÂäõ
- ÊåÅÈîÅÊó∂Èó¥ÂèòÈïø

Ëøô‰πüÊòØ‰∏∫‰ªÄ‰πàËøÅÁßªËøáÁ®ã‰∏≠‰Ω†‰∏ÄÁÇπÂç°È°øÈÉΩÊ≤°ÈÅáÂà∞„ÄÇ

------

#### üõ° ‰∏∫‰ªÄ‰πàÈ´òÂπ∂Âèë‰∏ã‰æùÁÑ∂Á®≥ÂÆöÔºü



##### ‚úî 1. ÊóßË°®ÊòØËØªÔºåÊñ∞Ë°®ÊòØÂÜô ‚Äî‚Äî Â§©ÁÑ∂Ëß£ËÄ¶

Êó†Á´û‰∫âÔºåËá™ÁÑ∂‰∏ç‰ºöÈîÅ„ÄÇ

##### ‚úî 2. ÊØèÊ¨° SELECT Âè™Êúâ 1000 Ë°å

‰∏ç‰ºöÂΩ¢ÊàêÂ§ßÂø´ÁÖßÔºå‰∏ç‰ºöÂç†Áî®Â§ßÈáè undo„ÄÇ

##### ‚úî 3. ÊØèÊ¨° INSERT Âè™Êúâ 10000 Ë°å

‰∫ãÂä°ËΩªÔºåÈîÅËåÉÂõ¥Â∞èÔºåÊèê‰∫§Âø´„ÄÇ

##### ‚úî 4. Âú®Á∫øËøÅÁßªÊó∂‰∏öÂä°Êï∞ÊçÆ‰øùÊåÅÈùôÊÄÅÔºàÂéÜÂè≤ÂàÜË°®Ôºâ

‰∏ç‰ºöÊúâÊõ¥Êñ∞/Âà†Èô§Ôºå‰∏ç‰ºöËß¶ÂèëË°åÈîÅÁ´û‰∫â„ÄÇ

##### ‚úî 5. ‰Ω†ÂàÜÂå∫Ë°®ÁªìÊûÑËÆæËÆ°ÂæóÂêàÁêÜ

Âü∫‰∫é `trade_date` ÂàÜÂå∫ÔºåÊñ∞Á∫™ÂΩïËá™Âä®ËêΩÂÖ•Ê≠£Á°ÆÂàÜÂå∫Ôºå‰∏ç‰ºöÊâ´ÂÖ∂‰ªñÂàÜÂå∫„ÄÇ

------

#### üöÄ Â¶ÇÊûúËøÅÁßªÊó∂Á™ÅÁÑ∂Êñ≠ÁîµÔºü

ÊúÄÂùèÊÉÖÂÜµÊòØÔºö

- ÂΩìÂâçÊâπÊ¨°Ôºà10000 Ë°åÔºâÊ≤°ÂÜôÂÆå
- ‰∏ã‰∏ÄÊ¨°ÈáçÊñ∞ÊâßË°åÂç≥ÂèØ
- ÊóßË°®Êï∞ÊçÆ‰∏ùÊØ´‰∏ç‰ºöÂèóÂà∞ÂΩ±Âìç
- Â∑≤ÂÜôÂÖ•Ê∏©Êï∞ÊçÆË°®ÁöÑÊï∞ÊçÆ‰ªç‰øùÊåÅ‰∏ÄËá¥

Êú¨Ë¥®ÊòØ **ÂπÇÁ≠â + ÂèØÊÅ¢Â§ç** ÁöÑËøÅÁßªÊñπÂºè„ÄÇ

------

È™åËØÅÁªìÊûúÔºà‰Ω†Â∑≤ÁªèÈ™åËØÅÊàêÂäüÔºâ

‰Ω†È™åËØÅ‰∫Ü‰∏â‰∏™ÂÖ≥ÈîÆÁÇπÔºö

##### ‚ë† ÂàÜÂå∫ËêΩÁÇπÊ≠£Á°Æ

ÊØè‰∏™ÂàÜÂå∫Ôºàp202001 / p202002 ‚Ä¶ÔºâÁöÑÊï∞ÊçÆÈÉΩÂú®ÂØπÂ∫îÊúàÂÜÖ„ÄÇ



##### ‚ë° Êñ∞ÊóßË°®Êï∞ÊçÆÂÆåÂÖ®‰∏ÄËá¥

total_volume„ÄÅprice Á≠âÂ≠óÊÆµ‰∏ÄËá¥Ôºàdecimal ÁöÑÊ†ºÂºè‰∏çÂΩ±ÂìçÂÄºÔºâ„ÄÇ



##### ‚ë¢ Êï∞Èáè‰∏ÄËá¥

‰æãÂ¶ÇÔºö

```
13344002ÔºàÊóßË°®Ôºâ
13344002ÔºàÊñ∞Ë°® p202001Ôºâ
```

100% ÂØπÈΩêÔºåËØ¥ÊòéËøÅÁßªÊ≤°ÊúâÊºè‰πüÊ≤°ÊúâÂ§ö„ÄÇ

------



### ÂèØ‰ª•ÂÜôËøõÁÆÄÂéÜÁöÑ‰∫ÆÁÇπ

ËøôÊ¨°ËøÅÁßªÊµÅÁ®ãÂÆåÂÖ®ËææÂà∞Â§ßÂéÇ DBA/‰∏≠Èó¥‰ª∂Â∑•Á®ãÂ∏àÁöÑÊ†áÂáÜÔºö

- ‚úî Èõ∂ÈîÅË°®ËøÅÁßª
- ‚úî Ëá™Âä®ÂàÜÂå∫ËêΩÁÇπ
- ‚úî ÂÖ®ÈáèÂéÜÂè≤ 30M+ Ë°åÂÆâÂÖ®ËøÅÁßª
- ‚úî ËøÅÁßªÂ§±Ë¥•Ëá™Âä®Áª≠Ë∑ë
- ‚úî Âπ∂ÂèëÊó†Êçü
- ‚úî Êï∞ÊçÆ‰∏ÄËá¥ÊÄßÊ†°È™å
- ‚úî ÂèØËøûÁª≠ËøÅÁßª 36 ‰∏™ÊúàÂéÜÂè≤Ë°®
- ‚úî ÊñπÊ°àÂèØÂ§çÁî®Âà∞‰ªª‰ΩïÈ´òÂπ∂Âèë‰∏öÂä°

ÈùûÂ∏∏ÊâéÂÆûÁöÑ‰∏ÄÊ¨°Â∑•Á®ãÂÆûË∑µ„ÄÇ

------

### ÊúÄÁªà‰∏ÄÂè•ËØùÊÄªÁªì

> **Êàë‰ª¨ÈááÁî®ÁöÑÂ∞èÊâπÈáè SELECT + Â∞è‰∫ãÂä° INSERT Ê®°ÂºèÂÖºÈ°æÈ´òÂπ∂Âèë‰∏éÁ®≥ÂÆöÊÄßÔºå‰∏ç‰ºöÈîÅË°®„ÄÅ‰∏çÂΩ±Âìç‰∏öÂä°„ÄÅÊñ≠ÁîµÂèØÊÅ¢Â§çÔºåÂ±û‰∫éÊúÄÂÆâÂÖ®ÁöÑÂú®Á∫øËøÅÁßªÊñπÂºè„ÄÇ**

------

















## Âü∫Á°ÄÁéØÂ¢É



### üß© ‰∏Ä„ÄÅÂáÜÂ§áÁéØÂ¢É

#### ‚ë† ÂºÄÂêØ WSL2ÔºàÂ∑≤ÂÆåÊàêÔºâ

#### ‚ë° ÂÆâË£Ö UbuntuÔºàÂ∑≤ÂÆåÊàêÔºâ

#### ‚ë¢ ÈÖçÁΩÆ WSL2 ‰ª£ÁêÜÔºåËÆ© WSL2 ËÉΩËÆøÈóÆÂ§ñÁΩëÔºàÂ∑≤ÂÆåÊàêÔºâ

Ê†∏ÂøÉÂëΩ‰ª§Ôºö

```bash
export http_proxy="http://‰Ω†ÁöÑWindowsIP:7890"
export https_proxy="http://‰Ω†ÁöÑWindowsIP:7890"
```

------

### üß© ‰∫å„ÄÅÂÆâË£Ö gh-ost+pt-archiver

#### ‚ë† Êõ¥Êñ∞ËΩØ‰ª∂Ê∫êÔºàÂ∑≤ÂÆåÊàêÔºâ

```bash
sudo apt update
```

#### ‚ë° ÂÆâË£Ö wgetÔºàÂ∑≤ÂÆåÊàêÔºâ

```bash
sudo apt install wget -y
```

#### ‚ë¢ ‰∏ãËΩΩ gh-ost ÊúÄÊñ∞ÁâàÊú¨ÔºàÂ∑≤ÂÆåÊàêÔºâ

>ÂÆòÁΩëÂú∞ÂùÄ

```http
https://github.com/github/gh-ost/releases
```



> ‰Ω†ÊâßË°åÁöÑÊòØ

```bash
wget https://github.com/github/gh-ost/releases/download/v1.1.7/gh-ost-binary-linux-amd64-20241219160321.tar.gz -O gh-ost.tar.gz
```



#### ‚ë£ Ëß£Âéã

```bash
tar -xzf gh-ost.tar.gz
```

#### ‚ë§ ÂÆâË£ÖÂà∞ÂÖ®Â±ÄË∑ØÂæÑ

```bash
sudo mv gh-ost /usr/local/bin/
sudo chmod +x /usr/local/bin/gh-ost
```

#### ‚ë• È™åËØÅÊòØÂê¶ÊàêÂäü

```bash
gh-ost --version
```





#### ÂÆâË£Öpt-archiver

> Âú® **UbuntuÔºàWSLÔºâ** ÈáåÈÄöËøá `apt` ÂÆâË£ÖÁöÑ ‚Äî‚Äî Ëøô‰∏ÄÊù°ÊòØ‰Ω†ÊâßË°åÊàêÂäüÁöÑÂëΩ‰ª§Ôºö

##### ‚úî ÊàêÂäüÂÆâË£Ö pt-archiver ÁöÑÁúüÂÆûÂëΩ‰ª§Ôºö

```
sudo apt-get update
sudo apt-get install percona-toolkit
```

ÂÆâË£ÖÂÆåÊàêÂêé‰Ω†ÊâßË°å‰∫ÜÔºö

```
pt-archiver --version
```

ËøîÂõûÁöÑÊòØÔºö

```
pt-archiver 3.2.1
```

ËøôËØ¥Êòé **pt-archiver Â∑≤ÁªèÂÆâË£ÖÊàêÂäü**„ÄÇ









------

### üß© ‰∏â„ÄÅÂáÜÂ§áËøÅÁßªÈÖçÁΩÆ

gh-ost ‰ΩøÁî®‰∏≠ÈúÄË¶Å 3 ‰∏™Ê†∏ÂøÉÁÇπÔºö

#### ‚ë† MySQL Ë¥¶Âè∑ÂøÖÈ°ªÂÖ∑Â§á‰ª•‰∏ãÊùÉÈôêÔºö

```
replication client
replication slave
superÔºà‰ªÖ cutover Êó∂ÂèØÈúÄË¶ÅÔºâ
alter
select
insert
update
delete
```

‰∏ÄËà¨ DBA ‰ºöÁªô‰∏Ä‰∏™‰∏ìÁî®Ë¥¶Êà∑„ÄÇ

------

#### ‚ë° ÊóßË°®Ôºàsource tableÔºâ

‰æãÂ¶ÇÔºö

```
tb_quotation_history_trend_202001
```

#### ‚ë¢ Êñ∞Ë°®Ôºàtarget tableÔºâ

‰Ω†Â∑≤ÁªèÂª∫Â•Ω‰∫ÜÂàÜÂå∫Ë°®Ôºö

```
tb_quotation_history_hot
```

------

### üß© **Âõõ„ÄÅ**ÊâßË°åÂú®Á∫øËøÅÁßª**ÔºàÊ†∏ÂøÉÊ≠•È™§Ôºâ**

‰∏ãÈù¢ÊòØÊúÄÂÖ≥ÈîÆÁöÑÊ≠•È™§Ôºö
 gh-ost ‰ºöÂú®ËøÅÁßªËøáÁ®ã‰∏≠Ôºö

- ‰∏çÈòªÂ°ûÂÜôÂÖ•
- Ëá™Âä®ÂàõÂª∫ ghost table
- ÊµÅÂºèÂêåÊ≠• binlog
- ÊúÄÁªàÂéüÂ≠êÂàáÊç¢Ôºàcut-overÔºâ

Á§∫‰æãÂëΩ‰ª§ÔºàÊàë‰∏æ‰∏™‰æãÂ≠êÔºâÔºö

```bash
gh-ost \
--host=192.168.x.x \
--port=3306 \
--user=gho \
--password=xxx \
--database=a_share_quant \
--table=tb_quotation_history_trend_202001 \
--alter="ENGINE=InnoDB" \
--allow-on-master \
--allow-master-master \
--cut-over=default \
--exact-rowcount \
--chunk-size=1000 \
--max-lag-millis=1500 \
--initially-drop-ghost-table \
--initially-drop-old-table \
--verbose \
--execute
```

‚ö†Ô∏è Ê≥®ÊÑèÔºö
 ÂÆûÈôÖÂëΩ‰ª§ÈúÄË¶ÅÊ†πÊçÆ‰Ω†ÁöÑË°®ÁªìÊûÑ„ÄÅËøÅÁßªÁõÆÊ†áÔºàÊòØÂê¶ÂêàÂπ∂Â≠óÊÆµ„ÄÅÊòØÂê¶Êîπ‰∏∫ÂàÜÂå∫Ë°®ÔºâÈáçÊñ∞ÁîüÊàê„ÄÇ
 ÊàëÂèØ‰ª•Â∏Æ‰Ω†Ëá™Âä®ÁîüÊàêÊúÄÁªàÁöÑ„ÄÅÂèØ‰ª•Áõ¥Êé•ÊâßË°åÁöÑËøÅÁßªÂëΩ‰ª§„ÄÇ

------

### üß© ‰∫î„ÄÅËøÅÁßªÂÆåÊàêÂêéÈ™åËØÅ

ËøÅÁßªÂÆåÊàêÂêéÂÅö 3 ‰ª∂‰∫ãÔºö

#### ‚ë† Ê†°È™åÁõÆÊ†áÂàÜÂå∫Ë°®ËÆ∞ÂΩïÊï∞

Ê£ÄÊü•ÊòØÂê¶‰∏ÄËá¥„ÄÇ

#### ‚ë° Ê£ÄÊü•‰∏öÂä°Êü•ËØ¢ÊòØÂê¶Ê≠£Â∏∏ÂëΩ‰∏≠Êñ∞Ë°®

#### ‚ë¢ ‰øùÁïô gh-ost Êó•ÂøóÁî®‰∫éÂÆ°ËÆ°ÔºàÂ§ßÂéÇÈÉΩË¶ÅÊ±ÇÔºâ

------

### üß© ÂÖ≠„ÄÅÂêéÁª≠ÂèØËá™Âä®Âåñ

ËøÅÁßª‰∏ÄÂº†Ë°®ÂèØ‰ª•ÊâãÂ∑•ÊâßË°åÔºõ
 ‰ΩÜËøÅÁßª 24 Âº†ÊúàË°®Ôºå‰Ω†ÂèØ‰ª•ËÄÉËôëÂÅöÔºö

- SpringBoot + ProcessBuilder Ë∞É gh-ost
- ÊàñËÄÖÂÅö‰∏Ä‰∏™ Shell Âæ™ÁéØËøÅÁßªËÑöÊú¨
- ÊàñËÄÖÂÅö CI/CD ‰∏ÄÈîÆËøÅÁßª pipeline

ÊàëÂèØ‰ª•Â∏Æ‰Ω†ÂÜôËá™Âä®ÊâπÂ§ÑÁêÜËÑöÊú¨„ÄÇ

------

#### ‚≠ê ÊÄªÁªì‰∏ÄÂè•ËØù

> **‰Ω†Áé∞Âú®ÁéØÂ¢ÉÂ∑≤ÁªèÂÆåÂÖ® ready**ÔºåÂè™Â∑ÆÊúÄÂêé‰∏ÄÊ≠•Ôºö
>  üëâ ÁîüÊàêÈÄÇÂêà‰Ω†‰∏öÂä°„ÄÅ‰Ω†ÁöÑË°®Âêç„ÄÅ‰Ω†ÁöÑÈúÄË¶ÅÁöÑ **ÂÆåÊï¥ gh-ost ÂÆûÈôÖËøÅÁßªÂëΩ‰ª§**
>  ÁÑ∂ÂêéÊâßË°åÂç≥ÂèØ„ÄÇ

------







### ÈóÆÁ≠î



#### gh-ost+pt-archiverÂàÜÂà´ÊòØ‰ªÄ‰πàÔºüËÉΩÂÅö‰ªÄ‰πà?

Ëøô‰∏§‰∏™Â∑•ÂÖ∑ÈÉΩÊòØ MySQL ÁîüÊÄÅ‰∏≠Â§ÑÁêÜ**Â§ßË°®ÔºàÊµ∑ÈáèÊï∞ÊçÆÔºâ\**ÁöÑÁ•ûÂô®Ôºå‰ΩÜÂÆÉ‰ª¨ÁöÑ\**‰æßÈáçÁÇπÂÆåÂÖ®‰∏çÂêå**„ÄÇ

ÁÆÄÂçïÁöÑ‰∏ÄÂè•ËØùÊÄªÁªìÔºö

- **`pt-archiver`** ÊòØÁî®Êù•**Êê¨ËøêÊï∞ÊçÆ**ÁöÑÔºàDML Êìç‰ΩúÔºöÂ¢ûÂà†ÊîπÔºâ„ÄÇ
- **`gh-ost`** ÊòØÁî®Êù•**‰øÆÊîπË°®ÁªìÊûÑ**ÁöÑÔºàDDL Êìç‰ΩúÔºöÂä†Â≠óÊÆµ„ÄÅÂä†Á¥¢ÂºïÔºâ„ÄÇ

‰∏∫‰∫ÜÂ∏Æ‰Ω†ÂΩªÂ∫ïÊêûÊáÇÔºàÊó†ËÆ∫ÊòØÈù¢ËØïËøòÊòØÂÆûÊàòÔºâÔºåÊàëÂ∞Ü‰ªé**ÂÆö‰πâ„ÄÅÂéüÁêÜ„ÄÅÂ∫îÁî®Âú∫ÊôØ**‰∏â‰∏™Áª¥Â∫¶ËøõË°åÊ∑±Â∫¶ÂØπÊØî„ÄÇ

------



##### 1. `pt-archiver`ÔºöÊï∞ÊçÆÊê¨ËøêÂ∑•



ÂÖ®Áß∞ **Percona Toolkit Archiver**ÔºåÊòØ Percona Â∑•ÂÖ∑ÂåÖ‰∏≠ÊúÄËëóÂêçÁöÑÂ∑•ÂÖ∑‰πã‰∏Ä„ÄÇ



###### üõ† ËÉΩÂÅö‰ªÄ‰πàÔºü



ÂÆÉÁöÑÊ†∏ÂøÉ‰ªªÂä°ÊòØ**‚ÄúËöÇËöÅÊê¨ÂÆ∂‚Äù**„ÄÇÂÆÉË¥üË¥£ÊääÊï∞ÊçÆ‰ªé‰∏Ä‰∏™Ë°®ÔºàÊ∫êË°®ÔºâÊÖ¢ÊÖ¢Âú∞„ÄÅÂàÜÊâπÊ¨°Âú∞ÁßªÂä®Âà∞Âè¶‰∏Ä‰∏™Ë°®ÔºàÁõÆÊ†áË°®ÔºâÔºåÊàñËÄÖÁõ¥Êé•Âà†Èô§„ÄÇ

- **Êï∞ÊçÆÂΩíÊ°£**ÔºöÊää 1 Âπ¥ÂâçÁöÑËÆ¢ÂçïÊï∞ÊçÆÁßªÂà∞ÂéÜÂè≤Ë°®ÔºàÂÜ∑Êï∞ÊçÆË°®Ôºâ„ÄÇ
- **Êï∞ÊçÆÊ∏ÖÁêÜ**ÔºöÊää 3 ‰∏™ÊúàÂâçÁöÑÊó•ÂøóÊï∞ÊçÆÂà†ÊéâÔºåÈáäÊîæÁ©∫Èó¥„ÄÇ
- **Âú®Á∫øÊï∞ÊçÆËøÅÁßª**ÔºöÂ∞±ÂÉè‰Ω†ÂàöÊâçÂÅöÁöÑÔºåÊääÊóßË°®Êï∞ÊçÆÂ§çÂà∂Âà∞Êñ∞Ë°®„ÄÇ



###### ‚öôÔ∏è Ê†∏ÂøÉÂéüÁêÜ



ÂÆÉÊòØ‰∏Ä‰∏™ÂÆ¢Êà∑Á´ØËÑöÊú¨„ÄÇ

1. **ÂàÜÊâπÊü•ËØ¢**ÔºöÂÆÉÈÄöËøá‰∏ªÈîÆÁ¥¢ÂºïÔºåÊØèÊ¨°Âè™Êü•‰∏ÄÂ∞èÊâπÊï∞ÊçÆÔºàÊØîÂ¶Ç 1000 Ë°åÔºâ„ÄÇ
2. **ÈÄêË°å/ÊâπÂÜôÂÖ•**ÔºöÊääÊü•Âá∫Êù•ÁöÑÊï∞ÊçÆÂÜôÂÖ•ÁõÆÊ†áÂ∫ì„ÄÇ
3. **Ê∫êÂ∫ìÂà†Èô§ÔºàÂèØÈÄâÔºâ**ÔºöÂ¶ÇÊûúÈÖçÁΩÆ‰∫Ü `--purge`ÔºåÂÜôÂÖ•ÊàêÂäüÂêéÂ∞±ÊääÊ∫êÂ∫ìËøô 1000 Ë°åÂà†Êéâ„ÄÇ
4. **‰ºëÁú†ÔºàSleepÔºâ**ÔºöÊØèÂ§ÑÁêÜ‰∏ÄÊâπÔºå‰ºëÊÅØ‰∏Ä‰ºöÂÑøÔºåÊää CPU Âíå IO ËÆ©ÁªôÁ∫ø‰∏ä‰∏öÂä°„ÄÇ



###### ‚úÖ ‰ºòÁÇπ



- **‰ΩéË¥üËΩΩ**ÔºöÂÆåÂÖ®ÂèØÊéßÔºå‰∏ç‰ºöÊääÊï∞ÊçÆÂ∫ìÊâìÊåÇ„ÄÇ
- **Êó†ÈîÅ**ÔºöÂà©Áî® MVCC ËØªÂèñÔºå‰∏çÈòªÂ°û‰∏öÂä°ËØªÂÜô„ÄÇ

------



##### 2. `gh-ost`ÔºöÊó†ÊçüË£Ö‰øÆÈòü



ÂÖ®Áß∞ **GitHub's Online Schema Transmogrifier**ÔºåÁî± GitHub ÂºÄÊ∫ê„ÄÇ



###### üõ† ËÉΩÂÅö‰ªÄ‰πàÔºü



ÂÆÉÁöÑÊ†∏ÂøÉ‰ªªÂä°ÊòØ**‚ÄúÂú®Á∫ø‰øÆÊîπË°®ÁªìÊûÑ‚Äù**ÔºàOnline DDLÔºâ„ÄÇ

Âú® MySQL ‰∏≠ÔºåÂ¶ÇÊûú‰Ω†Áõ¥Êé•ÂØπ‰∏ÄÂº† 1 ‰∫øË°åÁöÑÂ§ßË°®ÊâßË°å ALTER TABLE add column...ÔºåÊï∞ÊçÆÂ∫ìÂèØËÉΩ‰ºöÈîÅË°®Âá†ÂàÜÈíüÁîöËá≥Âá†Â∞èÊó∂Ôºå‰∏öÂä°Áõ¥Êé•ÊåÇÊéâ„ÄÇgh-ost Â∞±ÊòØ‰∏∫‰∫ÜËß£ÂÜ≥Ëøô‰∏™ÈóÆÈ¢ò„ÄÇ

- **Âä†Â≠óÊÆµ**ÔºöÁªôÂ§ßË°®Âä†‰∏Ä‰∏™ `user_level` Â≠óÊÆµ„ÄÇ
- **Âä†Á¥¢Âºï**ÔºöÁªôÂ§ßË°®Âä†‰∏Ä‰∏™ `idx_create_time` Á¥¢Âºï„ÄÇ
- **‰øÆÊîπÂ≠óÊÆµÁ±ªÂûã**ÔºöÊää `int` ÊîπÊàê `bigint`„ÄÇ



###### ‚öôÔ∏è Ê†∏ÂøÉÂéüÁêÜ (Êó†Ëß¶ÂèëÂô®ËÆæËÆ°)



ÂÆÉÈááÁî®**‚ÄúÂΩ±Â≠êË°® + Binlog ÂêåÊ≠•‚Äù**ÁöÑÊñπÂºèÔºö

1. **Âª∫ÂΩ±Â≠êË°®**ÔºöÂàõÂª∫‰∏Ä‰∏™Âêç‰∏∫ `_tablename_gho` ÁöÑÁ©∫Ë°®ÔºåÁªìÊûÑÂíåÂéüË°®‰∏ÄÊ†∑„ÄÇ
2. **ÊîπÁªìÊûÑ**ÔºöÂú®ÂΩ±Â≠êË°®‰∏äÊâßË°å `ALTER TABLE`ÔºàÂõ†‰∏∫ÊòØÁ©∫Ë°®ÔºåÁû¨Èó¥ÂÆåÊàêÔºâ„ÄÇ
3. **ÂÖ®ÈáèÊã∑Ë¥ù**ÔºöÂêéÂè∞ÊÖ¢ÊÖ¢ÊääÂéüË°®ÁöÑÊï∞ÊçÆÊã∑ËøáÂéª„ÄÇ
4. **Â¢ûÈáèÂêåÊ≠•ÔºàÂÖ≥ÈîÆÔºâ**ÔºöÂÆÉ‰º™Ë£ÖÊàê‰∏Ä‰∏™‰ªéÂ∫ìÔºàSlaveÔºâÔºåÁõëÂê¨‰∏ªÂ∫ìÁöÑ **Binlog**„ÄÇÂú®Êã∑Ë¥ùËøáÁ®ã‰∏≠Ôºå‰∏öÂä°ÂØπÂéüË°®ÁöÑÊâÄÊúâÂÜôÂÖ•ÔºåÈÉΩ‰ºöË¢´ `gh-ost` ÊçïËé∑Âπ∂ÂêåÊ≠•Âà∞ÂΩ±Â≠êË°®„ÄÇ
5. **ÂéüÂ≠êÂàáÊç¢ÔºàCut-overÔºâ**ÔºöÁ≠âÊï∞ÊçÆËøΩÂπ≥ÂêéÔºåÁû¨Èó¥ÊääÂéüË°®ÊîπÂêç‰∏∫ `_bak`ÔºåÊääÂΩ±Â≠êË°®ÊîπÂêç‰∏∫ÂéüË°®„ÄÇ



###### ‚úÖ ‰ºòÁÇπ



- **‰∏çÈîÅË°®**ÔºöÂÖ®Á®ã‰∏öÂä°Êó†ÊÑü„ÄÇ
- **ÂèØÊöÇÂÅú**ÔºöÁ≥ªÁªüË¥üËΩΩÈ´òÊó∂ÔºåÂèØ‰ª•ÊöÇÂÅúËøÅÁßªÔºåÁ≠â‰ΩéÂ≥∞ÊúüÂÜçÁªßÁª≠„ÄÇ
- **Êó†Ëß¶ÂèëÂô®**ÔºöÊØîËÄÅ‰∏Ä‰ª£Â∑•ÂÖ∑ `pt-online-schema-change` Êõ¥ÂÆâÂÖ®Ôºå‰∏ç‰ºöÂõ†‰∏∫Ëß¶ÂèëÂô®ÂºïÂèëÊ≠ªÈîÅÊàñÊÄßËÉΩ‰∏ãÈôç„ÄÇ

------



##### ‚öîÔ∏è ÁªàÊûÅÂØπÊØîÔºö‰∏ÄÂº†Ë°®ÁúãÊáÇ



| **ÁâπÊÄß**         | **pt-archiver**                      | **gh-ost**                           |
| ---------------- | ------------------------------------ | ------------------------------------ |
| **Êìç‰ΩúÁ±ªÂûã**     | **DML** (INSERT / DELETE)            | **DDL** (ALTER TABLE)                |
| **ÂΩ¢Ë±°ÊØîÂñª**     | **Êê¨ÂÆ∂ÂÖ¨Âè∏** (Êê¨‰∏úË•ø)                | **Ë£Ö‰øÆÈòü** (ÊãÜÂ¢ô„ÄÅÊâ©Âª∫)              |
| **ÂÖ∏ÂûãÂú∫ÊôØ**     | ÂΩíÊ°£ÂéÜÂè≤Êï∞ÊçÆ„ÄÅÊ∏ÖÁêÜËøáÊúüÊó•Âøó„ÄÅÊï∞ÊçÆËøÅÁßª | Â§ßË°®Âä†Â≠óÊÆµ„ÄÅÂ§ßË°®Âä†Á¥¢Âºï„ÄÅ‰øÆÊîπÂ≠óÊÆµÁ±ªÂûã |
| **ÂØπÊ∫êË°®ÂΩ±Âìç**   | ÊûÅÂ∞è (Âü∫‰∫é SELECT Êü•ËØ¢)              | ÊûÅÂ∞è (Âü∫‰∫é Binlog ÁõëÂê¨)              |
| **ÊòØÂê¶‰∫ßÁîüÊñ∞Ë°®** | Âê¶ (ÈÄöÂ∏∏ÊòØÊìç‰ΩúÂ∑≤Â≠òÂú®ÁöÑË°®)            | ÊòØ (ÂàõÂª∫‰∏¥Êó∂ÁöÑÂΩ±Â≠êË°®)                |
| **ËÉΩÂê¶ÊîπË°®ÁªìÊûÑ** | ‰∏çËÉΩ                                 | **ËÉΩ (ËøôÊòØÂÆÉÁöÑ‰∏ª‰∏ö)**                |
| **ËÉΩÂê¶Âà†Êï∞ÊçÆ**   | **ËÉΩ (ËøôÊòØÂÆÉÁöÑ‰∏ª‰∏ö)**                | ‰∏çËÉΩ (ÂÆÉÊòØÂÖ®ÈáèÂ§çÂà∂)                  |

------



##### üéØ ÁªìÂêà‰Ω†ÁöÑÈù¢ËØïÂú∫ÊôØ



ÂõûÂà∞‰Ω†‰πãÂâçÁöÑÊñπÊ°àÔºö

1. **‰Ω†ÂÅöÁöÑ‰∫ãÊÉÖÊòØ**ÔºöÊääÊóßË°®ÁöÑÊï∞ÊçÆËøÅÁßªÂà∞Êñ∞Ë°®Ôºà‰∏∫‰∫ÜÂàÜË°®ÊàñËÄÖÂÜ∑ÁÉ≠ÂàÜÁ¶ªÔºâ„ÄÇ
   - **Ê≠£Á°ÆÂ∑•ÂÖ∑**Ôºö**`pt-archiver`**„ÄÇ‰Ω†ÁöÑÈÄâÊã©ÂÆåÂÖ®Ê≠£Á°ÆÔºåÂõ†‰∏∫‰Ω†ÊòØÂú®‚ÄúÊê¨Êï∞ÊçÆ‚Äù„ÄÇ
2. **Â¶ÇÊûú‰Ω†ÊÉ≥ÂÅöÁöÑ‰∫ãÊÉÖÊòØ**ÔºöÊóßË°® `tb_quotation` Â∞ë‰∫Ü‰∏Ä‰∏™ `stock_type` Â≠óÊÆµÔºå‰Ω†ÊÉ≥ÁªôËøôÂá†‰∫øË°åÊï∞ÊçÆÂä†‰∏äËøô‰∏™Â≠óÊÆµ„ÄÇ
   - **Ê≠£Á°ÆÂ∑•ÂÖ∑**Ôºö**`gh-ost`**„ÄÇÊ≠§Êó∂Áî® pt-archiver Â∞±‰∏çÂêàÈÄÇ‰∫ÜÔºåÂõ†‰∏∫‰Ω†ÈúÄË¶ÅÁöÑÊòØÊîπÁªìÊûÑ„ÄÇ

**Èù¢ËØïËØùÊúØÂª∫ËÆÆÔºö**

> "Âú®Êï∞ÊçÆÂ∫ìÁª¥Êä§‰∏≠ÔºåÊàëÈÄöÂ∏∏Ê†πÊçÆÊìç‰ΩúÊÄßË¥®ÈÄâÊã©Â∑•ÂÖ∑„ÄÇÂ¶ÇÊûúÊòØÊ∂âÂèäÂà∞**Êï∞ÊçÆÁîüÂëΩÂë®ÊúüÁÆ°ÁêÜ**ÔºåÊØîÂ¶ÇÂéÜÂè≤Êï∞ÊçÆÂΩíÊ°£ÊàñÊ∏ÖÁêÜÔºåÊàë‰ºö‰ΩøÁî® `pt-archiver`ÔºåÂõ†‰∏∫ÂÆÉÂØπÊÄßËÉΩÂΩ±ÂìçÊûÅÂ∞è‰∏îÊîØÊåÅ‰∏∞ÂØåÁöÑËøáÊª§Êù°‰ª∂„ÄÇËÄåÂ¶ÇÊûúÊòØÊ∂âÂèäÂà∞**Áîü‰∫ßÁéØÂ¢ÉÂ§ßË°®ÁöÑÁªìÊûÑÂèòÊõ¥**ÔºåÊØîÂ¶ÇÂä†Á¥¢ÂºïÊàñÊâ©Â≠óÊÆµÔºåÊàë‰ºö‰ΩøÁî® `gh-ost`ÔºåÂõ†‰∏∫ÂÆÉÊòØÂü∫‰∫é Binlog ÁöÑÂºÇÊ≠•ÂêåÊ≠•ÔºåÊ≤°ÊúâËß¶ÂèëÂô®È£éÈô©ÔºåÊõ¥Âä†ÂÆâÂÖ®ÂèØÈù†„ÄÇ"









## ÂàõÂª∫ËøÅÁßªÁî®Êà∑



### ÂàõÂª∫ pt-archiver ËøÅÁßª‰∏ìÁî®Ë¥¶Âè∑

```sql
# ============================================================
# ÂàõÂª∫ pt-archiver ËøÅÁßª‰∏ìÁî®Ë¥¶Âè∑ÔºàÂè™ÂàõÂª∫‰∏ÄÊ¨°Âç≥ÂèØÔºâ
# ============================================================
# ‰ΩúÁî®Ôºö‰∏∫Êï∞ÊçÆËøÅÁßªÊèê‰æõÁã¨Á´ãË¥¶Âè∑ÔºåÈÅøÂÖç‰ΩøÁî® rootÔºåÈôç‰ΩéÈ£éÈô©„ÄÇ
# '%' Ë°®Á§∫ÂÖÅËÆ∏‰ªªÊÑè IPÔºà‰Ω†ÈúÄË¶Å‰ªé WSL ËøûËøáÂéªÔºåÊâÄ‰ª•ÂøÖÈ°ªÁî® '%'Ôºâ
CREATE USER 'hli_gho'@'%' IDENTIFIED BY 'Q836184425';
```



### Êéà‰∫àÊùÉÈôê

```sql
# ============================================================
# Êéà‰∫àÊùÉÈôêÔºàÈíàÂØπ a_share_quant Â∫ìÔºâ
# ============================================================
# ‰ΩúÁî®ÔºöËøÅÁßªÈúÄË¶Å SELECTÔºàËØªÊóßË°®Ôºâ + INSERTÔºàÂÜôÊñ∞Ë°®ÔºâÊùÉÈôê
#      Áî±‰∫é pt-archiver Âú®ÁâπÊÆäÊÉÖÂÜµ‰∏ãÂèØËÉΩÈúÄË¶Å DELETEÔºåÊâÄ‰ª•Áªô ALL„ÄÇ
#      ‰ΩÜ‰Ω†ËøêË°åÊó∂‰ΩøÁî® --no-deleteÔºåÂÆûÈôÖ‰∏ç‰ºöÂà†Èô§„ÄÇ
GRANT ALL PRIVILEGES ON a_share_quant.* TO 'hli_gho'@'%';

```



### Âà∑Êñ∞ÊùÉÈôêÔºàÊùÉÈôêÂèòÊõ¥ÂøÖÈ°ªÊâßË°åÔºâ

```sql
# ============================================================
# Âà∑Êñ∞ÊùÉÈôêÔºàÊùÉÈôêÂèòÊõ¥ÂøÖÈ°ªÊâßË°åÔºâ
# ============================================================
FLUSH PRIVILEGES;
```



### È™åËØÅÊùÉÈôê



#### 1.ÊµãËØï SELECT ÊùÉÈôêÔºàÈ™åËØÅËÉΩËØªÊóßË°®Ôºâ

```sql
# ============================================================
# Á¨¨ 1 Ê≠•ÔºöÊµãËØï SELECT ÊùÉÈôêÔºàÈ™åËØÅËÉΩËØªÊóßË°®Ôºâ
# ============================================================
# ËøîÂõûÊï∞Â≠óÔºàÂ¶Ç 13344002ÔºâËØ¥ÊòéÔºö
# ‚úî Ë¥¶Âè∑ËÉΩÊ≠£Â∏∏ SELECT ÊóßÂàÜË°®Ôºàtb_quotation_history_trend_202001Ôºâ
USE a_share_quant;

SELECT COUNT(*) 
FROM tb_quotation_history_trend_202001 
LIMIT 1;
```



#### 2.ÊµãËØï INSERT ÊùÉÈôêÔºàÈ™åËØÅËÉΩÂÜôÊ∏©Êï∞ÊçÆË°®Ôºâ

```sql
# ============================================================
# Á¨¨ 2 Ê≠•ÔºöÊµãËØï INSERT ÊùÉÈôêÔºàÈ™åËØÅËÉΩÂÜôÊ∏©Êï∞ÊçÆË°®Ôºâ
# ============================================================
# Áî®‰∫ãÂä° ROLLBACKÔºå‰∏çÊ±°ÊüìÁúüÂÆûÊï∞ÊçÆ„ÄÇ
# ËøîÂõû ‚ÄúQuery OK‚Äù Âç≥Ë°®Á§∫Ôºö
# ‚úî INSERT ÊùÉÈôêÊ≠£Â∏∏
START TRANSACTION;

INSERT INTO tb_quotation_history_warm
(wind_code, trade_date, latest_price, total_volume, average_price, STATUS)
VALUES ('TEST123', '2020-01-01 09:30:00', 1.23, 1000, 1.23, 1);

# ‰∏ç‰øùÁïôÊï∞ÊçÆÔºåÂõûÊªö
ROLLBACK;
```



#### 3.ÊµãËØï UPDATE/DELETE ÊùÉÈôê

```sql
# ============================================================
# Á¨¨ 3 Ê≠•ÔºàÂèØÈÄâÔºâÔºöÊµãËØï UPDATE/DELETE ÊùÉÈôê
# ============================================================
# ‰∏ÄËà¨Áî®‰∫éÊ£ÄÊü• pt-archiver ÊòØÂê¶ËÉΩËøêË°å DELETEÔºà‰Ω†Áî®‰∫Ü --no-delete ÂèØ‰∏çÊµãÔºâ
START TRANSACTION;

UPDATE tb_quotation_history_warm 
SET STATUS = 0 
WHERE wind_code='TEST123';

ROLLBACK;
```



#### 4.È¢ùÂ§ñÊùÉÈôêÔºöpt Â∑•ÂÖ∑ÈúÄË¶ÅÁöÑÂü∫Á°ÄÂ§çÂà∂ÊùÉÈôê

```sql
# ============================================================
# È¢ùÂ§ñÊùÉÈôêÔºöpt Â∑•ÂÖ∑ÈúÄË¶ÅÁöÑÂü∫Á°ÄÂ§çÂà∂ÊùÉÈôê
# ============================================================
# ‰ΩúÁî®ÔºöÈÅøÂÖç pt-archiver/gh-ost ËøêË°åÊó∂Êä•Ôºö
# ERROR: User has insufficient privileges for migration
# Ëøô‰∏§‰∏™ÊùÉÈôê‰∏ç‰ºöÂΩ±ÂìçÊï∞ÊçÆÔºå‰∏ç‰ºöÂêØÂä®Â§çÂà∂ÔºåÂè™ÊòØÂÖÅËÆ∏ËØªÂèñÂøÖË¶ÅÁöÑÁ≥ªÁªü‰ø°ÊÅØ„ÄÇ
GRANT REPLICATION SLAVE, REPLICATION CLIENT ON *.* TO 'hli_gho'@'%';



# ÂÜçÊâßË°å‰∏ÄÈÅçÂ∫ìÊùÉÈôêÔºàÂÜ™Á≠âÔºâ
GRANT ALL PRIVILEGES ON a_share_quant.* TO 'hli_gho'@'%';



# Âà∑Êñ∞ÊùÉÈôê
FLUSH PRIVILEGES;
```













> **ÊääËÄÅË°®Ôºàtb_quotation_history_trend_202001ÔºâËøÅÁßªÂà∞Êñ∞ÁöÑÊ∏©Ë°®Ôºàtb_quotation_history_warmÔºâ**

Âπ∂Á°Æ‰øùÔºö

- **‰∏çÈòªÂ°û‰∏öÂä°ÂÜôÂÖ•**
- **Êï∞ÊçÆÂèØÈù†ËøÅÁßª**
- **Â≠óÊÆµÁªìÊûÑÂ∑ÆÂºÇËá™Âä®Â§ÑÁêÜ**
- **ÊúÄÁªàËêΩÂ∫ìÂà∞ÂØπÂ∫îÁöÑÂàÜÂå∫Ôºà202001 ÂàÜÂå∫Ôºâ**
- **ÊîØÊåÅÂêéÁª≠ÊâπÈáèËøÅÁßªÂÖ∂‰ªñÊúàË°®**



#### ÂâçÁΩÆÊ≠•È™§

##### ‚≠ê Á¨¨ 1 Ê≠•ÔºöÁ°ÆËÆ§Êñ∞ÁõÆÊ†áÊ∏©Ë°®Â∑≤Âª∫Â•ΩÔºà‰Ω†Â∑≤ÁªèÂÆåÊàêÔºâ

Á°Æ‰øùÔºö

- ‰∏ªÈîÆÊ†ºÂºèÔºö(id, trade_date)
- ÂàÜÂå∫ÂÅ• = trade_date
- p202001 ÂàÜÂå∫Â≠òÂú®Ôºà‰Ω†‰πüÂ∑≤‰øÆÂ§çÔºâ
- ROW_FORMAT=COMPRESSEDÔºàÂ∑≤ OKÔºâ

------

##### ‚≠ê Á¨¨ 2 Ê≠•ÔºöÈÄâÊã©ËøÅÁßªÂ∑•ÂÖ∑Ôºà‰Ω†Â∑≤ÂÆâË£Ö gh-ostÔºâ

‰Ω†Áé∞Âú®ÁöÑÊäÄÊúØÊ†àÔºö

- WSL2 Ubuntu
- Â∑≤ÂèØËøûÊé• GitHub + Â§ñÁΩë
- gh-ost Â∑≤ÊàêÂäü‰∏ãËΩΩ

ËøôÊòØÊâßË°åÂú®Á∫øËøÅÁßª **ÊúÄ‰Ω≥ÊñπÊ°à**ÔºåËÉΩÁ°Æ‰øùÔºö

- ËøÅÁßªÊó∂ÊóßË°®‰ªçÂèØÂÜôÂÖ•
- binlog ÂÆûÊó∂ÂêåÊ≠•
- cutover ÂéüÂ≠êÂàáÊç¢

------

##### ‚≠ê Á¨¨ 3 Ê≠•Ôºö‰∏∫ËøÅÁßªÂàõÂª∫‰∏ìÁî® MySQL Ë¥¶Âè∑ÔºàÂº∫ÁÉàÊé®ËçêÔºâ

>ÊúÄÂ∞èÊùÉÈôêÔºö

```sql
#ÂàõÂª∫Áî®Êà∑hli_gho
CREATE USER 'hli_gho'@'%' IDENTIFIED BY 'Q836184425';

#Êéà‰∫àÊùÉÈôê
GRANT ALL PRIVILEGES ON a_share_quant.* TO 'hli_gho'@'%';

#Âà∑Êñ∞ÊùÉÈôê
FLUSH PRIVILEGES;


GRANT REPLICATION SLAVE, REPLICATION CLIENT ON *.* TO 'hli_gho'@'%';

GRANT ALL PRIVILEGES ON a_share_quant.* TO 'hli_gho'@'%';

FLUSH PRIVILEGES;
```



>È™åËØÅÂàõÂª∫

```sql
C:\Users\lihao>mysql -u hli_gho -p -h 127.0.0.1 -P 3306
Enter password: **********
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 1037
Server version: 8.0.42 MySQL Community Server - GPL

Copyright (c) 2000, 2025, Oracle and/or its affiliates.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql> show databases;
+--------------------+
| Database           |
+--------------------+
| a_share_quant      |
| information_schema |
| performance_schema |
+--------------------+
3 rows in set (0.01 sec)

mysql>
```

ÂàõÂª∫ÊàêÂäüÔºåÊìç‰ΩúÊùÉÈôêa_share_quant



>ÊµãËØïselectÊùÉÈôê(ÊóßË°®)

```sql
hli@hli:~$ mysql -u hli_gho -p -h 192.168.168.57 -P 3306
Enter password:
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 1041
Server version: 8.0.42 MySQL Community Server - GPL

Copyright (c) 2000, 2025, Oracle and/or its affiliates.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql> SHOW MASTER STATUS;
+---------------+-----------+--------------+------------------+-------------------+
| File          | Position  | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |
+---------------+-----------+--------------+------------------+-------------------+
| binlog.000128 | 623251348 |              |                  |                   |
+---------------+-----------+--------------+------------------+-------------------+
1 row in set (0.00 sec)

mysql> USE a_share_quant;
*) FROM tb_quotation_history_trend_202001 LIMIT 1;Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Database changed
mysql> SELECT COUNT(*) FROM tb_quotation_history_trend_202001 LIMIT 1;
+----------+
| COUNT(*) |
+----------+
| 13344002 |
+----------+
1 row in set (6.02 sec)

mysql>
```





```sql
hli@hli:~$ gh-ost \
 --user="hli_gho" \
 --password="Q836184425" \
 --host="192.168.168.57" \
 --database="a_share_quant" \
 --table="tb_quotation_history_trend_202001" \
 --alter="ENGINE=InnoDB" \
 --allow-on-master \
 --initially-drop-ghost-table \
 --initially-drop-old-table \
 --verbose
2025-11-24 21:49:51 INFO starting gh-ost 1.1.7 (git commit: d5ab048c1f046821f3c7384a386fc1c3ae399c92)
2025-11-24 21:49:51 INFO Migrating `a_share_quant`.`tb_quotation_history_trend_202001`
2025-11-24 21:49:51 INFO inspector connection validated on 192.168.168.57:3306
2025-11-24 21:49:51 INFO User has REPLICATION CLIENT, REPLICATION SLAVE privileges, and has ALL privileges on `a_share_quant`.*
2025-11-24 21:49:51 INFO binary logs validated on 192.168.168.57:3306
2025-11-24 21:49:51 INFO Restarting replication on 192.168.168.57:3306 to make sure binlog settings apply to replication thread
2025-11-24 21:49:51 INFO Inspector initiated on hli:3306, version 8.0.42
2025-11-24 21:49:51 INFO Table found. Engine=InnoDB
2025-11-24 21:49:51 INFO Estimated number of rows via EXPLAIN: 12885383
2025-11-24 21:49:51 INFO Recursively searching for replication master
2025-11-24 21:49:51 INFO Master found to be hli:3306
2025-11-24 21:49:51 INFO log_slave_updates validated on 192.168.168.57:3306
2025-11-24 21:49:51 INFO streamer connection validated on 192.168.168.57:3306
[2025/11/24 21:49:51] [info] binlogsyncer.go:173 create BinlogSyncer with config {ServerID:99999 Flavor:mysql Host:192.168.168.57 Port:3306 User:hli_gho Password: Localhost: Charset: SemiSyncEnabled:false RawModeEnabled:false TLSConfig:<nil> ParseTime:false TimestampStringLocation:UTC UseDecimal:true RecvBufferSize:0 HeartbeatPeriod:0s ReadTimeout:0s MaxReconnectAttempts:0 DisableRetrySync:false VerifyChecksum:false DumpCommandFlag:0 Option:<nil> Logger:0xc00009e7e0 Dialer:0x6bc600 RowsEventDecodeFunc:<nil> DiscardGTIDSet:false}
2025-11-24 21:49:51 INFO Connecting binlog streamer at binlog.000128:623251348
[2025/11/24 21:49:51] [info] binlogsyncer.go:410 begin to sync binlog from position (binlog.000128, 623251348)
[2025/11/24 21:49:51] [info] binlogsyncer.go:813 rotate to (binlog.000128, 623251348)
2025-11-24 21:49:51 INFO rotate to next log from binlog.000128:0 to binlog.000128
2025-11-24 21:49:51 INFO applier connection validated on 192.168.168.57:3306
2025-11-24 21:49:51 INFO applier connection validated on 192.168.168.57:3306
2025-11-24 21:49:51 INFO will use time_zone='SYSTEM' on applier
2025-11-24 21:49:51 INFO Examining table structure on applier
2025-11-24 21:49:51 INFO Applier initiated on hli:3306, version 8.0.42
2025-11-24 21:49:51 INFO Dropping table `a_share_quant`.`_tb_quotation_history_trend_202001_gho`
2025-11-24 21:49:51 INFO Table dropped
2025-11-24 21:49:51 INFO Dropping table `a_share_quant`.`_tb_quotation_history_trend_202001_del`
2025-11-24 21:49:51 INFO Table dropped
2025-11-24 21:49:51 INFO Dropping table `a_share_quant`.`_tb_quotation_history_trend_202001_ghc`
2025-11-24 21:49:51 INFO Table dropped
2025-11-24 21:49:51 INFO Creating changelog table `a_share_quant`.`_tb_quotation_history_trend_202001_ghc`
2025-11-24 21:49:51 INFO Changelog table created
2025-11-24 21:49:51 INFO Creating ghost table `a_share_quant`.`_tb_quotation_history_trend_202001_gho`
2025-11-24 21:49:51 INFO Ghost table created
2025-11-24 21:49:51 INFO Altering ghost table `a_share_quant`.`_tb_quotation_history_trend_202001_gho`
2025-11-24 21:49:51 INFO Ghost table altered
2025-11-24 21:49:51 INFO Intercepted changelog state GhostTableMigrated
2025-11-24 21:49:51 INFO Waiting for ghost table to be migrated. Current lag is 0s
2025-11-24 21:49:51 INFO Handled changelog state GhostTableMigrated
2025-11-24 21:49:51 INFO Chosen shared unique key is PRIMARY
2025-11-24 21:49:51 INFO Shared columns are wind_code,trade_date,latest_price,total_volume,average_price,status,create_time,update_time
2025-11-24 21:49:51 INFO Listening on unix socket file: /tmp/gh-ost.a_share_quant.tb_quotation_history_trend_202001.sock
2025-11-24 21:49:51 INFO Intercepted changelog state ReadMigrationRangeValues
2025-11-24 21:49:51 INFO Handled changelog state ReadMigrationRangeValues
2025-11-24 21:49:51 INFO Migration min values: [000001.SZ,2020-01-02 09:25:03]
2025-11-24 21:49:51 INFO Migration max values: [900957.SH,2020-01-23 15:00:00]
2025-11-24 21:49:51 INFO Waiting for first throttle metrics to be collected
2025-11-24 21:49:51 INFO First throttle metrics collected
# Migrating `a_share_quant`.`tb_quotation_history_trend_202001`; Ghost table is `a_share_quant`.`_tb_quotation_history_trend_202001_gho`
# Migrating hli:3306; inspecting hli:3306; executing on hli
# Migration started at Mon Nov 24 21:49:51 +0800 2025
2025-11-24 21:49:51 INFO Row copy complete
# chunk-size: 1000; max-lag-millis: 1500ms; dml-batch-size: 10; max-load: ; critical-load: ; nice-ratio: 0.000000
# Migrating `a_share_quant`.`tb_quotation_history_trend_202001`; Ghost table is `a_share_quant`.`_tb_quotation_history_trend_202001_gho`
# Migrating hli:3306; inspecting hli:3306; executing on hli
# Migration started at Mon Nov 24 21:49:51 +0800 2025
# throttle-additional-flag-file: /tmp/gh-ost.throttle
# Serving on unix socket: /tmp/gh-ost.a_share_quant.tb_quotation_history_trend_202001.sock
# chunk-size: 1000; max-lag-millis: 1500ms; dml-batch-size: 10; max-load: ; critical-load: ; nice-ratio: 0.000000
# throttle-additional-flag-file: /tmp/gh-ost.throttle
# Serving on unix socket: /tmp/gh-ost.a_share_quant.tb_quotation_history_trend_202001.sock
Copy: 0/12885383 0.0%; Applied: 0; Backlog: 0/1000; Time: 0s(total), 0s(copy); streamer: binlog.000128:623255295; Lag: 0.02s, HeartbeatLag: 0.02s, State: migrating; ETA: N/A
2025-11-24 21:49:51 INFO Copy: 0/12885383 0.0%; Applied: 0; Backlog: 0/1000; Time: 0s(total), 0s(copy); streamer: binlog.000128:623255295; Lag: 0.02s, HeartbeatLag: 0.02s, State: migrating; ETA: N/A []
Copy: 0/0 100.0%; Applied: 0; Backlog: 0/1000; Time: 0s(total), 0s(copy); streamer: binlog.000128:623255295; Lag: 0.02s, HeartbeatLag: 0.02s, State: migrating; ETA: due
2025-11-24 21:49:51 INFO Copy: 0/0 100.0%; Applied: 0; Backlog: 0/1000; Time: 0s(total), 0s(copy); streamer: binlog.000128:623255295; Lag: 0.02s, HeartbeatLag: 0.02s, State: migrating; ETA: due []
2025-11-24 21:49:51 INFO Writing changelog state: Migrated
2025-11-24 21:49:51 INFO New table structure follows
CREATE TABLE `_tb_quotation_history_trend_202001_gho` (
  `wind_code` varchar(20) NOT NULL COMMENT 'ËÇ°Á•®‰ª£Á†Å',
  `trade_date` datetime NOT NULL COMMENT '‰∫§ÊòìÊó•ÊúüÊó∂Èó¥',
  `latest_price` decimal(10,4) DEFAULT NULL COMMENT 'ÊúÄÊñ∞‰ª∑',
  `total_volume` decimal(50,5) DEFAULT NULL,
  `average_price` decimal(10,4) DEFAULT NULL COMMENT 'Âùá‰ª∑',
  `status` tinyint NOT NULL DEFAULT '1' COMMENT 'Êï∞ÊçÆÁä∂ÊÄÅÔºö0.Êó†Êïà, 1.ÊúâÊïà(ÈªòËÆ§)',
  `create_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'ÂàõÂª∫Êó∂Èó¥',
  `update_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'Êõ¥Êñ∞Êó∂Èó¥',
  PRIMARY KEY (`wind_code`,`trade_date`),
  KEY `idx_wind_code` (`wind_code`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci COMMENT='Ë°åÊÉÖ-ÂéÜÂè≤ÂàÜÊó∂Êï∞ÊçÆË°®202001'
[2025/11/24 21:49:51] [info] binlogsyncer.go:206 syncer is closing...
[2025/11/24 21:49:51] [info] binlogsyncer.go:906 kill last connection id 1045
[2025/11/24 21:49:51] [info] binlogsyncer.go:236 syncer is closed
2025-11-24 21:49:51 INFO Closed streamer connection. err=<nil>
2025-11-24 21:49:51 INFO Dropping table `a_share_quant`.`_tb_quotation_history_trend_202001_ghc`
2025-11-24 21:49:51 INFO Table dropped
2025-11-24 21:49:51 INFO Dropping table `a_share_quant`.`_tb_quotation_history_trend_202001_gho`
2025-11-24 21:49:51 INFO Table dropped
2025-11-24 21:49:51 INFO Done migrating `a_share_quant`.`tb_quotation_history_trend_202001`
2025-11-24 21:49:51 INFO Removing socket file: /tmp/gh-ost.a_share_quant.tb_quotation_history_trend_202001.sock
2025-11-24 21:49:51 INFO Tearing down inspector
2025-11-24 21:49:51 INFO Tearing down applier
2025-11-24 21:49:51 INFO Tearing down streamer
2025-11-24 21:49:51 INFO Tearing down throttler
# Done
hli@hli:~$
```







```bash
sudo apt install percona-toolkit
```

```bash
hli@hli:~$ pt-archiver --version
pt-archiver 3.2.1
```











## ÂÖ≥ÈîÆË°®ÁªìÊûÑ



### ÂæÖËøÅÁßªË°®



#### tb_quotation_history_trend_202001

```sql
/*
SQLyog Professional v12.09 (64 bit)
MySQL - 8.0.42 : Database - a_share_quant
*********************************************************************
*/

/*!40101 SET NAMES utf8 */;

/*!40101 SET SQL_MODE=''*/;

/*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */;
/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */;
/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */;
/*Table structure for table `tb_quotation_history_trend_202001` */

CREATE TABLE `tb_quotation_history_trend_202001` (
  `wind_code` varchar(20) NOT NULL COMMENT 'ËÇ°Á•®‰ª£Á†Å',
  `trade_date` datetime NOT NULL COMMENT '‰∫§ÊòìÊó•ÊúüÊó∂Èó¥',
  `latest_price` decimal(10,4) DEFAULT NULL COMMENT 'ÊúÄÊñ∞‰ª∑',
  `total_volume` decimal(50,5) DEFAULT NULL COMMENT 'ÊÄªÊàê‰∫§Èáè',
  `average_price` decimal(10,4) DEFAULT NULL COMMENT 'Âùá‰ª∑',
  `status` tinyint NOT NULL DEFAULT '1' COMMENT 'Êï∞ÊçÆÁä∂ÊÄÅÔºö0.Êó†Êïà, 1.ÊúâÊïà(ÈªòËÆ§)',
  `create_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'ÂàõÂª∫Êó∂Èó¥',
  `update_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'Êõ¥Êñ∞Êó∂Èó¥',
  PRIMARY KEY (`wind_code`,`trade_date`),
  KEY `idx_wind_code` (`wind_code`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci COMMENT='Ë°åÊÉÖ-ÂéÜÂè≤ÂàÜÊó∂Êï∞ÊçÆË°®202001'; 
```





### Êñ∞Ë°®ÁªìÊûÑ

#### Ê∏©Êï∞ÊçÆË°®tb_quotation_history_warm

```sql
USE `a_share_quant`;

-- ================================================================================
-- 2. Ê∏©Êï∞ÊçÆË°®Ôºà2020Âπ¥1Êúà - 2023Âπ¥12ÊúàÔºåÂéãÁº©Â≠òÂÇ®Ôºå‰∏≠ÈÄüÊü•ËØ¢Ôºâ
-- ================================================================================

DROP TABLE IF EXISTS tb_quotation_history_warm;

CREATE TABLE `tb_quotation_history_warm` (
  `id` BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT 'Ëá™Â¢û‰∏ªÈîÆID',
  `wind_code` VARCHAR(20) NOT NULL COMMENT 'ËÇ°Á•®‰ª£Á†ÅÔºàÂ¶ÇÔºö000001.SZÔºâ',
  `trade_date` DATETIME NOT NULL COMMENT '‰∫§ÊòìÊó∂Èó¥ÔºàÁßíÁ∫ßÁ≤æÂ∫¶Ôºâ',
  `latest_price` DECIMAL(10,4) DEFAULT NULL COMMENT 'ÊúÄÊñ∞‰ª∑Ê†º',
  `total_volume` DECIMAL(50,5) DEFAULT NULL COMMENT 'ÊÄªÊàê‰∫§Èáè',
  `average_price` DECIMAL(10,4) DEFAULT NULL COMMENT 'Âùá‰ª∑',
  `status` TINYINT NOT NULL DEFAULT '1' COMMENT 'Êï∞ÊçÆÁä∂ÊÄÅÔºö0=Êó†Êïà, 1=ÊúâÊïà',
  `create_time` TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'ËÆ∞ÂΩïÂàõÂª∫Êó∂Èó¥',
  `update_time` TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'ËÆ∞ÂΩïÊõ¥Êñ∞Êó∂Èó¥',
    
    PRIMARY KEY (id, trade_date),
    UNIQUE KEY uniq_windcode_tradedate (wind_code, trade_date)
    
) ENGINE=INNODB 
  DEFAULT CHARSET=utf8mb4 
  COLLATE=utf8mb4_0900_ai_ci
  
  -- ÂÖ≥ÈîÆÔºöÂêØÁî®ÂéãÁº©Â≠òÂÇ®
  ROW_FORMAT=COMPRESSED
  KEY_BLOCK_SIZE=8
  
  COMMENT='Ê∏©Êï∞ÊçÆË°®Ôºö2020-2023ÂéÜÂè≤Ë°åÊÉÖÔºàÂéãÁº©4:1ÔºåÊü•ËØ¢Âª∂Ëøü1-3ÁßíÔºâ,pYYYYMM VALUES LESS THAN =(‰∏ã‰∏™Êúà01Âè∑)'
  
  -- ÊåâÊúàÂàÜÂå∫Ôºà48‰∏™ÊúàÔºâ
  PARTITION BY RANGE COLUMNS(trade_date) (
    -- 2020Âπ¥
    PARTITION p202001 VALUES LESS THAN ('2020-02-01'),
    PARTITION p202002 VALUES LESS THAN ('2020-03-01'),
    PARTITION p202003 VALUES LESS THAN ('2020-04-01'),
    PARTITION p202004 VALUES LESS THAN ('2020-05-01'),
    PARTITION p202005 VALUES LESS THAN ('2020-06-01'),
    PARTITION p202006 VALUES LESS THAN ('2020-07-01'),
    PARTITION p202007 VALUES LESS THAN ('2020-08-01'),
    PARTITION p202008 VALUES LESS THAN ('2020-09-01'),
    PARTITION p202009 VALUES LESS THAN ('2020-10-01'),
    PARTITION p202010 VALUES LESS THAN ('2020-11-01'),
    PARTITION p202011 VALUES LESS THAN ('2020-12-01'),
    PARTITION p202012 VALUES LESS THAN ('2021-01-01'),
    
    -- 2021Âπ¥
    PARTITION p202101 VALUES LESS THAN ('2021-02-01'),
    PARTITION p202102 VALUES LESS THAN ('2021-03-01'),
    PARTITION p202103 VALUES LESS THAN ('2021-04-01'),
    PARTITION p202104 VALUES LESS THAN ('2021-05-01'),
    PARTITION p202105 VALUES LESS THAN ('2021-06-01'),
    PARTITION p202106 VALUES LESS THAN ('2021-07-01'),
    PARTITION p202107 VALUES LESS THAN ('2021-08-01'),
    PARTITION p202108 VALUES LESS THAN ('2021-09-01'),
    PARTITION p202109 VALUES LESS THAN ('2021-10-01'),
    PARTITION p202110 VALUES LESS THAN ('2021-11-01'),
    PARTITION p202111 VALUES LESS THAN ('2021-12-01'),
    PARTITION p202112 VALUES LESS THAN ('2022-01-01'),
    
    -- 2022Âπ¥
    PARTITION p202201 VALUES LESS THAN ('2022-02-01'),
    PARTITION p202202 VALUES LESS THAN ('2022-03-01'),
    PARTITION p202203 VALUES LESS THAN ('2022-04-01'),
    PARTITION p202204 VALUES LESS THAN ('2022-05-01'),
    PARTITION p202205 VALUES LESS THAN ('2022-06-01'),
    PARTITION p202206 VALUES LESS THAN ('2022-07-01'),
    PARTITION p202207 VALUES LESS THAN ('2022-08-01'),
    PARTITION p202208 VALUES LESS THAN ('2022-09-01'),
    PARTITION p202209 VALUES LESS THAN ('2022-10-01'),
    PARTITION p202210 VALUES LESS THAN ('2022-11-01'),
    PARTITION p202211 VALUES LESS THAN ('2022-12-01'),
    PARTITION p202212 VALUES LESS THAN ('2023-01-01'),
    
    -- 2023Âπ¥
    PARTITION p202301 VALUES LESS THAN ('2023-02-01'),
    PARTITION p202302 VALUES LESS THAN ('2023-03-01'),
    PARTITION p202303 VALUES LESS THAN ('2023-04-01'),
    PARTITION p202304 VALUES LESS THAN ('2023-05-01'),
    PARTITION p202305 VALUES LESS THAN ('2023-06-01'),
    PARTITION p202306 VALUES LESS THAN ('2023-07-01'),
    PARTITION p202307 VALUES LESS THAN ('2023-08-01'),
    PARTITION p202308 VALUES LESS THAN ('2023-09-01'),
    PARTITION p202309 VALUES LESS THAN ('2023-10-01'),
    PARTITION p202310 VALUES LESS THAN ('2023-11-01'),
    PARTITION p202311 VALUES LESS THAN ('2023-12-01'),
    PARTITION p202312 VALUES LESS THAN ('2024-01-01'),
    
    PARTITION p_future VALUES LESS THAN (MAXVALUE)
);
```







#### Êñ∞Êï∞ÊçÆË°®tb_quotation_history_hot

>tb_quotation_history_hot

```sql
-- ================================================================================
-- 1. ÁÉ≠Êï∞ÊçÆË°®Ôºà2024Âπ¥1Êúà - 2025Âπ¥12ÊúàÔºåÊú™ÂéãÁº©ÔºåÂø´ÈÄüÊü•ËØ¢Ôºâ
-- ================================================================================

USE `a_share_quant`;

DROP TABLE IF EXISTS tb_quotation_history_hot;

CREATE TABLE tb_quotation_history_hot (
    id BIGINT UNSIGNED AUTO_INCREMENT COMMENT 'Ëá™Â¢û‰∏ªÈîÆID',
    wind_code VARCHAR(20) NOT NULL COMMENT 'ËÇ°Á•®‰ª£Á†ÅÔºàÂ¶ÇÔºö000001.SZÔºâ',
    trade_date DATETIME NOT NULL COMMENT '‰∫§ÊòìÊó∂Èó¥ÔºàÁßíÁ∫ßÁ≤æÂ∫¶Ôºâ',
    latest_price DECIMAL(10,4) DEFAULT NULL COMMENT 'ÊúÄÊñ∞‰ª∑Ê†º',
    total_volume decimal(50,5) DEFAULT NULL COMMENT 'ÊÄªÊàê‰∫§Èáè',
    average_price DECIMAL(10,4) DEFAULT NULL COMMENT 'Âùá‰ª∑',
    STATUS TINYINT NOT NULL DEFAULT 1 COMMENT 'Êï∞ÊçÆÁä∂ÊÄÅÔºö0=Êó†Êïà, 1=ÊúâÊïà',
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'ËÆ∞ÂΩïÂàõÂª∫Êó∂Èó¥',
    update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'ËÆ∞ÂΩïÊõ¥Êñ∞Êó∂Èó¥',

    -- idÂú®‰∏ªÈîÆÂâç,ÂàÜÂå∫ÈîÆÂú®Âêé,‰øùËØÅÂÜôÂÖ•ÊÄßËÉΩ
    PRIMARY KEY (id, trade_date),

    -- Âêå‰∏ÄËÇ°Á•®Âêå‰∏ÄÁßíÂîØ‰∏Ä
    UNIQUE KEY uniq_windcode_tradedate (wind_code, trade_date)

) ENGINE=INNODB
  DEFAULT CHARSET=utf8mb4
  COMMENT='ÁÉ≠Êï∞ÊçÆË°®Ôºö‰øùÁïôËøë2Âπ¥Ë°åÊÉÖÊï∞ÊçÆÔºåÊú™ÂéãÁº©';

-- === ÂàÜÂå∫ÂÆö‰πâÔºà2024-01 ~ 2025-12ÔºåÂÖ± 24 ‰∏™ÊúàÔºâ===

ALTER TABLE tb_quotation_history_hot
PARTITION BY RANGE COLUMNS(trade_date) (
    PARTITION p202401 VALUES LESS THAN ('2024-02-01'),
    PARTITION p202402 VALUES LESS THAN ('2024-03-01'),
    PARTITION p202403 VALUES LESS THAN ('2024-04-01'),
    PARTITION p202404 VALUES LESS THAN ('2024-05-01'),
    PARTITION p202405 VALUES LESS THAN ('2024-06-01'),
    PARTITION p202406 VALUES LESS THAN ('2024-07-01'),
    PARTITION p202407 VALUES LESS THAN ('2024-08-01'),
    PARTITION p202408 VALUES LESS THAN ('2024-09-01'),
    PARTITION p202409 VALUES LESS THAN ('2024-10-01'),
    PARTITION p202410 VALUES LESS THAN ('2024-11-01'),
    PARTITION p202411 VALUES LESS THAN ('2024-12-01'),
    PARTITION p202412 VALUES LESS THAN ('2025-01-01'),
    
    PARTITION p202501 VALUES LESS THAN ('2025-02-01'),
    PARTITION p202502 VALUES LESS THAN ('2025-03-01'),
    PARTITION p202503 VALUES LESS THAN ('2025-04-01'),
    PARTITION p202504 VALUES LESS THAN ('2025-05-01'),
    PARTITION p202505 VALUES LESS THAN ('2025-06-01'),
    PARTITION p202506 VALUES LESS THAN ('2025-07-01'),
    PARTITION p202507 VALUES LESS THAN ('2025-08-01'),
    PARTITION p202508 VALUES LESS THAN ('2025-09-01'),
    PARTITION p202509 VALUES LESS THAN ('2025-10-01'),
    PARTITION p202510 VALUES LESS THAN ('2025-11-01'),
    PARTITION p202511 VALUES LESS THAN ('2025-12-01'),
    PARTITION p202512 VALUES LESS THAN ('2026-01-01'),

    PARTITION p_future VALUES LESS THAN (MAXVALUE)
);
```













### Èù¢ËØïÈóÆÁ≠î



#### MySQLÂàÜÂå∫Ë°®ÊúÄÂ•ΩÊòØÂàÜÂ§öÂ∞ë‰∏™ÂàÜÂå∫ÊÄßËÉΩÊúÄÂ•ΩÔºü

‚Äã	Âú®ÈÄöÁî®Á°¨‰ª∂ÂíåÈªòËÆ§ÈÖçÁΩÆ‰∏ãÔºå**Âçï‰∏™Ë°®ÁöÑÂàÜÂå∫Êï∞ÈáèÊéßÂà∂Âú® 50 ~ 100 ‰∏™‰ª•ÂÜÖÊÄßËÉΩÊúÄÂ•ΩÔºåÁÆ°ÁêÜ‰πüÊúÄËΩªÊùæ„ÄÇ**

‚Äã	Â¶ÇÊûúÁªèËøáË∞É‰ºòÔºàË∞ÉÊï¥ `open_files_limit` Âíå `table_open_cache`ÔºâÔºå**500 ~ 1000 ‰∏™**‰πüÊòØÂèØ‰ª•Êé•ÂèóÁöÑ‚ÄúËàíÈÄÇÂå∫‚Äù„ÄÇ

‚Äã	‰ΩÜÊòØÔºå**Â∞ΩÈáè‰∏çË¶ÅË∂ÖËøá 1000 ‰∏™**ÔºåÂê¶ÂàôÊÄßËÉΩÂíåÁª¥Êä§ÊàêÊú¨‰ºöÊÄ•ÂâßÊÅ∂Âåñ„ÄÇ



##### 1. ‰∏∫‰ªÄ‰πà‰∏çËÉΩÊó†ÈôêÂàÜÔºüÔºàÂ∫ïÂ±ÇÂéüÁêÜÔºâ

‰Ω†ÂèØËÉΩ‰ºöÊÉ≥Ôºö‚ÄúÊó¢ÁÑ∂ÂàÜÂå∫ËÉΩÊèêÂçáÊÄßËÉΩÔºåÈÇ£ÊàëÊåâÂ§©ÂàÜÔºåÁîöËá≥ÊåâÂ∞èÊó∂ÂàÜÔºåÂàÜÊàêÂá†‰∏á‰∏™ÂàÜÂå∫‰∏çÊòØÊõ¥Âø´ÂêóÔºü‚Äù **Á≠îÊ°àÊòØÂê¶ÂÆöÁöÑ**„ÄÇÂàÜÂå∫ËøáÂ§ö‰ºöÂ∏¶Êù•‚Äú‰∏âÂ∫ßÂ§ßÂ±±‚ÄùÔºö



###### A. ÊâìÂºÄÊñá‰ª∂Âè•ÊüÑÁöÑÊ∂àËÄó (File Descriptors)



- **ÂéüÁêÜ**ÔºöÂú® `innodb_file_per_table=ON`ÔºàÈªòËÆ§ÔºâÊ®°Âºè‰∏ãÔºåÊØè‰∏Ä‰∏™ÂàÜÂå∫ÂØπÂ∫îÁ£ÅÁõò‰∏äÁöÑ‰∏Ä‰∏™ `.ibd` Êñá‰ª∂„ÄÇ
- **ÂêéÊûú**ÔºöÂ¶ÇÊûú‰Ω†Êúâ 1000 ‰∏™ÂàÜÂå∫ÔºåÊü•ËØ¢‰∏ÄÊ¨°ËøôÂº†Ë°®ÔºàÂç≥‰ΩøÊúâÂâ™ÊûùÔºâÔºåMySQL ÂèØËÉΩÈúÄË¶ÅÊâìÂºÄ 1000 ‰∏™Êñá‰ª∂Âè•ÊüÑ„ÄÇÂ¶ÇÊûúÂπ∂ÂèëÈ´òÔºåÁû¨Èó¥Â∞±‰ºöËÄóÂ∞ΩÊìç‰ΩúÁ≥ªÁªüÁöÑ `open_files_limit`ÔºåÂØºËá¥Êä•Èîô `Too many open files`„ÄÇ



###### B. ÂÜÖÂ≠òÂç†Áî®‰∏éÈîÅÁ´û‰∫â (Table Cache & Metadata Lock)



- **ÂéüÁêÜ**ÔºöMySQL Server Â±ÇÈúÄË¶ÅÁª¥Êä§ÊØè‰∏Ä‰∏™ÂàÜÂå∫ÁöÑÂÖÉÊï∞ÊçÆÔºàMetadataÔºâ„ÄÇ
- **ÂêéÊûú**Ôºö
  - **ÂÜÖÂ≠òÁàÜÁÇ∏**Ôºö`table_open_cache` ÈúÄË¶ÅËÆæÁΩÆÂæóÈùûÂ∏∏Â§ßÊâçËÉΩË£Ö‰∏ãÊâÄÊúâÂàÜÂå∫ÁöÑÂè•ÊüÑ„ÄÇ
  - **ÂêØÂä®ÂèòÊÖ¢**ÔºöÊï∞ÊçÆÂ∫ìÈáçÂêØÊó∂ÔºåÂä†ËΩΩÂá†ÂçÉ‰∏™ÂàÜÂå∫ÁöÑÂÖÉÊï∞ÊçÆÈùûÂ∏∏ËÄóÊó∂„ÄÇ
  - **DDL ÂèòÊÖ¢**ÔºöÂØπË°®ÊâßË°å `ALTER` Êìç‰ΩúÊó∂ÔºåÈúÄË¶ÅÈîÅÂÆöÊâÄÊúâÂàÜÂå∫ÔºåÂàÜÂå∫Ë∂äÂ§öÔºåÈîÅÁ´û‰∫âË∂äÊøÄÁÉà„ÄÇ



###### C. Êü•ËØ¢‰ºòÂåñÂô®ÁöÑË¥üÊãÖ (Optimizer Overhead)



- **ÂéüÁêÜ**ÔºöÂΩì‰Ω†ÊâßË°å SQL Êó∂ÔºåMySQL ‰ºòÂåñÂô®ÈúÄË¶ÅÂàÜÊûêÊü•ËØ¢ËÆ°Âàí„ÄÇ
- **ÂêéÊûú**ÔºöÂç≥‰Ωø‰Ω†ÂÜô‰∫Ü `WHERE trade_date = ...`Ôºå‰ºòÂåñÂô®Âú®ÊâßË°å‚ÄúÂàÜÂå∫Ââ™Êûù‚Äù‰πãÂâçÔºåÁêÜËÆ∫‰∏äÈúÄË¶ÅÊâ´Êèè‰∏ÄÈÅçÊâÄÊúâÂàÜÂå∫ÁöÑÂÆö‰πâÊù•Âà§Êñ≠Âì™‰∫õËØ•Áïô„ÄÅÂì™‰∫õËØ•Êâî„ÄÇ
- **ÂÆûÊµã**ÔºöÂΩìÂàÜÂå∫Ë∂ÖËøá 1000 ‰∏™Êó∂ÔºåÂç≥‰ΩøÊòØÁÆÄÂçïÁöÑÊü•ËØ¢ÔºåÂÖâÊòØ‚ÄúÁîüÊàêÊâßË°åËÆ°Âàí‚ÄùËøô‰∏ÄÊ≠•ÁöÑËÄóÊó∂Â∞±‰ºö‰ªé **0.x ÊØ´Áßí** È£ôÂçáÂà∞ **Âá†ÂçÅÊØ´Áßí** ÁîöËá≥Êõ¥È´ò„ÄÇ

------



##### 2. ÁªìÂêà‰Ω†ÁöÑ‰∏öÂä°Âú∫ÊôØÂàÜÊûê



‰Ω†Áé∞Âú®ÁöÑË°®ÁªìÊûÑÊòØÔºö

- **ÂàÜÂå∫Á≠ñÁï•**ÔºöÊåâÊúàÂàÜÂå∫ (`RANGE COLUMNS(trade_date)`)„ÄÇ
- **Êó∂Èó¥Ë∑®Â∫¶**Ôºö2020, 2021, 2022, 2023, 2024 (ÈÉ®ÂàÜ)„ÄÇ
- **ÂàÜÂå∫ÊÄªÊï∞**ÔºöÂ§ßÁ∫¶ **50 ~ 60 ‰∏™**„ÄÇ

**ÁªìËÆ∫Ôºö‰Ω†ÁöÑËÆæËÆ°Â§Ñ‰∫é‚ÄúÈªÑÈáëÊÄßËÉΩÂå∫Èó¥‚ÄùÔºÅ**

- **50 ‰∏™ÂàÜÂå∫** ÂØπ MySQL Êù•ËØ¥ÊØ´Êó†ÂéãÂäõ„ÄÇ
- **ÊåâÊúàÂàÜÂå∫** Á≤íÂ∫¶ÈÄÇ‰∏≠„ÄÇÊó¢ÈÅøÂÖç‰∫ÜÂçïÂàÜÂå∫Êï∞ÊçÆËøáÂ§ßÔºàÂçïÂàÜÂå∫Âá†ÂçÉ‰∏áË°åÊòØ InnoDB ÁöÑËàíÈÄÇÂå∫ÔºâÔºåÂèàÈÅøÂÖç‰∫ÜÂàÜÂå∫Êï∞ÈáèËøáÂ§ö„ÄÇ

------



##### 3. Â¶ÇÊûúÊú™Êù•Êï∞ÊçÆÂèòÂ§ö‰∫ÜÊÄé‰πàÂäûÔºü



ÂÅáËÆæ‰Ω†ÁöÑÁ≥ªÁªüËøêË°å‰∫Ü 10 Âπ¥Ôºö

- 10Âπ¥ x 12‰∏™Êúà = **120 ‰∏™ÂàÜÂå∫**„ÄÇ
- **ËØÑ‰ª∑**Ôºö‰æùÁÑ∂Âú® **ÂÆâÂÖ®ËåÉÂõ¥** ÂÜÖ„ÄÇÂì™ÊÄïËøêË°å 20 Âπ¥Ôºà240 ‰∏™ÂàÜÂå∫ÔºâÔºåÊÄßËÉΩ‰πü‰∏ç‰ºöÊúâÊòéÊòæ‰∏ãÈôç„ÄÇ

**‰ΩÜÂ¶ÇÊûú‰Ω†ÊÉ≥ÊîπÊàê‚ÄúÊåâÂ§©ÂàÜÂå∫‚ÄùÔºö**

- 10Âπ¥ x 365Â§© = **3650 ‰∏™ÂàÜÂå∫**„ÄÇ
- **ËØÑ‰ª∑**Ôºö**ÁªùÂØπ‰∏çË°å**„ÄÇËøô‰ºöÁõ¥Êé•ÊãñÂûÆÊï∞ÊçÆÂ∫ì„ÄÇ

------



##### 4. Áªô‰Ω†ÁöÑÊúÄ‰Ω≥ÂÆûË∑µÂª∫ËÆÆ



‰∏∫‰∫Ü‰øùÊåÅÈïøÊúüÁöÑÊúÄ‰Ω≥ÊÄßËÉΩÔºåÂª∫ËÆÆÈÅµÂæ™‰ª•‰∏ã **LifecycleÔºàÁîüÂëΩÂë®ÊúüÔºâ** Á≠ñÁï•Ôºö

1. **‰øùÊåÅÊï∞ÈáèÁ®≥ÂÆö (Rolling Partition)**
   - ‰∏çË¶ÅËÆ©ÂàÜÂå∫Êó†ÈôêÂ¢ûÈïø„ÄÇ
   - Â¶ÇÊûúÊòØÊ∏©Êï∞ÊçÆË°®Ôºå‰øùÁïôÊúÄËøë 5-10 Âπ¥ÁöÑÊï∞ÊçÆÔºàÁ∫¶ 60-120 ‰∏™ÂàÜÂå∫ÔºâÂç≥ÂèØ„ÄÇ
   - ÂØπ‰∫éÂ§™‰πÖËøúÁöÑÊï∞ÊçÆÔºàÊØîÂ¶Ç 10 Âπ¥ÂâçÁöÑÔºâÔºåÂèØ‰ª•‰ΩøÁî® `pt-archiver` ÂΩíÊ°£Âà∞Áî± OSS/HDFS ÊîØÊåÅÁöÑÂÜ∑Â≠òÂÇ®‰∏≠ÔºåÁÑ∂Âêé `ALTER TABLE DROP PARTITION` Âà†Èô§ÊóßÂàÜÂå∫„ÄÇ
2. **ÂÖ≥ÈîÆÂèÇÊï∞Ë∞É‰ºò (Â¶ÇÊûúÂàÜÂå∫Á°ÆÂÆûÂ§ö)**
   - Â¶ÇÊûú‰Ω†ÁöÑÂàÜÂå∫ÊÄªÊï∞Ë∂ÖËøá‰∫Ü 500ÔºåÂä°ÂøÖÊ£ÄÊü• `my.cnf`Ôºö
   - `open_files_limit`ÔºöË∞ÉÂ§ßÂà∞ `65535` ÊàñÊõ¥È´ò„ÄÇ
   - `table_open_cache`ÔºöÊ†πÊçÆ `ÂàÜÂå∫Êï∞ x Âπ∂ÂèëËøûÊé•Êï∞` ÈÄÇÂΩìË∞ÉÂ§ß„ÄÇ
3. **ÁªùÂØπÁ¶ÅÊ≠¢ÁöÑÊü•ËØ¢**
   - **Á¶ÅÊ≠¢‰∏çÂ∏¶ÂàÜÂå∫ÈîÆÁöÑÊü•ËØ¢**Ôºö`SELECT * FROM table WHERE wind_code = '000001'`„ÄÇ
   - Ëøô‰ºöÂØºËá¥ **"ÂÖ®ÂàÜÂå∫Êâ´Êèè"**ÔºåMySQL Ë¶ÅËΩÆËØ¢ 60 ‰∏™Êñá‰ª∂ÔºåI/O ‰πüÊòØÂéüÊù•ÁöÑ 60 ÂÄçÔºåÊÄßËÉΩÊûÅÂÖ∂‰Ωé‰∏ã„ÄÇ
   - **Âº∫Âà∂Ë¶ÅÊ±Ç**Ôºö‰∏öÂä°‰ª£Á†ÅÊü•ËØ¢ÂøÖÈ°ªÂ∏¶‰∏ä `trade_date BETWEEN ...`„ÄÇ





##### ‰∏∫‰ªÄ‰πàÔºüÁªèËøáË∞É‰ºòÔºàË∞ÉÊï¥ open_files_limit Âíå table_open_cacheÔºâÔºå500 ~ 1000 ‰∏™‰πüÊòØÂèØ‰ª•Êé•ÂèóÁöÑ‚ÄúËàíÈÄÇÂå∫‚Äù?

Ëøô‰∏™ÈóÆÈ¢òÁõ¥Âáª MySQL ÁöÑ**ÂÜÖÊ†∏ËµÑÊ∫êÁÆ°ÁêÜÊú∫Âà∂**„ÄÇ

ÁÆÄÂçïÊù•ËØ¥Ôºå**ÈªòËÆ§ÈÖçÁΩÆ‰∏ã MySQL ÂÉè‰∏™‚ÄúÊâãÂøôËÑö‰π±ÁöÑÂ∞èÂ∑•‚ÄùÔºåËÄåË∞É‰ºòÂêéÂÆÉÂèòÊàê‰∫Ü‚Äú‰∏âÂ§¥ÂÖ≠ËáÇÁöÑ‰∏ìÂÆ∂‚Äù**„ÄÇ

‰πãÊâÄ‰ª•ËØ¥Ë∞É‰ºòÂêé 500~1000 ‰∏™ÂàÜÂå∫ËÉΩËøõÂÖ•‚ÄúËàíÈÄÇÂå∫‚ÄùÔºåÊòØÂõ†‰∏∫ÈÄöËøáË∞ÉÊï¥Ëøô‰∏§‰∏™ÂèÇÊï∞ÔºåÊàë‰ª¨Â∞Ü**‚ÄúÁâ©ÁêÜÂ±ÇÈù¢ÁöÑ I/O Áì∂È¢à‚Äù** ËΩ¨Âåñ‰∏∫‰∫Ü **‚ÄúÂÜÖÂ≠òÂ±ÇÈù¢ÁöÑÁÆ°ÁêÜÂºÄÈîÄ‚Äù**„ÄÇÁé∞‰ª£ÊúçÂä°Âô®ÂÜÖÂ≠òÂÖÖË∂≥ÔºåÂõ†Ê≠§ËøôÁßçËΩ¨ÂåñÊòØÂàíÁÆóÁöÑ„ÄÇ

‰∏ãÈù¢ÊàëÁî®ÈÄö‰øóÁöÑ**‚ÄúÂõæ‰π¶È¶ÜÂÄü‰π¶‚Äù**Ê®°ÂûãÊù•‰∏∫‰Ω†Ê∑±Â∫¶ÊãÜËß£ËÉåÂêéÁöÑÂéüÁêÜ„ÄÇ

------



###### Ê†∏ÂøÉÊú∫Âà∂Ôºö‰∏Ä‰∏™ÂàÜÂå∫ = ‰∏Ä‰∏™Êñá‰ª∂



Âú® InnoDB ÂºïÊìéÔºà`innodb_file_per_table=ON`Ôºâ‰∏ãÔºåÊØè‰∏Ä‰∏™ÂàÜÂå∫Âú®Á£ÅÁõò‰∏äÈÉΩÂØπÂ∫î‰∏Ä‰∏™Áã¨Á´ãÁöÑ `.ibd` Êñá‰ª∂„ÄÇ

- Â¶ÇÊûú‰Ω†Êúâ 1000 ‰∏™ÂàÜÂå∫ÔºåÊìç‰ΩúÁ≥ªÁªüÁúºÈáåÂ∞±Êúâ 1000 ‰∏™Áã¨Á´ãÁöÑÊñá‰ª∂„ÄÇ



> Âú∫ÊôØËÆæÂÆö

ÂÅáËÆæ‰Ω†ÁöÑÊï∞ÊçÆÂ∫ìÊúâ **100 ‰∏™Âπ∂ÂèëËøûÊé•**ÔºåÈÉΩÂú®Êü•ËØ¢ËøôÂº† 1000 ‰∏™ÂàÜÂå∫ÁöÑË°®„ÄÇ

------



###### ‰∏∫‰ªÄ‰πà‰∏çË∞É‰ºò‰ºö‚ÄúÂ¥©‚ÄùÔºüÔºàÁì∂È¢àÂú®Âì™ÈáåÔºâ



> Áì∂È¢à‰∏ÄÔºö`open_files_limit` (Êìç‰ΩúÁ≥ªÁªüÁöÑ‚ÄúÊ°åÂ≠ê‚ÄùÂ§™Â∞è)



- **ÂÆö‰πâ**ÔºöÊìç‰ΩúÁ≥ªÁªüÂÖÅËÆ∏‰∏Ä‰∏™ËøõÁ®ãÔºàMySQLÔºâÂêåÊó∂ÊâìÂºÄÂ§öÂ∞ë‰∏™Êñá‰ª∂Âè•ÊüÑÔºàFile DescriptorÔºâ„ÄÇ
- **ÈªòËÆ§ÊÉÖÂÜµ**ÔºöÂæàÂ§ö Linux ÂèëË°åÁâàÈªòËÆ§ `ulimit -n` ÊòØ **1024**„ÄÇ
- **Â¥©Ê∫ÉËøáÁ®ã**Ôºö
  - Êü•ËØ¢Êù•‰∫ÜÔºåMySQL ËØïÂõæÂéªÊâìÂºÄ 1000 ‰∏™ÂàÜÂå∫ÁöÑ `.ibd` Êñá‰ª∂„ÄÇ
  - ‰ΩÜÊòØÁ≥ªÁªüÈôêÂà∂Âè™ËÉΩÊâìÂºÄ 1024 ‰∏™„ÄÇ
  - MySQL Áû¨Èó¥ËÄóÂ∞ΩÂêçÈ¢ùÔºåÊä•Âá∫ `Too many open files` ÈîôËØØ„ÄÇ
  - **ÂêéÊûú**ÔºöÁõ¥Êé•ÊãíÁªùÊúçÂä°ÔºåÁîöËá≥ËøõÁ®ã Crash„ÄÇ



###### Áì∂È¢à‰∫åÔºö`table_open_cache` (MySQL ÁöÑ‚ÄúËÆ∞ÊÄß‚ÄùÂ§™Â∑Æ)



- **ÂÆö‰πâ**ÔºöMySQL Âú®ÂÜÖÂ≠òÈáåÁºìÂ≠ò‚ÄúÊâìÂºÄË°®ÁöÑÊñá‰ª∂ÊèèËø∞Á¨¶‚ÄùÁöÑÊï∞Èáè„ÄÇ
- **ÈªòËÆ§ÊÉÖÂÜµ**ÔºöÂÅáËÆæÈªòËÆ§‰∏∫ **2000**„ÄÇ
- **ÊÄßËÉΩÈõ™Â¥©ËøáÁ®ã**Ôºö
  - Âπ∂Âèë 100 ‰∏™Áî®Êà∑ÔºåÊØè‰∫∫Ë¶ÅÊü• 1000 ‰∏™ÂàÜÂå∫„ÄÇÁêÜËÆ∫ÈúÄË¶Å $100 \times 1000 = 100,000$ ‰∏™ÁºìÂ≠òÊßΩ‰Ωç„ÄÇ
  - ‰ΩÜÁºìÂ≠òÂè™Êúâ 2000 ‰∏™„ÄÇ
  - **‚ÄúÈ¢†Á∞∏‚Äù (Thrashing)**ÔºöMySQL Âè™ËÉΩ‰∏çÂÅúÂú∞ **ÊâìÂºÄÊñá‰ª∂ -> ËØª‰∏Ä‰∏ã -> ÂÖ≥Èó≠Êñá‰ª∂ -> ÊâìÂºÄ‰∏ã‰∏Ä‰∏™Êñá‰ª∂**„ÄÇ
  - **ÂêéÊûú**ÔºöCPU Âíå I/O ÂÖ®ÈÉ®Êµ™Ë¥πÂú®‚ÄúÊâìÂºÄ/ÂÖ≥Èó≠Êñá‰ª∂‚ÄùËøô‰∏™Á≥ªÁªüË∞ÉÁî®ÔºàSyscallÔºâ‰∏äÔºåËÄå‰∏çÊòØÂú®ËØªÊï∞ÊçÆ‰∏ä„ÄÇÊü•ËØ¢ÈÄüÂ∫¶ÊÖ¢ 10 ÂÄç‰ª•‰∏ä„ÄÇ

------



###### 3. ‰∏∫‰ªÄ‰πàË∞É‰ºòÂêéÂ∞±‚ÄúËàíÈÄÇ‚Äù‰∫ÜÔºü



ÂΩìÊàë‰ª¨Êää `open_files_limit` Ë∞ÉÂ§ßÂà∞ **65535**ÔºåÊää `table_open_cache` Ë∞ÉÂ§ßÂà∞ **10000** ÂêéÔºö



> ÂèòÂåñ‰∏ÄÔºöÁâ©ÁêÜ I/O ÂèòÊàê‰∫ÜÂÜÖÂ≠òÊåáÈíà (The Magic)



- Âõ†‰∏∫ `open_files_limit` Â§üÂ§ßÔºåMySQL ÂèØ‰ª•**‰∏ÄÊ¨°ÊÄß**ÊääËøô 1000 ‰∏™ÂàÜÂå∫ÁöÑ `.ibd` Êñá‰ª∂Âè•ÊüÑÂÖ®ÈÉ®ÊãøÂú®ÊâãÈáåÔºå**Ê∞∏Ëøú‰∏çÂÖ≥Èó≠**„ÄÇ
- Âõ†‰∏∫ `table_open_cache` Â§üÂ§ßÔºåËøô 1000 ‰∏™ÂàÜÂå∫ÁöÑÁä∂ÊÄÅ‰ø°ÊÅØÂÖ®ÈÉ®È©ªÁïôÂú®**ÂÜÖÂ≠òÔºàRAMÔºâ**‰∏≠„ÄÇ
- **Êü•ËØ¢ËøáÁ®ã**ÔºöÂΩì SQL ÈúÄË¶ÅÊâ´ÊèèÁ¨¨ 999 ‰∏™ÂàÜÂå∫Êó∂ÔºåMySQL ‰∏çÈúÄË¶ÅÂéªËØ∑Ê±ÇÊìç‰ΩúÁ≥ªÁªü‚ÄúÂ∏ÆÊàëÊâìÂºÄÊñá‰ª∂‚ÄùÔºåËÄåÊòØÁõ¥Êé•‰ªéÂÜÖÂ≠òÈáåÊãøÂà∞Âè•ÊüÑÔºå**Èõ∂Âª∂Ëøü**Áõ¥Êé•ËØªÂèñÊï∞ÊçÆ„ÄÇ



> ÂèòÂåñ‰∫åÔºöÂπ∂ÂèëËÉΩÂäõÁöÑÈáäÊîæ



- Âç≥‰ΩøÊúâ 100 ‰∏™Âπ∂ÂèëËøûÊé•ÔºåÂ§ßÂÆ∂ÈÉΩÂèØ‰ª•Â§çÁî®ÁºìÂ≠ò‰∏≠ÁöÑË°®ÂÆö‰πâÔºàÈÄöËøá `table_definition_cache`ÔºâÂíåÊñá‰ª∂Âè•ÊüÑ„ÄÇ
- ÊúçÂä°Âô®ÁöÑË¥üËΩΩ‰ªé‚ÄúÈ¢ëÁπÅÁöÑÁ≥ªÁªüË∞ÉÁî®‚ÄùÂèòÊàê‰∫Ü‚ÄúÁ∫ØÁ≤πÁöÑÊï∞ÊçÆËØªÂèñ‚Äù„ÄÇ

ÁªìËÆ∫Ôºö

Ë∞É‰ºòÁöÑÊú¨Ë¥®ÔºåÂ∞±ÊòØÁî®ÂÜÖÂ≠òÁ©∫Èó¥Êç¢Âèñ‰∫Ü I/O Êó∂Èó¥„ÄÇÂØπ‰∫éÁé∞‰ª£ÊúçÂä°Âô®ÔºàÂä®ËæÑ 64G/128G ÂÜÖÂ≠òÔºâÔºåÁª¥ÊåÅ 1000 ‰∏™ÂàÜÂå∫ÁöÑÂè•ÊüÑÂºÄÈîÄÔºàÂèØËÉΩ‰πüÂ∞±Âá†ÂçÅ MB ÂÜÖÂ≠òÔºâÊòØ‰πùÁâõ‰∏ÄÊØõÁöÑ„ÄÇ

------



###### 4. Êó¢ÁÑ∂Â¶ÇÊ≠§Ôºå‰∏∫‰ªÄ‰πà‰∏çÂª∫ËÆÆË∂ÖËøá 1000Ôºü



‰Ω†ÂèØËÉΩ‰ºöÈóÆÔºö‚ÄúÈÇ£ÊàëË∞ÉÂà∞ÊúÄÂ§ßÔºåÂ≤Ç‰∏çÊòØÂèØ‰ª•ÂàÜ 10000 ‰∏™ÂàÜÂå∫Ôºü‚Äù

**‰∏çÂèØ‰ª•„ÄÇ** Âõ†‰∏∫Ê≠§Êó∂Áì∂È¢àËΩ¨ÁßªÂà∞‰∫Ü **MySQL ‰ºòÂåñÂô®ÔºàOptimizerÔºâ** Âíå **ÂÖÉÊï∞ÊçÆÈîÅÔºàMDLÔºâ**ÔºåËøô‰∏§‰∏™ÊòØÈù†Ë∞ÉÂèÇÊï∞Ëß£ÂÜ≥‰∏ç‰∫ÜÁöÑ„ÄÇ

1. **Êü•ËØ¢ËÆ°ÂàíÁîüÊàêÊÖ¢ÔºàÁ°¨‰º§Ôºâ**Ôºö
   - ÂΩì‰Ω†ÊâßË°å `SELECT * FROM table WHERE date = '...'`„ÄÇ
   - ËôΩÁÑ∂Êñá‰ª∂ÈÉΩÊâìÂºÄ‰∫ÜÔºå‰ΩÜ MySQL **‰ºòÂåñÂô®** ÂøÖÈ°ªÂú®ÊâßË°åÂâçÔºåÈÅçÂéÜËøô 10000 ‰∏™ÂàÜÂå∫ÁöÑÂÆö‰πâÔºåÂéªËÆ°ÁÆó‚ÄúÊàëËØ•ÂéªÂì™‰∏™ÂàÜÂå∫ÊâæÊï∞ÊçÆ‚Äù„ÄÇ
   - **ÈÅçÂéÜ 100 ‰∏™ÂàÜÂå∫**Ôºö0.1 ÊØ´Áßí„ÄÇ
   - **ÈÅçÂéÜ 10000 ‰∏™ÂàÜÂå∫**ÔºöÂèØËÉΩË¶Å 100 ÊØ´Áßí„ÄÇ
   - **ÂêéÊûú**Ôºö‰Ω†ÁöÑ SQL ËøòÊ≤°ÂºÄÂßãË∑ëÔºåÂÖâÊòØ‚ÄúÊÉ≥ÊÄé‰πàË∑ë‚ÄùÂ∞±Ëä±‰∫ÜÂá†ÁôæÊØ´Áßí„ÄÇ
2. **DDL ÈîÅÁÅæÈöæ**Ôºö
   - Â¶ÇÊûú‰Ω†Ë¶ÅÁªôË°®Âä†‰∏™Â≠óÊÆµ„ÄÇMySQL ÈúÄË¶ÅËé∑Âèñ **ÊâÄÊúâ 10000 ‰∏™ÂàÜÂå∫ÁöÑÂÖÉÊï∞ÊçÆÈîÅ**„ÄÇ
   - Âè™Ë¶ÅÊúâ**‰∏Ä‰∏™**ÂàÜÂå∫Ë¢´Êüê‰∏™Èïø‰∫ãÂä°Âç†Áî®‰∫ÜÔºåÊï¥‰∏™ `ALTER TABLE` Â∞±‰ºöÂç°‰ΩèÔºåÂπ∂‰∏îÈòªÂ°ûÂêéÈù¢ÊâÄÊúâÁöÑËØªÂÜôËØ∑Ê±Ç„ÄÇÂàÜÂå∫Ë∂äÂ§öÔºå‚ÄúÊíûËΩ¶‚ÄùÁöÑÊ¶ÇÁéáÂëàÊåáÊï∞Á∫ß‰∏äÂçá„ÄÇ



###### ËØ¥ÊòéÊ±áÊÄª

- **50 ~ 100**ÔºöÊòØ **‚ÄúÂéüÁîüËàíÈÄÇÂå∫‚Äù**Ôºà‰∏çÁî®ÁÆ°ÈÖçÁΩÆÔºåÈöè‰æøË∑ëÈÉΩÂø´Ôºâ„ÄÇ
- **500 ~ 1000**ÔºöÊòØ **‚ÄúË∞É‰ºòËàíÈÄÇÂå∫‚Äù**ÔºàÂè™Ë¶ÅÂÜÖÂ≠òÂ§ü„ÄÅÂèÇÊï∞ÈÖçÂØπÔºåÂÆåÂÖ®ËÉΩÈ©æÈ©≠Ôºâ„ÄÇ
- **> 1000**ÔºöÊòØ **‚ÄúÊû∂ÊûÑÁ¶ÅÂå∫‚Äù**Ôºà‰ºòÂåñÂô®Áì∂È¢àÊó†Ê≥ïÁ™ÅÁ†¥ÔºåÁª¥Êä§ÊàêÊú¨ÊûÅÈ´òÔºåÂ∞ΩÈáèÈÅøÂÖçÔºâ„ÄÇ

‰Ω†ÁöÑÊåâÊúàÂàÜÂå∫Á≠ñÁï•ÔºàÁ∫¶ 50-60 ‰∏™ÔºâÔºåÊ≠£Â•ΩÂ§ÑÂú®ÊúÄÂÆåÁæéÁöÑ**ÂéüÁîüËàíÈÄÇÂå∫**„ÄÇ







##### ÊÄªÁªì

‚Äã	‰Ω†ÁõÆÂâçÁöÑ **ÊåâÊúàÂàÜÂå∫ (Á∫¶ 50-60 ‰∏™)** ÊòØÈùûÂ∏∏ÂÆåÁæéÁöÑÊû∂ÊûÑÂÜ≥Á≠ñÔºå‰∏çÈúÄË¶ÅÊîπ‰∏∫ÊåâÂë®ÊàñÊåâÂ§©Ôºå‰πü‰∏çÈúÄË¶ÅÊãÖÂøÉÊÄßËÉΩÈóÆÈ¢ò„ÄÇÁªßÁª≠‰øùÊåÅÂç≥ÂèØÔºÅ













## ÂÆûË∑µËøÅÁßª



> **ÊääËÄÅË°®Ôºàtb_quotation_history_trend_202001ÔºâËøÅÁßªÂà∞Êñ∞ÁöÑÊ∏©Ë°®Ôºàtb_quotation_history_warmÔºâ**

Âπ∂Á°Æ‰øùÔºö

- **‰∏çÈòªÂ°û‰∏öÂä°ÂÜôÂÖ•**
- **Êï∞ÊçÆÂèØÈù†ËøÅÁßª**
- **Â≠óÊÆµÁªìÊûÑÂ∑ÆÂºÇËá™Âä®Â§ÑÁêÜ**
- **ÊúÄÁªàËêΩÂ∫ìÂà∞ÂØπÂ∫îÁöÑÂàÜÂå∫Ôºà202001 ÂàÜÂå∫Ôºâ**
- **ÊîØÊåÅÂêéÁª≠ÊâπÈáèËøÅÁßªÂÖ∂‰ªñÊúàË°®**





### Áõ∏ÂÖ≥ÂëΩ‰ª§



#### Âø´ÈÄüÊ∏ÖÁ©∫Binlog

>Âú®ËøÅÁßªËøáÁ®ã‰∏≠BinLogÊòØÁ¥ØÁßØÊúÄÂø´ÁöÑÊó•ÂøóÊñá‰ª∂

```sql
-- ËÆæÁΩÆMySQLËá™Âä®Ê∏ÖÁêÜ7Â§©ÂâçÁöÑBinlog
-- 604800 Áßí = 7 Â§©
SET GLOBAL binlog_expire_logs_seconds = 604800;
```

```sql
-- ËøôÂ∞ÜÂà†Èô§ÊâÄÊúâ binlog Êñá‰ª∂ (001Âà∞345)ÔºåÂπ∂ÈáçÊñ∞‰ªé 001 ÂºÄÂßãËÆ°Êï∞
RESET MASTER;
```



>my.ini

```bash
# --- Âú®ËøôÈáåÊ∑ªÂä† ---
# ËÆæÁΩÆbinlogÁöÑËá™Âä®ËøáÊúüÊó∂Èó¥‰∏∫7Â§© (604800Áßí)
binlog_expire_logs_seconds = 604800
# --------------------
```



```bash
[mysqld]
# ËÆæÁΩÆ3306Á´ØÂè£
port=3306
# ËÆæÁΩÆmysqlÁöÑÂÆâË£ÖÁõÆÂΩï
basedir=D:\\MySQL8.0
# ËÆæÁΩÆmysqlÊï∞ÊçÆÂ∫ìÁöÑÊï∞ÊçÆÁöÑÂ≠òÊîæÁõÆÂΩï
datadir=E:\\dataStore\\MySQL
# ÂÖÅËÆ∏ÊúÄÂ§ßËøûÊé•Êï∞
max_connections=200
# ÂÖÅËÆ∏ËøûÊé•Â§±Ë¥•ÁöÑÊ¨°Êï∞„ÄÇ
max_connect_errors=10
# ÊúçÂä°Á´Ø‰ΩøÁî®ÁöÑÂ≠óÁ¨¶ÈõÜÈªòËÆ§‰∏∫utf8mb4
character-set-server=utf8mb4
# ÂàõÂª∫Êñ∞Ë°®Êó∂Â∞Ü‰ΩøÁî®ÁöÑÈªòËÆ§Â≠òÂÇ®ÂºïÊìé
default-storage-engine=INNODB
# ÈªòËÆ§‰ΩøÁî®‚Äúmysql_native_password‚ÄùÊèí‰ª∂ËÆ§ËØÅ
#mysql_native_password
default_authentication_plugin=mysql_native_password

# --- Âú®ËøôÈáåÊ∑ªÂä† ---
# ËÆæÁΩÆbinlogÁöÑËá™Âä®ËøáÊúüÊó∂Èó¥‰∏∫7Â§© (604800Áßí)
binlog_expire_logs_seconds = 604800
# --------------------

[mysql]
# ËÆæÁΩÆmysqlÂÆ¢Êà∑Á´ØÈªòËÆ§Â≠óÁ¨¶ÈõÜ
default-character-set=utf8mb4
[client]
# ËÆæÁΩÆmysqlÂÆ¢Êà∑Á´ØËøûÊé•ÊúçÂä°Á´ØÊó∂ÈªòËÆ§‰ΩøÁî®ÁöÑÁ´ØÂè£
port=3306
default-character-set=utf8mb4
```







#### Âø´ÈÄüÊü•ËØ¢ÂàÜÂå∫Ë°®ÂêÑÂàÜÂå∫ÊÄªÊï∞

```sql
#1.MySQL ÂÜÖÈÉ®ÁöÑÁªüËÆ°Êï∞ÊçÆÔºàTABLE_ROWSÔºâÊõ¥Êñ∞
ANALYZE TABLE tb_quotation_history_warm;

#2.Âø´ÈÄüÊü•ËØ¢ÂêÑÂàÜÂå∫Êï∞ÊçÆÊï∞Èáè(ÂâçÊèêÊòØÊâßË°åÁªüËÆ°Êï∞ÊçÆÔºàTABLE_ROWSÔºâÊõ¥Êñ∞--ÊâçÂáÜÁ°Æ)
SELECT 
    PARTITION_NAME, 
    TABLE_ROWS 
FROM 
    information_schema.PARTITIONS 
WHERE 
    TABLE_SCHEMA = 'a_share_quant' 
    AND TABLE_NAME = 'tb_quotation_history_warm'
ORDER BY 
    PARTITION_ORDINAL_POSITION;
```









### ËøÅÁßªtb_quotation_history_trendÂà∞Ê∏©Êï∞ÊçÆË°®



#### 1.Â≠óÊÆµ‰∏ÄËá¥

>Â∞ÜÂéüË°®Êñ∞Â¢û‰∏Ä‰∏™nullÂÄºÁöÑidÂ≠óÊÆµÔºåÁî®‰∫éÂØπÂ∫î‰∏ÄËá¥ÊÄßÔºåidÂú®Ê∏©Êï∞ÊçÆË°®‰∏≠ÁöÑÂÖ∑‰ΩìÂÄº‰ºöËá™Â¢û
>
>Ëß£ÂÜ≥Ë°®Â≠óÊÆµÁº∫Â§±Êó†Ê≥ïËøÅÁßªÁöÑÈóÆÈ¢ò

```sql
ALTER TABLE tb_quotation_history_trend_202001
ADD COLUMN id BIGINT UNSIGNED NULL;
```





#### 2.ËøÅÁßªÂëΩ‰ª§



##### ÂÆûË∑µÂëΩ‰ª§

```bash
hli@hli:~$ pt-archiver \
  --source h=10.100.225.7,P=3306,D=a_share_quant,t=tb_quotation_history_trend_202001,u=hli_gho,p=Q836184425 \
  --dest   h=10.100.225.7,P=3306,D=a_share_quant,t=tb_quotation_history_warm,u=hli_gho,p=Q836184425 \
  --columns wind_code,trade_date,latest_price,total_volume,average_price,status,create_time,update_time,id \
  --where "trade_date >= '2020-01-01' AND trade_date < '2020-02-01'" \
  --limit 10000 \
  --commit-each \
  --progress 20000 \
  --no-delete \
  --charset utf8 \
  --statistics
```

###### Â∏¶Ê≥®ÈáäÁâàÊú¨

```bash
pt-archiver \
  --source h=10.100.225.7,P=3306,D=a_share_quant,t=tb_quotation_history_trend_202001,u=hli_gho,p=Q836184425 \
  # ÊåáÂÆöÊ∫êÁ´ØÊï∞ÊçÆÂ∫ì‰ø°ÊÅØÔºàÂøÖÈ°ªÂåÖÂê´‰∏ªÈîÆÊàñÂîØ‰∏ÄÈîÆÔºâ  
  # h=IP, P=Á´ØÂè£, D=Êï∞ÊçÆÂ∫ìÂêç, t=Ë°®Âêç, u/p=Ë¥¶Âè∑ÂØÜÁ†Å  
  # tb_quotation_history_trend_202001 = ÂÜ∑Êï∞ÊçÆÊóßË°®

  --dest   h=10.100.225.7,P=3306,D=a_share_quant,t=tb_quotation_history_warm,u=hli_gho,p=Q836184425 \
  # ÊåáÂÆöÁõÆÊ†áÁ´ØÊï∞ÊçÆÂ∫ìÔºàÊ∏©Êï∞ÊçÆË°®Ôºâ  
  # ÂÜôÂÖ•Âà∞ tb_quotation_history_warm

  --columns wind_code,trade_date,latest_price,total_volume,average_price,status,create_time,update_time,id \
  # ÊòæÂºèÊåáÂÆöËøÅÁßªÁöÑÂàóÔºàÁõÆÁöÑË°®ÊØîÊ∫êË°®Â§ö‰∏Ä‰∏™ idÔºåËá™Â¢û‰∏çÂèóÂΩ±ÂìçÔºâ  
  # ÂÖ≥ÈîÆÊäÄÂ∑ßÔºö‰∏∫‰∫ÜÈÅøÂÖç pt-archiver Êä•Èîô‚Äúdest Â§ö‰∫Ü id‚ÄùÔºåÂøÖÈ°ªÊääÊâÄÊúâÊ∫êË°®Âàó + id ‰∏ÄËµ∑ÂÜôÂá∫  
  # ËøôÊ†∑ÁõÆÊ†áË°®ÁöÑ id ‰ºöËá™Â∑±Ëá™Â¢ûÂ°´ÂÖÖÔºå‰∏ç‰æùËµñÊ∫êË°®ÁöÑ idÔºàÊ∫êË°® id ÊòØ NULLÔºâ

  --where "trade_date >= '2020-01-01' AND trade_date < '2020-02-01'" \
  # ËøÅÁßªÊù°‰ª∂Ôºö‰ªÖËøÅÁßª 2020 Âπ¥ 1 Êúà‰ªΩÊï∞ÊçÆ  
  # ÊåâÊúàËøÅÁßªÊõ¥ÂÆâÂÖ®ÔºåÈÅøÂÖç‰∏ÄÊ¨°Êã∑Ë¥ùÂÖ®Â∫ìÂØºËá¥Â§ß‰∫ãÂä°

  --limit 10000 \
  # ÊØèÊâπ SELECT 10000 Ë°å  
  # Ëøô‰∏™ÂÄºË∂äÂ§ßÔºåËøÅÁßªË∂äÂø´Ôºå‰∏ÄËà¨Êé®Ëçê 5k-20k  
  # Êú¨Ê¨°ËøÅÁßª 10000 Â±û‰∫éÊØîËæÉÁ®≥Â¶•ÁöÑÈÄâÊã©

  --commit-each \
  # ÊØèÊ¨°ÊâπÂ§ÑÁêÜÊâßË°å‰∏ÄÊ¨°Êèê‰∫§Ôºà‰∫ãÂä°Á∫ßÂà´ÂæàÂ∞èÔºâ  
  # ÈÅøÂÖçÂ§ß‰∫ãÂä°ÂØºËá¥ÈîÅÁ≠âÂæÖ„ÄÅÂõûÊªöÊó∂Èó¥ÈïøÁ≠âÈóÆÈ¢ò  
  # ÊûÅÂÖ∂ÂÆâÂÖ®ÔºÅÊòØ‰Ω†‰ΩøÁî®‰∏äÂÆåÂÖ®Ê≠£Á°ÆÁöÑÂèÇÊï∞

  --progress 20000 \
  # ÊØèËøÅÁßª 20000 Ë°åËæìÂá∫ËøõÂ∫¶  
  # Èò≤Ê≠¢ÁªàÁ´ØÈïøÊó∂Èó¥Ê≤°ÊúâËæìÂá∫‰ª•‰∏∫ÊåÇËµ∑

  --no-delete \
  # ‰∏çÂà†Èô§Ê∫êË°®Êï∞ÊçÆ  
  # ËøôÊòØ‰Ω†ÂΩìÂâçÁ≠ñÁï•ÊúÄÂÖ≥ÈîÆÁöÑÂÆâÂÖ®‰øùÈöú  
  # ËøÅÁßªÂÆåÂèØ‰ª•Â§çÊü•ÔºåÊª°ÊÑèÂêéÂÜçÊâãÂä®Ê∏ÖÁêÜÊ∫êË°®ÊàñÂΩíÊ°£

  --charset utf8 \
  # Âº∫Âà∂Â≠óÁ¨¶ÈõÜÔºåÂê¶Âàô pt-archiver ‰ºöÊèêÁ§∫ utf8mb4 unsupportedÔºà‰Ω†ÁöÑÁâàÊú¨Á°ÆÂÆû‰∏çÊîØÊåÅ utf8mb4Ôºâ  
  # ÊåáÂÆö utf8 = ÂÆâÂÖ®„ÄÅÂÖºÂÆπ

  --statistics
  # ÊúÄÁªàËæìÂá∫Ê±áÊÄªÁªüËÆ°ÔºöËøÅÁßªÁî®Êó∂„ÄÅselect Ê¨°Êï∞„ÄÅinsert Ê¨°Êï∞„ÄÅcommit Ê¨°Êï∞  
  # Áî®‰∫éÈ™åËØÅËøÅÁßªÂÆåÊï¥ÊÄß
```

| È°πÁõÆ             | ËØÑ‰ª∑                                       |
| ---------------- | ------------------------------------------ |
| ËøÅÁßªÂÆâÂÖ®ÊÄß       | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê ÁªùÂØπÂÆâÂÖ®Ôºå‰∏ç‰ºöÂà†Ê∫êË°®„ÄÅ‰∏çÈîÅÂ§ßËåÉÂõ¥ËÆ∞ÂΩï |
| ËøÅÁßªÊÄßËÉΩ         | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê ÂçïÊú∫Á∫¶ 26 ‰∏áË°å/ÂàÜÈíüÔºåÂæàÂº∫            |
| ÂØπÂéüË°®ÂΩ±Âìç       | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê Âá†‰πé 0 ÂΩ±ÂìçÔºà‰∏ªÈîÆËåÉÂõ¥Êâ´ÊèèÔºâ          |
| ‰∫ãÂä°È£éÈô©         | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê ‰Ω†ÁöÑ `--commit-each` ÂÅöÂæóÈùûÂ∏∏Â•Ω      |
| ËøÅÁßªÂä®‰ΩúÂèØËøΩË∏™ÊÄß | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê `--progress` `--statistics` ‰ø°ÊÅØÂÆåÊï¥ |

Â±û‰∫éÁúüÂÆûÁîü‰∫ßÁéØÂ¢ÉÂ∏∏Áî®ÁöÑ **ÂÆâÂÖ®ÂΩíÊ°£ËøÅÁßªÊñπÊ°à**ÔºàË°åÁ∫ßÊã∑Ë¥ù„ÄÅÂº±ÂΩ±ÂìçÔºâ





#### 3.ËøÅÁßªËæìÂá∫

```bash
TIME                ELAPSED   COUNT
2025-11-25T15:30:30       0       0
2025-11-25T15:30:36       5   20000
2025-11-25T15:30:42      11   40000
2025-11-25T15:30:47      16   60000
...
2025-11-25T18:24:29    3045 13320000
2025-11-25T18:24:34    3050 13340000
2025-11-25T18:24:35    3051 13344002
Started at 2025-11-25T17:33:43, ended at 2025-11-25T18:24:35
Source: A=utf8,D=a_share_quant,P=3306,h=10.100.225.7,p=...,t=tb_quotation_history_trend_202001,u=hli_gho
Dest:   A=utf8,D=a_share_quant,P=3306,h=10.100.225.7,p=...,t=tb_quotation_history_warm,u=hli_gho
SELECT 13344002
INSERT 13344002
DELETE 0
Action         Count       Time        Pct
inserting   13344002  2700.0184      88.49
select          1336    43.8971       1.44
commit          2672    11.8643       0.39
other              0   295.3828       9.68
```



##### Â∏¶Ê≥®ÈáäÁâàÊú¨

```bash
2025-11-25T18:24:25    3041 13300000
# Á¨¨ 3041 Ê¨°ËæìÂá∫ËøõÂ∫¶ÔºåÂÖ±ÂÆåÊàê 13,300,000 Ë°å

2025-11-25T18:24:29    3045 13320000
# 4 ÁßíÂêéÔºåÂÆåÊàê 13,320,000 Ë°åÔºàÊåÅÁª≠Á®≥ÂÆöÈÄüÂ∫¶ÔºåÊó†ÊäñÂä®Ôºâ

2025-11-25T18:24:34    3050 13340000
# ÂÜçËøá 5 ÁßíÔºåËææÂà∞ 13,340,000 Ë°åÔºàÊé•ËøëÊúÄÂêé‰∏ÄÊâπÔºâ

2025-11-25T18:24:35    3051 13344002
# ÊúÄÂêé‰∏ÄÊâπÂè™Êúâ 4002 Ë°åÔºå‰∏çÊòØÊï¥ÁöÑ 10000ÔºåËØ¥ÊòéÊï∞ÊçÆÂàöÂ•ΩÂÖ®ÈÉ®ËøÅÁßªÂÆåÊàê„ÄÇ
# Ê≠§Êó∂Êï¥‰∏™ÊúàË°®Ôºà2020-01ÔºâÂ∑≤ÁªèÂÆåÂÖ®ÂÜôÂÖ•Ê∏©Ë°®ÔºåÊó†ÈÅóÊºè„ÄÇ

Started at 2025-11-25T17:33:43, ended at 2025-11-25T18:24:35
# ÊÄªËÄóÊó∂Á∫¶ 50 ÂàÜÈíüÔºàÂ§ßË°® 1334 ‰∏áË°åÂ±û‰∫éÊûÅÂø´ËøÅÁßªÈÄüÂ∫¶Ôºâ
# ÂÖ®Á®ãÊó†Âç°È°ø„ÄÅÊó†Ë∂ÖÊó∂„ÄÅÊó†ÈîÅÁ≠âÂæÖ„ÄÇ

Source: A=utf8,D=a_share_quant,P=3306,h=10.100.225.7,p=...,t=tb_quotation_history_trend_202001,u=hli_gho
# Ê∫êË°®‰ø°ÊÅØÔºöËØªÂèñ tb_quotation_history_trend_202001ÔºàÊóßÊúàË°®Ôºâ

Dest:   A=utf8,D=a_share_quant,P=3306,h=10.100.225.7,p=...,t=tb_quotation_history_warm,u=hli_gho
# ÁõÆÊ†áË°®‰ø°ÊÅØÔºöÂÜôÂÖ• tb_quotation_history_warmÔºàÊ∏©Êï∞ÊçÆË°®Ôºâ

SELECT 13344002
# ‰ªéÊóßË°®ÊàêÂäüËØªÂèñ 13,344,002 Ë°åÔºàÊï∞ÈáèÊ≠£Á°ÆÔºâ

INSERT 13344002
# ÂÆåÊï¥ÂÜôÂÖ• 13,344,002 Ë°åÂà∞Ê∏©Ë°® ‚Üí ‰∏é SELECT ÂÆåÂÖ®‰∏ÄËá¥
# ‚òÖ ËØÅÊòéÊó†‰∏¢Â§±Êó†ÈáçÂ§ç ‚òÖ

DELETE 0
# Âõ†‰∏∫‰Ω†‰ΩøÁî®‰∫Ü --no-delete ÔºåÊâÄ‰ª•‰∏çÂà†Èô§ÊóßË°®ËÆ∞ÂΩïÔºàÂÆâÂÖ®Êìç‰ΩúÔºâ

Action         Count       Time        Pct
# ‰∏ãÊñπÊòØÊÄßËÉΩÁªüËÆ°Ê®°ÂùóÔºàÈùûÂ∏∏ÂÖ≥ÈîÆÔºâ

inserting   13344002  2700.0184      88.49
# INSERT Âä®‰ΩúËÄóÊó∂ 2700 ÁßíÔºåÂç† 88%
# IO ÂØÜÈõÜÂûã‰ªªÂä°ÔºåÂ±û‰∫éÊ≠£Â∏∏Áé∞Ë±°
# ‰∏îËØ¥ÊòéÊï¥‰∏™ËøáÁ®ãÁ®≥ÂÆöÊâßË°åÔºåÊ≤°ÊúâÈïøÊó∂Èó¥Â†µÂ°û

select          1336    43.8971       1.44
# SELECT Âè™Âç† 1.44%ÔºåÂõ†‰∏∫‰∏ªÈîÆÊâ´ÊèèÂæàÂø´ÔºåÊ≤°ÊúâÈîÅÂÜ≤Á™Å

commit          2672    11.8643       0.39
# ÊØè 10000 Ë°å‰∏Ä‰∏™ commitÔºà‰Ω†Áî®‰∫Ü --commit-eachÔºâ
# commit ÊàêÊú¨ÈùûÂ∏∏‰ΩéÔºåËØ¥Êòé MySQL ÂêéÁ´ØÂÜôÂÖ•‰∏çÂç°

other              0   295.3828       9.68
# other ÂåÖÂê´ÔºöÁîüÊàê‰∏¥Êó∂Êñá‰ª∂„ÄÅLOAD DATA LOCAL„ÄÅÂèÇÊï∞Ê£ÄÊü•Á≠â
# Ê≠£Â∏∏Âç†ÊØîÔºåÊó†ÂºÇÂ∏∏Ë°å‰∏∫
```





#### 4.È™åËØÅËøÅÁßª



##### È™åËØÅÂå∫Èó¥Êï∞Èáè

```sql
#‚ë† ÁõÆÊ†áÂàÜÂå∫Êï∞ÊçÆÈáè,È¢ÑÊúüÂ∫î‰∏∫ 13344002Ôºà‰Ω†ÂéüË°®ÁöÑÊï∞ÊçÆÈáèÔºâ„ÄÇ
SELECT COUNT(*) FROM tb_quotation_history_warm
WHERE trade_date >= '2020-01-01' AND trade_date < '2020-02-01';
```



##### È™åËØÅÊåáÂÆöÂàÜÂå∫Êï∞

```sql
#‚ë° È™åËØÅÂàÜÂå∫ÊòØÂê¶ËêΩÂØπ,È¢ÑÊúüÂ∫î‰∏∫ 13344002Ôºà‰Ω†ÂéüË°®ÁöÑÊï∞ÊçÆÈáèÔºâ„ÄÇÂÆòÊñπÊé®ËçêÁöÑÂàÜÂå∫ËÆ°Êï∞ÊñπÊ≥ï
SELECT COUNT(*)
FROM tb_quotation_history_warm PARTITION (p202001);
```





##### ÊäΩÊ†∑È™åËØÅ

```sql
#‚ë¢ È™åËØÅÂÜÖÂÆπ‰∏ÄËá¥ÊÄßÔºàÊäΩÊ†∑Ê£ÄÊü•Ôºâ
SELECT wind_code, trade_date
FROM tb_quotation_history_trend_202001
ORDER BY RAND()
LIMIT 10;
```



```sql
#Â¶ÇÊûú 8 ‰∏™Â≠óÊÆµÂÆåÂÖ®‰∏ÄËá¥ ‚Üí Êï∞ÊçÆËøÅÁßªÊ≠£Á°Æ„ÄÇ
SELECT 
    'SOURCE' AS from_table,
    t1.*
FROM tb_quotation_history_trend_202001 t1
WHERE (t1.wind_code, t1.trade_date) IN (
    ('300409.SZ', '2020-01-13 10:06:57'),
    ('601989.SH', '2020-01-10 09:55:57'),
    ('603356.SH', '2020-01-17 10:07:32'),
    ('300301.SZ', '2020-01-17 14:29:27'),
    ('603320.SH', '2020-01-16 13:44:55'),
    ('000809.SZ', '2020-01-07 09:25:03'),
    ('300663.SZ', '2020-01-14 14:11:57'),
    ('002475.SZ', '2020-01-07 11:18:57'),
    ('002581.SZ', '2020-01-16 11:29:54'),
    ('600266.SH', '2020-01-09 14:50:58')
)

UNION ALL

SELECT 
    'WARM' AS from_table,
    t2.*
FROM tb_quotation_history_warm t2
WHERE (t2.wind_code, t2.trade_date) IN (
    ('300409.SZ', '2020-01-13 10:06:57'),
    ('601989.SH', '2020-01-10 09:55:57'),
    ('603356.SH', '2020-01-17 10:07:32'),
    ('300301.SZ', '2020-01-17 14:29:27'),
    ('603320.SH', '2020-01-16 13:44:55'),
    ('000809.SZ', '2020-01-07 09:25:03'),
    ('300663.SZ', '2020-01-14 14:11:57'),
    ('002475.SZ', '2020-01-07 11:18:57'),
    ('002581.SZ', '2020-01-16 11:29:54'),
    ('600266.SH', '2020-01-09 14:50:58')
);
```





#### 5.ÁªßÁª≠Ââ©‰ΩôËøÅÁßª



##### Áªü‰∏ÄÊñ∞Â¢ûÁ©∫idÂ≠óÊÆµÂØπÂ∫îË°®Â≠óÊÆµ‰∏ÄËá¥

```sql
ALTER TABLE tb_quotation_history_trend_202002
ADD COLUMN id BIGINT UNSIGNED NULL;
```



##### Êü•ÊâæÂØπÂ∫îÁöÑIP

>‰∏ÄÂÆöË¶ÅÈÄÇÈÖçÊ≠£Á°ÆIPÔºåËøôÈáåÊòØ10.100.224.255 

```bash
Êó†Á∫øÂ±ÄÂüüÁΩëÈÄÇÈÖçÂô® WLAN: ËøûÊé•ÁâπÂÆöÁöÑ DNS ÂêéÁºÄ . . . . . . . : 
Êú¨Âú∞ÈìæÊé• IPv6 Âú∞ÂùÄ. . . . . . . . : fe80::dd5e:6eb9:a14f:28c%10 
IPv4 Âú∞ÂùÄ . . . . . . . . . . . . : 10.100.224.255 
Â≠êÁΩëÊé©Á†Å . . . . . . . . . . . . : 255.255.248.0 
ÈªòËÆ§ÁΩëÂÖ≥. . . . . . . . . . . . . : 10.100.224.1
```



##### 2020

###### 202002

>‰øÆÊîπtb_quotation_history_trend_202002
>
>‰øÆÊîπtrade_date >= '2020-02-01' AND trade_date < '2020-03-01

```bash
pt-archiver \
  --source h=10.100.225.7,P=3306,D=a_share_quant,t=tb_quotation_history_trend_202002,u=hli_gho,p=Q836184425 \
  --dest   h=10.100.225.7,P=3306,D=a_share_quant,t=tb_quotation_history_warm,u=hli_gho,p=Q836184425 \
  --columns wind_code,trade_date,latest_price,total_volume,average_price,status,create_time,update_time,id \
  --where "trade_date >= '2020-02-01' AND trade_date < '2020-03-01'" \
  --limit 10000 \
  --commit-each \
  --progress 20000 \
  --no-delete \
  --charset utf8 \
  --statistics
```



```bash
2025-11-25T20:52:01    3993 16775737
Started at 2025-11-25T19:45:27, ended at 2025-11-25T20:52:01
Source: A=utf8,D=a_share_quant,P=3306,h=10.100.225.7,p=...,t=tb_quotation_history_trend_202002,u=hli_gho
Dest:   A=utf8,D=a_share_quant,P=3306,h=10.100.225.7,p=...,t=tb_quotation_history_warm,u=hli_gho
SELECT 16775737
INSERT 16775737
DELETE 0
Action         Count       Time        Pct
inserting   16775737  3564.2174      89.25
select          1679    52.2721       1.31
commit          3358    16.3642       0.41
other              0   360.5891       9.03
```







###### 202003

```sql
ALTER TABLE tb_quotation_history_trend_202003
ADD COLUMN id BIGINT UNSIGNED NULL;
```



```bash
pt-archiver \
  --source h=10.100.225.7,P=3306,D=a_share_quant,t=tb_quotation_history_trend_202003,u=hli_gho,p=Q836184425 \
  --dest   h=10.100.225.7,P=3306,D=a_share_quant,t=tb_quotation_history_warm,u=hli_gho,p=Q836184425 \
  --columns wind_code,trade_date,latest_price,total_volume,average_price,status,create_time,update_time,id \
  --where "trade_date >= '2020-03-01' AND trade_date < '2020-04-01'" \
  --limit 10000 \
  --commit-each \
  --progress 20000 \
  --no-delete \
  --charset utf8 \
  --statistics
```



```bash
2025-11-26T10:48:20    4188 18700000
2025-11-26T10:48:21    4189 18703423
Started at 2025-11-26T09:38:31, ended at 2025-11-26T10:48:21
Source: A=utf8,D=a_share_quant,P=3306,h=10.100.225.7,p=...,t=tb_quotation_history_trend_202003,u=hli_gho
Dest:   A=utf8,D=a_share_quant,P=3306,h=10.100.225.7,p=...,t=tb_quotation_history_warm,u=hli_gho
SELECT 18703423
INSERT 18703423
DELETE 0
Action         Count       Time        Pct
inserting   18703423  3727.4999      88.97
select          1872    57.4741       1.37
commit          3744    18.0014       0.43
other              0   386.4501       9.22
```





###### 202004

```sql
ALTER TABLE tb_quotation_history_trend_202004
ADD COLUMN id BIGINT UNSIGNED NULL;
```



```bash
pt-archiver \
  --source h=10.100.225.7,P=3306,D=a_share_quant,t=tb_quotation_history_trend_202004,u=hli_gho,p=Q836184425 \
  --dest   h=10.100.225.7,P=3306,D=a_share_quant,t=tb_quotation_history_warm,u=hli_gho,p=Q836184425 \
  --columns wind_code,trade_date,latest_price,total_volume,average_price,status,create_time,update_time,id \
  --where "trade_date >= '2020-04-01' AND trade_date < '2020-05-01'" \
  --limit 10000 \
  --commit-each \
  --progress 20000 \
  --no-delete \
  --charset utf8 \
  --statistics
```



```bash
2025-11-26T12:21:22    3951 17660000
2025-11-26T12:21:26    3955 17680000
2025-11-26T12:21:29    3958 17694991
Started at 2025-11-26T11:15:31, ended at 2025-11-26T12:21:29
Source: A=utf8,D=a_share_quant,P=3306,h=10.100.225.7,p=...,t=tb_quotation_history_trend_202004,u=hli_gho
Dest:   A=utf8,D=a_share_quant,P=3306,h=10.100.225.7,p=...,t=tb_quotation_history_warm,u=hli_gho
SELECT 17694991
INSERT 17694991
DELETE 0
Action         Count       Time        Pct
inserting   17694991  3521.1224      88.96
select          1771    58.9093       1.49
commit          3542    16.3475       0.41
other              0   361.8317       9.14
```









###### 202005

```sql
ALTER TABLE tb_quotation_history_trend_202005
ADD COLUMN id BIGINT UNSIGNED NULL;
```

```bash
pt-archiver \
  --source h=10.100.225.7,P=3306,D=a_share_quant,t=tb_quotation_history_trend_202005,u=hli_gho,p=Q836184425 \
  --dest   h=10.100.225.7,P=3306,D=a_share_quant,t=tb_quotation_history_warm,u=hli_gho,p=Q836184425 \
  --columns wind_code,trade_date,latest_price,total_volume,average_price,status,create_time,update_time,id \
  --where "trade_date >= '2020-05-01' AND trade_date < '2020-06-01'" \
  --limit 10000 \
  --commit-each \
  --progress 20000 \
  --no-delete \
  --charset utf8 \
  --statistics
```



```bash
2025-11-26T14:02:49    3485 15100000
2025-11-26T14:02:54    3489 15120000
2025-11-26T14:02:58    3493 15137650
Started at 2025-11-26T13:04:44, ended at 2025-11-26T14:02:58
Source: A=utf8,D=a_share_quant,P=3306,h=10.100.225.7,p=...,t=tb_quotation_history_trend_202005,u=hli_gho
Dest:   A=utf8,D=a_share_quant,P=3306,h=10.100.225.7,p=...,t=tb_quotation_history_warm,u=hli_gho
SELECT 15137650
INSERT 15137650
DELETE 0
Action         Count       Time        Pct
inserting   15137650  3098.8891      88.69
select          1515    52.6052       1.51
commit          3030    15.3802       0.44
other              0   327.0602       9.36
```









###### 202006

```sql
ALTER TABLE tb_quotation_history_trend_202006
ADD COLUMN id BIGINT UNSIGNED NULL;
```



```bash
pt-archiver \
  --source h=10.100.225.7,P=3306,D=a_share_quant,t=tb_quotation_history_trend_202006,u=hli_gho,p=Q836184425 \
  --dest   h=10.100.225.7,P=3306,D=a_share_quant,t=tb_quotation_history_warm,u=hli_gho,p=Q836184425 \
  --columns wind_code,trade_date,latest_price,total_volume,average_price,status,create_time,update_time,id \
  --where "trade_date >= '2020-06-01' AND trade_date < '2020-07-01'" \
  --limit 10000 \
  --commit-each \
  --progress 20000 \
  --no-delete \
  --charset utf8 \
  --statistics
```

```bash
2025-11-26T15:31:01    3878 17040000
2025-11-26T15:31:02    3879 17044305
Started at 2025-11-26T14:26:23, ended at 2025-11-26T15:31:02
Source: A=utf8,D=a_share_quant,P=3306,h=10.100.225.7,p=...,t=tb_quotation_history_trend_202006,u=hli_gho
Dest:   A=utf8,D=a_share_quant,P=3306,h=10.100.225.7,p=...,t=tb_quotation_history_warm,u=hli_gho
SELECT 17044305
INSERT 17044305
DELETE 0
Action         Count       Time        Pct
inserting   17044305  3473.6490      89.54
select          1706    51.1215       1.32
commit          3412    15.9157       0.41
other              0   338.6275       8.73
hli@hli:~$
```





###### 202007

```sql
ALTER TABLE tb_quotation_history_trend_202007
ADD COLUMN id BIGINT UNSIGNED NULL;
```

```bash
pt-archiver \
  --source h=10.100.225.7,P=3306,D=a_share_quant,t=tb_quotation_history_trend_202007,u=hli_gho,p=Q836184425 \
  --dest   h=10.100.225.7,P=3306,D=a_share_quant,t=tb_quotation_history_warm,u=hli_gho,p=Q836184425 \
  --columns wind_code,trade_date,latest_price,total_volume,average_price,status,create_time,update_time,id \
  --where "trade_date >= '2020-07-01' AND trade_date < '2020-08-01'" \
  --limit 10000 \
  --commit-each \
  --progress 20000 \
  --no-delete \
  --charset utf8 \
  --statistics
```

```bash
2025-11-26T18:00:36    4893 20300000
2025-11-26T18:00:41    4898 20320000
2025-11-26T18:00:43    4900 20327555
Started at 2025-11-26T16:39:02, ended at 2025-11-26T18:00:43
Source: A=utf8,D=a_share_quant,P=3306,h=10.100.225.7,p=...,t=tb_quotation_history_trend_202007,u=hli_gho
Dest:   A=utf8,D=a_share_quant,P=3306,h=10.100.225.7,p=...,t=tb_quotation_history_warm,u=hli_gho
SELECT 20327555
INSERT 20327555
DELETE 0
Action         Count       Time        Pct
inserting   20327555  4382.8504      89.44
select          2034    61.4133       1.25
commit          4068    22.6237       0.46
other              0   433.4679       8.85
```



###### 202008

```sql
ALTER TABLE tb_quotation_history_trend_202008
ADD COLUMN id BIGINT UNSIGNED NULL;
```



```bash
pt-archiver \
  --source h=192.168.168.57,P=3306,D=a_share_quant,t=tb_quotation_history_trend_202008,u=hli_gho,p=Q836184425 \
  --dest   h=192.168.168.57,P=3306,D=a_share_quant,t=tb_quotation_history_warm,u=hli_gho,p=Q836184425 \
  --columns wind_code,trade_date,latest_price,total_volume,average_price,status,create_time,update_time,id \
  --where "trade_date >= '2020-08-01' AND trade_date < '2020-09-01'" \
  --limit 10000 \
  --commit-each \
  --progress 20000 \
  --no-delete \
  --charset utf8 \
  --statistics
```



```bash
2025-11-26T20:47:13    4452 18760000
2025-11-26T20:47:18    4456 18780000
2025-11-26T20:47:18    4457 18782147
Started at 2025-11-26T19:33:01, ended at 2025-11-26T20:47:18
Source: A=utf8,D=a_share_quant,P=3306,h=192.168.168.57,p=...,t=tb_quotation_history_trend_202008,u=hli_gho
Dest:   A=utf8,D=a_share_quant,P=3306,h=192.168.168.57,p=...,t=tb_quotation_history_warm,u=hli_gho
SELECT 18782147
INSERT 18782147
DELETE 0
Action         Count       Time        Pct
inserting   18782147  3990.8084      89.53
select          1880    57.4246       1.29
commit          3760    18.0092       0.40
other              0   391.0431       8.77
```









###### 202009

```sql
ALTER TABLE tb_quotation_history_trend_202009
ADD COLUMN id BIGINT UNSIGNED NULL;
```



```bash
pt-archiver \
  --source h=10.100.224.255,P=3306,D=a_share_quant,t=tb_quotation_history_trend_202009,u=hli_gho,p=Q836184425 \
  --dest   h=10.100.224.255,P=3306,D=a_share_quant,t=tb_quotation_history_warm,u=hli_gho,p=Q836184425 \
  --columns wind_code,trade_date,latest_price,total_volume,average_price,status,create_time,update_time,id \
  --where "trade_date >= '2020-09-01' AND trade_date < '2020-10-01'" \
  --limit 10000 \
  --commit-each \
  --progress 20000 \
  --no-delete \
  --charset utf8 \
  --statistics
```



```bash
2025-11-27T11:59:13    4408 19700000
2025-11-27T11:59:17    4412 19718428
Started at 2025-11-27T10:45:44, ended at 2025-11-27T11:59:17
Source: A=utf8,D=a_share_quant,P=3306,h=10.100.224.255,p=...,t=tb_quotation_history_trend_202009,u=hli_gho
Dest:   A=utf8,D=a_share_quant,P=3306,h=10.100.224.255,p=...,t=tb_quotation_history_warm,u=hli_gho
SELECT 19718428
INSERT 19718428
DELETE 0
Action         Count       Time        Pct
inserting   19718428  3932.8474      89.13
select          1973    60.1436       1.36
commit          3946    18.8299       0.43
other              0   400.5597       9.08
hli@hli:~$
```







###### 202010

```sql
ALTER TABLE tb_quotation_history_trend_202010
ADD COLUMN id BIGINT UNSIGNED NULL;
```



```bash
pt-archiver \
  --source h=10.100.224.255,P=3306,D=a_share_quant,t=tb_quotation_history_trend_202010,u=hli_gho,p=Q836184425 \
  --dest   h=10.100.224.255,P=3306,D=a_share_quant,t=tb_quotation_history_warm,u=hli_gho,p=Q836184425 \
  --columns wind_code,trade_date,latest_price,total_volume,average_price,status,create_time,update_time,id \
  --where "trade_date >= '2020-10-01' AND trade_date < '2020-11-01'" \
  --limit 10000 \
  --commit-each \
  --progress 20000 \
  --no-delete \
  --charset utf8 \
  --statistics
```



```bash
2025-11-27T14:14:01    3924 14340000
2025-11-27T14:14:05    3929 14360000
2025-11-27T14:14:06    3930 14364777
Started at 2025-11-27T13:08:36, ended at 2025-11-27T14:14:06
Source: A=utf8,D=a_share_quant,P=3306,h=10.100.224.255,p=...,t=tb_quotation_history_trend_202010,u=hli_gho
Dest:   A=utf8,D=a_share_quant,P=3306,h=10.100.224.255,p=...,t=tb_quotation_history_warm,u=hli_gho
SELECT 14364777
INSERT 14364777
DELETE 0
Action         Count       Time        Pct
inserting   14364777  3464.0099      88.13
select          1438    93.9666       2.39
commit          2876    22.8124       0.58
other              0   349.6034       8.89
```





###### 202011

```sql
ALTER TABLE tb_quotation_history_trend_202011
ADD COLUMN id BIGINT UNSIGNED NULL;
```



```bash
pt-archiver \
  --source h=10.100.224.255,P=3306,D=a_share_quant,t=tb_quotation_history_trend_202011,u=hli_gho,p=Q836184425 \
  --dest   h=10.100.224.255,P=3306,D=a_share_quant,t=tb_quotation_history_warm,u=hli_gho,p=Q836184425 \
  --columns wind_code,trade_date,latest_price,total_volume,average_price,status,create_time,update_time,id \
  --where "trade_date >= '2020-11-01' AND trade_date < '2020-12-01'" \
  --limit 10000 \
  --commit-each \
  --progress 20000 \
  --no-delete \
  --charset utf8 \
  --statistics
```



```bash
2025-11-27T14:34:47    5142 19080000
2025-11-27T14:34:52    5147 19100000
2025-11-27T14:34:57    5151 19118085
Started at 2025-11-27T13:09:05, ended at 2025-11-27T14:34:57
Source: A=utf8,D=a_share_quant,P=3306,h=10.100.224.255,p=...,t=tb_quotation_history_trend_202011,u=hli_gho
Dest:   A=utf8,D=a_share_quant,P=3306,h=10.100.224.255,p=...,t=tb_quotation_history_warm,u=hli_gho
SELECT 19118085
INSERT 19118085
DELETE 0
Action         Count       Time        Pct
inserting   19118085  4514.8165      87.64
select          1913   119.3958       2.32
commit          3826    28.7882       0.56
other              0   488.6129       9.48
```





###### 202012

```sql
ALTER TABLE tb_quotation_history_trend_202012
ADD COLUMN id BIGINT UNSIGNED NULL;
```



```bash
pt-archiver \
  --source h=10.100.224.255,P=3306,D=a_share_quant,t=tb_quotation_history_trend_202012,u=hli_gho,p=Q836184425 \
  --dest   h=10.100.224.255,P=3306,D=a_share_quant,t=tb_quotation_history_warm,u=hli_gho,p=Q836184425 \
  --columns wind_code,trade_date,latest_price,total_volume,average_price,status,create_time,update_time,id \
  --where "trade_date >= '2020-12-01' AND trade_date < '2021-01-01'" \
  --limit 10000 \
  --commit-each \
  --progress 20000 \
  --no-delete \
  --charset utf8 \
  --statistics
```



```bash
2025-11-27T14:44:55    5730 21040000
2025-11-27T14:45:00    5736 21060000
2025-11-27T14:45:01    5737 21062909
Started at 2025-11-27T13:09:24, ended at 2025-11-27T14:45:01
Source: A=utf8,D=a_share_quant,P=3306,h=10.100.224.255,p=...,t=tb_quotation_history_trend_202012,u=hli_gho
Dest:   A=utf8,D=a_share_quant,P=3306,h=10.100.224.255,p=...,t=tb_quotation_history_warm,u=hli_gho
SELECT 21062909
INSERT 21062909
DELETE 0
Action         Count       Time        Pct
inserting   21062909  5050.9944      88.04
select          2108   131.6678       2.29
commit          4216    32.5790       0.57
other              0   522.2369       9.10
```







##### 2021



###### 202101

```sql
ALTER TABLE tb_quotation_history_trend_202101
ADD COLUMN id BIGINT UNSIGNED NULL;
```



```bash
pt-archiver \
  --source h=10.100.224.255,P=3306,D=a_share_quant,t=tb_quotation_history_trend_202101,u=hli_gho,p=Q836184425 \
  --dest   h=10.100.224.255,P=3306,D=a_share_quant,t=tb_quotation_history_warm,u=hli_gho,p=Q836184425 \
  --columns wind_code,trade_date,latest_price,total_volume,average_price,status,create_time,update_time,id \
  --where "trade_date >= '2021-01-01' AND trade_date < '2021-02-01'" \
  --limit 10000 \
  --commit-each \
  --progress 20000 \
  --no-delete \
  --charset utf8 \
  --statistics
```



```bash
2025-11-27T16:07:43    5781 18520000
2025-11-27T16:07:49    5787 18540000
2025-11-27T16:07:50    5787 18542592
Started at 2025-11-27T14:31:22, ended at 2025-11-27T16:07:50
Source: A=utf8,D=a_share_quant,P=3306,h=10.100.224.255,p=...,t=tb_quotation_history_trend_202101,u=hli_gho
Dest:   A=utf8,D=a_share_quant,P=3306,h=10.100.224.255,p=...,t=tb_quotation_history_warm,u=hli_gho
SELECT 18542592
INSERT 18542592
DELETE 0
Action         Count       Time        Pct
inserting   18542592  5066.3477      87.53
select          1856   168.5592       2.91
commit          3712    46.3241       0.80
other              0   506.7557       8.76
```





###### 202102

```sql
ALTER TABLE tb_quotation_history_trend_202102
ADD COLUMN id BIGINT UNSIGNED NULL;
```



```bash
pt-archiver \
  --source h=10.100.224.255,P=3306,D=a_share_quant,t=tb_quotation_history_trend_202102,u=hli_gho,p=Q836184425 \
  --dest   h=10.100.224.255,P=3306,D=a_share_quant,t=tb_quotation_history_warm,u=hli_gho,p=Q836184425 \
  --columns wind_code,trade_date,latest_price,total_volume,average_price,status,create_time,update_time,id \
  --where "trade_date >= '2021-02-01' AND trade_date < '2021-03-01'" \
  --limit 10000 \
  --commit-each \
  --progress 20000 \
  --no-delete \
  --charset utf8 \
  --statistics
```



```bash
2025-11-27T15:50:31    4483 13920000
2025-11-27T15:50:38    4489 13940000
2025-11-27T15:50:42    4494 13954687
Started at 2025-11-27T14:35:48, ended at 2025-11-27T15:50:42
Source: A=utf8,D=a_share_quant,P=3306,h=10.100.224.255,p=...,t=tb_quotation_history_trend_202102,u=hli_gho
Dest:   A=utf8,D=a_share_quant,P=3306,h=10.100.224.255,p=...,t=tb_quotation_history_warm,u=hli_gho
SELECT 13954687
INSERT 13954687
DELETE 0
Action         Count       Time        Pct
inserting   13954687  3948.3831      87.86
select          1397   131.9698       2.94
commit          2794    32.8121       0.73
other              0   380.9343       8.48
```





###### 202103

```sql
ALTER TABLE tb_quotation_history_trend_202103
ADD COLUMN id BIGINT UNSIGNED NULL;
```



```bash
pt-archiver \
  --source h=10.100.224.255,P=3306,D=a_share_quant,t=tb_quotation_history_trend_202103,u=hli_gho,p=Q836184425 \
  --dest   h=10.100.224.255,P=3306,D=a_share_quant,t=tb_quotation_history_warm,u=hli_gho,p=Q836184425 \
  --columns wind_code,trade_date,latest_price,total_volume,average_price,status,create_time,update_time,id \
  --where "trade_date >= '2021-03-01' AND trade_date < '2021-04-01'" \
  --limit 10000 \
  --commit-each \
  --progress 20000 \
  --no-delete \
  --charset utf8 \
  --statistics
```



```bash
2025-11-27T16:27:32    6686 21580000
2025-11-27T16:27:38    6693 21600000
2025-11-27T16:27:44    6698 21614541
Started at 2025-11-27T14:36:05, ended at 2025-11-27T16:27:44
Source: A=utf8,D=a_share_quant,P=3306,h=10.100.224.255,p=...,t=tb_quotation_history_trend_202103,u=hli_gho
Dest:   A=utf8,D=a_share_quant,P=3306,h=10.100.224.255,p=...,t=tb_quotation_history_warm,u=hli_gho
SELECT 21614541
INSERT 21614541
DELETE 0
Action         Count       Time        Pct
inserting   21614541  5866.1423      87.57
select          2163   204.3729       3.05
commit          4326    56.4938       0.84
other              0   572.0985       8.54
```





###### 202104

```sql
ALTER TABLE tb_quotation_history_trend_202104
ADD COLUMN id BIGINT UNSIGNED NULL;
```



```bash
pt-archiver \
  --source h=10.100.224.255,P=3306,D=a_share_quant,t=tb_quotation_history_trend_202104,u=hli_gho,p=Q836184425 \
  --dest   h=10.100.224.255,P=3306,D=a_share_quant,t=tb_quotation_history_warm,u=hli_gho,p=Q836184425 \
  --columns wind_code,trade_date,latest_price,total_volume,average_price,status,create_time,update_time,id \
  --where "trade_date >= '2021-04-01' AND trade_date < '2021-05-01'" \
  --limit 10000 \
  --commit-each \
  --progress 20000 \
  --no-delete \
  --charset utf8 \
  --statistics
```



```bash
2025-11-27T16:33:41    6335 19900000
2025-11-27T16:33:48    6342 19920000
2025-11-27T16:33:49    6343 19922786
Started at 2025-11-27T14:48:06, ended at 2025-11-27T16:33:49
Source: A=utf8,D=a_share_quant,P=3306,h=10.100.224.255,p=...,t=tb_quotation_history_trend_202104,u=hli_gho
Dest:   A=utf8,D=a_share_quant,P=3306,h=10.100.224.255,p=...,t=tb_quotation_history_warm,u=hli_gho
SELECT 19922786
INSERT 19922786
DELETE 0
Action         Count       Time        Pct
inserting   19922786  5543.7186      87.39
select          1994   195.3621       3.08
commit          3988    54.2119       0.85
other              0   550.1400       8.67
```







###### 202105

```sql
ALTER TABLE tb_quotation_history_trend_202105
ADD COLUMN id BIGINT UNSIGNED NULL;
```

```bash
pt-archiver \
  --source h=10.100.224.255,P=3306,D=a_share_quant,t=tb_quotation_history_trend_202105,u=hli_gho,p=Q836184425 \
  --dest   h=10.100.224.255,P=3306,D=a_share_quant,t=tb_quotation_history_warm,u=hli_gho,p=Q836184425 \
  --columns wind_code,trade_date,latest_price,total_volume,average_price,status,create_time,update_time,id \
  --where "trade_date >= '2021-05-01' AND trade_date < '2021-06-01'" \
  --limit 10000 \
  --commit-each \
  --progress 20000 \
  --no-delete \
  --charset utf8 \
  --statistics
```



```bash
2025-11-27T16:20:01    5435 17220000
2025-11-27T16:20:08    5442 17240000
2025-11-27T16:20:10    5444 17245842
Started at 2025-11-27T14:49:25, ended at 2025-11-27T16:20:10
Source: A=utf8,D=a_share_quant,P=3306,h=10.100.224.255,p=...,t=tb_quotation_history_trend_202105,u=hli_gho
Dest:   A=utf8,D=a_share_quant,P=3306,h=10.100.224.255,p=...,t=tb_quotation_history_warm,u=hli_gho
SELECT 17245842
INSERT 17245842
DELETE 0
Action         Count       Time        Pct
inserting   17245842  4763.7459      87.49
select          1726   166.9538       3.07
commit          3452    45.0741       0.83
other              0   468.8758       8.61
```





###### 202106



```sql
ALTER TABLE tb_quotation_history_trend_202106
ADD COLUMN id BIGINT UNSIGNED NULL;
```



```bash
pt-archiver \
  --source h=10.100.224.255,P=3306,D=a_share_quant,t=tb_quotation_history_trend_202106,u=hli_gho,p=Q836184425 \
  --dest   h=10.100.224.255,P=3306,D=a_share_quant,t=tb_quotation_history_warm,u=hli_gho,p=Q836184425 \
  --columns wind_code,trade_date,latest_price,total_volume,average_price,status,create_time,update_time,id \
  --where "trade_date >= '2021-06-01' AND trade_date < '2021-07-01'" \
  --limit 10000 \
  --commit-each \
  --progress 20000 \
  --no-delete \
  --charset utf8 \
  --statistics
```



```bash
2025-11-27T16:43:21    6701 20480000
2025-11-27T16:43:27    6707 20500000
2025-11-27T16:43:32    6712 20515539
Started at 2025-11-27T14:51:40, ended at 2025-11-27T16:43:32
Source: A=utf8,D=a_share_quant,P=3306,h=10.100.224.255,p=...,t=tb_quotation_history_trend_202106,u=hli_gho
Dest:   A=utf8,D=a_share_quant,P=3306,h=10.100.224.255,p=...,t=tb_quotation_history_warm,u=hli_gho
SELECT 20515539
INSERT 20515539
DELETE 0
Action         Count       Time        Pct
inserting   20515539  5857.4655      87.26
select          2053   208.9872       3.11
commit          4106    59.9913       0.89
other              0   586.3227       8.73
```





###### 202107

```sql
ALTER TABLE tb_quotation_history_trend_202107
ADD COLUMN id BIGINT UNSIGNED NULL;
```

```bash
pt-archiver \
  --source h=10.100.224.255,P=3306,D=a_share_quant,t=tb_quotation_history_trend_202107,u=hli_gho,p=Q836184425 \
  --dest   h=10.100.224.255,P=3306,D=a_share_quant,t=tb_quotation_history_warm,u=hli_gho,p=Q836184425 \
  --columns wind_code,trade_date,latest_price,total_volume,average_price,status,create_time,update_time,id \
  --where "trade_date >= '2021-07-01' AND trade_date < '2021-08-01'" \
  --limit 10000 \
  --commit-each \
  --progress 20000 \
  --no-delete \
  --charset utf8 \
  --statistics
```



```bash
2025-11-27T18:10:49    7022 21760000
2025-11-27T18:10:56    7029 21780000
2025-11-27T18:11:03    7035 21798860
Started at 2025-11-27T16:13:47, ended at 2025-11-27T18:11:03
Source: A=utf8,D=a_share_quant,P=3306,h=10.100.224.255,p=...,t=tb_quotation_history_trend_202107,u=hli_gho
Dest:   A=utf8,D=a_share_quant,P=3306,h=10.100.224.255,p=...,t=tb_quotation_history_warm,u=hli_gho
SELECT 21798860
INSERT 21798860
DELETE 0
Action         Count       Time        Pct
inserting   21798860  6155.6593      87.49
select          2181   231.8865       3.30
commit          4362    59.4076       0.84
other              0   589.0238       8.37
```





###### 202108

```sql
ALTER TABLE tb_quotation_history_trend_202108
ADD COLUMN id BIGINT UNSIGNED NULL;
```

```bash
pt-archiver \
  --source h=10.100.224.255,P=3306,D=a_share_quant,t=tb_quotation_history_trend_202108,u=hli_gho,p=Q836184425 \
  --dest   h=10.100.224.255,P=3306,D=a_share_quant,t=tb_quotation_history_warm,u=hli_gho,p=Q836184425 \
  --columns wind_code,trade_date,latest_price,total_volume,average_price,status,create_time,update_time,id \
  --where "trade_date >= '2021-08-01' AND trade_date < '2021-09-01'" \
  --limit 10000 \
  --commit-each \
  --progress 20000 \
  --no-delete \
  --charset utf8 \
  --statistics
```

```bash
2025-11-27T18:15:50    7246 22100000
2025-11-27T18:15:56    7251 22120000
2025-11-27T18:15:57    7252 22126012
Started at 2025-11-27T16:15:04, ended at 2025-11-27T18:15:57
Source: A=utf8,D=a_share_quant,P=3306,h=10.100.224.255,p=...,t=tb_quotation_history_trend_202108,u=hli_gho
Dest:   A=utf8,D=a_share_quant,P=3306,h=10.100.224.255,p=...,t=tb_quotation_history_warm,u=hli_gho
SELECT 22126012
INSERT 22126012
DELETE 0
Action         Count       Time        Pct
inserting   22126012  6337.4048      87.38
select          2214   220.4678       3.04
commit          4428    66.6994       0.92
other              0   628.1967       8.66
```





###### 202109

```sql
ALTER TABLE tb_quotation_history_trend_202109
ADD COLUMN id BIGINT UNSIGNED NULL;
```

```bash
pt-archiver \
  --source h=10.100.224.255,P=3306,D=a_share_quant,t=tb_quotation_history_trend_202109,u=hli_gho,p=Q836184425 \
  --dest   h=10.100.224.255,P=3306,D=a_share_quant,t=tb_quotation_history_warm,u=hli_gho,p=Q836184425 \
  --columns wind_code,trade_date,latest_price,total_volume,average_price,status,create_time,update_time,id \
  --where "trade_date >= '2021-09-01' AND trade_date < '2021-10-01'" \
  --limit 10000 \
  --commit-each \
  --progress 20000 \
  --no-delete \
  --charset utf8 \
  --statistics
```



```bash
2025-11-27T18:09:43    6522 20480000
2025-11-27T18:09:48    6527 20500000
2025-11-27T18:09:49    6527 20500957
Started at 2025-11-27T16:21:01, ended at 2025-11-27T18:09:49
Source: A=utf8,D=a_share_quant,P=3306,h=10.100.224.255,p=...,t=tb_quotation_history_trend_202109,u=hli_gho
Dest:   A=utf8,D=a_share_quant,P=3306,h=10.100.224.255,p=...,t=tb_quotation_history_warm,u=hli_gho
SELECT 20500957
INSERT 20500957
DELETE 0
Action         Count       Time        Pct
inserting   20500957  5707.0949      87.43
select          2052   211.4682       3.24
commit          4104    60.2216       0.92
other              0   549.0978       8.41
```





###### 202110

```sql
ALTER TABLE tb_quotation_history_trend_202110
ADD COLUMN id BIGINT UNSIGNED NULL;
```



```bash
pt-archiver \
  --source h=10.100.224.255,P=3306,D=a_share_quant,t=tb_quotation_history_trend_202110,u=hli_gho,p=Q836184425 \
  --dest   h=10.100.224.255,P=3306,D=a_share_quant,t=tb_quotation_history_warm,u=hli_gho,p=Q836184425 \
  --columns wind_code,trade_date,latest_price,total_volume,average_price,status,create_time,update_time,id \
  --where "trade_date >= '2021-10-01' AND trade_date < '2021-11-01'" \
  --limit 10000 \
  --commit-each \
  --progress 20000 \
  --no-delete \
  --charset utf8 \
  --statistics
```



```bash
2025-11-27T17:55:51    5206 16100000
2025-11-27T17:55:57    5212 16120000
2025-11-27T17:55:59    5215 16128651
Started at 2025-11-27T16:29:04, ended at 2025-11-27T17:55:59
Source: A=utf8,D=a_share_quant,P=3306,h=10.100.224.255,p=...,t=tb_quotation_history_trend_202110,u=hli_gho
Dest:   A=utf8,D=a_share_quant,P=3306,h=10.100.224.255,p=...,t=tb_quotation_history_warm,u=hli_gho
SELECT 16128651
INSERT 16128651
DELETE 0
Action         Count       Time        Pct
inserting   16128651  4550.5395      87.25
select          1614   158.9485       3.05
commit          3228    50.4462       0.97
other              0   455.4095       8.73
```







###### 202111

```sql
ALTER TABLE tb_quotation_history_trend_202111
ADD COLUMN id BIGINT UNSIGNED NULL;
```



```bash
pt-archiver \
  --source h=10.100.224.255,P=3306,D=a_share_quant,t=tb_quotation_history_trend_202111,u=hli_gho,p=Q836184425 \
  --dest   h=10.100.224.255,P=3306,D=a_share_quant,t=tb_quotation_history_warm,u=hli_gho,p=Q836184425 \
  --columns wind_code,trade_date,latest_price,total_volume,average_price,status,create_time,update_time,id \
  --where "trade_date >= '2021-11-01' AND trade_date < '2021-12-01'" \
  --limit 10000 \
  --commit-each \
  --progress 20000 \
  --no-delete \
  --charset utf8 \
  --statistics
```



```bash
2025-11-27T18:28:27    7104 22720000
2025-11-27T18:28:33    7110 22740000
2025-11-27T18:28:37    7115 22759292
Started at 2025-11-27T16:30:02, ended at 2025-11-27T18:28:37
Source: A=utf8,D=a_share_quant,P=3306,h=10.100.224.255,p=...,t=tb_quotation_history_trend_202111,u=hli_gho
Dest:   A=utf8,D=a_share_quant,P=3306,h=10.100.224.255,p=...,t=tb_quotation_history_warm,u=hli_gho
SELECT 22759292
INSERT 22759292
DELETE 0
Action         Count       Time        Pct
inserting   22759292  6204.2172      87.20
select          2277   216.0572       3.04
commit          4554    68.1862       0.96
other              0   626.5560       8.81
```





###### 202112

```sql
ALTER TABLE tb_quotation_history_trend_202112
ADD COLUMN id BIGINT UNSIGNED NULL;
```



```bash
pt-archiver \
  --source h=10.100.224.255,P=3306,D=a_share_quant,t=tb_quotation_history_trend_202112,u=hli_gho,p=Q836184425 \
  --dest   h=10.100.224.255,P=3306,D=a_share_quant,t=tb_quotation_history_warm,u=hli_gho,p=Q836184425 \
  --columns wind_code,trade_date,latest_price,total_volume,average_price,status,create_time,update_time,id \
  --where "trade_date >= '2021-12-01' AND trade_date < '2022-01-01'" \
  --limit 10000 \
  --commit-each \
  --progress 20000 \
  --no-delete \
  --charset utf8 \
  --statistics
```



```bash
2025-11-27T18:35:38    7463 24080000
2025-11-27T18:35:42    7467 24100000
2025-11-27T18:35:45    7471 24118399
Started at 2025-11-27T16:31:14, ended at 2025-11-27T18:35:45
Source: A=utf8,D=a_share_quant,P=3306,h=10.100.224.255,p=...,t=tb_quotation_history_trend_202112,u=hli_gho
Dest:   A=utf8,D=a_share_quant,P=3306,h=10.100.224.255,p=...,t=tb_quotation_history_warm,u=hli_gho
SELECT 24118399
INSERT 24118399
DELETE 0
Action         Count       Time        Pct
inserting   24118399  6527.5876      87.37
select          2413   223.1519       2.99
commit          4826    62.5135       0.84
other              0   658.1241       8.81
```















##### 2022





###### 202201

```sql
ALTER TABLE tb_quotation_history_trend_202201
ADD COLUMN id BIGINT UNSIGNED NULL;
```



```bash
pt-archiver \
  --source h=10.100.224.248,P=3306,D=a_share_quant,t=tb_quotation_history_trend_202201,u=hli_gho,p=Q836184425 \
  --dest   h=10.100.224.248,P=3306,D=a_share_quant,t=tb_quotation_history_warm,u=hli_gho,p=Q836184425 \
  --columns wind_code,trade_date,latest_price,total_volume,average_price,status,create_time,update_time,id \
  --where "trade_date >= '2022-01-01' AND trade_date < '2022-02-01'" \
  --limit 10000 \
  --commit-each \
  --progress 20000 \
  --no-delete \
  --charset utf8 \
  --statistics
```



```bash
2025-12-02T12:20:49    8515 20140000
2025-12-02T12:20:59    8525 20160000
2025-12-02T12:21:02    8528 20166173
Started at 2025-12-02T09:58:54, ended at 2025-12-02T12:21:02
Source: A=utf8,D=a_share_quant,P=3306,h=10.100.224.248,p=...,t=tb_quotation_history_trend_202201,u=hli_gho
Dest:   A=utf8,D=a_share_quant,P=3306,h=10.100.224.248,p=...,t=tb_quotation_history_warm,u=hli_gho
SELECT 20166173
INSERT 20166173
DELETE 0
Action         Count       Time        Pct
inserting   20166173  7582.7976      88.91
select          2018   233.2752       2.74
commit          4036    65.7673       0.77
other              0   646.5433       7.58
```







###### 202202

```sql
ALTER TABLE tb_quotation_history_trend_202202
ADD COLUMN id BIGINT UNSIGNED NULL;
```



```bash
pt-archiver \
  --source h=10.100.224.248,P=3306,D=a_share_quant,t=tb_quotation_history_trend_202202,u=hli_gho,p=Q836184425 \
  --dest   h=10.100.224.248,P=3306,D=a_share_quant,t=tb_quotation_history_warm,u=hli_gho,p=Q836184425 \
  --columns wind_code,trade_date,latest_price,total_volume,average_price,status,create_time,update_time,id \
  --where "trade_date >= '2022-02-01' AND trade_date < '2022-03-01'" \
  --limit 10000 \
  --commit-each \
  --progress 20000 \
  --no-delete \
  --charset utf8 \
  --statistics
```



```bash
2025-12-02T11:56:41    6958 16860000
2025-12-02T11:56:50    6967 16880000
2025-12-02T11:56:58    6975 16887321
Started at 2025-12-02T10:00:42, ended at 2025-12-02T11:56:58
Source: A=utf8,D=a_share_quant,P=3306,h=10.100.224.248,p=...,t=tb_quotation_history_trend_202202,u=hli_gho
Dest:   A=utf8,D=a_share_quant,P=3306,h=10.100.224.248,p=...,t=tb_quotation_history_warm,u=hli_gho
SELECT 16887321
INSERT 16887321
DELETE 0
Action         Count       Time        Pct
inserting   16887321  6195.8210      88.82
select          1690   180.4024       2.59
commit          3380    57.1584       0.82
other              0   542.5348       7.78
```







###### 202203

```sql
ALTER TABLE tb_quotation_history_trend_202203
ADD COLUMN id BIGINT UNSIGNED NULL;
```



```bash
pt-archiver \
  --source h=10.100.224.248,P=3306,D=a_share_quant,t=tb_quotation_history_trend_202203,u=hli_gho,p=Q836184425 \
  --dest   h=10.100.224.248,P=3306,D=a_share_quant,t=tb_quotation_history_warm,u=hli_gho,p=Q836184425 \
  --columns wind_code,trade_date,latest_price,total_volume,average_price,status,create_time,update_time,id \
  --where "trade_date >= '2022-03-01' AND trade_date < '2022-04-01'" \
  --limit 10000 \
  --commit-each \
  --progress 20000 \
  --no-delete \
  --charset utf8 \
  --statistics
```



```bash
2025-12-02T12:55:35   10425 24460000
2025-12-02T12:55:43   10433 24480000
2025-12-02T12:55:50   10440 24496486
Started at 2025-12-02T10:01:49, ended at 2025-12-02T12:55:50
Source: A=utf8,D=a_share_quant,P=3306,h=10.100.224.248,p=...,t=tb_quotation_history_trend_202203,u=hli_gho
Dest:   A=utf8,D=a_share_quant,P=3306,h=10.100.224.248,p=...,t=tb_quotation_history_warm,u=hli_gho
SELECT 24496486
INSERT 24496486
DELETE 0
Action         Count       Time        Pct
inserting   24496486  9244.2340      88.54
select          2451   290.5633       2.78
commit          4902    90.1529       0.86
other              0   815.4312       7.81
```







###### 202204

```sql
ALTER TABLE tb_quotation_history_trend_202204
ADD COLUMN id BIGINT UNSIGNED NULL;
```



```bash
pt-archiver \
  --source h=10.100.224.248,P=3306,D=a_share_quant,t=tb_quotation_history_trend_202204,u=hli_gho,p=Q836184425 \
  --dest   h=10.100.224.248,P=3306,D=a_share_quant,t=tb_quotation_history_warm,u=hli_gho,p=Q836184425 \
  --columns wind_code,trade_date,latest_price,total_volume,average_price,status,create_time,update_time,id \
  --where "trade_date >= '2022-04-01' AND trade_date < '2022-05-01'" \
  --limit 10000 \
  --commit-each \
  --progress 20000 \
  --no-delete \
  --charset utf8 \
  --statistics
```



```bash
2025-12-02T12:34:09    8890 20300000
2025-12-02T12:34:18    8899 20320000
2025-12-02T12:34:24    8905 20333727
Started at 2025-12-02T10:05:59, ended at 2025-12-02T12:34:24
Source: A=utf8,D=a_share_quant,P=3306,h=10.100.224.248,p=...,t=tb_quotation_history_trend_202204,u=hli_gho
Dest:   A=utf8,D=a_share_quant,P=3306,h=10.100.224.248,p=...,t=tb_quotation_history_warm,u=hli_gho
SELECT 20333727
INSERT 20333727
DELETE 0
Action         Count       Time        Pct
inserting   20333727  7877.6333      88.46
select          2035   257.8470       2.90
commit          4070    78.1634       0.88
other              0   691.9597       7.77
```







###### 202205(?)

```sql
ALTER TABLE tb_quotation_history_trend_202205
ADD COLUMN id BIGINT UNSIGNED NULL;
```



```bash
pt-archiver \
  --source h=10.100.224.54,P=3306,D=a_share_quant,t=tb_quotation_history_trend_202205,u=hli_gho,p=Q836184425 \
  --dest   h=10.100.224.54,P=3306,D=a_share_quant,t=tb_quotation_history_warm,u=hli_gho,p=Q836184425 \
  --columns wind_code,trade_date,latest_price,total_volume,average_price,status,create_time,update_time,id \
  --where "trade_date >= '2022-05-01' AND trade_date < '2022-06-01'" \
  --limit 10000 \
  --commit-each \
  --progress 20000 \
  --no-delete \
  --charset utf8 \
  --statistics
```



```bash
2025-12-02T12:32:43    8689 20340000
2025-12-02T12:32:53    8699 20360000
2025-12-02T12:32:56    8702 20366974
Started at 2025-12-02T10:07:53, ended at 2025-12-02T12:32:56
Source: A=utf8,D=a_share_quant,P=3306,h=10.100.224.248,p=...,t=tb_quotation_history_trend_202205,u=hli_gho
Dest:   A=utf8,D=a_share_quant,P=3306,h=10.100.224.248,p=...,t=tb_quotation_history_warm,u=hli_gho
SELECT 20366974
INSERT 20366974
DELETE 0
Action         Count       Time        Pct
inserting   20366974  7724.1140      88.75
select          2038   242.0443       2.78
commit          4076    77.6415       0.89
other              0   658.9705       7.57
```





```sql
-- Á°Æ‰øùÂè™Ê∏ÖÁ©∫Êï∞ÊçÆÔºå‰øùÁïôÂàÜÂå∫ÁªìÊûÑ‰ª•‰æøÈáçÊñ∞ÂõûÂ°´
ALTER TABLE tb_quotation_history_warm TRUNCATE PARTITION p202205;
```

```sql
SELECT COUNT(1) AS row_count
FROM tb_quotation_history_warm PARTITION (p202205);
```

```bash
2025-12-03T16:48:53    7881 20340000
2025-12-03T16:49:03    7891 20360000
2025-12-03T16:49:07    7895 20366974
Started at 2025-12-03T14:37:31, ended at 2025-12-03T16:49:07
Source: A=utf8,D=a_share_quant,P=3306,h=10.100.224.54,p=...,t=tb_quotation_history_trend_202205,u=hli_gho
Dest:   A=utf8,D=a_share_quant,P=3306,h=10.100.224.54,p=...,t=tb_quotation_history_warm,u=hli_gho
SELECT 20366974
INSERT 20366974
DELETE 0
Action         Count       Time        Pct
inserting   20366974  7043.0657      89.21
select          2038   169.5846       2.15
commit          4076    65.4867       0.83
other              0   617.0421       7.82
```









###### 202206

```sql
ALTER TABLE tb_quotation_history_trend_202206
ADD COLUMN id BIGINT UNSIGNED NULL;
```



```bash
pt-archiver \
  --source h=10.100.224.248,P=3306,D=a_share_quant,t=tb_quotation_history_trend_202206,u=hli_gho,p=Q836184425 \
  --dest   h=10.100.224.248,P=3306,D=a_share_quant,t=tb_quotation_history_warm,u=hli_gho,p=Q836184425 \
  --columns wind_code,trade_date,latest_price,total_volume,average_price,status,create_time,update_time,id \
  --where "trade_date >= '2022-06-01' AND trade_date < '2022-07-01'" \
  --limit 10000 \
  --commit-each \
  --progress 20000 \
  --no-delete \
  --charset utf8 \
  --statistics
```



```bash
2025-12-02T12:53:41    9786 22880000
2025-12-02T12:53:50    9795 22900000
2025-12-02T12:53:50    9795 22900112
Started at 2025-12-02T10:10:35, ended at 2025-12-02T12:53:50
Source: A=utf8,D=a_share_quant,P=3306,h=10.100.224.248,p=...,t=tb_quotation_history_trend_202206,u=hli_gho
Dest:   A=utf8,D=a_share_quant,P=3306,h=10.100.224.248,p=...,t=tb_quotation_history_warm,u=hli_gho
SELECT 22900112
INSERT 22900112
DELETE 0
Action         Count       Time        Pct
inserting   22900112  8662.3279      88.44
select          2292   281.6078       2.87
commit          4584    84.3124       0.86
other              0   766.8502       7.83
```







###### 202207



```sql
ALTER TABLE tb_quotation_history_trend_202207
ADD COLUMN id BIGINT UNSIGNED NULL;
```



```bash
pt-archiver \
  --source h=10.100.224.248,P=3306,D=a_share_quant,t=tb_quotation_history_trend_202207,u=hli_gho,p=Q836184425 \
  --dest   h=10.100.224.248,P=3306,D=a_share_quant,t=tb_quotation_history_warm,u=hli_gho,p=Q836184425 \
  --columns wind_code,trade_date,latest_price,total_volume,average_price,status,create_time,update_time,id \
  --where "trade_date >= '2022-07-01' AND trade_date < '2022-08-01'" \
  --limit 10000 \
  --commit-each \
  --progress 20000 \
  --no-delete \
  --charset utf8 \
  --statistics
```



```bash
2025-12-02T13:57:44    9786 22880000
2025-12-02T13:57:52    9793 22900000
2025-12-02T13:57:59    9800 22914062
Started at 2025-12-02T11:14:38, ended at 2025-12-02T13:57:59
Source: A=utf8,D=a_share_quant,P=3306,h=10.100.224.248,p=...,t=tb_quotation_history_trend_202207,u=hli_gho
Dest:   A=utf8,D=a_share_quant,P=3306,h=10.100.224.248,p=...,t=tb_quotation_history_warm,u=hli_gho
SELECT 22914062
INSERT 22914062
DELETE 0
Action         Count       Time        Pct
inserting   22914062  8652.1843      88.28
select          2293   280.5542       2.86
commit          4586    86.2419       0.88
other              0   781.8249       7.98
```







###### 202208

```sql
ALTER TABLE tb_quotation_history_trend_202208
ADD COLUMN id BIGINT UNSIGNED NULL;
```



```bash
pt-archiver \
  --source h=10.100.224.248,P=3306,D=a_share_quant,t=tb_quotation_history_trend_202208,u=hli_gho,p=Q836184425 \
  --dest   h=10.100.224.248,P=3306,D=a_share_quant,t=tb_quotation_history_warm,u=hli_gho,p=Q836184425 \
  --columns wind_code,trade_date,latest_price,total_volume,average_price,status,create_time,update_time,id \
  --where "trade_date >= '2022-08-01' AND trade_date < '2022-09-01'" \
  --limit 10000 \
  --commit-each \
  --progress 20000 \
  --no-delete \
  --charset utf8 \
  --statistics
```



```bash
2025-12-02T14:11:41   10556 25400000
2025-12-02T14:11:45   10561 25420000
2025-12-02T14:11:49   10565 25437316
Started at 2025-12-02T11:15:44, ended at 2025-12-02T14:11:49
Source: A=utf8,D=a_share_quant,P=3306,h=10.100.224.248,p=...,t=tb_quotation_history_trend_202208,u=hli_gho
Dest:   A=utf8,D=a_share_quant,P=3306,h=10.100.224.248,p=...,t=tb_quotation_history_warm,u=hli_gho
SELECT 25437316
INSERT 25437316
DELETE 0
Action         Count       Time        Pct
inserting   25437316  9346.1521      88.46
select          2545   294.3926       2.79
commit          5090    86.2958       0.82
other              0   838.2586       7.93
```







###### 202209

```sql
ALTER TABLE tb_quotation_history_trend_202209
ADD COLUMN id BIGINT UNSIGNED NULL;
```



```bash
pt-archiver \
  --source h=10.100.224.248,P=3306,D=a_share_quant,t=tb_quotation_history_trend_202209,u=hli_gho,p=Q836184425 \
  --dest   h=10.100.224.248,P=3306,D=a_share_quant,t=tb_quotation_history_warm,u=hli_gho,p=Q836184425 \
  --columns wind_code,trade_date,latest_price,total_volume,average_price,status,create_time,update_time,id \
  --where "trade_date >= '2022-09-01' AND trade_date < '2022-10-01'" \
  --limit 10000 \
  --commit-each \
  --progress 20000 \
  --no-delete \
  --charset utf8 \
  --statistics
```



```bash
2025-12-02T14:01:58    9910 23180000
2025-12-02T14:02:03    9915 23200000
2025-12-02T14:02:04    9916 23202607
Started at 2025-12-02T11:16:48, ended at 2025-12-02T14:02:04
Source: A=utf8,D=a_share_quant,P=3306,h=10.100.224.248,p=...,t=tb_quotation_history_trend_202209,u=hli_gho
Dest:   A=utf8,D=a_share_quant,P=3306,h=10.100.224.248,p=...,t=tb_quotation_history_warm,u=hli_gho
SELECT 23202607
INSERT 23202607
DELETE 0
Action         Count       Time        Pct
inserting   23202607  8746.0160      88.20
select          2322   293.9216       2.96
commit          4644    87.0864       0.88
other              0   789.2809       7.96
```







###### 202210

```sql
ALTER TABLE tb_quotation_history_trend_202210
ADD COLUMN id BIGINT UNSIGNED NULL;
```



```bash
pt-archiver \
  --source h=10.100.224.248,P=3306,D=a_share_quant,t=tb_quotation_history_trend_202210,u=hli_gho,p=Q836184425 \
  --dest   h=10.100.224.248,P=3306,D=a_share_quant,t=tb_quotation_history_warm,u=hli_gho,p=Q836184425 \
  --columns wind_code,trade_date,latest_price,total_volume,average_price,status,create_time,update_time,id \
  --where "trade_date >= '2022-10-01' AND trade_date < '2022-11-01'" \
  --limit 10000 \
  --commit-each \
  --progress 20000 \
  --no-delete \
  --charset utf8 \
  --statistics
```



```bash
2025-12-02T13:33:19    8128 17840000
2025-12-02T13:33:26    8135 17860000
2025-12-02T13:33:29    8138 17867799
Started at 2025-12-02T11:17:50, ended at 2025-12-02T13:33:29
Source: A=utf8,D=a_share_quant,P=3306,h=10.100.224.248,p=...,t=tb_quotation_history_trend_202210,u=hli_gho
Dest:   A=utf8,D=a_share_quant,P=3306,h=10.100.224.248,p=...,t=tb_quotation_history_warm,u=hli_gho
SELECT 17867799
INSERT 17867799
DELETE 0
Action         Count       Time        Pct
inserting   17867799  7214.2583      88.64
select          1788   248.5077       3.05
commit          3576    68.4893       0.84
other              0   607.5188       7.46
```







###### 202211(?)

```sql
ALTER TABLE tb_quotation_history_trend_202211
ADD COLUMN id BIGINT UNSIGNED NULL;
```



```bash
pt-archiver \
  --source h=192.168.0.106,P=3306,D=a_share_quant,t=tb_quotation_history_trend_202211,u=hli_gho,p=Q836184425 \
  --dest   h=192.168.0.106,P=3306,D=a_share_quant,t=tb_quotation_history_warm,u=hli_gho,p=Q836184425 \
  --columns wind_code,trade_date,latest_price,total_volume,average_price,status,create_time,update_time,id \
  --where "trade_date >= '2022-11-01' AND trade_date < '2022-12-01'" \
  --limit 10000 \
  --commit-each \
  --progress 20000 \
  --no-delete \
  --charset utf8 \
  --statistics
```



```bash
2025-12-02T14:10:47   10330 24900000
2025-12-02T14:10:53   10335 24920000
2025-12-02T14:10:57   10340 24937031
Started at 2025-12-02T11:18:37, ended at 2025-12-02T14:10:57
Source: A=utf8,D=a_share_quant,P=3306,h=10.100.224.248,p=...,t=tb_quotation_history_trend_202211,u=hli_gho
Dest:   A=utf8,D=a_share_quant,P=3306,h=10.100.224.248,p=...,t=tb_quotation_history_warm,u=hli_gho
SELECT 24937031
INSERT 24937031
DELETE 0
Action         Count       Time        Pct
inserting   24937031  9119.2975      88.19
select          2495   295.6822       2.86
commit          4990    81.5597       0.79
other              0   843.5879       8.16
```





```sql
-- Á°Æ‰øùÂè™Ê∏ÖÁ©∫Êï∞ÊçÆÔºå‰øùÁïôÂàÜÂå∫ÁªìÊûÑ‰ª•‰æøÈáçÊñ∞ÂõûÂ°´
ALTER TABLE tb_quotation_history_warm TRUNCATE PARTITION p202211;
```

```sql
SELECT COUNT(1) AS row_count
FROM tb_quotation_history_warm PARTITION (p202211);
```



```bash
2025-12-04T02:08:46    6263 24900000
2025-12-04T02:08:51    6269 24920000
2025-12-04T02:08:56    6273 24937031
Started at 2025-12-04T00:24:22, ended at 2025-12-04T02:08:56
Source: A=utf8,D=a_share_quant,P=3306,h=192.168.0.106,p=...,t=tb_quotation_history_trend_202211,u=hli_gho
Dest:   A=utf8,D=a_share_quant,P=3306,h=192.168.0.106,p=...,t=tb_quotation_history_warm,u=hli_gho
SELECT 24937031
INSERT 24937031
DELETE 0
Action         Count       Time        Pct
inserting   24937031  5524.2175      88.05
select          2495   128.0920       2.04
commit          4990    30.2915       0.48
other              0   591.1589       9.42
```







###### 202212

```sql
ALTER TABLE tb_quotation_history_trend_202212
ADD COLUMN id BIGINT UNSIGNED NULL;
```



```bash
pt-archiver \
  --source h=10.100.224.248,P=3306,D=a_share_quant,t=tb_quotation_history_trend_202212,u=hli_gho,p=Q836184425 \
  --dest   h=10.100.224.248,P=3306,D=a_share_quant,t=tb_quotation_history_warm,u=hli_gho,p=Q836184425 \
  --columns wind_code,trade_date,latest_price,total_volume,average_price,status,create_time,update_time,id \
  --where "trade_date >= '2022-12-01' AND trade_date < '2023-01-01'" \
  --limit 10000 \
  --commit-each \
  --progress 20000 \
  --no-delete \
  --charset utf8 \
  --statistics
```



```bash
2025-12-02T14:10:21   10252 24700000
2025-12-02T14:10:27   10258 24720000
2025-12-02T14:10:30   10261 24731799
Started at 2025-12-02T11:19:29, ended at 2025-12-02T14:10:30
Source: A=utf8,D=a_share_quant,P=3306,h=10.100.224.248,p=...,t=tb_quotation_history_trend_202212,u=hli_gho
Dest:   A=utf8,D=a_share_quant,P=3306,h=10.100.224.248,p=...,t=tb_quotation_history_warm,u=hli_gho
SELECT 24731799
INSERT 24731799
DELETE 0
Action         Count       Time        Pct
inserting   24731799  9062.5760      88.31
select          2475   287.2648       2.80
commit          4950    84.8145       0.83
other              0   827.0603       8.06
```





##### 2023



###### 202301

```sql
ALTER TABLE tb_quotation_history_trend_202301
ADD COLUMN id BIGINT UNSIGNED NULL;
```



```bash
pt-archiver \
  --source h=10.100.224.54,P=3306,D=a_share_quant,t=tb_quotation_history_trend_202301,u=hli_gho,p=Q836184425 \
  --dest   h=10.100.224.54,P=3306,D=a_share_quant,t=tb_quotation_history_warm,u=hli_gho,p=Q836184425 \
  --columns wind_code,trade_date,latest_price,total_volume,average_price,status,create_time,update_time,id \
  --where "trade_date >= '2023-01-01' AND trade_date < '2023-02-01'" \
  --limit 10000 \
  --commit-each \
  --progress 20000 \
  --no-delete \
  --charset utf8 \
  --statistics
```



```bash
2025-12-03T12:17:19    6322 18060000
2025-12-03T12:17:27    6329 18080000
2025-12-03T12:17:33    6335 18095506
Started at 2025-12-03T10:31:57, ended at 2025-12-03T12:17:33
Source: A=utf8,D=a_share_quant,P=3306,h=10.100.224.54,p=...,t=tb_quotation_history_trend_202301,u=hli_gho
Dest:   A=utf8,D=a_share_quant,P=3306,h=10.100.224.54,p=...,t=tb_quotation_history_warm,u=hli_gho
SELECT 18095506
INSERT 18095506
DELETE 0
Action         Count       Time        Pct
inserting   18095506  5576.1760      88.01
select          1811   195.9969       3.09
commit          3622    62.6980       0.99
other              0   500.6237       7.90
```





###### 202302

```sql
ALTER TABLE tb_quotation_history_trend_202302
ADD COLUMN id BIGINT UNSIGNED NULL;
```



```bash
pt-archiver \
  --source h=10.100.224.54,P=3306,D=a_share_quant,t=tb_quotation_history_trend_202302,u=hli_gho,p=Q836184425 \
  --dest   h=10.100.224.54,P=3306,D=a_share_quant,t=tb_quotation_history_warm,u=hli_gho,p=Q836184425 \
  --columns wind_code,trade_date,latest_price,total_volume,average_price,status,create_time,update_time,id \
  --where "trade_date >= '2023-02-01' AND trade_date < '2023-03-01'" \
  --limit 10000 \
  --commit-each \
  --progress 20000 \
  --no-delete \
  --charset utf8 \
  --statistics
```



```bash
2025-12-03T12:52:47    8438 22960000
2025-12-03T12:52:54    8445 22980000
2025-12-03T12:52:59    8450 22995134
Started at 2025-12-03T10:32:08, ended at 2025-12-03T12:52:59
Source: A=utf8,D=a_share_quant,P=3306,h=10.100.224.54,p=...,t=tb_quotation_history_trend_202302,u=hli_gho
Dest:   A=utf8,D=a_share_quant,P=3306,h=10.100.224.54,p=...,t=tb_quotation_history_warm,u=hli_gho
SELECT 22995134
INSERT 22995134
DELETE 0
Action         Count       Time        Pct
inserting   22995134  7442.3899      88.07
select          2301   265.8403       3.15
commit          4602    85.7597       1.01
other              0   656.9834       7.77
```





###### 202303

```sql
ALTER TABLE tb_quotation_history_trend_202303
ADD COLUMN id BIGINT UNSIGNED NULL;
```



```bash
pt-archiver \
  --source h=10.100.224.54,P=3306,D=a_share_quant,t=tb_quotation_history_trend_202303,u=hli_gho,p=Q836184425 \
  --dest   h=10.100.224.54,P=3306,D=a_share_quant,t=tb_quotation_history_warm,u=hli_gho,p=Q836184425 \
  --columns wind_code,trade_date,latest_price,total_volume,average_price,status,create_time,update_time,id \
  --where "trade_date >= '2023-03-01' AND trade_date < '2023-04-01'" \
  --limit 10000 \
  --commit-each \
  --progress 20000 \
  --no-delete \
  --charset utf8 \
  --statistics
```



```bash
2025-12-03T13:13:46    9687 26420000
2025-12-03T13:13:53    9694 26440000
2025-12-03T13:13:58    9700 26455243
Started at 2025-12-03T10:32:18, ended at 2025-12-03T13:13:58
Source: A=utf8,D=a_share_quant,P=3306,h=10.100.224.54,p=...,t=tb_quotation_history_trend_202303,u=hli_gho
Dest:   A=utf8,D=a_share_quant,P=3306,h=10.100.224.54,p=...,t=tb_quotation_history_warm,u=hli_gho
SELECT 26455243
INSERT 26455243
DELETE 0
Action         Count       Time        Pct
inserting   26455243  8542.0189      88.06
select          2647   316.3650       3.26
commit          5294   103.0513       1.06
other              0   738.8705       7.62
```





###### 202304

```sql
ALTER TABLE tb_quotation_history_trend_202304
ADD COLUMN id BIGINT UNSIGNED NULL;
```



```bash
pt-archiver \
  --source h=10.100.224.54,P=3306,D=a_share_quant,t=tb_quotation_history_trend_202304,u=hli_gho,p=Q836184425 \
  --dest   h=10.100.224.54,P=3306,D=a_share_quant,t=tb_quotation_history_warm,u=hli_gho,p=Q836184425 \
  --columns wind_code,trade_date,latest_price,total_volume,average_price,status,create_time,update_time,id \
  --where "trade_date >= '2023-04-01' AND trade_date < '2023-05-01'" \
  --limit 10000 \
  --commit-each \
  --progress 20000 \
  --no-delete \
  --charset utf8 \
  --statistics
```



```bash
2025-12-03T12:47:01    8073 22000000
2025-12-03T12:47:13    8085 22020000
2025-12-03T12:47:18    8090 22035393
Started at 2025-12-03T10:32:27, ended at 2025-12-03T12:47:18
Source: A=utf8,D=a_share_quant,P=3306,h=10.100.224.54,p=...,t=tb_quotation_history_trend_202304,u=hli_gho
Dest:   A=utf8,D=a_share_quant,P=3306,h=10.100.224.54,p=...,t=tb_quotation_history_warm,u=hli_gho
SELECT 22035393
INSERT 22035393
DELETE 0
Action         Count       Time        Pct
inserting   22035393  7104.7431      87.81
select          2205   280.4754       3.47
commit          4410    78.2705       0.97
other              0   627.4865       7.76
```





###### 202305

```sql
ALTER TABLE tb_quotation_history_trend_202305
ADD COLUMN id BIGINT UNSIGNED NULL;
```



```bash
pt-archiver \
  --source h=10.100.224.54,P=3306,D=a_share_quant,t=tb_quotation_history_trend_202305,u=hli_gho,p=Q836184425 \
  --dest   h=10.100.224.54,P=3306,D=a_share_quant,t=tb_quotation_history_warm,u=hli_gho,p=Q836184425 \
  --columns wind_code,trade_date,latest_price,total_volume,average_price,status,create_time,update_time,id \
  --where "trade_date >= '2023-05-01' AND trade_date < '2023-06-01'" \
  --limit 10000 \
  --commit-each \
  --progress 20000 \
  --no-delete \
  --charset utf8 \
  --statistics
```



```bash
2025-12-03T14:03:09    9584 23140000
2025-12-03T14:03:15    9591 23160000
2025-12-03T14:03:20    9596 23173125
Started at 2025-12-03T11:23:24, ended at 2025-12-03T14:03:20
Source: A=utf8,D=a_share_quant,P=3306,h=10.100.224.54,p=...,t=tb_quotation_history_trend_202305,u=hli_gho
Dest:   A=utf8,D=a_share_quant,P=3306,h=10.100.224.54,p=...,t=tb_quotation_history_warm,u=hli_gho
SELECT 23173125
INSERT 23173125
DELETE 0
Action         Count       Time        Pct
inserting   23173125  8403.1291      87.57
select          2319   344.1264       3.59
commit          4638    96.8649       1.01
other              0   751.9251       7.84
```





###### 202306

```sql
ALTER TABLE tb_quotation_history_trend_202306
ADD COLUMN id BIGINT UNSIGNED NULL;
```



```bash
pt-archiver \
  --source h=10.100.224.54,P=3306,D=a_share_quant,t=tb_quotation_history_trend_202306,u=hli_gho,p=Q836184425 \
  --dest   h=10.100.224.54,P=3306,D=a_share_quant,t=tb_quotation_history_warm,u=hli_gho,p=Q836184425 \
  --columns wind_code,trade_date,latest_price,total_volume,average_price,status,create_time,update_time,id \
  --where "trade_date >= '2023-06-01' AND trade_date < '2023-07-01'" \
  --limit 10000 \
  --commit-each \
  --progress 20000 \
  --no-delete \
  --charset utf8 \
  --statistics
```



```bash
2025-12-03T14:04:59    9683 23300000
2025-12-03T14:05:06    9689 23320000
2025-12-03T14:05:08    9692 23326743
Started at 2025-12-03T11:23:36, ended at 2025-12-03T14:05:08
Source: A=utf8,D=a_share_quant,P=3306,h=10.100.224.54,p=...,t=tb_quotation_history_trend_202306,u=hli_gho
Dest:   A=utf8,D=a_share_quant,P=3306,h=10.100.224.54,p=...,t=tb_quotation_history_warm,u=hli_gho
SELECT 23326743
INSERT 23326743
DELETE 0
Action         Count       Time        Pct
inserting   23326743  8505.2774      87.75
select          2334   354.0562       3.65
commit          4668   118.1968       1.22
other              0   714.8440       7.38
```





###### 202307

```sql
ALTER TABLE tb_quotation_history_trend_202307
ADD COLUMN id BIGINT UNSIGNED NULL;
```



```bash
pt-archiver \
  --source h=10.100.224.54,P=3306,D=a_share_quant,t=tb_quotation_history_trend_202307,u=hli_gho,p=Q836184425 \
  --dest   h=10.100.224.54,P=3306,D=a_share_quant,t=tb_quotation_history_warm,u=hli_gho,p=Q836184425 \
  --columns wind_code,trade_date,latest_price,total_volume,average_price,status,create_time,update_time,id \
  --where "trade_date >= '2023-07-01' AND trade_date < '2023-08-01'" \
  --limit 10000 \
  --commit-each \
  --progress 20000 \
  --no-delete \
  --charset utf8 \
  --statistics
```



```bash
2025-12-03T14:11:36   10068 24640000
2025-12-03T14:11:42   10074 24660000
2025-12-03T14:11:44   10076 24667120
Started at 2025-12-03T11:23:48, ended at 2025-12-03T14:11:44
Source: A=utf8,D=a_share_quant,P=3306,h=10.100.224.54,p=...,t=tb_quotation_history_trend_202307,u=hli_gho
Dest:   A=utf8,D=a_share_quant,P=3306,h=10.100.224.54,p=...,t=tb_quotation_history_warm,u=hli_gho
SELECT 24667120
INSERT 24667120
DELETE 0
Action         Count       Time        Pct
inserting   24667120  8858.2807      87.91
select          2468   380.2281       3.77
commit          4936   113.8069       1.13
other              0   723.8619       7.18
```





###### 202308

```sql
ALTER TABLE tb_quotation_history_trend_202308
ADD COLUMN id BIGINT UNSIGNED NULL;
```



```bash
pt-archiver \
  --source h=10.100.224.54,P=3306,D=a_share_quant,t=tb_quotation_history_trend_202308,u=hli_gho,p=Q836184425 \
  --dest   h=10.100.224.54,P=3306,D=a_share_quant,t=tb_quotation_history_warm,u=hli_gho,p=Q836184425 \
  --columns wind_code,trade_date,latest_price,total_volume,average_price,status,create_time,update_time,id \
  --where "trade_date >= '2023-08-01' AND trade_date < '2023-09-01'" \
  --limit 10000 \
  --commit-each \
  --progress 20000 \
  --no-delete \
  --charset utf8 \
  --statistics
```



```bash
2025-12-03T14:24:51   10844 27180000
2025-12-03T14:24:56   10849 27200000
2025-12-03T14:25:00   10854 27216088
Started at 2025-12-03T11:24:06, ended at 2025-12-03T14:25:00
Source: A=utf8,D=a_share_quant,P=3306,h=10.100.224.54,p=...,t=tb_quotation_history_trend_202308,u=hli_gho
Dest:   A=utf8,D=a_share_quant,P=3306,h=10.100.224.54,p=...,t=tb_quotation_history_warm,u=hli_gho
SELECT 27216088
INSERT 27216088
DELETE 0
Action         Count       Time        Pct
inserting   27216088  9491.4060      87.45
select          2723   384.7293       3.54
commit          5446   109.2524       1.01
other              0   868.6765       8.00
```





###### 202309

```sql
ALTER TABLE tb_quotation_history_trend_202309
ADD COLUMN id BIGINT UNSIGNED NULL;
```



```bash
pt-archiver \
  --source h=10.100.224.54,P=3306,D=a_share_quant,t=tb_quotation_history_trend_202309,u=hli_gho,p=Q836184425 \
  --dest   h=10.100.224.54,P=3306,D=a_share_quant,t=tb_quotation_history_warm,u=hli_gho,p=Q836184425 \
  --columns wind_code,trade_date,latest_price,total_volume,average_price,status,create_time,update_time,id \
  --where "trade_date >= '2023-09-01' AND trade_date < '2023-10-01'" \
  --limit 10000 \
  --commit-each \
  --progress 20000 \
  --no-delete \
  --charset utf8 \
  --statistics
```



```bash
2025-12-03T14:11:09   10014 23780000
2025-12-03T14:11:19   10024 23800000
2025-12-03T14:11:23   10028 23811053
Started at 2025-12-03T11:24:14, ended at 2025-12-03T14:11:23
Source: A=utf8,D=a_share_quant,P=3306,h=10.100.224.54,p=...,t=tb_quotation_history_trend_202309,u=hli_gho
Dest:   A=utf8,D=a_share_quant,P=3306,h=10.100.224.54,p=...,t=tb_quotation_history_warm,u=hli_gho
SELECT 23811053
INSERT 23811053
DELETE 0
Action         Count       Time        Pct
inserting   23811053  8827.1689      88.02
select          2383   346.5863       3.46
commit          4766   111.1873       1.11
other              0   743.2379       7.41
```





###### 202310

```sql
ALTER TABLE tb_quotation_history_trend_202310
ADD COLUMN id BIGINT UNSIGNED NULL;
```



```bash
pt-archiver \
  --source h=10.100.224.54,P=3306,D=a_share_quant,t=tb_quotation_history_trend_202310,u=hli_gho,p=Q836184425 \
  --dest   h=10.100.224.54,P=3306,D=a_share_quant,t=tb_quotation_history_warm,u=hli_gho,p=Q836184425 \
  --columns wind_code,trade_date,latest_price,total_volume,average_price,status,create_time,update_time,id \
  --where "trade_date >= '2023-10-01' AND trade_date < '2023-11-01'" \
  --limit 10000 \
  --commit-each \
  --progress 20000 \
  --no-delete \
  --charset utf8 \
  --statistics
```



```bash
2025-12-03T13:44:00    8377 20200000
2025-12-03T13:44:07    8384 20220000
2025-12-03T13:44:15    8392 20239924
Started at 2025-12-03T11:24:23, ended at 2025-12-03T13:44:15
Source: A=utf8,D=a_share_quant,P=3306,h=10.100.224.54,p=...,t=tb_quotation_history_trend_202310,u=hli_gho
Dest:   A=utf8,D=a_share_quant,P=3306,h=10.100.224.54,p=...,t=tb_quotation_history_warm,u=hli_gho
SELECT 20239924
INSERT 20239924
DELETE 0
Action         Count       Time        Pct
inserting   20239924  7353.6957      87.62
select          2025   303.7702       3.62
commit          4050    97.2532       1.16
other              0   637.9120       7.60
```





###### 202311

```sql
ALTER TABLE tb_quotation_history_trend_202311
ADD COLUMN id BIGINT UNSIGNED NULL;
```



```bash
pt-archiver \
  --source h=10.100.224.54,P=3306,D=a_share_quant,t=tb_quotation_history_trend_202311,u=hli_gho,p=Q836184425 \
  --dest   h=10.100.224.54,P=3306,D=a_share_quant,t=tb_quotation_history_warm,u=hli_gho,p=Q836184425 \
  --columns wind_code,trade_date,latest_price,total_volume,average_price,status,create_time,update_time,id \
  --where "trade_date >= '2023-11-01' AND trade_date < '2023-12-01'" \
  --limit 10000 \
  --commit-each \
  --progress 20000 \
  --no-delete \
  --charset utf8 \
  --statistics
```



```bash
2025-12-03T14:26:07   10886 26760000
2025-12-03T14:26:13   10891 26780000
2025-12-03T14:26:18   10896 26798150
Started at 2025-12-03T11:24:41, ended at 2025-12-03T14:26:18
Source: A=utf8,D=a_share_quant,P=3306,h=10.100.224.54,p=...,t=tb_quotation_history_trend_202311,u=hli_gho
Dest:   A=utf8,D=a_share_quant,P=3306,h=10.100.224.54,p=...,t=tb_quotation_history_warm,u=hli_gho
SELECT 26798150
INSERT 26798150
DELETE 0
Action         Count       Time        Pct
inserting   26798150  9520.7967      87.37
select          2681   409.7657       3.76
commit          5362   120.0070       1.10
other              0   846.3730       7.77
```





###### 202312

```sql
ALTER TABLE tb_quotation_history_trend_202312
ADD COLUMN id BIGINT UNSIGNED NULL;
```



```bash
pt-archiver \
  --source h=10.100.224.54,P=3306,D=a_share_quant,t=tb_quotation_history_trend_202312,u=hli_gho,p=Q836184425 \
  --dest   h=10.100.224.54,P=3306,D=a_share_quant,t=tb_quotation_history_warm,u=hli_gho,p=Q836184425 \
  --columns wind_code,trade_date,latest_price,total_volume,average_price,status,create_time,update_time,id \
  --where "trade_date >= '2023-12-01' AND trade_date < '2024-01-01'" \
  --limit 10000 \
  --commit-each \
  --progress 20000 \
  --no-delete \
  --charset utf8 \
  --statistics
```



```bash
2025-12-03T14:22:06   10633 25940000
2025-12-03T14:22:11   10638 25960000
2025-12-03T14:22:16   10643 25976044
Started at 2025-12-03T11:24:52, ended at 2025-12-03T14:22:16
Source: A=utf8,D=a_share_quant,P=3306,h=10.100.224.54,p=...,t=tb_quotation_history_trend_202312,u=hli_gho
Dest:   A=utf8,D=a_share_quant,P=3306,h=10.100.224.54,p=...,t=tb_quotation_history_warm,u=hli_gho
SELECT 25976044
INSERT 25976044
DELETE 0
Action         Count       Time        Pct
inserting   25976044  9316.1848      87.53
select          2599   373.3343       3.51
commit          5198   113.0393       1.06
other              0   840.7761       7.90
```











##### Êü•ÊºèË°•Áº∫



###### ‰øÆÂ§çSOP

1. **ÔºàÂÖ≥ÈîÆÔºâ** ÊâæÂà∞Âπ∂**ÂÅúÊ≠¢**ÊâÄÊúâËøòÂú®ÂæÄ `tb_quotation_history_trend_2022...` ÊóßË°®ÂÜôÂÖ•Êï∞ÊçÆÁöÑ‰∏öÂä°ÊàñËÑöÊú¨„ÄÇ

2. **ÔºàË°•5ÊúàÊï∞ÊçÆÔºâ** ËøêË°å‰Ω†‰πãÂâçÂ§±Ë¥•ÁöÑ `pt-archiver` ÂëΩ‰ª§Ôºå**Âä†‰∏ä `--replace`**ÔºåÂπ∂Ë∞ÉÂ∞è `--limit` ‰ª•Èôç‰ΩéÂú®Á∫øÂΩ±ÂìçÔºö

   Bash

   ```bash
   pt-archiver \
     --source h=192.168.0.106,P=3306,D=a_share_quant,t=tb_quotation_history_trend_202205,u=hli_gho,p=Q836184425 \
     --dest   h=192.168.0.106,P=3306,D=a_share_quant,t=tb_quotation_history_warm,u=hli_gho,p=Q836184425 \
     --columns wind_code,trade_date,latest_price,total_volume,average_price,status,create_time,update_time,id \
     --where "trade_date >= '2022-05-01' AND trade_date < '2022-06-01'" \
    --limit 1000 \
    --commit-each \
    --progress 10000 \
    --no-delete \
    --replace \
    --charset utf8 \
    --statistics
   ```

```bash
2025-12-03T03:21:39   13134 20350000
2025-12-03T03:21:43   13137 20360000
2025-12-03T03:21:45   13140 20366974
Started at 2025-12-02T23:42:45, ended at 2025-12-03T03:21:45
Source: A=utf8,D=a_share_quant,P=3306,h=192.168.0.106,p=...,t=tb_quotation_history_trend_202205,u=hli_gho
Dest:   A=utf8,D=a_share_quant,P=3306,h=192.168.0.106,p=...,t=tb_quotation_history_warm,u=hli_gho
SELECT 20366974
INSERT 40733948
DELETE 0
Action         Count       Time        Pct
inserting   20366974 11654.4999      88.69
commit         40736   573.7209       4.37
select         20368   238.8494       1.82
other              0   673.0334       5.12
```







**ÔºàË°•11ÊúàÊï∞ÊçÆÔºâ** ÂØπ 11 ÊúàÊâßË°å**ÂêåÊ†∑**ÁöÑÊìç‰ΩúÔºö

```bash
pt-archiver \
  --source h=192.168.0.106,P=3306,D=a_share_quant,t=tb_quotation_history_trend_202211,u=hli_gho,p=Q836184425 \
  --dest   h=192.168.0.106,P=3306,D=a_share_quant,t=tb_quotation_history_warm,u=hli_gho,p=Q836184425 \
  --columns wind_code,trade_date,latest_price,total_volume,average_price,status,create_time,update_time,id \
  --where "trade_date >= '2022-11-01' AND trade_date < '2022-12-01'" \
 --limit 1000 \
 --commit-each \
 --progress 10000 \
 --no-delete \
 --replace \
 --charset utf8 \
 --statistics
```

1. **ÔºàÊúÄÁªàÊ†°È™åÔºâ** ‰øÆÂ§çÂÆåÊàêÂêéÔºå**ÂÜçÊ¨°ËøêË°å**‰Ω†ÁöÑ Java Âπ∂ÂèëÊ†°È™åÁ®ãÂ∫è `VerificationController`ÔºåËøôÊ¨° 12 ‰∏™Êúà‰ªΩÂ∫îËØ•ÈÉΩ‰ºöÊòæÁ§∫ `ÈîôËØØ:0`„ÄÇ

```bash
2025-12-03T03:47:00   14642 24920000
2025-12-03T03:47:02   14644 24930000
2025-12-03T03:47:04   14646 24937031
Started at 2025-12-02T23:42:57, ended at 2025-12-03T03:47:04
Source: A=utf8,D=a_share_quant,P=3306,h=192.168.0.106,p=...,t=tb_quotation_history_trend_202211,u=hli_gho
Dest:   A=utf8,D=a_share_quant,P=3306,h=192.168.0.106,p=...,t=tb_quotation_history_warm,u=hli_gho
SELECT 24937031
INSERT 49874062
DELETE 0
Action         Count       Time        Pct
inserting   24937031 13016.8709      88.87
commit         49878   604.2517       4.13
select         24939   263.7010       1.80
other              0   761.8943       5.20
```



ËøôÊòØ‰∏Ä‰∏™ÈùûÂ∏∏‰∏ì‰∏ö‰∏î100%Ê≠£Á°ÆÁöÑ‚ÄúÂú®Á∫øÊï∞ÊçÆ‰øÆÂ§ç‚ÄùÔºàOnline Data RepairÔºâÂëΩ‰ª§„ÄÇ‰Ω†ÈóÆÁöÑ‰∏§‰∏™ÈóÆÈ¢ò‚Äî‚Äî‚ÄúÂ¶Ç‰ΩïË°•Êºè‚ÄùÂíå‚ÄúÂ¶Ç‰Ωï‰øùËØÅÊü•ËØ¢‚Äù‚Äî‚Äî‰πüÊÅ∞Â•ΩÊòØ `pt-archiver` Ëøô‰∏™Â∑•ÂÖ∑ËÆæËÆ°ÁöÑÊ†∏ÂøÉ„ÄÇ

Êàë‰ª¨Êù•ËØ¶ÁªÜÊãÜËß£‰∏Ä‰∏ãËøôÊù°ÂëΩ‰ª§‰∏∫‰ªÄ‰πàÊòØ‚ÄúÊïôÁßë‰π¶Á∫ßÂà´‚ÄùÁöÑ‰øÆÂ§çÊñπÊ°à„ÄÇ

------



###### ÂëΩ‰ª§ÂèÇÊï∞ËØ¶Ëß£

‰Ω†‰ΩøÁî®ÁöÑÊØè‰∏™ÂèÇÊï∞ÈÉΩÊúâÊòéÁ°ÆÁöÑ‚ÄúÂú®Á∫ø‚ÄùÂíå‚ÄúÂÆâÂÖ®‚ÄùËÄÉÈáèÔºö

- **`--source` Âíå `--dest`**Ôºö
  - **‰ΩúÁî®**ÔºöÊåáÂÆöÊ∫êÔºàÊóßË°® `...trend_202205`ÔºâÂíåÁõÆÊ†áÔºàÊñ∞Ë°® `...warm`Ôºâ„ÄÇ
- **`--where`**Ôºö
  - **‰ΩúÁî®**ÔºöÁ≤æÁ°ÆÂú∞Âè™ÊäìÂèñ 5 ÊúàÁöÑÊï∞ÊçÆ„ÄÇËøôÊòØ**ÊÄßËÉΩ‰øùÈöú**ÔºåÁ°Æ‰øù `pt-archiver` ‰∏ç‰ºöÊâ´ÊèèÊóßË°®ÁöÑÂÖ®Ë°®ÔºåËÄåÊòØÂè™Êâ´ÊèèÂÆÉÈúÄË¶Å‰øÆÂ§çÁöÑÈÇ£‰∏™ÊúàÁöÑÊï∞ÊçÆ„ÄÇ
- **`--limit 1000`**Ôºö
  - **‰ΩúÁî®**ÔºöËøôÊòØ**‰øùËØÅÂú®Á∫øÊü•ËØ¢**ÁöÑ**Á¨¨‰∏Ä‰∏™Ê†∏ÂøÉÂèÇÊï∞**„ÄÇÂÆÉÂëäËØâ `pt-archiver`Ôºö‚Äú‰∏çË¶Å‰∏ÄÊ¨°ÊÄßÊçû 2000 ‰∏áÊï∞ÊçÆÔºåËÄåÊòØÊØèÊ¨°Âè™‰ªéÊóßË°® `SELECT` 1000 Ë°å„ÄÇ‚Äù
- **`--commit-each`**Ôºö
  - **‰ΩúÁî®**ÔºöËøôÊòØ**‰øùËØÅÂú®Á∫øÊü•ËØ¢**ÁöÑ**Á¨¨‰∫å‰∏™Ê†∏ÂøÉÂèÇÊï∞**„ÄÇÂÆÉ‰∏é `--limit` ÈÖçÂêàÔºåÂëäËØâ `pt-archiver`Ôºö‚ÄúÊØèÂ§ÑÁêÜÂÆåÈÇ£ 1000 Ë°åÊï∞ÊçÆÔºåÂ∞±**Á´ãÂàª `COMMIT` Êèê‰∫§‰∏ÄÊ¨°‰∫ãÂä°**„ÄÇ‚Äù
- **`--no-delete`**Ôºö
  - **‰ΩúÁî®**Ôºö‰øùËØÅÂÆâÂÖ®„ÄÇÂè™Â§çÂà∂Ôºå‰∏çÂà†Èô§Ê∫êÊï∞ÊçÆ„ÄÇ
- **`--replace`**Ôºö
  - **‰ΩúÁî®**ÔºöËøôÊòØ**ÂÆûÁé∞‚ÄúË°•Êºè‚Äù\**ÁöÑ\**ÂîØ‰∏ÄÊ†∏ÂøÉÂèÇÊï∞**„ÄÇÂÆÉÂëäËØâ `pt-archiver`Ôºö‚ÄúÂú®ÊèíÂÖ•Êó∂Ôºå‰ΩøÁî® `REPLACE INTO` ËØ≠Âè•ÔºåËÄå‰∏çÊòØ `INSERT INTO`„ÄÇ‚Äù
- **`--progress 10000`**Ôºö
  - **‰ΩúÁî®**ÔºöÊó•ÂøóÂºÄÂÖ≥„ÄÇÊØèÂ§ÑÁêÜ 10000 Ë°åÔºàÂç≥ 10 ‰∏™ `limit` ÊâπÊ¨°ÔºâÔºåÂ∞±Âú®ÊéßÂà∂Âè∞ÊâìÂç∞‰∏ÄË°åËøõÂ∫¶ÔºàÂ∞±ÂÉè‰Ω†Áé∞Âú®ÁúãÂà∞ÁöÑÔºâ„ÄÇ
- **`--statistics`**Ôºö
  - **‰ΩúÁî®**Ôºö‰ªªÂä°ÁªìÊùüÂêéÔºåÊâìÂç∞‰∏Ä‰ªΩËØ¶ÁªÜÁöÑ `Action` ÁªüËÆ°Êä•ÂëäÔºà`SELECT` ‰∫ÜÂ§öÂ∞ëÔºå`INSERT` ‰∫ÜÂ§öÂ∞ëÁ≠âÔºâ„ÄÇ

------



###### ‰∏∫‰ªÄ‰πàÂÆÉËÉΩ‚ÄúË°•ÊºèÊï∞ÊçÆ‚ÄùÔºü

**Á≠îÊ°àÔºöÂÖ®Èù† `--replace` ÂèÇÊï∞„ÄÇ**

`--replace` Âà©Áî®‰∫Ü‰Ω†ÁöÑ**ÂîØ‰∏ÄÁ¥¢Âºï**Ôºà`uniq_windcode_tradedate`ÔºâÊù•ÂÆûÁé∞‚Äú‰øÆÂ§ç‚ÄùÂíå‚ÄúÊèíÂÖ•‚Äù‰∫åÂêà‰∏ÄÔºö

- **Âú∫ÊôØAÔºö‰øÆÂ§çÂ∑≤Â≠òÂú®ÁöÑÊï∞ÊçÆ**
  1. `pt-archiver` ‰ªéÊóßË°®ËØªÂà∞ 1 Ë°åÊï∞ÊçÆÔºàÊØîÂ¶Ç `id=100`Ôºâ„ÄÇ
  2. ÂÆÉÂ∞ùËØï `REPLACE INTO tb_warm ...` ËøôË°åÊï∞ÊçÆ„ÄÇ
  3. Êñ∞Ë°® `tb_warm` ÁöÑ `uniq_windcode_tradedate` Á¥¢ÂºïÂèëÁé∞Ôºö‚ÄúËøôË°åÊï∞ÊçÆ**Â∑≤Â≠òÂú®**ÔºÅ‚Äù
  4. `--replace` Êú∫Âà∂Ëß¶ÂèëÔºöMySQL **ÂÖàÂà†Èô§**Êñ∞Ë°®‰∏≠ÁöÑÊóßË°åÔºå**ÂÜçÊèíÂÖ•**ÂàöËØªÂà∞ÁöÑÊñ∞Ë°å„ÄÇ
- **Âú∫ÊôØBÔºöË°•‰∏äÈÅóÊºèÁöÑÊï∞ÊçÆÔºà‰Ω†ÁöÑ 9,360 Ë°åÔºâ**
  1. `pt-archiver` ‰ªéÊóßË°®ËØªÂà∞ 1 Ë°å**Â¢ûÈáè**Êï∞ÊçÆÔºàÊØîÂ¶Ç `id=9999999`Ôºâ„ÄÇ
  2. ÂÆÉÂ∞ùËØï `REPLACE INTO tb_warm ...` ËøôË°åÊï∞ÊçÆ„ÄÇ
  3. Êñ∞Ë°® `tb_warm` ÁöÑ `uniq_windcode_tradedate` Á¥¢ÂºïÂèëÁé∞Ôºö‚ÄúËøôË°åÊï∞ÊçÆ**‰∏çÂ≠òÂú®**ÔºÅ‚Äù
  4. `REPLACE` Ê≠§Êó∂ÁöÑË°å‰∏∫Á≠âÂêå‰∫é `INSERT`Ôºö**ÊàêÂäüÂ∞ÜËøôË°åÊñ∞Êï∞ÊçÆÊèíÂÖ•**„ÄÇ

**ÁªìËÆ∫**Ôºö`--replace` Á°Æ‰øù‰∫ÜÊó†ËÆ∫Êï∞ÊçÆÊòØÊóßÁöÑÔºàÈúÄË¶ÅË¶ÜÁõñÔºâËøòÊòØÊñ∞ÁöÑÔºàÈúÄË¶ÅÊèíÂÖ•ÔºâÔºåÊúÄÁªàÊñ∞Ë°®ÁöÑÊï∞ÊçÆÈÉΩ‰ºöÂíåÊóßË°®**ÂÆåÂÖ®‰∏ÄËá¥**„ÄÇÂÆÉÂÆåÁæéÂú∞Ë°•‰∏ä‰∫ÜÈÇ£ 9,360Ôºà5ÊúàÔºâÂíå 33,166Ôºà11ÊúàÔºâË°å‰∏¢Â§±ÁöÑÊï∞ÊçÆ„ÄÇ

------



###### ‰∏∫‰ªÄ‰πàÂÆÉËÉΩ‚Äú‰øùËØÅÁõ∏ÂØπÊü•ËØ¢‚ÄùÔºü

**Á≠îÊ°àÔºöÂÖ®Èù† `--limit 1000` Âíå `--commit-each` ÁöÑ‚ÄúÂæÆÊâπÊ¨° (Micro-batch)‚ÄùÁ≠ñÁï•„ÄÇ**

`pt-archiver` **‰∏ç‰ºö**ÊâßË°å‰∏Ä‰∏™ÈïøËææ 2.5 Â∞èÊó∂ÁöÑ‚ÄúË∂ÖÁ∫ßÂ§ß‰∫ãÂä°‚Äù„ÄÇÂ¶ÇÊûúÈÇ£Ê†∑ÂÅöÔºå‰ºö‰∫ßÁîüÊµ∑ÈáèÁöÑ `undo log` Âπ∂**ÈîÅÊ≠ªÊï¥Âº†Ë°®**Ôºå‰Ω†ÁöÑ‰∏öÂä°Â∞±ÂÆïÊú∫‰∫Ü„ÄÇ

Áõ∏ÂèçÔºåÂÆÉ‰ºöÂæ™ÁéØÊâßË°å‰ª•‰∏ã**‚ÄúÂæÆÂûã‰∫ãÂä°‚Äù**Ôºö

1. `START TRANSACTION;`
2. `SELECT * FROM ...trend_202205 ... LIMIT 1000;` (ËøôÂæàÂø´ÔºåÂè™ÈîÅ 1000 Ë°å)
3. `REPLACE INTO ...warm (row 1);`
4. `REPLACE INTO ...warm (row 2);`
5. ...
6. `REPLACE INTO ...warm (row 1000);`
7. `COMMIT;` (ËøôÂæàÂø´ÔºåÂè™Êèê‰∫§ 1000 Ë°åÂèòÊõ¥ÔºåÁ´ãÂàªÈáäÊîæÈîÅ)

**ËøôÂØπ‰Ω†Á∫ø‰∏äÊü•ËØ¢ÁöÑÂ•ΩÂ§ÑÊòØÔºö**

- **ÈîÅÁ≤íÂ∫¶ÊûÅÂ∞è**Ôºö`REPLACE`Ôºà`DELETE`+`INSERT`ÔºâÁ°ÆÂÆû‰ºöÂä†ÈîÅÔºå‰ΩÜÂÆÉÂè™ÈîÅ‰Ωè**ÂΩìÂâçÊ≠£Âú®Â§ÑÁêÜÁöÑ 1000 Ë°å**„ÄÇ
- **ÈîÅÊó∂Èó¥ÊûÅÁü≠**ÔºöÂ§ÑÁêÜ 1000 Ë°åÊï∞ÊçÆÂèØËÉΩÂè™ÈúÄË¶Å 0.5 Áßí„ÄÇ
- **È´òÂπ∂ÂèëÊÄß**ÔºöÂú®Ëøô 0.5 Áßí‰πãÂ§ñÔºå‰Ω†ÂÖ∂‰ªñÁöÑ‰∏öÂä°Êü•ËØ¢ÔºàÊØîÂ¶ÇÊü• K Á∫øÔºâÂèØ‰ª•**Ëá™Áî±Âú∞**ËÆøÈóÆË°®‰∏≠ÁöÑÂÖ∂‰ªñ 2000 ‰∏áË°åÊï∞ÊçÆ„ÄÇ

**ÁªìËÆ∫**Ôºö`pt-archiver` ÈÄöËøáËøôÁßç‚ÄúÂ∞èÊ≠•Âø´Ë∑ë‚ÄùÁöÑÂæÆÊâπÊ¨°ÊñπÂºèÔºå**Êää‰∏Ä‰∏™ 2.5 Â∞èÊó∂ÁöÑÈïø‰∫ãÂä°ÔºåÊãÜÊàê‰∫Ü 20,377 ‰∏™Ôºà`20,376,334 / 1000`ÔºâÂêÑËá™Âè™ÊåÅÁª≠ 0.5 ÁßíÁöÑÁü≠‰∫ãÂä°**„ÄÇ

ËøôÁ°Æ‰øù‰∫ÜÂÆÉÂú®Â∑•‰ΩúÊó∂ÔºåÂè™‰ºöÂØπÊï∞ÊçÆÂ∫ìÈÄ†Êàê**ÈùûÂ∏∏ËΩªÂæÆ„ÄÅÂèØÊéßÁöÑÂéãÂäõ**Ôºå‰ªéËÄå‰øùËØÅ‰∫ÜÁ∫ø‰∏äÊü•ËØ¢‰∏öÂä°ÁöÑ**Áõ∏ÂØπÂèØÁî®ÊÄß**„ÄÇ





###### Âõ†‰∏∫ÊóßË°®ÁöÑidÊòØnullÔºåÂÖ∂ÂÆûÂØπ‰∫éÂØπÂ∫îÂàÜÂå∫Ë°®‰∏≠ÁöÑÂÖ∑‰ΩìÊï∞ÊçÆÊù•ËØ¥ÔºåÊòØ‰∏çÊòØÂ∞±Êµ™Ë¥π‰∏ÄÊâπid‰∫ÜÔºü

ÊòØÁöÑÔºå‰Ω†ËØ¥ÁöÑ**ÂÆåÂÖ®Ê≠£Á°Æ**„ÄÇ‰Ω†ÁöÑÊ¥ûÂØüÂäõÈùûÂ∏∏ÊïèÈîê„ÄÇ

‰Ω†Á¨¨‰∏ÄÊ¨°ËøÅÁßªÊèíÂÖ•ÁöÑ `20,366,974` Ë°åÊï∞ÊçÆÔºàÂÅáËÆæÂÆÉ‰ª¨ÁöÑ `id` ÊòØ‰ªé `1` Âà∞ `20,366,974`ÔºâÔºåÂú®ËøôÊ¨° `--replace` ‰øÆÂ§çÊìç‰Ωú‰∏≠ÔºåÂ∞Ü‰ºö**ÂÖ®ÈÉ®Ë¢´Âà†Èô§**„ÄÇ

ÁÑ∂ÂêéÔºå`pt-archiver` ‰ºö‰∏∫**ÊâÄÊúâ**ÁöÑ `20,376,334` Ë°åÊï∞ÊçÆÔºàÂåÖÊã¨ÊóßÁöÑÂíåÊñ∞ÁöÑÔºâ**ÁîüÊàê‰∏ÄÊâπÂÖ®Êñ∞ÁöÑ `AUTO_INCREMENT` ID**ÔºàÊØîÂ¶Ç‰ªé `264,241,408` ÂºÄÂßãÔºåÊé•ÁùÄ‰Ω† 2022 Âπ¥ 12 ÊúàËøÅÁßªÂÆåÁöÑÊúÄÂêé‰∏Ä‰∏™ ID ÁªßÁª≠Â¢ûÈïøÔºâ„ÄÇ

**ÊâÄ‰ª•Ôºå‰Ω†Á¨¨‰∏ÄÊ¨°ÁîüÊàêÁöÑ 2036 ‰∏á‰∏™ IDÔºåÁ°ÆÂÆû‚ÄúÊµ™Ë¥π‚ÄùÊéâ‰∫Ü„ÄÇ**

------

> ‰∏∫‰ªÄ‰πàËØ¥ËøôÁßç‚ÄúÊµ™Ë¥π‚ÄùÊòØÂÆåÂÖ®ÂèØ‰ª•Êé•ÂèóÁöÑÔºü

ËøôÊÅ∞ÊÅ∞ÊòØËøô‰∏™ÊñπÊ°à**ÂÆâÂÖ®„ÄÅÂÅ•Â£Æ**ÁöÑ‰ΩìÁé∞„ÄÇ

1. **`BIGINT UNSIGNED` Âá†‰πéÊòØÊó†ÈôêÁöÑ**Ôºö
   - ‰Ω†ÁöÑ‰∏ªÈîÆ `id` ÊòØ `BIGINT UNSIGNED` Á±ªÂûã„ÄÇ
   - ÂÆÉÁöÑÊúÄÂ§ßÂÄºÊòØ 18,446,744,073,709,551,615Ôºà1844 ‰∫ø‰∫øÔºâ„ÄÇ
   - ‰Ω†‚ÄúÊµ™Ë¥π‚ÄùÁöÑËøô 2000 ‰∏á‰∏™ IDÔºåÂØπ‰∫éËøô‰∏™Êï∞Â≠óÊù•ËØ¥ÔºåËøû‚Äú‰πùÁâõ‰∏ÄÊØõ‚ÄùÈÉΩÁÆó‰∏ç‰∏äÔºåÂÆåÂÖ®ÂèØ‰ª•ÂøΩÁï•‰∏çËÆ°„ÄÇ`AUTO_INCREMENT` ËÆ°Êï∞Âô®Ë∑≥Ë∑ÉÊòØÊ≠£Â∏∏‰∏îÊó†ÂÆ≥ÁöÑ„ÄÇ
2. **`id` Âè™ÊòØ‚ÄúÁâ©ÁêÜ‰∏ªÈîÆ‚ÄùÔºåÊ≤°Êúâ‰∏öÂä°Âê´‰πâ**Ôºö
   - Âú®‰Ω†ÁöÑËÆæËÆ°‰∏≠Ôºå`id` ÁöÑÂîØ‰∏Ä‰ΩúÁî®Â∞±ÊòØ‰Ωú‰∏∫ËÅöÁ∞áÁ¥¢ÂºïÔºå‰øùËØÅÊï∞ÊçÆ**Áâ©ÁêÜÂ≠òÂÇ®ÊúâÂ∫è**Ôºà‰∏∫‰∫ÜËß£ÂÜ≥È°µÂàÜË£ÇÔºâÔºå‰ª•ÂèäÂú® `REPLACE` Êó∂Êèê‰æõ‰∏Ä‰∏™‰∏ªÈîÆ„ÄÇ
   - **ÁúüÊ≠£Êúâ‰∏öÂä°Âê´‰πâÁöÑ**ÊòØ‰Ω†ÁöÑ `uniq_windcode_tradedate` ÂîØ‰∏ÄÁ¥¢Âºï„ÄÇ
   - Âè™Ë¶Å `uniq_windcode_tradedate` Á¥¢ÂºïËÉΩ‰øùËØÅ K Á∫øÁöÑÂîØ‰∏ÄÊÄßÔºå`id` Á©∂Á´üÊòØ `123` ËøòÊòØ `987654321` Ê†πÊú¨‰∏çÈáçË¶Å„ÄÇ
3. **‚ÄúÊµ™Ë¥π ID‚ÄùÊòØ‚Äú‰øùËØÅÂú®Á∫ø‚ÄùÁöÑ‰ª£‰ª∑**Ôºö
   - Êàë‰ª¨‰πãÊâÄ‰ª•‚ÄúÊµ™Ë¥π‚ÄùËøô‰∫õ IDÔºåÂ∞±ÊòØ‰∏∫‰∫ÜÊâßË°å `--replace` Ëøô‰∏™**‚ÄúÂú®Á∫ø‰øÆÂ§ç‚Äù**Êìç‰Ωú„ÄÇ
   - Ëøô‰∏™‰ª£‰ª∑ÔºàÊµ™Ë¥π 2000 ‰∏á‰∏™ IDÔºâÔºåÂíå `DROP PARTITION` ÊñπÊ°àÂ∏¶Êù•ÁöÑ**‚Äú2.5 Â∞èÊó∂Êï∞ÊçÆÁ©∫Á™óÊúü‚Äù**‰ª•Âèä**‚Äú‰∏≠ÈÄîÂ§±Ë¥•ÂØºËá¥Êï∞ÊçÆÊ∞∏‰πÖ‰∏¢Â§±‚Äù**ÁöÑ S0 Á∫ßÁîü‰∫ß‰∫ãÊïÖÈ£éÈô©Áõ∏ÊØîÔºåÊòØ**ÂÆåÂÖ®ÂÄºÂæó**ÁöÑ„ÄÇ

> ÊÄªÁªìÔºö

‰Ω†Áî®‚ÄúÊµ™Ë¥π‚Äù2000 ‰∏á‰∏™ÊØ´Êó†‰∏öÂä°‰ª∑ÂÄºÁöÑ BIGINT Êï∞Â≠óÔºåÊç¢Êù•‰∫ÜÊï∞ÊçÆ 0 ‰∏¢Â§±„ÄÅÊúçÂä° 0 ‰∏≠Êñ≠ÁöÑÂÆåÁæé‰øÆÂ§ç„ÄÇËøôÊòØ‰∏ÄÁ¨îÈùûÂ∏∏ÂàíÁÆóÁöÑ‰∫§Êòì„ÄÇ









### ËøÅÁßªtb_quotation_history_trendÂà∞ÁÉ≠Êï∞ÊçÆË°®



##### 2024



###### 202401

```sql
ALTER TABLE tb_quotation_history_trend_202401
ADD COLUMN id BIGINT UNSIGNED NULL;
```



```bash
pt-archiver \
  --source h=192.168.0.106,P=3306,D=a_share_quant,t=tb_quotation_history_trend_202401,u=hli_gho,p=Q836184425 \
  --dest   h=192.168.0.106,P=3306,D=a_share_quant,t=tb_quotation_history_hot,u=hli_gho,p=Q836184425 \
  --columns wind_code,trade_date,latest_price,total_volume,average_price,status,create_time,update_time,id \
  --where "trade_date >= '2024-01-01' AND trade_date < '2024-02-01'" \
  --limit 10000 \
  --commit-each \
  --progress 20000 \
  --no-delete \
  --charset utf8 \
  --statistics
```



```bash
2025-12-03T03:03:47   12029 27320000
2025-12-03T03:03:53   12035 27340000
2025-12-03T03:03:55   12037 27348568
Started at 2025-12-02T23:43:18, ended at 2025-12-03T03:03:55
Source: A=utf8,D=a_share_quant,P=3306,h=192.168.0.106,p=...,t=tb_quotation_history_trend_202401,u=hli_gho
Dest:   A=utf8,D=a_share_quant,P=3306,h=192.168.0.106,p=...,t=tb_quotation_history_hot,u=hli_gho
SELECT 27348568
INSERT 27348568
DELETE 0
Action         Count       Time        Pct
inserting   27348568 10565.1308      87.77
select          2736   372.2527       3.09
commit          5472   190.7701       1.58
other              0   909.5998       7.56
```





###### 202402

```sql
ALTER TABLE tb_quotation_history_trend_202402
ADD COLUMN id BIGINT UNSIGNED NULL;
```



```bash
pt-archiver \
  --source h=192.168.0.106,P=3306,D=a_share_quant,t=tb_quotation_history_trend_202402,u=hli_gho,p=Q836184425 \
  --dest   h=192.168.0.106,P=3306,D=a_share_quant,t=tb_quotation_history_hot,u=hli_gho,p=Q836184425 \
  --columns wind_code,trade_date,latest_price,total_volume,average_price,status,create_time,update_time,id \
  --where "trade_date >= '2024-02-01' AND trade_date < '2024-03-01'" \
  --limit 10000 \
  --commit-each \
  --progress 20000 \
  --no-delete \
  --charset utf8 \
  --statistics
```



```bash
2025-12-03T02:04:25    8456 18740000
2025-12-03T02:04:33    8464 18760000
2025-12-03T02:04:38    8469 18770163
Started at 2025-12-02T23:43:28, ended at 2025-12-03T02:04:38
Source: A=utf8,D=a_share_quant,P=3306,h=192.168.0.106,p=...,t=tb_quotation_history_trend_202402,u=hli_gho
Dest:   A=utf8,D=a_share_quant,P=3306,h=192.168.0.106,p=...,t=tb_quotation_history_hot,u=hli_gho
SELECT 18770163
INSERT 18770163
DELETE 0
Action         Count       Time        Pct
inserting   18770163  7419.4544      87.61
select          1879   262.8748       3.10
commit          3758   145.6964       1.72
other              0   641.0580       7.57
```







###### 202403

```sql
ALTER TABLE tb_quotation_history_trend_202403
ADD COLUMN id BIGINT UNSIGNED NULL;
```



```bash
pt-archiver \
  --source h=192.168.0.106,P=3306,D=a_share_quant,t=tb_quotation_history_trend_202403,u=hli_gho,p=Q836184425 \
  --dest   h=192.168.0.106,P=3306,D=a_share_quant,t=tb_quotation_history_hot,u=hli_gho,p=Q836184425 \
  --columns wind_code,trade_date,latest_price,total_volume,average_price,status,create_time,update_time,id \
  --where "trade_date >= '2024-03-01' AND trade_date < '2024-04-01'" \
  --limit 10000 \
  --commit-each \
  --progress 20000 \
  --no-delete \
  --charset utf8 \
  --statistics
```



```bash
2025-12-03T02:54:52   11470 26000000
2025-12-03T02:54:58   11476 26020000
2025-12-03T02:55:00   11478 26026094
Started at 2025-12-02T23:43:42, ended at 2025-12-03T02:55:00
Source: A=utf8,D=a_share_quant,P=3306,h=192.168.0.106,p=...,t=tb_quotation_history_trend_202403,u=hli_gho
Dest:   A=utf8,D=a_share_quant,P=3306,h=192.168.0.106,p=...,t=tb_quotation_history_hot,u=hli_gho
SELECT 26026094
INSERT 26026094
DELETE 0
Action         Count       Time        Pct
inserting   26026094 10083.9787      87.85
select          2604   352.7438       3.07
commit          5208   180.5445       1.57
other              0   861.2087       7.50
```





###### 202404

```sql
ALTER TABLE tb_quotation_history_trend_202404
ADD COLUMN id BIGINT UNSIGNED NULL;
```



```bash
pt-archiver \
  --source h=192.168.0.106,P=3306,D=a_share_quant,t=tb_quotation_history_trend_202404,u=hli_gho,p=Q836184425 \
  --dest   h=192.168.0.106,P=3306,D=a_share_quant,t=tb_quotation_history_hot,u=hli_gho,p=Q836184425 \
  --columns wind_code,trade_date,latest_price,total_volume,average_price,status,create_time,update_time,id \
  --where "trade_date >= '2024-04-01' AND trade_date < '2024-05-01'" \
  --limit 10000 \
  --commit-each \
  --progress 20000 \
  --no-delete \
  --charset utf8 \
  --statistics
```



```bash
2025-12-03T02:48:06   11054 24600000
2025-12-03T02:48:13   11061 24620000
2025-12-03T02:48:19   11067 24637984
Started at 2025-12-02T23:43:51, ended at 2025-12-03T02:48:19
Source: A=utf8,D=a_share_quant,P=3306,h=192.168.0.106,p=...,t=tb_quotation_history_trend_202404,u=hli_gho
Dest:   A=utf8,D=a_share_quant,P=3306,h=192.168.0.106,p=...,t=tb_quotation_history_hot,u=hli_gho
SELECT 24637984
INSERT 24637984
DELETE 0
Action         Count       Time        Pct
inserting   24637984  9653.7134      87.22
select          2465   339.8219       3.07
commit          4930   175.8677       1.59
other              0   898.4480       8.12
```





###### 202405

```sql
ALTER TABLE tb_quotation_history_trend_202405
ADD COLUMN id BIGINT UNSIGNED NULL;
```



```bash
pt-archiver \
  --source h=192.168.0.106,P=3306,D=a_share_quant,t=tb_quotation_history_trend_202405,u=hli_gho,p=Q836184425 \
  --dest   h=192.168.0.106,P=3306,D=a_share_quant,t=tb_quotation_history_hot,u=hli_gho,p=Q836184425 \
  --columns wind_code,trade_date,latest_price,total_volume,average_price,status,create_time,update_time,id \
  --where "trade_date >= '2024-05-01' AND trade_date < '2024-06-01'" \
  --limit 10000 \
  --commit-each \
  --progress 20000 \
  --no-delete \
  --charset utf8 \
  --statistics
```

```bash
2025-12-03T02:46:11   10929 24440000
2025-12-03T02:46:18   10936 24460000
2025-12-03T02:46:24   10942 24475472
Started at 2025-12-02T23:44:02, ended at 2025-12-03T02:46:24
Source: A=utf8,D=a_share_quant,P=3306,h=192.168.0.106,p=...,t=tb_quotation_history_trend_202405,u=hli_gho
Dest:   A=utf8,D=a_share_quant,P=3306,h=192.168.0.106,p=...,t=tb_quotation_history_hot,u=hli_gho
SELECT 24475472
INSERT 24475472
DELETE 0
Action         Count       Time        Pct
inserting   24475472  9613.8336      87.86
select          2449   339.1531       3.10
commit          4898   180.6805       1.65
other              0   809.1599       7.39
```





###### 202406

```sql
ALTER TABLE tb_quotation_history_trend_202406
ADD COLUMN id BIGINT UNSIGNED NULL;
```



```bash
pt-archiver \
  --source h=192.168.0.106,P=3306,D=a_share_quant,t=tb_quotation_history_trend_202406,u=hli_gho,p=Q836184425 \
  --dest   h=192.168.0.106,P=3306,D=a_share_quant,t=tb_quotation_history_hot,u=hli_gho,p=Q836184425 \
  --columns wind_code,trade_date,latest_price,total_volume,average_price,status,create_time,update_time,id \
  --where "trade_date >= '2024-06-01' AND trade_date < '2024-07-01'" \
  --limit 10000 \
  --commit-each \
  --progress 20000 \
  --no-delete \
  --charset utf8 \
  --statistics
```



```bash
2025-12-03T02:34:34   10223 23120000
2025-12-03T02:34:42   10230 23140000
2025-12-03T02:34:48   10236 23155798
Started at 2025-12-02T23:44:11, ended at 2025-12-03T02:34:48
Source: A=utf8,D=a_share_quant,P=3306,h=192.168.0.106,p=...,t=tb_quotation_history_trend_202406,u=hli_gho
Dest:   A=utf8,D=a_share_quant,P=3306,h=192.168.0.106,p=...,t=tb_quotation_history_hot,u=hli_gho
SELECT 23155798
INSERT 23155798
DELETE 0
Action         Count       Time        Pct
inserting   23155798  8969.6587      87.62
select          2317   323.6310       3.16
commit          4634   169.0901       1.65
other              0   774.3338       7.56
```





###### 202407

```sql
ALTER TABLE tb_quotation_history_trend_202407
ADD COLUMN id BIGINT UNSIGNED NULL;
```



```bash
pt-archiver \
  --source h=192.168.0.106,P=3306,D=a_share_quant,t=tb_quotation_history_trend_202407,u=hli_gho,p=Q836184425 \
  --dest   h=192.168.0.106,P=3306,D=a_share_quant,t=tb_quotation_history_hot,u=hli_gho,p=Q836184425 \
  --columns wind_code,trade_date,latest_price,total_volume,average_price,status,create_time,update_time,id \
  --where "trade_date >= '2024-07-01' AND trade_date < '2024-08-01'" \
  --limit 10000 \
  --commit-each \
  --progress 20000 \
  --no-delete \
  --charset utf8 \
  --statistics
```



```bash
2025-12-03T02:48:27   11042 24760000
2025-12-03T02:48:34   11049 24780000
2025-12-03T02:48:36   11051 24786422
Started at 2025-12-02T23:44:24, ended at 2025-12-03T02:48:36
Source: A=utf8,D=a_share_quant,P=3306,h=192.168.0.106,p=...,t=tb_quotation_history_trend_202407,u=hli_gho
Dest:   A=utf8,D=a_share_quant,P=3306,h=192.168.0.106,p=...,t=tb_quotation_history_hot,u=hli_gho
SELECT 24786422
INSERT 24786422
DELETE 0
Action         Count       Time        Pct
inserting   24786422  9670.9452      87.51
select          2480   336.0679       3.04
commit          4960   184.4582       1.67
other              0   860.1945       7.78
```





###### 202408

```sql
ALTER TABLE tb_quotation_history_trend_202408
ADD COLUMN id BIGINT UNSIGNED NULL;
```



```bash
pt-archiver \
  --source h=192.168.0.106,P=3306,D=a_share_quant,t=tb_quotation_history_trend_202408,u=hli_gho,p=Q836184425 \
  --dest   h=192.168.0.106,P=3306,D=a_share_quant,t=tb_quotation_history_hot,u=hli_gho,p=Q836184425 \
  --columns wind_code,trade_date,latest_price,total_volume,average_price,status,create_time,update_time,id \
  --where "trade_date >= '2024-08-01' AND trade_date < '2024-09-01'" \
  --limit 10000 \
  --commit-each \
  --progress 20000 \
  --no-delete \
  --charset utf8 \
  --statistics
```



```bash
2025-12-03T02:58:10   11615 26520000
2025-12-03T02:58:17   11622 26540000
2025-12-03T02:58:20   11625 26547676
Started at 2025-12-02T23:44:34, ended at 2025-12-03T02:58:20
Source: A=utf8,D=a_share_quant,P=3306,h=192.168.0.106,p=...,t=tb_quotation_history_trend_202408,u=hli_gho
Dest:   A=utf8,D=a_share_quant,P=3306,h=192.168.0.106,p=...,t=tb_quotation_history_hot,u=hli_gho
SELECT 26547676
INSERT 26547676
DELETE 0
Action         Count       Time        Pct
inserting   26547676 10207.2290      87.80
select          2656   356.9980       3.07
commit          5312   190.1841       1.64
other              0   871.4546       7.50
```





###### 202409

```sql
ALTER TABLE tb_quotation_history_trend_202409
ADD COLUMN id BIGINT UNSIGNED NULL;
```



```bash
pt-archiver \
  --source h=192.168.0.106,P=3306,D=a_share_quant,t=tb_quotation_history_trend_202409,u=hli_gho,p=Q836184425 \
  --dest   h=192.168.0.106,P=3306,D=a_share_quant,t=tb_quotation_history_hot,u=hli_gho,p=Q836184425 \
  --columns wind_code,trade_date,latest_price,total_volume,average_price,status,create_time,update_time,id \
  --where "trade_date >= '2024-09-01' AND trade_date < '2024-10-01'" \
  --limit 10000 \
  --commit-each \
  --progress 20000 \
  --no-delete \
  --charset utf8 \
  --statistics
```



```bash
2025-12-03T02:39:57   10512 22940000
2025-12-03T02:40:05   10520 22960000
2025-12-03T02:40:08   10523 22967881
Started at 2025-12-02T23:44:44, ended at 2025-12-03T02:40:08
Source: A=utf8,D=a_share_quant,P=3306,h=192.168.0.106,p=...,t=tb_quotation_history_trend_202409,u=hli_gho
Dest:   A=utf8,D=a_share_quant,P=3306,h=192.168.0.106,p=...,t=tb_quotation_history_hot,u=hli_gho
SELECT 22967881
INSERT 22967881
DELETE 0
Action         Count       Time        Pct
inserting   22967881  9226.5765      87.68
select          2298   319.4078       3.04
commit          4596   174.7442       1.66
other              0   802.6364       7.63
```





###### 202410

```sql
ALTER TABLE tb_quotation_history_trend_202410
ADD COLUMN id BIGINT UNSIGNED NULL;
```



```bash
pt-archiver \
  --source h=192.168.0.106,P=3306,D=a_share_quant,t=tb_quotation_history_trend_202410,u=hli_gho,p=Q836184425 \
  --dest   h=192.168.0.106,P=3306,D=a_share_quant,t=tb_quotation_history_hot,u=hli_gho,p=Q836184425 \
  --columns wind_code,trade_date,latest_price,total_volume,average_price,status,create_time,update_time,id \
  --where "trade_date >= '2024-10-01' AND trade_date < '2024-11-01'" \
  --limit 10000 \
  --commit-each \
  --progress 20000 \
  --no-delete \
  --charset utf8 \
  --statistics
```



```bash
2025-12-03T02:36:09   10253 22340000
2025-12-03T02:36:20   10264 22360000
2025-12-03T02:36:24   10269 22372058
Started at 2025-12-02T23:45:15, ended at 2025-12-03T02:36:24
Source: A=utf8,D=a_share_quant,P=3306,h=192.168.0.106,p=...,t=tb_quotation_history_trend_202410,u=hli_gho
Dest:   A=utf8,D=a_share_quant,P=3306,h=192.168.0.106,p=...,t=tb_quotation_history_hot,u=hli_gho
SELECT 22372058
INSERT 22372058
DELETE 0
Action         Count       Time        Pct
inserting   22372058  8999.8851      87.64
select          2239   311.3486       3.03
commit          4478   164.5186       1.60
other              0   793.7900       7.73
```





###### 202411

```sql
ALTER TABLE tb_quotation_history_trend_202411
ADD COLUMN id BIGINT UNSIGNED NULL;
```



```bash
pt-archiver \
  --source h=192.168.0.106,P=3306,D=a_share_quant,t=tb_quotation_history_trend_202411,u=hli_gho,p=Q836184425 \
  --dest   h=192.168.0.106,P=3306,D=a_share_quant,t=tb_quotation_history_hot,u=hli_gho,p=Q836184425 \
  --columns wind_code,trade_date,latest_price,total_volume,average_price,status,create_time,update_time,id \
  --where "trade_date >= '2024-11-01' AND trade_date < '2024-12-01'" \
  --limit 10000 \
  --commit-each \
  --progress 20000 \
  --no-delete \
  --charset utf8 \
  --statistics
```



```bash
2025-12-03T02:56:11   11444 25820000
2025-12-03T02:56:17   11450 25840000
2025-12-03T02:56:23   11456 25858804
Started at 2025-12-02T23:45:26, ended at 2025-12-03T02:56:23
Source: A=utf8,D=a_share_quant,P=3306,h=192.168.0.106,p=...,t=tb_quotation_history_trend_202411,u=hli_gho
Dest:   A=utf8,D=a_share_quant,P=3306,h=192.168.0.106,p=...,t=tb_quotation_history_hot,u=hli_gho
SELECT 25858804
INSERT 25858804
DELETE 0
Action         Count       Time        Pct
inserting   25858804 10045.0370      87.68
select          2587   347.3910       3.03
commit          5174   184.6961       1.61
other              0   879.7909       7.68
```





###### 202412

```sql
ALTER TABLE tb_quotation_history_trend_202412
ADD COLUMN id BIGINT UNSIGNED NULL;
```



```bash
pt-archiver \
  --source h=192.168.0.106,P=3306,D=a_share_quant,t=tb_quotation_history_trend_202412,u=hli_gho,p=Q836184425 \
  --dest   h=192.168.0.106,P=3306,D=a_share_quant,t=tb_quotation_history_hot,u=hli_gho,p=Q836184425 \
  --columns wind_code,trade_date,latest_price,total_volume,average_price,status,create_time,update_time,id \
  --where "trade_date >= '2024-12-01' AND trade_date < '2025-01-01'" \
  --limit 10000 \
  --commit-each \
  --progress 20000 \
  --no-delete \
  --charset utf8 \
  --statistics
```



```bash
2025-12-03T03:06:25   12049 27980000
2025-12-03T03:06:32   12055 28000000
2025-12-03T03:06:32   12055 28000023
Started at 2025-12-02T23:45:36, ended at 2025-12-03T03:06:32
Source: A=utf8,D=a_share_quant,P=3306,h=192.168.0.106,p=...,t=tb_quotation_history_trend_202412,u=hli_gho
Dest:   A=utf8,D=a_share_quant,P=3306,h=192.168.0.106,p=...,t=tb_quotation_history_hot,u=hli_gho
SELECT 28000023
INSERT 28000023
DELETE 0
Action         Count       Time        Pct
inserting   28000023 10585.0870      87.80
select          2802   366.8869       3.04
commit          5604   193.0035       1.60
other              0   911.6044       7.56
```









---



##### 2025



###### 202501

```sql
ALTER TABLE tb_quotation_history_trend_202501
ADD COLUMN id BIGINT UNSIGNED NULL;
```



```bash
pt-archiver \
  --source h=10.100.224.54,P=3306,D=a_share_quant,t=tb_quotation_history_trend_202501,u=hli_gho,p=Q836184425 \
  --dest   h=10.100.224.54,P=3306,D=a_share_quant,t=tb_quotation_history_hot,u=hli_gho,p=Q836184425 \
  --columns wind_code,trade_date,latest_price,total_volume,average_price,status,create_time,update_time,id \
  --where "trade_date >= '2025-01-01' AND trade_date < '2025-02-01'" \
  --limit 10000 \
  --commit-each \
  --progress 20000 \
  --no-delete \
  --charset utf8 \
  --statistics
```



```bash
2025-12-03T18:44:41   10934 22620000
2025-12-03T18:44:48   10941 22640000
2025-12-03T18:44:50   10943 22644365
Started at 2025-12-03T15:42:27, ended at 2025-12-03T18:44:50
Source: A=utf8,D=a_share_quant,P=3306,h=10.100.224.54,p=...,t=tb_quotation_history_trend_202501,u=hli_gho
Dest:   A=utf8,D=a_share_quant,P=3306,h=10.100.224.54,p=...,t=tb_quotation_history_hot,u=hli_gho
SELECT 22644365
INSERT 22644365
DELETE 0
Action         Count       Time        Pct
inserting   22644365  9757.5829      89.16
commit          4532   149.6830       1.37
select          2266   138.2683       1.26
other              0   897.8935       8.20
```





###### 202502

```sql
ALTER TABLE tb_quotation_history_trend_202502
ADD COLUMN id BIGINT UNSIGNED NULL;
```



```bash
pt-archiver \
  --source h=10.100.224.54,P=3306,D=a_share_quant,t=tb_quotation_history_trend_202502,u=hli_gho,p=Q836184425 \
  --dest   h=10.100.224.54,P=3306,D=a_share_quant,t=tb_quotation_history_hot,u=hli_gho,p=Q836184425 \
  --columns wind_code,trade_date,latest_price,total_volume,average_price,status,create_time,update_time,id \
  --where "trade_date >= '2025-02-01' AND trade_date < '2025-03-01'" \
  --limit 10000 \
  --commit-each \
  --progress 20000 \
  --no-delete \
  --charset utf8 \
  --statistics
```



```bash
2025-12-03T18:47:06   11065 22940000
2025-12-03T18:47:12   11072 22960000
2025-12-03T18:47:16   11076 22962978
Started at 2025-12-03T15:42:40, ended at 2025-12-03T18:47:16
Source: A=utf8,D=a_share_quant,P=3306,h=10.100.224.54,p=...,t=tb_quotation_history_trend_202502,u=hli_gho
Dest:   A=utf8,D=a_share_quant,P=3306,h=10.100.224.54,p=...,t=tb_quotation_history_hot,u=hli_gho
SELECT 22962978
INSERT 22962978
DELETE 0
Action         Count       Time        Pct
inserting   22962978  9894.7914      89.33
commit          4596   160.2228       1.45
select          2298   138.5711       1.25
other              0   882.4877       7.97
```





###### 202503

```sql
ALTER TABLE tb_quotation_history_trend_202503
ADD COLUMN id BIGINT UNSIGNED NULL;
```



```bash
pt-archiver \
  --source h=10.100.224.54,P=3306,D=a_share_quant,t=tb_quotation_history_trend_202503,u=hli_gho,p=Q836184425 \
  --dest   h=10.100.224.54,P=3306,D=a_share_quant,t=tb_quotation_history_hot,u=hli_gho,p=Q836184425 \
  --columns wind_code,trade_date,latest_price,total_volume,average_price,status,create_time,update_time,id \
  --where "trade_date >= '2025-03-01' AND trade_date < '2025-04-01'" \
  --limit 10000 \
  --commit-each \
  --progress 20000 \
  --no-delete \
  --charset utf8 \
  --statistics
```



```bash
2025-12-03T19:10:18   12444 26820000
2025-12-03T19:10:22   12449 26840000
2025-12-03T19:10:25   12452 26851958
Started at 2025-12-03T15:42:53, ended at 2025-12-03T19:10:25
Source: A=utf8,D=a_share_quant,P=3306,h=10.100.224.54,p=...,t=tb_quotation_history_trend_202503,u=hli_gho
Dest:   A=utf8,D=a_share_quant,P=3306,h=10.100.224.54,p=...,t=tb_quotation_history_hot,u=hli_gho
SELECT 26851958
INSERT 26851958
DELETE 0
Action         Count       Time        Pct
inserting   26851958 11174.9447      89.74
commit          5374   161.7596       1.30
select          2687   147.3168       1.18
other              0   968.1534       7.77
```





###### 202504

```sql
ALTER TABLE tb_quotation_history_trend_202504
ADD COLUMN id BIGINT UNSIGNED NULL;
```



```bash
pt-archiver \
  --source h=10.100.224.54,P=3306,D=a_share_quant,t=tb_quotation_history_trend_202504,u=hli_gho,p=Q836184425 \
  --dest   h=10.100.224.54,P=3306,D=a_share_quant,t=tb_quotation_history_hot,u=hli_gho,p=Q836184425 \
  --columns wind_code,trade_date,latest_price,total_volume,average_price,status,create_time,update_time,id \
  --where "trade_date >= '2025-04-01' AND trade_date < '2025-05-01'" \
  --limit 10000 \
  --commit-each \
  --progress 20000 \
  --no-delete \
  --charset utf8 \
  --statistics
```



```bash
2025-12-03T19:08:56   12350 26700000
2025-12-03T19:09:01   12356 26720000
2025-12-03T19:09:02   12357 26725607
Started at 2025-12-03T15:43:05, ended at 2025-12-03T19:09:02
Source: A=utf8,D=a_share_quant,P=3306,h=10.100.224.54,p=...,t=tb_quotation_history_trend_202504,u=hli_gho
Dest:   A=utf8,D=a_share_quant,P=3306,h=10.100.224.54,p=...,t=tb_quotation_history_hot,u=hli_gho
SELECT 26725607
INSERT 26725607
DELETE 0
Action         Count       Time        Pct
inserting   26725607 10927.1411      88.43
select          2674   377.3250       3.05
commit          5348   144.9582       1.17
other              0   908.0809       7.35
```





###### 202505

```sql
ALTER TABLE tb_quotation_history_trend_202505
ADD COLUMN id BIGINT UNSIGNED NULL;
```



```bash
pt-archiver \
  --source h=10.100.224.54,P=3306,D=a_share_quant,t=tb_quotation_history_trend_202505,u=hli_gho,p=Q836184425 \
  --dest   h=10.100.224.54,P=3306,D=a_share_quant,t=tb_quotation_history_hot,u=hli_gho,p=Q836184425 \
  --columns wind_code,trade_date,latest_price,total_volume,average_price,status,create_time,update_time,id \
  --where "trade_date >= '2025-05-01' AND trade_date < '2025-06-01'" \
  --limit 10000 \
  --commit-each \
  --progress 20000 \
  --no-delete \
  --charset utf8 \
  --statistics
```



```bash
2025-12-03T18:57:25   11648 24240000
2025-12-03T18:57:31   11654 24260000
2025-12-03T18:57:37   11660 24271723
Started at 2025-12-03T15:43:16, ended at 2025-12-03T18:57:37
Source: A=utf8,D=a_share_quant,P=3306,h=10.100.224.54,p=...,t=tb_quotation_history_trend_202505,u=hli_gho
Dest:   A=utf8,D=a_share_quant,P=3306,h=10.100.224.54,p=...,t=tb_quotation_history_hot,u=hli_gho
SELECT 24271723
INSERT 24271723
DELETE 0
Action         Count       Time        Pct
inserting   24271723 10247.9564      87.88
select          2429   353.6671       3.03
commit          4858   129.3618       1.11
other              0   929.9559       7.97
```





###### 202506

```sql
ALTER TABLE tb_quotation_history_trend_202506
ADD COLUMN id BIGINT UNSIGNED NULL;
```



```bash
pt-archiver \
  --source h=10.100.224.54,P=3306,D=a_share_quant,t=tb_quotation_history_trend_202506,u=hli_gho,p=Q836184425 \
  --dest   h=10.100.224.54,P=3306,D=a_share_quant,t=tb_quotation_history_hot,u=hli_gho,p=Q836184425 \
  --columns wind_code,trade_date,latest_price,total_volume,average_price,status,create_time,update_time,id \
  --where "trade_date >= '2025-06-01' AND trade_date < '2025-07-01'" \
  --limit 10000 \
  --commit-each \
  --progress 20000 \
  --no-delete \
  --charset utf8 \
  --statistics
```



```bash
2025-12-03T19:05:56   12148 25560000
2025-12-03T19:06:01   12154 25580000
2025-12-03T19:06:02   12154 25580053
Started at 2025-12-03T15:43:27, ended at 2025-12-03T19:06:02
Source: A=utf8,D=a_share_quant,P=3306,h=10.100.224.54,p=...,t=tb_quotation_history_trend_202506,u=hli_gho
Dest:   A=utf8,D=a_share_quant,P=3306,h=10.100.224.54,p=...,t=tb_quotation_history_hot,u=hli_gho
SELECT 25580053
INSERT 25580053
DELETE 0
Action         Count       Time        Pct
inserting   25580053 10724.2771      88.24
select          2560   354.6864       2.92
commit          5120   144.9282       1.19
other              0   930.2657       7.65
```





###### 202507

```sql
ALTER TABLE tb_quotation_history_trend_202507
ADD COLUMN id BIGINT UNSIGNED NULL;
```



```bash
pt-archiver \
  --source h=10.100.224.54,P=3306,D=a_share_quant,t=tb_quotation_history_trend_202507,u=hli_gho,p=Q836184425 \
  --dest   h=10.100.224.54,P=3306,D=a_share_quant,t=tb_quotation_history_hot,u=hli_gho,p=Q836184425 \
  --columns wind_code,trade_date,latest_price,total_volume,average_price,status,create_time,update_time,id \
  --where "trade_date >= '2025-07-01' AND trade_date < '2025-08-01'" \
  --limit 10000 \
  --commit-each \
  --progress 20000 \
  --no-delete \
  --charset utf8 \
  --statistics
```



```bash
2025-12-03T19:20:52   13033 29440000
2025-12-03T19:20:56   13038 29460000
2025-12-03T19:20:58   13040 29470553
Started at 2025-12-03T15:43:38, ended at 2025-12-03T19:20:58
Source: A=utf8,D=a_share_quant,P=3306,h=10.100.224.54,p=...,t=tb_quotation_history_trend_202507,u=hli_gho
Dest:   A=utf8,D=a_share_quant,P=3306,h=10.100.224.54,p=...,t=tb_quotation_history_hot,u=hli_gho
SELECT 29470553
INSERT 29470553
DELETE 0
Action         Count       Time        Pct
inserting   29470553 11504.5048      88.22
select          2949   374.5260       2.87
commit          5898   145.5708       1.12
other              0  1015.6905       7.79
```





###### 202508

```sql
ALTER TABLE tb_quotation_history_trend_202508
ADD COLUMN id BIGINT UNSIGNED NULL;
```



```bash
pt-archiver \
  --source h=10.100.224.54,P=3306,D=a_share_quant,t=tb_quotation_history_trend_202508,u=hli_gho,p=Q836184425 \
  --dest   h=10.100.224.54,P=3306,D=a_share_quant,t=tb_quotation_history_hot,u=hli_gho,p=Q836184425 \
  --columns wind_code,trade_date,latest_price,total_volume,average_price,status,create_time,update_time,id \
  --where "trade_date >= '2025-08-01' AND trade_date < '2025-09-01'" \
  --limit 10000 \
  --commit-each \
  --progress 20000 \
  --no-delete \
  --charset utf8 \
  --statistics
```



```bash
2025-12-03T19:10:49   12385 27020000
2025-12-03T19:10:53   12390 27040000
2025-12-03T19:10:54   12390 27043878
Started at 2025-12-03T15:44:23, ended at 2025-12-03T19:10:54
Source: A=utf8,D=a_share_quant,P=3306,h=10.100.224.54,p=...,t=tb_quotation_history_trend_202508,u=hli_gho
Dest:   A=utf8,D=a_share_quant,P=3306,h=10.100.224.54,p=...,t=tb_quotation_history_hot,u=hli_gho
SELECT 27043878
INSERT 27043878
DELETE 0
Action         Count       Time        Pct
inserting   27043878 10885.8240      87.85
select          2706   377.4832       3.05
commit          5412   143.3292       1.16
other              0   984.2123       7.94
```





###### 202509(?)

```sql
ALTER TABLE tb_quotation_history_trend_202509
ADD COLUMN id BIGINT UNSIGNED NULL;
```



```bash
pt-archiver \
  --source h=192.168.0.106,P=3306,D=a_share_quant,t=tb_quotation_history_trend_202509,u=hli_gho,p=Q836184425 \
  --dest   h=192.168.0.106,P=3306,D=a_share_quant,t=tb_quotation_history_hot,u=hli_gho,p=Q836184425 \
  --columns wind_code,trade_date,latest_price,total_volume,average_price,status,create_time,update_time,id \
  --where "trade_date >= '2025-09-01' AND trade_date < '2025-10-01'" \
  --limit 10000 \
  --commit-each \
  --progress 20000 \
  --no-delete \
  --charset utf8 \
  --statistics
```



```bash
2025-12-04T02:16:38    6710 28200000
2025-12-04T02:16:42    6714 28220000
2025-12-04T02:16:43    6716 28225185
Started at 2025-12-04T00:24:47, ended at 2025-12-04T02:16:43
Source: A=utf8,D=a_share_quant,P=3306,h=192.168.0.106,p=...,t=tb_quotation_history_trend_202509,u=hli_gho
Dest:   A=utf8,D=a_share_quant,P=3306,h=192.168.0.106,p=...,t=tb_quotation_history_hot,u=hli_gho
SELECT 28225185
INSERT 28225185
DELETE 0
Action         Count       Time        Pct
inserting   28225185  5924.6723      88.22
select          2824   138.7507       2.07
commit          5648    34.3711       0.51
other              0   618.3331       9.21
```





###### 202510

```sql
ALTER TABLE tb_quotation_history_trend_202510
ADD COLUMN id BIGINT UNSIGNED NULL;
```



```bash
pt-archiver \
  --source h=10.100.224.54,P=3306,D=a_share_quant,t=tb_quotation_history_trend_202510,u=hli_gho,p=Q836184425 \
  --dest   h=10.100.224.54,P=3306,D=a_share_quant,t=tb_quotation_history_hot,u=hli_gho,p=Q836184425 \
  --columns wind_code,trade_date,latest_price,total_volume,average_price,status,create_time,update_time,id \
  --where "trade_date >= '2025-10-01' AND trade_date < '2025-11-01'" \
  --limit 10000 \
  --commit-each \
  --progress 20000 \
  --no-delete \
  --charset utf8 \
  --statistics
```



```bash
2025-12-03T18:37:07   10333 20740000
2025-12-03T18:37:14   10341 20760000
2025-12-03T18:37:21   10348 20779569
Started at 2025-12-03T15:44:53, ended at 2025-12-03T18:37:21
Source: A=utf8,D=a_share_quant,P=3306,h=10.100.224.54,p=...,t=tb_quotation_history_trend_202510,u=hli_gho
Dest:   A=utf8,D=a_share_quant,P=3306,h=10.100.224.54,p=...,t=tb_quotation_history_hot,u=hli_gho
SELECT 20779569
INSERT 20779569
DELETE 0
Action         Count       Time        Pct
inserting   20779569  9118.7936      88.12
select          2079   302.4730       2.92
commit          4158   131.1210       1.27
other              0   796.0376       7.69
```





###### 202511

```sql
ALTER TABLE tb_quotation_history_trend_202511
ADD COLUMN id BIGINT UNSIGNED NULL;
```



```bash
pt-archiver \
  --source h=10.100.224.54,P=3306,D=a_share_quant,t=tb_quotation_history_trend_202511,u=hli_gho,p=Q836184425 \
  --dest   h=10.100.224.54,P=3306,D=a_share_quant,t=tb_quotation_history_hot,u=hli_gho,p=Q836184425 \
  --columns wind_code,trade_date,latest_price,total_volume,average_price,status,create_time,update_time,id \
  --where "trade_date >= '2025-11-01' AND trade_date < '2025-12-01'" \
  --limit 10000 \
  --commit-each \
  --progress 20000 \
  --no-delete \
  --charset utf8 \
  --statistics
```



```bash
2025-12-03T18:58:38   11614 24420000
2025-12-03T18:58:46   11622 24440000
2025-12-03T18:58:49   11625 24451024
Started at 2025-12-03T15:45:03, ended at 2025-12-03T18:58:49
Source: A=utf8,D=a_share_quant,P=3306,h=10.100.224.54,p=...,t=tb_quotation_history_trend_202511,u=hli_gho
Dest:   A=utf8,D=a_share_quant,P=3306,h=10.100.224.54,p=...,t=tb_quotation_history_hot,u=hli_gho
SELECT 24451024
INSERT 24451024
DELETE 0
Action         Count       Time        Pct
inserting   24451024 10262.7357      88.27
select          2447   345.8028       2.97
commit          4894   128.8162       1.11
other              0   888.5881       7.64
```





###### 202512(Êú™ÂºÄÂßã)

```sql
ALTER TABLE tb_quotation_history_trend_202512
ADD COLUMN id BIGINT UNSIGNED NULL;
```



```bash
pt-archiver \
  --source h=10.100.224.54,P=3306,D=a_share_quant,t=tb_quotation_history_trend_202512,u=hli_gho,p=Q836184425 \
  --dest   h=10.100.224.54,P=3306,D=a_share_quant,t=tb_quotation_history_hot,u=hli_gho,p=Q836184425 \
  --columns wind_code,trade_date,latest_price,total_volume,average_price,status,create_time,update_time,id \
  --where "trade_date >= '2025-12-01' AND trade_date < '2026-01-01'" \
  --limit 10000 \
  --commit-each \
  --progress 20000 \
  --no-delete \
  --charset utf8 \
  --statistics
```







































## È™åËØÅÊåáÊ†á

>**Á≠îÊ°àÊòØËÇØÂÆöÁöÑ„ÄÇ‰∏ç‰ªÖ‰ºö‚ÄúÁúºÂâç‰∏Ä‰∫Æ‚ÄùÔºåÁîöËá≥ÂèØËÉΩÊàê‰∏∫‰Ω†Èù¢ËØï‰∏≠ÁöÑ‚ÄúÈ´òÂàÜÊùÄÊâãÈîè‚Äù„ÄÇ**
>
>ÂØπ‰∫é **Á§æÊãõ 3-5 Âπ¥** ÁöÑÂ≤ó‰ΩçÔºàÂØπÂ∫îÈòøÈáå P6/P6+ÔºåÂ≠óËäÇ 2-1/2-2ÔºâÔºåÈù¢ËØïÂÆòÂØªÊâæÁöÑÊ†∏ÂøÉÁ¥†Ë¥®ÊòØÔºö**‰∏ç‰ªÖ‰ªÖÊòØ‚ÄúÂÅöËøá‚ÄùÔºåËÄåÊòØ‚ÄúÂÅöÊ∑±‚Äù„ÄÅ‚ÄúÂÅöÁªÜ‚Äù‰∏îÂÖ∑Â§á‚ÄúÊûÅËá¥ÁöÑÂ∑•Á®ãÂåñÊÄùÁª¥‚Äù„ÄÇ**
>
>‰Ω†ÁöÑËøôÊ¨°ÁªèÂéÜÂÆåÁæéÂ•ëÂêà‰∫ÜËøô‰∫õË¶ÅÊ±Ç„ÄÇ
>
>------
>
>
>
>### ‰∏∫‰ªÄ‰πàËøô‰∏™È°πÁõÆËÉΩÊâìÂä®Â§ßÂéÇÈù¢ËØïÂÆòÔºüÔºàÈù¢ËØïÂÆòËßÜËßíÊãÜËß£Ôºâ
>
>
>
>
>
>#### 1. ËßÑÊ®°Â§üÂ§ßÔºåÁóõÁÇπÂ§üÁóõÔºà‰∏öÂä°‰ª∑ÂÄºÔºâ
>
>
>
>- **ÊôÆÈÄöÂõûÁ≠î**Ôºö‚ÄúÊàëËøÅÁßª‰∫ÜÂá†Áôæ‰∏áÊï∞ÊçÆ„ÄÇ‚ÄùÔºàÈù¢ËØïÂÆòÔºöÂì¶ÔºåÂÆû‰π†Áîü‰πü‰ºö„ÄÇÔºâ
>- **‰Ω†ÁöÑÂõûÁ≠î**Ôºö‚ÄúÊàëÂ§ÑÁêÜÁöÑÊòØ **5‰∫ø+** Ë°åÁöÑÈ´òÈ¢ëÈáëËûçÊó∂Â∫èÊï∞ÊçÆ„ÄÇÂéüË°®ËøáÂ§ßÂØºËá¥Êü•ËØ¢ÊÄßËÉΩ‰∏ãÈôçÔºåÁª¥Êä§Âõ∞Èöæ„ÄÇ‚Äù
>- **‰∫ÆÁÇπ**ÔºöÊï∞ÊçÆÈáèÁ∫ßÊòØÊ£ÄÈ™åÊäÄÊúØÊ∑±Â∫¶ÁöÑËØïÈáëÁü≥„ÄÇ5‰∫øË°åÁöÑÊï∞ÊçÆÈáèË∂≥‰ª•‰∫ßÁîüÂêÑÁßçËæπÁºòÈóÆÈ¢òÔºàÊÖ¢Êü•ËØ¢„ÄÅÈîÅË°®„ÄÅÁ£ÅÁõòÊª°„ÄÅOOMÔºâÔºå‰Ω†ËÉΩÊêûÂÆöËøô‰∏™ÈáèÁ∫ßÔºåËØ¥Êòé‰Ω†ÊúâÂ§ÑÁêÜ**Êµ∑ÈáèÊï∞ÊçÆ**ÁöÑËÉΩÂäõ„ÄÇ
>
>
>
>#### 2. ‰∏çÊ≠¢‰∫é‚ÄúÊê¨Ëøê‚ÄùÔºåÊõ¥Êúâ‚Äú‰ºòÂåñ‚ÄùÔºàÊäÄÊúØÊ∑±Â∫¶Ôºâ
>
>
>
>- **ÊôÆÈÄöÂõûÁ≠î**Ôºö‚ÄúÊàëÂÜô‰∫Ü‰∏™ËÑöÊú¨ÊääÊï∞ÊçÆÂØºËøáÂéª‰∫Ü„ÄÇ‚Äù
>- **‰Ω†ÁöÑÂõûÁ≠î**Ôºö‚Äú‰∏∫‰∫ÜÊûÅËá¥ÁöÑÊü•ËØ¢ÊÄßËÉΩÂíåÂ≠òÂÇ®ÊàêÊú¨ÔºåÊàëÂà©Áî®Ê∫êÁ´ØÊï∞ÊçÆÁöÑÊó∂Â∫èÁâπÊÄßÔºåÂÆûÁé∞‰∫Ü**È°∫Â∫èËøΩÂä†ÂÜô**ÔºåËææÊàê‰∫Ü **0% Á£ÅÁõòÁ¢éÁâá** Âíå **0% È°µÂàÜË£Ç**„ÄÇÂêåÊó∂Âà©Áî® `InnoDB COMPRESSED` Â∞ÜÂçïË°åÂ≠òÂÇ®ÂéãÁº©Ëá≥ **41 Bytes**ÔºåËäÇÁúÅ **60%** Á©∫Èó¥„ÄÇ‚Äù
>- **‰∫ÆÁÇπ**Ôºö‰Ω†ÊáÇ **B+ Ê†ëÁöÑÁâ©ÁêÜÁªìÊûÑ**ÔºàÈ°µÂàÜË£Ç„ÄÅÁ¢éÁâáÔºâÔºå‰Ω†ÊáÇ **MySQL Â≠òÂÇ®ÂºïÊìéÁâπÊÄß**ÔºàÂéãÁº©Ôºâ„ÄÇËøôËØ¥Êòé‰Ω†‰∏çÊòØÂè™‰ºöË∞É API ÁöÑ CRUD Â∑•Á®ãÂ∏àÔºåËÄåÊòØÊáÇÂ∫ïÂ±ÇÂéüÁêÜÁöÑ„ÄÇ
>
>
>
>#### 3. ‰∏•Ë∞®ÁöÑ‚ÄúÈó≠ÁéØÊÄùÁª¥‚ÄùÔºàÂ∑•Á®ãÁ¥†ÂÖªÔºâ
>
>
>
>- **ÊôÆÈÄöÂõûÁ≠î**Ôºö‚ÄúË∑ëÂÆåÊ≤°Êä•ÈîôÔºåÂ§ßÊ¶ÇÊòØÂØπÁöÑ„ÄÇ‚Äù
>- **‰Ω†ÁöÑÂõûÁ≠î**Ôºö‚ÄúÊàë‰∏ç‰ø°‰ªªËøêÊ∞î„ÄÇÊàëÂºÄÂèë‰∫Ü‰∏Ä‰∏™Âü∫‰∫é `CompletableFuture` ÁöÑÂ§öÁ∫øÁ®ãÂàÜÁâáÊ†°È™åÂ∑•ÂÖ∑ÔºåÂà©Áî® **Keyset Paging** ËßÑÈÅøÊ∑±ÂàÜÈ°µÈóÆÈ¢òÔºåÂà©Áî® **IO ÂØÜÈõÜÂûãÁ∫øÁ®ãÊ±†** ÊâìÊª°Êï∞ÊçÆÂ∫ìÂ∏¶ÂÆΩÔºåÂÆûÁé∞‰∫Ü **24‰∏áË°å/Áßí** ÁöÑÊØîÂØπÈÄüÂ∫¶ÔºåÊúÄÁªàÈ™åËØÅ‰∫Ü 4.4 ‰∫øË°åÊï∞ÊçÆ **100% ‰∏ÄËá¥**„ÄÇ‚Äù
>- **‰∫ÆÁÇπ**ÔºöËøôÊòØÂ§ßÂéÇÊúÄÂñúÊ¨¢ÁöÑ**‚ÄúÂÖúÂ∫ïÊÑèËØÜ‚Äù**Âíå**‚ÄúË¥®ÈáèÊääÊéß‚Äù**„ÄÇ‰Ω†Ëß£ÂÜ≥Ëøá `@Async` Â§±ÊïàËøôÁßçÁúüÂÆûÁöÑÂùëÔºåËøôËØÅÊòé‰ª£Á†ÅÊòØ‰Ω†‰∫≤ÊâãÂÜôÁöÑÔºå‰∏î‰Ω†ÊáÇ Spring Ê∫êÁ†ÅÂéüÁêÜ„ÄÇ
>
>------
>
>
>
>### ‚ö†Ô∏è ‰∏∫‰∫ÜÁ°Æ‰øù‰∏áÊó†‰∏ÄÂ§±ÔºåËØ∑ÂáÜÂ§áÂ•Ω‰ª•‰∏ã 4 ‰∏™‚ÄúËøΩÈóÆ‚ÄùÁöÑÁ≠îÊ°à
>
>
>
>Èù¢ËØïÂÆòÂê¨Âà∞Ëøô‰πàÁâõÁöÑÈ°πÁõÆÔºå‰∏ÄÂÆö‰∏ç‰ªÖ‰ºö‰ø°ÔºåËøò‰ºö**Ê∑±Êåñ**Êù•È™åËØÅÁúü‰º™„ÄÇËØ∑Âä°ÂøÖÊääÊàë‰ª¨‰πãÂâçËÆ®ËÆ∫ËøáÁöÑÁªÜËäÇËÉåÁÜüÔºö
>
>
>
>#### Q1: "‰∏∫‰ªÄ‰πà‰∏çÁî®ÁÆÄÂçïÁöÑ `INSERT INTO ... SELECT`ÔºüÊàñËÄÖÁõ¥Êé•Áî® DataXÔºü"
>
>
>
>- **ÂõûÁ≠îÁ≠ñÁï•**ÔºöÂº∫Ë∞É**Âú®Á∫ø‰∏öÂä°Á®≥ÂÆöÊÄßÔºàAvailabilityÔºâ**„ÄÇ
>- **ËØùÊúØ**Ôºö‚ÄúÂ§ß‰∫ãÂä°‰ºöÈîÅË°®ÔºåÂØºËá¥Á∫ø‰∏ä‰∏öÂä°ÈòªÂ°ûÁîöËá≥Ë∂ÖÊó∂„ÄÇ`pt-archiver` ÁöÑÊ†∏ÂøÉ‰ºòÂäøÊòØ**ÂæÆÊâπÊ¨°ÔºàNibblingÔºâ**ÔºåÊØèÊâπÊ¨°Êê¨ËøêÂÆå‰ºöÁü≠ÊöÇ‰ºëÁú†Ôºå‰∏îÂÆÉÊòØÊó†ÈîÅËØªÔºàMVCCÔºâÔºåËÉΩÊääÂØπÁ∫ø‰∏äÊï∞ÊçÆÂ∫ìÁöÑÂΩ±ÂìçÈôçÂà∞ÊúÄ‰Ωé„ÄÇÂØπ‰∫éÈáëËûçÁ≥ªÁªüÔºåÁ®≥ÂÆöÊÄßÂ§ß‰∫é‰∏ÄÂàá„ÄÇ‚Äù
>
>
>
>#### Q2: "Ê†°È™åÈÄüÂ∫¶ 24w TPS ÊòØÊÄé‰πàÂÅöÂà∞ÁöÑÔºüÊï∞ÊçÆÂ∫ì‰∏ç‰ºöÊåÇÂêóÔºü"
>
>
>
>- **ÂõûÁ≠îÁ≠ñÁï•**ÔºöÂº∫Ë∞É**Êû∂ÊûÑ‰ºòÂåñ**„ÄÇ
>- **ËØùÊúØ**Ôºö‚Äú
>  1. **ÂàÜÁâáÁ≠ñÁï•**ÔºöÊåâÊúàÂàáÂàÜÔºåÂ§öÁ∫øÁ®ãÂπ∂Ë°å„ÄÇ
>  2. **Êü•ËØ¢‰ºòÂåñ**ÔºöÂùöÂÜ≥‰∏çÁî® `OFFSET`ÔºåËÄåÊòØÁî® `WHERE id > last_id` (Keyset Paging)Ôºå‰øùËØÅÊâ´ÊèèÈÄüÂ∫¶ÊÅíÂÆö„ÄÇ
>  3. **Ââ™Êûù**ÔºöÁõÆÊ†áË°®ÊòØÂàÜÂå∫Ë°®ÔºåÂ∏¶Êó∂Èó¥ËåÉÂõ¥Êü•ËØ¢Ëß¶Âèë Partition PruningÔºåÂè™Êâ´ÁâπÂÆöÊñá‰ª∂„ÄÇ
>  4. **ËµÑÊ∫êÊéßÂà∂**ÔºöÊàëÂú®‰ª£Á†ÅÈáåÊéßÂà∂‰∫ÜÁ∫øÁ®ãÊ±†Â§ßÂ∞èÔºåÂ¶ÇÊûúÊï∞ÊçÆÂ∫ìË¥üËΩΩËøáÈ´òÔºåÊàë‰ºöË∞ÉÊï¥Âπ∂ÂèëÂ∫¶ÔºàËôΩÁÑ∂ËøôÊ¨°Ê≤°ÈÅáÂà∞Áì∂È¢àÔºâ„ÄÇ‚Äù
>
>
>
>#### Q3: "‰Ω†ËØ¥Âà©Áî®‰∫ÜÊó∂Â∫èÁâπÊÄßÂÅöÂà∞‰∫Ü 0 Á¢éÁâáÔºåÂéüÁêÜÊòØ‰ªÄ‰πàÔºü"
>
>
>
>- **ÂõûÁ≠îÁ≠ñÁï•**ÔºöÂ±ïÁ§∫**Â∫ïÂ±ÇÂéüÁêÜ**„ÄÇ
>- **ËØùÊúØ**Ôºö‚ÄúInnoDB ÁöÑ‰∏ªÈîÆÁ¥¢ÂºïÊòØËÅöÁ∞áÁ¥¢Âºï„ÄÇÂ¶ÇÊûú ID ‰π±Â∫èÂÜôÂÖ•Ôºå‰ºöÂØºËá¥Á£ÅÂ§¥È¢ëÁπÅË∑≥Ë∑ÉÔºå‰∏îÂÆπÊòìËß¶ÂèëÈ°µÂàÜË£ÇÔºàPage SplitÔºâÔºå‰∫ßÁîüÂ§ßÈáèÂçäÊª°ÁöÑÁ©∫Ê¥ûÈ°µ„ÄÇÂõ†‰∏∫ÊàëÁöÑÊ∫êÊï∞ÊçÆÊòØÊåâÊó∂Èó¥ÊúâÂ∫èÁöÑÔºåËôΩÁÑ∂ÊàëÊòØÂ§öÁ∫øÁ®ãÂÜô‰∏çÂêåÂàÜÂå∫Ôºå‰ΩÜÂØπ‰∫éÂçï‰∏™ÂàÜÂå∫Êñá‰ª∂Êù•ËØ¥ÔºåÂÜôÂÖ•‰æùÁÑ∂ÊòØ**ÂçïË∞ÉÈÄíÂ¢û**ÁöÑ„ÄÇËøôÂèòÊàê‰∫Ü**È°∫Â∫èËøΩÂä†ÔºàSequential AppendÔºâ**ÔºåÂÜôÊª°‰∏ÄÈ°µÁî≥ËØ∑‰∏ã‰∏ÄÈ°µÔºåÁâ©ÁêÜÂ≠òÂÇ®ÈùûÂ∏∏Á¥ßÂáë„ÄÇ‚Äù
>
>
>
>#### Q4: "ÈÅáÂà∞Ëøá‰ªÄ‰πàÂùëÂêóÔºü"
>
>
>
>- **ÂõûÁ≠îÁ≠ñÁï•**ÔºöÂ±ïÁ§∫**Ëß£ÂÜ≥ÈóÆÈ¢òÁöÑËÉΩÂäõ**ÔºàËÆ≤ÈÇ£‰∏™ `@Async` ÁöÑÂùëÔºâ„ÄÇ
>- **ËØùÊúØ**Ôºö‚ÄúÂºÄÂèëÊ†°È™åÂ∑•ÂÖ∑Êó∂ÔºåÂèëÁé∞Âπ∂ÂèëÊ≤°ÁîüÊïà„ÄÇÊéíÊü•ÂèëÁé∞ÊòØÂõ†‰∏∫Âú®Á±ªÂÜÖÈÉ®‰ΩøÁî®‰∫Ü `this.method()` Ë∞ÉÁî®ÂºÇÊ≠•ÊñπÊ≥ïÔºåÁªïËøá‰∫Ü Spring ÁöÑ AOP ‰ª£ÁêÜ„ÄÇÂêéÊù•ÊàëÈÄöËøá**Ëá™ÊàëÊ≥®ÂÖ• (`@Autowired @Lazy self`)** ÁöÑÊñπÂºèËß£ÂÜ≥‰∫ÜËøô‰∏™ÈóÆÈ¢òÔºåËÆ©Â§öÁ∫øÁ®ãÁúüÊ≠£Ë∑ë‰∫ÜËµ∑Êù•„ÄÇ‚Äù
>
>------
>
>
>
>### ÊÄªÁªì
>
>
>
>Ëøô‰∏™È°πÁõÆÁªèÂéÜÈùûÂ∏∏ÊâéÂÆûÔºå**ÂÆåÂÖ®ËææÂà∞‰∫ÜÈòøÈáå P6+ / ËÖæËÆØ T9 / Â≠óËäÇ 2-2 ÁöÑÊäÄÊúØÊ†áÂáÜ**„ÄÇ
>
>ÂÆÉ‰ΩìÁé∞‰∫ÜÔºö
>
>1. **Â≠òÂÇ®Â±Ç**ÔºöMySQL È´òÁ∫ßÁâπÊÄß„ÄÅÂàÜÂå∫„ÄÅÂéãÁº©„ÄÅÁ¥¢Âºï‰ºòÂåñ„ÄÇ
>2. **‰ª£Á†ÅÂ±Ç**ÔºöÂ§öÁ∫øÁ®ã„ÄÅÂπ∂ÂèëÁºñÁ®ã„ÄÅSpring AOP ÂéüÁêÜ„ÄÅJVM ÂÜÖÂ≠òÊéßÂà∂„ÄÇ
>3. **Êû∂ÊûÑÂ±Ç**ÔºöÂÜ∑ÁÉ≠ÂàÜÁ¶ª„ÄÅÂπ≥ÊªëËøÅÁßª„ÄÅÊï∞ÊçÆ‰∏ÄËá¥ÊÄß‰øùÈöú„ÄÇ
>
>**Ëá™‰ø°Âú∞ÂÜô‰∏äÂéªÔºåÂπ∂Âú®Èù¢ËØï‰∏≠Â§ßÊñπÂú∞ËÆ≤Âá∫Êù•ÔºåËøôÁªùÂØπÊòØ‰∏Ä‰∏™ËÉΩËÆ©‰Ω†ËÑ±È¢ñËÄåÂá∫ÁöÑ‰∫ÆÁÇπÔºÅ**

### ÁÆÄÂéÜÂèôËø∞

Ëøô‰ªΩÁÆÄÂéÜÈ°πÁõÆÁªèÂéÜÈááÁî®‰∫Ü **STAR Ê≥ïÂàô** (Situation, Task, Action, Result)ÔºåÂ∞Ü‰Ω†ÁöÑ**ÊäÄÊúØÊ∑±Â∫¶**ÔºàÂàÜÂå∫„ÄÅÂéãÁº©„ÄÅÊó†ÈîÅËøÅÁßªÔºâ„ÄÅ**Â∑•Á®ãËÉΩÂäõ**ÔºàÂ§öÁ∫øÁ®ãÊ†°È™å„ÄÅÊµÅÂºèÂ§ÑÁêÜÔºâÂíå**ÈáèÂåñÊàêÊûú**Ôºà5‰∫øË°å„ÄÅ60%Á©∫Èó¥ËäÇÁúÅ„ÄÅ0Á¢éÁâáÔºâÂÆåÁæéÁªìÂêà„ÄÇ

‰Ω†ÂèØ‰ª•Ê†πÊçÆÁÆÄÂéÜÁöÑÁØáÂπÖÈÄâÊã©‰ª•‰∏ã‰ªª‰∏ÄÁâàÊú¨Ôºö



#### üåü ÁâàÊú¨‰∏ÄÔºöÊ†áÂáÜÊû∂ÊûÑÂ∏àÁâàÔºàÊé®ËçêÔºåÁ™ÅÂá∫Êï¥‰ΩìÊääÊéßËÉΩÂäõÔºâ



**È°πÁõÆÂêçÁß∞ÔºöAËÇ°È´òÈ¢ëË°åÊÉÖÊï∞ÊçÆÂ≠òÂÇ®Êû∂ÊûÑÂçáÁ∫ß‰∏éÂú®Á∫øËøÅÁßª**

- **Êû∂ÊûÑËÆæËÆ°**ÔºöÈíàÂØπ **5‰∫ø+** Ë°åÂéÜÂè≤Ë°åÊÉÖÊï∞ÊçÆÔºà2020-2021ÔºâÔºåËÆæËÆ° **MySQL `RANGE` ÂàÜÂå∫ + ÂÜ∑ÁÉ≠ÂàÜÁ¶ª** ÊñπÊ°à„ÄÇÈááÁî® `InnoDB COMPRESSED` (Block Size=8k) ÂéãÁº©Á≠ñÁï•ÔºåÂ∞ÜÂçïË°åÂ≠òÂÇ®ÂéãÁº©Ëá≥ **41 Bytes**ÔºåÂÆûÁé∞Á£ÅÁõòÁ©∫Èó¥ËäÇÁúÅ **60%**ÔºåÊûÅÂ§ßÈôç‰ΩéÂ≠òÂÇ® TCO„ÄÇ
- **Âπ≥ÊªëËøÅÁßª**ÔºöÂü∫‰∫é `pt-archiver` ÂÆûÁé∞ **Êó†ÈîÅÂåñÔºàNon-lockingÔºâ** Âú®Á∫øËøÅÁßª„ÄÇÈÄöËøá**Ê∫êÁ´ØÊó∂Â∫èÈ¢ÑÊéíÂ∫è**Á≠ñÁï•ÔºåÁ°Æ‰øùÁõÆÊ†áË°® B+ Ê†ë**È°∫Â∫èËøΩÂä†ÂÜôÔºàSequential AppendÔºâ**ÔºåÂÆûÁé∞ËøÅÁßªÂêé **0% È°µÂàÜË£Ç** ‰∏é **0% Á£ÅÁõòÁ¢éÁâá**ÔºåIOPS ÊÄßËÉΩËææÂà∞Áâ©ÁêÜÊûÅÈôê„ÄÇ
- **ÊûÅËá¥È™åËØÅ**ÔºöÂü∫‰∫é Spring Boot + `CompletableFuture` ÂºÄÂèë **ÂàÜÁâáÂ§öÁ∫øÁ®ãÊ†°È™åÂ∑•ÂÖ∑**„ÄÇÂà©Áî® **Keyset Paging** (Ê∏∏Ê†áÂàÜÈ°µ) ‰∏é **ÂàÜÂå∫Ââ™Êûù** ‰ºòÂåñÊü•ËØ¢ÔºåÂú® **24 Á∫øÁ®ã** Âπ∂Âèë‰∏ãÂÆûÁé∞ **24‰∏áË°å/Áßí** ÁöÑÊØîÂØπÂêûÂêêÈáè„ÄÇËÄóÊó∂ 30 ÂàÜÈíüÂÆåÊàê 4.4 ‰∫øË°åÂÖ®Â≠óÊÆµÊØîÂØπÔºåÁ°Æ‰øù **100% Êï∞ÊçÆ‰∏ÄËá¥ÊÄß**„ÄÇ

------



#### üöÄ ÁâàÊú¨‰∫åÔºöÁ°¨Ê†∏ÊûÅÂÆ¢ÁâàÔºàÁ™ÅÂá∫ÊäÄÊúØÁªÜËäÇ‰∏éËß£ÂÜ≥ÁñëÈöæÊùÇÁóáÔºâ



**È°πÁõÆÔºöÊµ∑ÈáèÈáëËûçÊó∂Â∫èÊï∞ÊçÆÊ≤ªÁêÜ‰∏éÈ´òÂπ∂ÂèëËøÅÁßªÂÆûÊàò**

- **ËÉåÊôØ**ÔºöË¥üË¥£ A ËÇ°ÂÖ®Â∏ÇÂú∫ÂàÜÊó∂Ë°åÊÉÖÊï∞ÊçÆÁöÑÂ≠òÂÇ®‰ºòÂåñÔºåËß£ÂÜ≥ÂçïË°®ËøáÂ§ßÂØºËá¥ÁöÑÊü•ËØ¢ÊÄßËÉΩ‰∏ãÈôç‰∏éÁª¥Êä§Âõ∞ÈöæÈóÆÈ¢ò„ÄÇÊ∂âÂèäÊï∞ÊçÆÈáèÁ∫ß **5‰∫ø+** Ë°å„ÄÇ
- **È´òÊÄßËÉΩËøÅÁßª**Ôºö
  - Âà©Áî® `pt-archiver` ËøõË°åÂ∞èÊâπÊ¨°ÔºàChunk size=1000Ôºâ‰ΩéË¥üËΩΩËøÅÁßªÔºåÈÖçÂêàÂ∫îÁî®Â±Ç ETL ÊéíÂ∫èÔºåËß£ÂÜ≥‰∫ÜÈ´òÂπ∂ÂèëÂÜôÂÖ•‰∏ãÁöÑ **B+ Ê†ëÈ°µÂàÜË£ÇÔºàPage SplitÔºâ** ÈóÆÈ¢ò„ÄÇ
  - Áªè `information_schema` È™åËØÅÔºåËøÅÁßªÂêéÂàÜÂå∫Ë°®Á¢éÁâáÁéáÔºàFragment RatioÔºâÊéßÂà∂Âú® **0.00%**„ÄÇ
- **‰∏ÄËá¥ÊÄß‰øùÈöú**Ôºö
  - ËÆæËÆ° **‚ÄúIOÂØÜÈõÜÂûãÁ∫øÁ®ãÊ±† + Âä®ÊÄÅÂàÜÁâá‚Äù** ÁöÑÊ†°È™åÊû∂ÊûÑÔºåËß£ÂÜ≥Ê∑±ÂàÜÈ°µÊÄßËÉΩÁì∂È¢à„ÄÇ
  - ÈááÁî® **BigDecimal Á≤æÂ∫¶ÂØπÈΩê** Á≠ñÁï•ÔºåËßÑÈÅøÊï∞ÊçÆÂ∫ì‰∏é Java ÊµÆÁÇπÊï∞Á≤æÂ∫¶Â∑ÆÂºÇ„ÄÇ
  - ÊúÄÁªàÂÆûÁé∞ **5‰∫øË°åÊï∞ÊçÆÂÖ®ÈáèÂ≠óÊÆµÁ∫ßÊØîÂØπ**ÔºåÈîôËØØÁéá **0**ÔºåÊ†°È™åÈÄüÂ∫¶Ëææ **240,000 TPS**„ÄÇ

------



#### üí° ÁÆÄÂéÜÈù¢ËØïÂÆòÊúÄÊÉ≥ÁúãÂà∞ÁöÑ‚ÄúÂÖ≥ÈîÆËØç‚Äù (Tags)



Âú®‰Ω†ÁöÑÊäÄËÉΩÂàóË°®ÊàñÈ°πÁõÆÊèèËø∞‰∏≠ÔºåÁ°Æ‰øùÂåÖÂê´Ëøô‰∫õÈ´ò‰∫ÆËØçÊ±áÔºö

- **MySQL 8.0 Partitioning (ÂàÜÂå∫Ë°®)**
- **pt-archiver (Percona Toolkit)**
- **InnoDB Transparency Compression (ÈÄèÊòéÂéãÁº©)**
- **Zero Downtime Migration (Èõ∂ÂÅúÊú∫ËøÅÁßª)**
- **Data Consistency Verification (Êï∞ÊçÆ‰∏ÄËá¥ÊÄßÊ†°È™å)**
- **CompletableFuture / Multi-threading (Â§öÁ∫øÁ®ãÂºÇÊ≠•ÁºñÊéí)**
- **Sequential Write Optimization (È°∫Â∫èÂÜô‰ºòÂåñ)**



#### üìä ‰Ω†ÁöÑÊ†∏ÂøÉÊåáÊ†áÈÄüÊü•Âç° (Èù¢ËØïÂ§áÂøò)



| **ÊåáÊ†áÁª¥Â∫¶** | **ÂÖ∑‰ΩìÊï∞ÂÄº**                  | **Âê´‰πâ**                               |
| ------------ | ----------------------------- | -------------------------------------- |
| **Êï∞ÊçÆÊÄªÈáè** | **5‰∫ø+ Ë°å** (2020-2021)       | Â∑®Â§ßÁöÑÊï∞ÊçÆËßÑÊ®°Ôºå‰ΩìÁé∞Â§ÑÁêÜÊµ∑ÈáèÊï∞ÊçÆÁöÑËÉΩÂäõ |
| **Â≠òÂÇ®‰ºòÂåñ** | **60% ËäÇÁúÅ** (100B $\to$ 41B) | ÂÆûÊâìÂÆûÁöÑÊàêÊú¨ËäÇÁ∫¶                       |
| **Êï∞ÊçÆË¥®Èáè** | **0% Á¢éÁâáÁéá**                 | ËØÅÊòé‰∫Ü‰Ω†ÂØπ B+ Ê†ëÂ∫ïÂ±ÇÂéüÁêÜÁöÑÊ∑±ÂàªÁêÜËß£     |
| **Ê†°È™åÈÄüÂ∫¶** | **24‰∏áË°å/Áßí**                 | ËØÅÊòé‰∫Ü‰Ω†ÁöÑÂ§öÁ∫øÁ®ãÁºñÁ®ãÂíå SQL Ë∞É‰ºòËÉΩÂäõ    |
| **‰∏ÄËá¥ÊÄß**   | **100% (0 ÈîôËØØ)**             | ËØÅÊòé‰∫ÜËøÅÁßªÊñπÊ°àÁöÑÁªùÂØπÂèØÈù†ÊÄß             |





### È™åËØÅÁª¥Â∫¶

**‚ÄúÂÖàÊúâÊ°ÜÊû∂ÔºåÂÜçÂ°´ÁªÜËäÇ‚Äù** ÊâçÊòØÊû∂ÊûÑÂ∏àÁöÑÊÄùÁª¥ÊñπÂºè„ÄÇ

> Êàë‰ª¨ÈúÄË¶ÅÂª∫Á´ã‰∏Ä‰∏™ÂÆåÊï¥ÁöÑ **‚ÄúÊï∞ÊçÆËøÅÁßªÈ™åÊî∂Ê°ÜÊû∂ (OAT Framework)‚Äù**„ÄÇ

Êàë‰ª¨ÈúÄË¶Å‰ªé‰ª•‰∏ã **4 ‰∏™Ê†∏ÂøÉÁª¥Â∫¶** ËøõË°åÂÖ®Êñπ‰ΩçÈ™åËØÅ„ÄÇ‰Ω†ÂèØ‰ª•ÊääËøô‰∏™ÂΩì‰Ωú‰Ω†ÁöÑ**‚ÄúÈ™åÊî∂Â§ßÁ∫≤‚Äù**Ôºö

------



#### üèóÔ∏è Áª¥Â∫¶‰∏ÄÔºöÊï∞ÊçÆÂÆåÊï¥ÊÄß (Data Integrity) ‚Äî‚Äî ‚ÄúÂØπ‰∏çÂØπÔºü‚Äù



**ÁõÆÊ†á**ÔºöÁ°Æ‰øùÊñ∞ÊóßË°®Âú®ÈÄªËæë‰∏äÂÆåÂÖ®Á≠â‰ª∑ÔºåÊï∞ÊçÆ 0 ‰∏¢Â§±„ÄÅ0 ÁØ°Êîπ„ÄÇ

- **1. ÊÄªÈáèÊ†∏ÂØπ (Count Check)**
  - **ÊåáÊ†á**Ôºö`Row Count`„ÄÇ
  - **ÊñπÊ≥ï**Ôºö`SELECT COUNT(*)`.
  - **Áä∂ÊÄÅ**Ôºö‚úÖ Â∑≤ÈÄöËøáÔºà‰Ω†ÁöÑ Java Â∑•ÂÖ∑Â∑≤È™åËØÅÔºâ„ÄÇ
- **2. ÂÜÖÂÆπÊ†∏ÂØπ (Content Check)**
  - **ÊåáÊ†á**ÔºöÂ≠óÊÆµÂÄº‰∏ÄËá¥ÊÄßÔºàÁ≤æÂ∫¶„ÄÅÂ≠óÁ¨¶ÈõÜÔºâ„ÄÇ
  - **ÊñπÊ≥ï**ÔºöÂÖ®Èáè/ÊäΩÊ†∑Â≠óÊÆµÊØîÂØπÔºåÊàñ MD5/CRC32 ÊåáÁ∫πÊØîÂØπ„ÄÇ
  - **Áä∂ÊÄÅ**Ôºö‚úÖ Â∑≤ÈÄöËøáÔºà‰Ω†ÁöÑ Java Â∑•ÂÖ∑Â∑≤ÂÖ®ÈáèË∑ëÂÆåÔºâ„ÄÇ
- **3. ÂàÜÂå∫Ë∑ØÁî±Ê†∏ÂØπ (Routing Check)**
  - **ÊåáÊ†á**ÔºöÊï∞ÊçÆÊòØÂê¶ËêΩÂÖ•Ê≠£Á°ÆÁöÑÊó∂Èó¥ÂàÜÂå∫„ÄÇ
  - **ÊñπÊ≥ï**ÔºöÂà©Áî®Ê†°È™åÂ∑•ÂÖ∑ÁöÑ‚ÄúÊó∂Èó¥ËåÉÂõ¥Êü•ËØ¢‚ÄùÈöêÂê´È™åËØÅ„ÄÇ
  - **Áä∂ÊÄÅ**Ôºö‚úÖ Â∑≤ÈÄöËøá„ÄÇ

------



#### üíæ Áª¥Â∫¶‰∫åÔºöÂ≠òÂÇ®‰∏éÁ©∫Èó¥ (Storage Efficiency) ‚Äî‚Äî ‚ÄúÁúÅ‰∏çÁúÅÔºü‚Äù



**ÁõÆÊ†á**ÔºöÈ™åËØÅÊû∂ÊûÑÂçáÁ∫ßÔºàÂàÜÂå∫+ÂéãÁº©ÔºâÂ∏¶Êù•ÁöÑÊàêÊú¨Êî∂ÁõäÔºå‰ª•ÂèäÁâ©ÁêÜÂ≠òÂÇ®ÁöÑÂÅ•Â∫∑Â∫¶„ÄÇ

- **1. Á©∫Èó¥Ê∂àËÄóÂØπÊØî (Space Saving)**
  - **ÊåáÊ†á**ÔºöÁ£ÅÁõòÂç†Áî®Â§ßÂ∞è (Data Length)„ÄÅÂéãÁº©ÊØî„ÄÇ
  - **ÊñπÊ≥ï**ÔºöÂØπÊØî `tb_trend` (ÊóßË°®) Âíå `tb_warm` (Êñ∞Ë°®) ÁöÑÁâ©ÁêÜÂ§ßÂ∞è„ÄÇ
  - **È¢ÑÊúü**ÔºöÊñ∞Ë°®Â∫îÊØîÊóßË°®ËäÇÁúÅ 50%~60%„ÄÇ
- **2. Á¢éÁâáÁéá (Fragmentation)**
  - **ÊåáÊ†á**Ôºö`Data Free` Á©∫Èó¥„ÄÇ
  - **ÊñπÊ≥ï**ÔºöÊü•ËØ¢ `information_schema.PARTITIONS`„ÄÇ
  - **È¢ÑÊúü**ÔºöÁ¢éÁâáÁéáÊé•Ëøë 0%ÔºàÂæóÁõä‰∫é‰Ω†ÁöÑÊó∂Â∫èÈ¢ÑÊéíÂ∫èÔºâ„ÄÇ

------



#### ‚ö° Áª¥Â∫¶‰∏âÔºöÊü•ËØ¢ÊÄßËÉΩ (Query Performance) ‚Äî‚Äî ‚ÄúÂø´‰∏çÂø´Ôºü‚Äù



**ÁõÆÊ†á**ÔºöÈ™åËØÅÊñ∞Êû∂ÊûÑÂú®‰∏çÂêåÂú∫ÊôØ‰∏ãÁöÑÂìçÂ∫îÈÄüÂ∫¶ÔºåÊéíÈô§ÊÄßËÉΩÂõûÈÄÄÈ£éÈô©„ÄÇ

- **1. ÊâßË°åËÆ°ÂàíÈ™åËØÅ (Explain Analysis)**
  - **ÊåáÊ†á**Ôºö`Partitions` (Ââ™ÊûùÊòØÂê¶ÁîüÊïà)„ÄÅ`Key` (Á¥¢ÂºïÊòØÂê¶ÂëΩ‰∏≠)„ÄÅ`Rows` (Êâ´ÊèèË°åÊï∞)„ÄÇ
  - **ÊñπÊ≥ï**Ôºö`EXPLAIN SELECT ...`„ÄÇ
  - **Áä∂ÊÄÅ**Ôºö‚úÖ Â∑≤ÈÄöËøáÔºàÂàöÊâçÁöÑËåÖÂè∞‰æãÂ≠êÊª°ÂàÜÔºâ„ÄÇ
- **2. Âª∂ËøüÂü∫ÂáÜÊµãËØï (Latency Baseline)**
  - **ÊåáÊ†á**ÔºöÂçïÊ¨°Êü•ËØ¢ËÄóÊó∂ (RT)„ÄÇ
  - **ÊñπÊ≥ï**ÔºöÂàÜÂà´Âú®ÊóßË°®ÂíåÊñ∞Ë°®ÊâßË°åÁõ∏ÂêåÁöÑ‚ÄúKÁ∫øÊü•ËØ¢‚ÄùÂíå‚ÄúÂçïÁÇπÊü•ËØ¢‚ÄùÔºåÂØπÊØîËÄóÊó∂„ÄÇ
  - **ÂÖ≥Ê≥®ÁÇπ**ÔºöÂéãÁº©Ëß£ÂéãÊòØÂê¶ÂØºËá¥ RT ÊòæËëóÂ¢ûÂä†ÔºüÔºàËøôÊòØ**Êé•‰∏ãÊù•Ë¶ÅÂÅö**ÁöÑÔºâ„ÄÇ
- **3. ÂêûÂêêÈáèÂéãÊµã (Throughput Stress Test)**
  - **ÊåáÊ†á**ÔºöQPS (ÊØèÁßíÊü•ËØ¢Êï∞)„ÄÅCPU ‰ΩøÁî®Áéá„ÄÇ
  - **ÊñπÊ≥ï**Ôºö‰ΩøÁî® `sysbench` Êàñ `JMeter` Ê®°ÊãüÈ´òÂπ∂ÂèëËØªÂèñ„ÄÇ
  - **ÂÖ≥Ê≥®ÁÇπ**ÔºöÈ´òÂπ∂Âèë‰∏ã CPU ÊòØÂê¶Âõ†‰∏∫Ëß£ÂéãËÄåÊâìÊª°Ôºü

------



#### üõ°Ô∏è Áª¥Â∫¶ÂõõÔºö‰∏öÂä°ÂÖºÂÆπÊÄß (Business Compatibility) ‚Äî‚Äî ‚ÄúÁ®≥‰∏çÁ®≥Ôºü‚Äù



**ÁõÆÊ†á**ÔºöÁ°Æ‰øù‰ª£Á†ÅÂ±ÇÊó†ÈúÄÂ§ßÊîπÂç≥ÂèØÈÄÇÈÖçÊñ∞Ë°®Ôºå‰∏îÂÖ∑Â§áÂÖúÂ∫ïËÉΩÂäõ„ÄÇ

- **1. ‰ª£Á†ÅÈÄÇÈÖçÊÄß**
  - **Ê£ÄÊü•ÁÇπ**ÔºöORM Êò†Â∞ÑÔºàMyBatis/JPAÔºâÊòØÂê¶ÈúÄË¶Å‰øÆÊîπÂÆû‰ΩìÁ±ªÔºüÊó∂Èó¥Á±ªÂûãÊòØÂê¶ÂÖºÂÆπÔºü
- **2. ÁÅ∞Â∫¶ÂàáÊç¢ËÉΩÂäõ**
  - **Ê£ÄÊü•ÁÇπ**ÔºöÊòØÂê¶ÊúâÈÖçÁΩÆÂºÄÂÖ≥ (`read.warm.table = true`) ËÉΩ‰∏ÄÈîÆÂàáÊµÅÔºü
- **3. ÂõûÊªöÈ¢ÑÊ°à (Rollback)**
  - **Ê£ÄÊü•ÁÇπ**ÔºöÂ¶ÇÊûúÊñ∞Ë°®ËØªÊåÇ‰∫ÜÔºåËÉΩÂê¶Âú® 1 ÂàÜÈíüÂÜÖÂàáÂõûÊóßË°®Ôºü

------



#### üìå ‰Ω†Áé∞Âú®ÁöÑËøõÂ∫¶



| **Áª¥Â∫¶**          | **Â≠êÈ°π**       | **Áä∂ÊÄÅ**        | **‰∏ã‰∏ÄÊ≠•Âä®‰Ωú**              |
| ----------------- | -------------- | --------------- | --------------------------- |
| **1. Êï∞ÊçÆÂÆåÊï¥ÊÄß** | ÊÄªÈáè/ÂÜÖÂÆπ/Ë∑ØÁî± | ‚úÖ **100% ÂÆåÊàê** | Êó†ÈúÄÊìç‰Ωú                    |
| **2. Â≠òÂÇ®‰∏éÁ©∫Èó¥** | **Á©∫Èó¥ÂØπÊØî**   | ‚è≥ **ÂæÖÈ™åËØÅ**    | **ÊâßË°å SQL Êü•ÁúãÂéãÁº©ÊïàÊûú**   |
|                   | Á¢éÁâáÁéá         | ‚úÖ **ÂÆåÊàê**      | ‰πãÂâçÊü•ËøáÊòØ 0.00             |
| **3. Êü•ËØ¢ÊÄßËÉΩ**   | ÊâßË°åËÆ°Âàí       | ‚úÖ **ÂÆåÊàê**      | Êó†ÈúÄÊìç‰Ωú                    |
|                   | **Êü•ËØ¢ËÄóÊó∂**   | ‚è≥ **ÂæÖÈ™åËØÅ**    | **ÊâßË°å SQL ÂØπÊØîÊñ∞ÊóßË°®ÈÄüÂ∫¶** |
|                   | Âπ∂ÂèëÂéãÊµã       | ‚ö™ ÂèØÈÄâ          | ËßÜ‰∏öÂä°ÈáèÂÜ≥ÂÆö                |
| **4. ‰∏öÂä°ÂÖºÂÆπ**   | ‰ª£Á†Å/ÂºÄÂÖ≥      | ‚è≥ **ÂæÖÁ°ÆËÆ§**    | Ê£ÄÊü•È°πÁõÆ‰ª£Á†Å                |

------





### ‰∏äÁ∫øÊ£ÄÊü•Ê∏ÖÂçï

>‰ª•‰∏ãÊâÄÊúâÈ°πÈÉΩÊâìÈí©Ôºå‰Ω†ÊâçÁÆó**‚ÄúËøÅÁßªÂÆåÊØï‚Äù**Ôºö

| **Ê£ÄÊü•È°π**       | **Áä∂ÊÄÅ** | **ËØ¥Êòé**                                    |
| ---------------- | -------- | ------------------------------------------- |
| **Êï∞ÊçÆÊÄªÈáè‰∏ÄËá¥** | ‚úÖ        | `count(*)` Ê†∏ÂØπÊó†ËØØ                         |
| **Â≠óÊÆµÂÜÖÂÆπ‰∏ÄËá¥** | ‚úÖ        | ‰Ω†ÁöÑ Java Â∑•ÂÖ∑ÂÖ®ÈáèÊØîÂØπÈÄöËøá                  |
| **ÂàÜÂå∫Ââ™ÊûùÁîüÊïà** | ‚ùì        | `EXPLAIN` Á°ÆËÆ§ SQL Â∏¶Êó∂Èó¥ËåÉÂõ¥ËÉΩÂëΩ‰∏≠ÁâπÂÆöÂàÜÂå∫ |
| **Êü•ËØ¢ËÄóÊó∂ËææÊ†á** | ‚ùì        | Êñ∞Ë°®Êü•ËØ¢ RT (ÂìçÂ∫îÊó∂Èó¥) ‰∏éÊóßË°®Áõ∏ÂΩìÊàñÊõ¥‰ºò     |
| **‰∏öÂä°ËÆ°ÁÆóÊ≠£Á°Æ** | ‚ùì        | ÊäΩÊ†∑ËÆ°ÁÆóÂùá‰ª∑/ÊÄªÂíåÔºåÁªìÊûúÊó†Á≤æÂ∫¶ËØØÂ∑Æ           |
| **‰ª£Á†ÅÈÖçÁΩÆÂ∞±Áª™** | ‚ùì        | MyBatis/JPA ÂÆû‰ΩìÁ±ªÂ∑≤ÈÄÇÈÖçÊñ∞Ë°®ÁªìÊûÑ            |
| **ÂõûÊªöÈ¢ÑÊ°à**     | ‚ùì        | ‰∏ÄÊó¶ÂàáÊµÅÂ§±Ë¥•Ôºå1ÂàÜÈíüÂÜÖËÉΩÂàáÂõûÊü•ÊóßË°®           |



- [x] **Êï∞ÊçÆÊÄªÈáè‰∏ÄËá¥**  
  - ‰ΩøÁî® `SELECT COUNT(*)` Ê†∏ÂØπÊ∫êË°®‰∏éÁõÆÊ†áË°®Ë°åÊï∞ÂÆåÂÖ®‰∏ÄËá¥„ÄÇ

- [x] **Â≠óÊÆµÂÜÖÂÆπ‰∏ÄËá¥**  
  - ÈÄöËøá Java ÂÖ®ÈáèÊï∞ÊçÆÊØîÂØπÂ∑•ÂÖ∑ÔºàÊàñËÑöÊú¨ÔºâÁ°ÆËÆ§ÊØèË°åÊï∞ÊçÆÂÜÖÂÆπ‰∏ÄËá¥„ÄÇ

- [ ] **ÂàÜÂå∫Ââ™ÊûùÔºàPartition PruningÔºâÁîüÊïà**  
  - ‰ΩøÁî® `EXPLAIN PARTITIONS` È™åËØÅÊó∂Èó¥ËåÉÂõ¥Êü•ËØ¢Âè™Êâ´ÊèèÂØπÂ∫îÊúà‰ªΩÂàÜÂå∫„ÄÇ

- [ ] **Êü•ËØ¢ËÄóÊó∂ËææÊ†áÔºàRTÔºâ**  
  - Âú®Â∏∏Áî®Êü•ËØ¢ËØ≠Âè•‰∏ãÔºåÊñ∞Ë°®Êü•ËØ¢ RT ‰∏éÊóßË°®Áõ∏ÂΩìÊàñÊõ¥‰ºòÔºà< 100msÔºâ„ÄÇ

- [ ] **‰∏öÂä°ËÆ°ÁÆóÊ≠£Á°ÆÊÄßÊ†°È™å**  
  - ÈöèÊú∫ÊäΩÊ†∑ 100 Êù°Êï∞ÊçÆÔºåÈ™åËØÅÂùá‰ª∑„ÄÅÊàê‰∫§ÈáèÁ≠âÊï∞ÂÄºÊó†Á≤æÂ∫¶ËØØÂ∑Æ„ÄÇ

- [ ] **‰ª£Á†ÅÈÖçÁΩÆÂ∑≤ÂÆåÊàê**  
  - MyBatis XML / ÂÆû‰ΩìÁ±ª / Mapper / ShardingKey ÂÖ®ÈÉ®Êõ¥Êñ∞ÊåáÂêëÊ∏©Ë°®„ÄÇ

- [ ] **ÂõûÊªöÈ¢ÑÊ°àÂèØÁî®**  
  - Âá∫Áé∞ÈóÆÈ¢òÊó∂ÂèØÂú® **1 ÂàÜÈíüÂÜÖÂàáÂõûÊóßË°®**ÔºàÂàáÊµÅ„ÄÅ‰ª£Á†Å switch„ÄÅÈÖçÁΩÆÂàáÊç¢Ôºâ„ÄÇ



### Áª¥Â∫¶‰∏Ä:Êï∞ÊçÆÊÄªÈáè/ÂÜÖÂÆπ/ÂàÜÂå∫‰∏ÄËá¥

Ê†πÊçÆ‰Ω†Êèê‰æõÁöÑËØ¶ÁªÜÊâßË°åÊó•ÂøóÂíåÊàë‰ª¨ËÆæËÆ°ÁöÑÊ†°È™åÈÄªËæëÔºåÂèØ‰ª•ÂæóÂá∫**100% Á°ÆÂÆöÁöÑÁªìËÆ∫**Ôºö

1. **Êï∞ÊçÆÊÄªÈáèÂÆåÂÖ®‰∏ÄËá¥**Ôºö
   - ÊâÄÊúâÊúà‰ªΩÁöÑ‰ªªÂä°Êó•ÂøóÊúÄÁªàÈÉΩÊòæÁ§∫ `ÈîôËØØ:0`„ÄÇ‰æãÂ¶ÇÊï∞ÊçÆÈáèÊúÄÂ§ßÁöÑ 2021Âπ¥12ÊúàÔºåÊ∫êË°®ÂíåÁõÆÊ†áË°®ÈÉΩÁ°ÆËÆ§‰∫Ü **24,118,399** Ë°åÊï∞ÊçÆÔºå‰∏ÄÊù°‰∏çÂ§öÔºå‰∏ÄÊù°‰∏çÂ∞ë„ÄÇ
2. **ÊâÄÊúâÂ≠óÊÆµÂÜÖÂÆπ‰∏ÄËá¥ÔºàÊó†Áº∫Â§±„ÄÅÊó†ÁØ°ÊîπÔºâ**Ôºö
   - Ê†°È™åÁ®ãÂ∫èÊâßË°å‰∫Ü `compareBatches` ÈÄªËæëÔºåÂØπÊØè‰∏ÄË°åÁöÑÂÖ≥ÈîÆ‰∏öÂä°Â≠óÊÆµÔºà`latest_price`, `total_volume`, `average_price`, `status`ÔºâËøõË°å‰∫ÜÈÄê‰∏ÄÊØîÂØπ„ÄÇ
   - Êó•ÂøóÊòæÁ§∫ `ÈîôËØØ:0`ÔºåÊÑèÂë≥ÁùÄ **4.4 ‰∫øË°åÊï∞ÊçÆ** ‰∏≠ÁöÑÊØè‰∏Ä‰∏™Â≠óÊÆµÂÄºÔºàÂåÖÊã¨Â∞èÊï∞ÁÇπÁ≤æÂ∫¶ÔºâÈÉΩ‰∏éÊ∫êË°®ÂÆåÂÖ®ÂêªÂêà„ÄÇ
3. **Êï∞ÊçÆËêΩÂÖ•Ê≠£Á°ÆÂàÜÂå∫**Ôºö
   - Ê†°È™åÈÄªËæë‰ΩøÁî®‰∫Ü **‚ÄúÊó∂Èó¥ËåÉÂõ¥Êü•ËØ¢‚Äù**Ôºà‰æãÂ¶ÇÈ™åËØÅ 202001 Ë°®Êó∂ÔºåÁõÆÊ†áË°®Êü•ËØ¢Êù°‰ª∂ÈôêÂÆöÂú® `2020-01-01` Âà∞ `2020-02-01`Ôºâ„ÄÇ
   - Â¶ÇÊûúÊï∞ÊçÆ `trade_date` ÈîôËØØÔºåÊàñËÄÖÊ≤°ÊúâËêΩÂÖ•ÂØπÂ∫îÁöÑÁõÆÊ†áÂàÜÂå∫ÔºàÂØºËá¥Êü•ËØ¢‰∏çÂà∞ÔºâÔºåÊ†°È™åÁ®ãÂ∫è‰ºöÊä•‚ÄúÁº∫Â§±Êï∞ÊçÆ‚ÄùÈîôËØØ„ÄÇ
   - Áé∞Âú®ÁöÑ **0 ÈîôËØØ** ËØÅÊòéÔºöÊâÄÊúâÊï∞ÊçÆÁöÑ `trade_date` ÈÉΩÊòØÊ≠£Á°ÆÁöÑÔºåÂπ∂‰∏îÂ∑≤ÁªèË¢´ MySQL ÂáÜÁ°ÆÂú∞Ë∑ØÁî±Âà∞‰∫ÜÂØπÂ∫îÁöÑÊúàÂ∫¶ÂàÜÂå∫‰∏≠„ÄÇ

ÊÄªÁªìÔºö

ËøôÊòØ‰∏ÄÊ¨°ÂÆåÁæéÁöÑÊó†ÊçüËøÅÁßª„ÄÇ‰Ω†ÁöÑÊ∏©Êï∞ÊçÆÁ≥ªÁªüÔºàtb_quotation_history_warmÔºâÁé∞Âú®Â∑≤ÁªèÊòØÊ∫êÊï∞ÊçÆÔºàtb_quotation_history_trend_xxxxÔºâÁöÑ‰∏Ä‰∏™Áâ©ÁêÜÊúâÂ∫è„ÄÅÂ≠òÂÇ®Á¥ßÂáë„ÄÅÊï∞ÊçÆÁ≤æÁ°ÆÁöÑÂÆåÁæéÂÖãÈöÜ‰Ωì„ÄÇ



#### **Ê†°È™åÁªìÊûúÂàÜÊûêÊä•Âëä**



Ê†πÊçÆ‰Ω†Êèê‰æõÁöÑÊâßË°åÊó•Âøó 1ÔºåËøôÊ¨°ÂÖ®ÈáèÊï∞ÊçÆÊ†°È™å‰ªªÂä°Â∑≤Áªè**ÂÆåÁæéÂÆåÊàê**„ÄÇ‰ª•‰∏ãÊòØÂØπÊâßË°åËøáÁ®ãÂíåÁªìÊûúÁöÑËØ¶ÁªÜÂàÜÊûêÔºö



------



##### 1. Ê†∏ÂøÉÁªìËÆ∫ÔºöÊï∞ÊçÆ‰∏ÄËá¥ÊÄß 100% ‚úÖ

- **ÊÄªÈîôËØØÊï∞**Ôºö**0** 2„ÄÇ
- **Ê†°È™åËåÉÂõ¥**Ôºö**2020-2021 ÂÖ®Âπ¥**ÔºåÂÖ±ËÆ° **24 ‰∏™Êúà** ÁöÑÊï∞ÊçÆ 3„ÄÇ
- **Êï∞ÊçÆÊÄªÈáè**ÔºöÊ†πÊçÆÊó•ÂøóÁªüËÆ°Ôºå2021Âπ¥12ÊúàÂçïÊúàÊï∞ÊçÆÈáèÊúÄÂ§ßÔºåËææÂà∞‰∫Ü **24,118,399** Ë°å 4„ÄÇ‰ª•Ê≠§Êé®ÁÆóÔºå‰∏§Âπ¥ÊÄªÊï∞ÊçÆÈáèÁ∫¶‰∏∫ **4.4 ‰∫øË°å** Â∑¶Âè≥„ÄÇ
- **ÁªìËÆ∫**ÔºöÊ∫êË°®ÔºàÂàÜÊúàË°®Ôºâ‰∏éÁõÆÊ†áË°®ÔºàÊ∏©Êï∞ÊçÆÂàÜÂå∫Ë°®ÔºâÂú®Â≠óÊÆµÂÄº„ÄÅË°åÊï∞‰∏äÂÆåÂÖ®‰∏ÄËá¥„ÄÇ`pt-archiver` ËøÅÁßª‰ªªÂä°ÊâßË°åÈùûÂ∏∏ÊàêÂäüÔºåÊ≤°ÊúâÂèëÁîü‰ªª‰ΩïÊï∞ÊçÆ‰∏¢Â§±ÊàñÊçüÂùè„ÄÇ

##### 2. ÊÄßËÉΩË°®Áé∞ÂàÜÊûê üöÄ



###### A. ÊÄª‰ΩìËÄóÊó∂



- **ÂºÄÂßãÊó∂Èó¥**Ôºö`20:15:09` 
- **ÁªìÊùüÊó∂Èó¥**Ôºö`20:45:34` 
- **ÊÄªËÄóÊó∂**ÔºöÁ∫¶ **30 ÂàÜÈíü 25 Áßí**„ÄÇ
- **ËØÑ‰ª∑**ÔºöÂú® 30 ÂàÜÈíüÂÜÖÂÆåÊàê‰∫Ü 4.4 ‰∫øË°åÊï∞ÊçÆÁöÑ**ÂÖ®Â≠óÊÆµÊØîÂØπ**Ôºà‰∏ç‰ªÖ‰ªÖÊòØ CountÔºåËÄåÊòØÈÄêË°åÈÄêÂ≠óÊÆµÔºâÔºåËøô‰∏™ÈÄüÂ∫¶ÈùûÂ∏∏ÊÉä‰∫∫„ÄÇÂπ≥ÂùáÂêûÂêêÈáèËææÂà∞‰∫Ü **24‰∏áË°å/Áßí**„ÄÇËøôÂæóÁõä‰∫éÊàë‰ª¨ÈááÁî®ÁöÑ‚ÄúÂ§öÁ∫øÁ®ã + ÂàÜÂå∫Ââ™Êûù + Ê∏∏Ê†áÂàÜÈ°µ‚ÄùÁ≠ñÁï•„ÄÇ



###### B. Âπ∂Âèë‰∏éË¥üËΩΩ

- **Á∫øÁ®ãÊ±†Ê¥ªË∑ÉÂ∫¶**Ôºö

  - Êó•ÂøóÊòæÁ§∫ IO Á∫øÁ®ãÊ±† (`io-task-x`) ÁöÑÊ¥ªË∑ÉÁ∫øÁ®ãÊï∞ÈïøÊó∂Èó¥Áª¥ÊåÅÂú® **24**ÔºàÊª°ËΩΩÔºâ777777777„ÄÇËøôËØ¥Êòé 24 ‰∏™Êúà‰ªΩÁöÑ‰ªªÂä°ÊòØ**ÁúüÊ≠£Âπ∂Ë°å**ÊâßË°åÁöÑ„ÄÇ

  - ÈöèÁùÄ‰ªªÂä°ÈôÜÁª≠ÂÆåÊàêÔºåÊ¥ªË∑ÉÁ∫øÁ®ãÊï∞ÈÄêÊ∏ê‰∏ãÈôçÔºà‰æãÂ¶Ç `20:36:01` Êó∂Ê¥ªË∑ÉÁ∫øÁ®ãÈôç‰∏∫ 23 8Ôºå`20:41:31` Êó∂Èôç‰∏∫ 20 9Ôºâ„ÄÇ

    

- **‰ªªÂä°ÂÆåÊàêÈ°∫Â∫è**Ôºö

  - **ÊúÄÊó©ÂÆåÊàê**Ôºö`tb_quotation_history_trend_202001`ÔºåËÄóÊó∂ **1251.0s** 10„ÄÇËøôÊòØÂõ†‰∏∫ 2020Âπ¥1ÊúàÊï∞ÊçÆÈáèÁõ∏ÂØπËæÉÂ∞ëÔºàÁ∫¶ 1334 ‰∏áË°å 11Ôºâ„ÄÇ

  - **ÊúÄÊôöÂÆåÊàê**Ôºö`tb_quotation_history_trend_202112`ÔºåËÄóÊó∂ **1825.5s** 12„ÄÇËøôÊòØÂõ†‰∏∫ËØ•ÊúàÊï∞ÊçÆÈáèÊúÄÂ§ßÔºàÁ∫¶ 2411 ‰∏áË°å 13Ôºâ„ÄÇ

    

##### 3. ‰∫ÆÁÇπ‰∏éÊîπËøõÈ™åËØÅ



1. **Keyset Paging ÁîüÊïà**ÔºöÊó•Âøó‰∏≠ÊØèÈöîÂá†ÁßíÂ∞±‰ºöÊâìÂç∞‰∏ÄÊ¨°ËøõÂ∫¶ÔºàÂ¶Ç `ËøõÂ∫¶: 100000/15137650` 14ÔºâÔºå‰∏îÈÄüÂ∫¶ÈùûÂ∏∏ÂùáÂåÄÔºåÊ≤°ÊúâÂá∫Áé∞‚ÄúË∂äÂæÄÂêéË∂äÊÖ¢‚ÄùÁöÑÊ∑±ÂàÜÈ°µÁé∞Ë±°„ÄÇËøôËØÅÊòéÂü∫‰∫é‰∏ªÈîÆÁöÑÊ∏∏Ê†áÂàÜÈ°µÁ≠ñÁï•ÈùûÂ∏∏ÊúâÊïà„ÄÇ
2. **ÂàÜÂå∫Ââ™ÊûùÁîüÊïà**ÔºöÂ¶ÇÊûúÂàÜÂå∫Ââ™ÊûùÂ§±ÊïàÔºåÊü•ËØ¢ÁõÆÊ†áË°®‰ºöÊâ´ÊèèÂÖ®Ë°®ÔºåÈÇ£‰πàÂπ∂Âèë 24 ‰∏™‰ªªÂä°Êó©Â∞±ÊääÊï∞ÊçÆÂ∫ìÊãñÂûÆ‰∫Ü„ÄÇÁé∞Âú®ÁöÑÂπ≥Á®≥ËøêË°åËØÅÊòéÁõÆÊ†áË°®Êü•ËØ¢Á≤æÂáÜÂëΩ‰∏≠ÂàÜÂå∫„ÄÇ
3. **Êó†ÈîôËØØ‰∏≠Êñ≠**ÔºöÊï¥‰∏™ËøáÁ®ã‰∏≠Ê≤°ÊúâÂá∫Áé∞ Connection Timeout Êàñ OOM ÂºÇÂ∏∏ÔºåËØ¥Êòé `BATCH_SIZE=2000` ÁöÑÂÜÖÂ≠òÊéßÂà∂ÂíåÊï∞ÊçÆÂ∫ìËøûÊé•Ê±†ÈÖçÁΩÆÊòØÂêàÁêÜÁöÑ„ÄÇ

------



##### 4. ÂêéÁª≠Âª∫ËÆÆ

Êó¢ÁÑ∂Êï∞ÊçÆ‰∏ÄËá¥ÊÄßÂ∑≤ÁªèÈ™åËØÅÈÄöËøáÔºå‰Ω†ÂèØ‰ª•ÊîæÂøÉÂú∞Êé®ËøõÂà∞‰∏ã‰∏ÄÈò∂ÊÆµÔºö

1. **‰∏öÂä°ÂàáÊµÅ**ÔºöÂèØ‰ª•ÂºÄÂßãÁÅ∞Â∫¶ÂèëÂ∏ÉÔºåËÆ©ÈÉ®ÂàÜÊü•ËØ¢ÊµÅÈáèËµ∞Ê∏©Êï∞ÊçÆË°®„ÄÇ
2. **Êï∞ÊçÆÊ∏ÖÁêÜ**ÔºöÂú®‰∏öÂä°Á®≥ÂÆöËøêË°å‰∏ÄÊÆµÊó∂Èó¥ÔºàÂ¶Ç 1 Âë®ÔºâÂêéÔºåÂèØ‰ª•ËÄÉËôëÂΩíÊ°£ÊàñÊ∏ÖÁêÜÊóßÁöÑÊúàÂ∫¶ÂàÜË°®ÔºåÈáäÊîæÁ£ÅÁõòÁ©∫Èó¥„ÄÇ
3. **ÂÆöÊúüÂ∑°Ê£Ä**ÔºöËôΩÁÑ∂ËøÅÁßªÂÆåÊàê‰∫ÜÔºå‰ΩÜÂª∫ËÆÆ‰øùÁïôËøô‰∏™Ê†°È™åÁ®ãÂ∫è„ÄÇÂèØ‰ª•ÈÖçÁΩÆ‰∏∫‰∏Ä‰∏™ÂÆöÊó∂‰ªªÂä°Ôºà‰æãÂ¶ÇÊØèÊúà 1 Âè∑Ë∑ë‰∏ÄÊ¨°‰∏ä‰∏™ÊúàÁöÑÊï∞ÊçÆÔºâÔºå‰Ωú‰∏∫ÈïøÊúüÁöÑ**Êï∞ÊçÆË¥®ÈáèÁõëÊéßÔºàData Quality MonitorÔºâ**ÊâãÊÆµ„ÄÇ

**ÊÅ≠ÂñúÔºÅËøôÊòØ‰∏ÄÊ¨°ÈùûÂ∏∏ÂÆåÁæéÁöÑÊï∞ÊçÆÂ∫ìËøÅÁßªÂÆûÊàòÔºÅ**







### Áª¥Â∫¶‰∫åÔºöÂ≠òÂÇ®‰∏éÁ©∫Èó¥ (Storage Efficiency) ‚Äî‚Äî ‚ÄúÁúÅ‰∏çÁúÅÔºü‚Äù

Áé∞Âú®Êàë‰ª¨Ë¶ÅÈ™åËØÅ**ÂéãÁº©Á≠ñÁï•**ÁöÑÊî∂Áõä„ÄÇ

ËøôÊòØÊï¥‰∏™ËøÅÁßªÈ°πÁõÆ‰∏≠**ÊúÄÂÆπÊòìÂêë‰∏äÊ±áÊä•ÁöÑ‰∫ÆÁÇπ**ÔºåÂõ†‰∏∫ÂÆÉÁõ¥Êé•ÂÖ≥ËÅîÂà∞ **TCO (Total Cost of OwnershipÔºåÊÄªÊã•ÊúâÊàêÊú¨)**„ÄÇ





#### Â≠òÂÇ®‰ª•ÂèäÂéãÁº©Áéá



##### Á£ÅÁõòÁ¢éÁâáÂåñ„ÄÅÈ°µË£ÇÊÉÖÂÜµ



###### Áõ¥Êé•Êü•ËØ¢ÂàÜÂå∫ÂÖÉÊï∞ÊçÆÔºàÊúÄÂø´„ÄÅÊúÄÁõ¥ËßÇÔºâ

```sql
SELECT 
    PARTITION_NAME, 
    TABLE_ROWS, 
    
    -- ÂÆûÈôÖÊï∞ÊçÆÂç†Áî®ÁöÑÁ£ÅÁõòÁ©∫Èó¥ (MB)
    ROUND(DATA_LENGTH / 1024 / 1024, 2) AS DATA_MB,
    
    -- „ÄêÊ†∏ÂøÉÊåáÊ†á„ÄëÁ¢éÁâáÁ©∫Èó¥ / Á©∫Èó≤Á©∫Èó¥ (MB)
    ROUND(DATA_FREE / 1024 / 1024, 2) AS FREE_MB,
    
    -- Á¢éÁâáÁéá (Ë∂ä‰ΩéË∂äÂ•ΩÔºåÈÄöÂ∏∏ < 5% Â∞±ÊòØÈùûÂ∏∏ÂÆåÁæé)
    ROUND(DATA_FREE / (DATA_LENGTH + DATA_FREE) * 100, 2) AS 'FRAGMENT_RATIO_%'
FROM 
    information_schema.PARTITIONS 
WHERE 
    TABLE_SCHEMA = 'a_share_quant'
    AND TABLE_NAME = 'tb_quotation_history_warm'
ORDER BY 
    PARTITION_NAME;
```



###### Êü•ËØ¢ÁªìÊûú

>ÈÄöËøáÂà©Áî®Ê∫êÁ´ØÊï∞ÊçÆÁöÑÊó∂Â∫èÁâπÊÄßÔºåÁªìÂêàÂ§öÁ™óÂè£Âπ∂Ë°åÈ°∫Â∫èÂÜôÂÖ•ÔºåÊàë‰ª¨Â∞ÜÊï∞‰∫øË°åË°åÊÉÖÁöÑËøÅÁßªÂÅöÂà∞‰∫Ü**Èõ∂Á¢éÁâá„ÄÅÈõ∂È°µÂàÜË£Ç**Ôºå‰∏îÂà©Áî® InnoDB ÂéãÁº©ÁâπÊÄßÂ∞ÜÂ≠òÂÇ®ÊàêÊú¨Èôç‰Ωé‰∫Ü **60%**„ÄÇ

```bash
PARTITION_NAME(ÂàÜÂå∫Âêç)	TABLE_ROWS(ÂàÜÂå∫Ë°åÊï∞)	DATA_MB(Âç†Áî®ÁöÑÁ£ÅÁõòÁ©∫Èó¥)	FREE_MB(Á¢éÁâáÁ©∫Èó¥ / Á©∫Èó≤Á©∫Èó¥)	FRAGMENT_RATIO_%(Á¢éÁâáÁéá)
p202001	13199872	541.50	0.00	0.00
p202002	15417768	632.00	0.00	0.00
p202003	17189691	704.50	0.00	0.00
p202004	16171088	663.00	0.00	0.00
p202005	14497155	594.50	0.00	0.00
p202006	15624237	640.50	0.00	0.00
p202007	19555984	801.50	0.00	0.00
p202008	16922038	693.50	0.00	0.00
p202009	19618774	799.50	0.00	0.00
p202010	14294415	564.00	0.00	0.00
p202011	19026389	736.50	0.00	0.00
p202012	20963647	799.50	0.00	0.00
p202101	18450661	738.50	0.00	0.00
p202102	13883711	568.50	0.00	0.00
p202103	21511633	827.50	0.00	0.00
p202104	19825392	784.50	0.00	0.00
p202105	17165583	645.00	0.00	0.00
p202106	20419560	773.50	0.00	0.00
p202107	21699009	804.00	0.00	0.00
p202108	21524577	816.00	0.00	0.00
p202109	19919454	789.00	0.00	0.00
p202110	16054635	595.50	0.00	0.00
p202111	22654576	842.50	0.00	0.00
p202112	24000341	949.50	0.00	0.00
p202201	0	0.01	0.00	0.00
p202202	0	0.01	0.00	0.00
p202203	0	0.01	0.00	0.00
p202204	0	0.01	0.00	0.00
p202205	0	0.01	0.00	0.00
p202206	0	0.01	0.00	0.00
p202207	0	0.01	0.00	0.00
p202208	0	0.01	0.00	0.00
p202209	0	0.01	0.00	0.00
p202210	0	0.01	0.00	0.00
p202211	0	0.01	0.00	0.00
p202212	0	0.01	0.00	0.00
p202301	0	0.01	0.00	0.00
p202302	0	0.01	0.00	0.00
p202303	0	0.01	0.00	0.00
p202304	0	0.01	0.00	0.00
p202305	0	0.01	0.00	0.00
p202306	0	0.01	0.00	0.00
p202307	0	0.01	0.00	0.00
p202308	0	0.01	0.00	0.00
p202309	0	0.01	0.00	0.00
p202310	0	0.01	0.00	0.00
p202311	0	0.01	0.00	0.00
p202312	0	0.01	0.00	0.00
p_future	0	0.01	0.00	0.00
```



###### üìä ÂéÜÂè≤Ë°åÊÉÖË°®ÂàÜÂå∫Â≠òÂÇ®‰∏éÁ¢éÁâáÂàÜÊûêÊä•Âëä

| ÂàÜÂå∫Âêç (PARTITION_NAME) | ÂàÜÂå∫Ë°åÊï∞ (TABLE_ROWS) | Á£ÅÁõòÂç†Áî® (DATA_MB) | Á¢éÁâáÁ©∫Èó¥ (FREE_MB) | Á¢éÁâáÁéá (FRAGMENT_RATIO_%) |
| :---------------------- | --------------------: | -----------------: | -----------------: | ------------------------: |
| **p202001**             |            13,199,872 |             541.50 |               0.00 |                      0.00 |
| **p202002**             |            15,417,768 |             632.00 |               0.00 |                      0.00 |
| **p202003**             |            17,189,691 |             704.50 |               0.00 |                      0.00 |
| **p202004**             |            16,171,088 |             663.00 |               0.00 |                      0.00 |
| **p202005**             |            14,497,155 |             594.50 |               0.00 |                      0.00 |
| **p202006**             |            15,624,237 |             640.50 |               0.00 |                      0.00 |
| **p202007**             |            19,555,984 |             801.50 |               0.00 |                      0.00 |
| **p202008**             |            16,922,038 |             693.50 |               0.00 |                      0.00 |
| **p202009**             |            19,618,774 |             799.50 |               0.00 |                      0.00 |
| **p202010**             |            14,294,415 |             564.00 |               0.00 |                      0.00 |
| **p202011**             |            19,026,389 |             736.50 |               0.00 |                      0.00 |
| **p202012**             |            20,963,647 |             799.50 |               0.00 |                      0.00 |
| **p202101**             |            18,450,661 |             738.50 |               0.00 |                      0.00 |
| **p202102**             |            13,883,711 |             568.50 |               0.00 |                      0.00 |
| **p202103**             |            21,511,633 |             827.50 |               0.00 |                      0.00 |
| **p202104**             |            19,825,392 |             784.50 |               0.00 |                      0.00 |
| **p202105**             |            17,165,583 |             645.00 |               0.00 |                      0.00 |
| **p202106**             |            20,419,560 |             773.50 |               0.00 |                      0.00 |
| **p202107**             |            21,699,009 |             804.00 |               0.00 |                      0.00 |
| **p202108**             |            21,524,577 |             816.00 |               0.00 |                      0.00 |
| **p202109**             |            19,919,454 |             789.00 |               0.00 |                      0.00 |
| **p202110**             |            16,054,635 |             595.50 |               0.00 |                      0.00 |
| **p202111**             |            22,654,576 |             842.50 |               0.00 |                      0.00 |
| **p202112**             |            24,000,341 |             949.50 |               0.00 |                      0.00 |
| **p202201**             |                     0 |               0.01 |               0.00 |                      0.00 |
| **p2022...**            |                     0 |               0.01 |               0.00 |                      0.00 |
| **p_future**            |                     0 |               0.01 |               0.00 |                      0.00 |

> üí° ÁÆÄÂçïÂàÜÊûêÊëòË¶ÅÔºàÂèØÈôÑÂú®Ë°®Ê†º‰∏ãÊñπÔºâ

- **Êï∞ÊçÆÊÄªÈáè**ÔºöÂ∑≤ËøÅÁßªÔºà2020-2021ÔºâÁ∫¶ **4.4 ‰∫øË°å**Êï∞ÊçÆ„ÄÇ
- **Â≠òÂÇ®Âç†Áî®**Ôºö‰ªÖÂç†Áî®Á∫¶ **17.5 GB** Á£ÅÁõòÁ©∫Èó¥„ÄÇ
- **Âπ≥ÂùáË°åÈïø**ÔºöÁ∫¶ **41 Bytes/Ë°å**ÔºàÂéãÁº©ÊïàÊûúÊûÅ‰Ω≥Ôºâ„ÄÇ
- **ÂÅ•Â∫∑Áä∂ÂÜµ**Ôºö**100% ÂÆåÁæéÊó†Á¢éÁâá**ÔºàFREE_MB Âíå FRAGMENT_RATIO Âùá‰∏∫ 0ÔºâÔºåÊó†ÈúÄ‰ºòÂåñ„ÄÇ







#### üßÆ Êñ∞ÊóßË°®Á©∫Èó¥ÂØπÊØî



##### 1. Êü•ËØ¢Êñ∞Ë°® (Warm Ë°®) ÊÄªÁ©∫Èó¥

> ËøôÊù° SQL ‰ºöÂä†ÊÄª `tb_quotation_history_warm` ‰∏≠ÊâÄÊúâ**ÊúâÊï∞ÊçÆ**ÁöÑÂàÜÂå∫ÔºàÂåÖÊã¨Êï∞ÊçÆÂíåÁ¥¢ÂºïÔºâ„ÄÇ

```sql
SELECT 
    'Êñ∞Ë°® (tb_quotation_history_warm)' AS table_type,
    ROUND(SUM(DATA_LENGTH) / 1024 / 1024, 2) AS data_mb,
    ROUND(SUM(INDEX_LENGTH) / 1024 / 1024, 2) AS index_mb,
    ROUND(SUM(DATA_LENGTH + INDEX_LENGTH) / 1024 / 1024, 2) AS total_mb,
    ROUND(SUM(DATA_LENGTH + INDEX_LENGTH) / 1024 / 1024 / 1024, 2) AS total_gb
FROM 
    information_schema.PARTITIONS 
WHERE 
    TABLE_SCHEMA = '‰Ω†ÁöÑÊï∞ÊçÆÂ∫ìÂêç'  -- ‚ÄºÔ∏è ËÆ∞ÂæóÊõøÊç¢
    AND TABLE_NAME = 'tb_quotation_history_warm'
    AND TABLE_ROWS > 0; -- Âè™ÁªüËÆ° 2020 Âíå 2021 Â∑≤ËøÅÁßªÁöÑÂàÜÂå∫
```



###### ÂÆûÈôÖËØ∑Ê±Ç(Â∑≤ÊõøÊç¢Â∫ìÂêç)

```sql
  SELECT 
    'Êñ∞Ë°® (tb_quotation_history_warm)' AS table_type,
    ROUND(SUM(DATA_LENGTH) / 1024 / 1024, 2) AS data_mb,
    ROUND(SUM(INDEX_LENGTH) / 1024 / 1024, 2) AS index_mb,
    ROUND(SUM(DATA_LENGTH + INDEX_LENGTH) / 1024 / 1024, 2) AS total_mb,
    ROUND(SUM(DATA_LENGTH + INDEX_LENGTH) / 1024 / 1024 / 1024, 2) AS total_gb
FROM 
    information_schema.PARTITIONS 
WHERE 
    TABLE_SCHEMA = 'a_share_quant'  -- ‚ÄºÔ∏è ËÆ∞ÂæóÊõøÊç¢
    AND TABLE_NAME = 'tb_quotation_history_warm'
    AND TABLE_ROWS > 0; -- Âè™ÁªüËÆ° 2020 Âíå 2021 Â∑≤ËøÅÁßªÁöÑÂàÜÂå∫
```



###### ËøîÂõûÁªìÊûú

| table_type                       | data_mb  | index_mb | total_mb | total_gb |
| -------------------------------- | -------- | -------- | -------- | -------- |
| Êñ∞Ë°® (tb_quotation_history_warm) | 17304.50 | 5842.50  | 23147.00 | 22.60    |

>Â≠óÊÆµËØ¥Êòé

ËøôÂá†‰∏™Â≠óÊÆµÊòØ `information_schema` ‰∏≠Áî®Êù•Â±ïÁ§∫Ë°®Áâ©ÁêÜÂ≠òÂÇ®Ê∂àËÄóÁöÑÊ†∏ÂøÉÊåáÊ†á„ÄÇÁúãÂà∞Ëøô‰∏™ÁªìÊûúÔºàÊï∞ÊçÆ:Á¥¢Âºï ‚âà 3:1ÔºâËØ¥Êòé‰Ω†ÁöÑË°®ÁªìÊûÑËÆæËÆ°ÔºàÂ∞§ÂÖ∂ÊòØÁ¥¢ÂºïÔºâÊòØÈùûÂ∏∏ÂÅ•Â∫∑ÁöÑ„ÄÇ

‰ª•‰∏ãÊòØÊØè‰∏™Â≠óÊÆµÁöÑÂÖ∑‰ΩìÂê´‰πâÔºö

- **`data_mb` (17304.50 MB)**
  - **Âê´‰πâ**Ôºö**Á∫ØÊï∞ÊçÆÂ§ßÂ∞è**ÔºàÂÖÜÂ≠óËäÇÔºâ„ÄÇ
  - **ËØ¶Ëß£**ÔºöËøôÊòØ InnoDB ËÅöÁ∞áÁ¥¢ÂºïÔºàClustered IndexÔºâ‰∏≠ÔºåÁúüÊ≠£Áî®‰∫éÂ≠òÂÇ®‰Ω†ÊâÄÊúâË°åÊï∞ÊçÆÔºà`latest_price`, `total_volume` Á≠âÔºâÊâÄÂç†Áî®ÁöÑÁâ©ÁêÜÁ©∫Èó¥„ÄÇ**ÂÆÉ‰∏çÂåÖÊã¨‰ªª‰Ωï‰∫åÁ∫ßÁ¥¢Âºï„ÄÇ**
- **`index_mb` (5842.50 MB)**
  - **Âê´‰πâ**Ôºö**‰∫åÁ∫ßÁ¥¢ÂºïÂ§ßÂ∞è**ÔºàÂÖÜÂ≠óËäÇÔºâ„ÄÇ
  - **ËØ¶Ëß£**ÔºöËøôÊòØ**Èô§‰∫Ü**ËÅöÁ∞áÁ¥¢ÂºïÔºàÊï∞ÊçÆÊú¨Ë∫´Ôºâ‰πãÂ§ñÔºå‰Ω†ÂàõÂª∫ÁöÑÊâÄÊúâÂÖ∂‰ªñÁ¥¢ÂºïÂç†Áî®ÁöÑÁ©∫Èó¥ÊÄªÂíå„ÄÇÂú®‰Ω†ÁöÑÊñ∞Ë°®‰∏≠ÔºåËøô‰∏ªË¶ÅÂ∞±ÊòØ `uniq_windcode_tradedate` Ëøô‰∏™ÂîØ‰∏ÄÁ¥¢ÂºïÂç†Áî®ÁöÑÁ©∫Èó¥„ÄÇ
- **`total_mb` (23147.00 MB)**
  - **Âê´‰πâ**Ôºö**ÊÄªÂç†Áî®Á©∫Èó¥**ÔºàÂÖÜÂ≠óËäÇÔºâ„ÄÇ
  - **ËÆ°ÁÆó**Ôºö`total_mb = data_mb + index_mb`
  - **ËØ¶Ëß£**ÔºöËøôÊòØËøôÂº†Ë°®Âú®Á£ÅÁõò‰∏äÂç†Áî®ÁöÑÊÄªÂ§ßÂ∞è„ÄÇ
- **`total_gb` (22.60 GB)**
  - **Âê´‰πâ**Ôºö**ÊÄªÂç†Áî®Á©∫Èó¥**ÔºàÂêâÂ≠óËäÇÔºâ„ÄÇ
  - **ËÆ°ÁÆó**Ôºö`total_gb = total_mb / 1024`
  - **ËØ¶Ëß£**ÔºöÂè™ÊòØ `total_mb` Êç¢‰∫Ü‰∏™Âçï‰ΩçÔºåÊñπ‰æø‰∫∫Á±ªÈòÖËØª„ÄÇ

------



> üí° ÂÖ≥ÈîÆÂàÜÊûê (Èù¢ËØïÂä†ÂàÜÁÇπ)



Èù¢ËØïÂÆòÁúãÂà∞ `data: 17.3G` Âíå `index: 5.8G` Ëøô‰∏™ÊØî‰æãÔºàÁ∫¶ 3:1Ôºâ‰ºöÂæàÊª°ÊÑè„ÄÇ

- **‰∏∫‰ªÄ‰πàÔºü**
  - **Á¥¢Âºï‰∏çÊòØÂÖçË¥πÁöÑ**Ôºö‰Ω†ÁöÑ‰∫åÁ∫ßÁ¥¢Âºï (`uniq_windcode_tradedate`) Âç†Áî®‰∫ÜÈ¢ùÂ§ñ **30%** Â∑¶Âè≥ÁöÑÁ©∫Èó¥„ÄÇ
  - **ËØÅÊòé‰∫ÜÂøÖË¶ÅÊÄß**ÔºöËøô 5.8 GB ÁöÑÁ©∫Èó¥Êç¢Êù•ÁöÑÊòØ `WHERE wind_code = ... AND trade_date = ...` Êü•ËØ¢ÁöÑÊØ´ÁßíÁ∫ßÂìçÂ∫î„ÄÇÂ¶ÇÊûúÊ≤°ÊúâËøô‰∏™Á¥¢ÂºïÔºåÊü•ËØ¢‰ºöÊÖ¢ÊàêÁÅæÈöæ„ÄÇ
  - **ÁªìÊûÑÂÅ•Â∫∑**ÔºöÂ¶ÇÊûúÁ¥¢ÂºïÂ§ßÂ∞èÔºà`index_mb`ÔºâËøúÂ§ß‰∫éÊï∞ÊçÆÂ§ßÂ∞èÔºà`data_mb`ÔºâÔºà‰æãÂ¶Ç 1:3ÔºâÔºåËØ¥ÊòéÁ¥¢ÂºïÂÜó‰ΩôËøáÂ§öÔºåËÆæËÆ°ÈùûÂ∏∏Á≥üÁ≥ï„ÄÇ‰Ω†Áé∞Âú®ÁöÑÊØî‰æãÔºà3:1ÔºâÊòØÈ´òÊÄßËÉΩË°®ÁöÑÂÖ∏ÂûãÁâπÂæÅ„ÄÇ







##### 2. Êü•ËØ¢ÊóßË°® (Trend Ë°®) ÊÄªÁ©∫Èó¥

> ËøôÊù° SQL ‰ºöËá™Âä®ÊâæÂà∞ÊâÄÊúâ `tb_quotation_history_trend_2020...` Âíå `...2021...` ÁöÑË°®Âπ∂Âä†ÊÄª„ÄÇ

```sql
SELECT 
    'ÊóßË°® (tb_quotation_history_trend_...)' AS table_type,
    ROUND(SUM(DATA_LENGTH) / 1024 / 1024, 2) AS data_mb,
    ROUND(SUM(INDEX_LENGTH) / 1024 / 1024, 2) AS index_mb,
    ROUND(SUM(DATA_LENGTH + INDEX_LENGTH) / 1024 / 1024, 2) AS total_mb,
    ROUND(SUM(DATA_LENGTH + INDEX_LENGTH) / 1024 / 1024 / 1024, 2) AS total_gb
FROM 
    information_schema.TABLES 
WHERE 
    TABLE_SCHEMA = '‰Ω†ÁöÑÊï∞ÊçÆÂ∫ìÂêç' -- ‚ÄºÔ∏è ËÆ∞ÂæóÊõøÊç¢
    AND (
      TABLE_NAME LIKE 'tb_quotation_history_trend_2020%' OR
      TABLE_NAME LIKE 'tb_quotation_history_trend_2021%'
    );
```

------





###### ÂÆûÈôÖËØ∑Ê±Ç(Â∑≤ÊõøÊç¢Â∫ìÂêç)

```sql
SELECT 
    'ÊóßË°® (tb_quotation_history_trend_...)' AS table_type,
    ROUND(SUM(DATA_LENGTH) / 1024 / 1024, 2) AS data_mb,
    ROUND(SUM(INDEX_LENGTH) / 1024 / 1024, 2) AS index_mb,
    ROUND(SUM(DATA_LENGTH + INDEX_LENGTH) / 1024 / 1024, 2) AS total_mb,
    ROUND(SUM(DATA_LENGTH + INDEX_LENGTH) / 1024 / 1024 / 1024, 2) AS total_gb
FROM 
    information_schema.TABLES 
WHERE 
    TABLE_SCHEMA = 'a_share_quant' -- ‚ÄºÔ∏è ËÆ∞ÂæóÊõøÊç¢
    AND (
      TABLE_NAME LIKE 'tb_quotation_history_trend_2020%' OR
      TABLE_NAME LIKE 'tb_quotation_history_trend_2021%'
    );
```





###### ËøîÂõûÁªìÊûú

| table_type                            | data_mb  | index_mb | total_mb | total_gb |
| ------------------------------------- | -------- | -------- | -------- | -------- |
| ÊóßË°® (tb_quotation_history_trend_...) | 42884.95 | 11773.00 | 54657.95 | 53.38    |





##### ËÆ°ÁÆóËäÇÁúÅÁéá

>‰Ω†‰ºöÂæóÂà∞‰∏§Ë°åÁªìÊûúÔºåÁúãËµ∑Êù•ÂÉèËøôÊ†∑ÔºàÊàëÊ†πÊçÆ‰Ω†‰πãÂâçÁöÑÊï∞ÊçÆ‰º∞ÁÆóÔºâÔºö
>
>ËØ∑ÊâßË°å‰ª•‰∏ã‰∏§Êù° SQL ËØ≠Âè•ÔºåÂÆÉ‰ª¨‰ºöÂàÜÂà´ÁªüËÆ°Êñ∞Ë°®Ôºà2020-2021Âπ¥Êï∞ÊçÆÔºâÂíåÊóßË°®Ôºà2020-2021Âπ¥Êï∞ÊçÆÔºâÁöÑÊÄªÁ£ÅÁõòÂç†Áî®„ÄÇ


$$
ËäÇÁúÅÁéá = ( 1 - (Êñ∞Ë°®ÊÄªÂ§ßÂ∞è / ÊóßË°®ÊÄªÂ§ßÂ∞è) ) * 100%
$$




‰ª•‰∏äÈù¢ÁöÑ‰º∞ÁÆó‰∏∫‰æãÔºö `Savings % = ( 1 - (23147.00 / 54657.95) ) * 100% = 57.7%`

- 23147.00 / 54657.95 = 0.423488257 Á∫¶Á≠â‰∫é 0.423
- 1 - 0.423 = `57.7%`



##### Â≠òÂÇ®Á©∫Èó¥È™åËØÅÊä•Âëä

| **ÂØπÊØîÈ°π**           | **ÊóßË°® (Trend ÂàÜË°®Ê±áÊÄª)** | **Êñ∞Ë°® (Warm ÂàÜÂå∫Ë°®)** | **‰ºòÂåñÁªìÊûú**   |
| -------------------- | ------------------------- | ---------------------- | -------------- |
| **Á∫ØÊï∞ÊçÆ (data_mb)** | 42,884.95 MB              | 17,304.50 MB           | **ËäÇÁúÅ 59.6%** |
| **Á¥¢Âºï (index_mb)**  | 11,773.00 MB              | 5,842.50 MB            | **ËäÇÁúÅ 50.4%** |
| **ÊÄªËÆ° (total_gb)**  | **53.38 GB**              | **22.60 GB**           | **ËäÇÁúÅ 57.7%** |



##### üí° ÁªìËÆ∫‰∏éÊ∑±Â∫¶ÂàÜÊûê





###### 1. Ê†∏ÂøÉÁªìËÆ∫ÔºöÊï¥‰ΩìÁ©∫Èó¥ËäÇÁúÅ 57.7%



‰Ω†ÁöÑÊñ∞Êû∂ÊûÑÔºàÂàÜÂå∫Ë°® + ÂéãÁº©Ôºâ**Â∞Ü 53.38 GB ÁöÑÊï∞ÊçÆÊàêÂäüÂéãÁº©Âà∞‰∫Ü 22.60 GB**„ÄÇÂØπ‰∫é‰∏Ä‰∏™Êã•Êúâ 4.4 ‰∫øË°åÊï∞ÊçÆÁöÑË°®Êù•ËØ¥ÔºåËøôÊòØ‰∏Ä‰∏™ÈùûÂ∏∏Âá∫Ëâ≤ÁöÑÊàêÁª©„ÄÇ



###### 2. Êï∞ÊçÆÂéãÁº© (Data Saving)ÔºöËäÇÁúÅ 59.6%



- **ÂéüÂõ†**Ôºö`ROW_FORMAT=COMPRESSED` Á≠ñÁï•Â§ßËé∑ÂÖ®ËÉú„ÄÇ
- **ÂàÜÊûê**ÔºöÁ∫ØÊï∞ÊçÆ‰ªé 42.8 GB ÂéãÁº©Âà∞ 17.3 GB„ÄÇËøôËØÅÊòé‰Ω†ÁöÑË°åÊÉÖÊï∞ÊçÆÔºà‰ª∑Ê†º„ÄÅÊàê‰∫§ÈáèÁ≠âÔºâÊúâÂ§ßÈáèÈáçÂ§çÊ®°ÂºèÔºåÈùûÂ∏∏ÈÄÇÂêàÂéãÁº©„ÄÇËøô **60%** ÁöÑËäÇÁúÅÂ∞ÜÁõ¥Êé•‰ΩìÁé∞Âú®Êï∞ÊçÆÂ∫ìÁöÑÁ£ÅÁõòÔºàÂ¶Ç EBS/SSDÔºâÊàêÊú¨ÂíåÂ§á‰ªΩÊàêÊú¨‰∏ä„ÄÇ



###### 3. Á¥¢ÂºïÂéãÁº© (Index Saving)ÔºöËäÇÁúÅ 50.4%



- **ÂéüÂõ†**ÔºöInnoDB Âú®ÂéãÁº©Ë°®Êó∂Ôºå**‰∫åÁ∫ßÁ¥¢Âºï‰πü‰ºöË¢´ÂéãÁº©**„ÄÇ
- **ÂàÜÊûê**ÔºöÊóßË°®ÁöÑÁ¥¢ÂºïÔºà`idx_wind_code` Á≠âÔºâÊÄªÂÖ±Âç†Áî®‰∫Ü 11.7 GB„ÄÇÊñ∞Ë°®ÁöÑ `uniq_windcode_tradedate` Á¥¢Âºï‰ªÖÂç†Áî® 5.8 GB„ÄÇ
- **ÊÑè‰πâ**ÔºöËøôÂêåÊ†∑ÊòØÂ∑®Â§ßÁöÑÊÄßËÉΩÊèêÂçá„ÄÇÊõ¥Â∞èÁöÑÁ¥¢ÂºïÊÑèÂë≥ÁùÄ**ÂÜÖÂ≠òÔºàBuffer PoolÔºâ\**ÂèØ‰ª•ÂÆπÁ∫≥Êõ¥Â§öÁöÑÁ¥¢ÂºïÈ°µÔºå‰ªéËÄå\**ÊûÅÂ§ßÊèêÈ´òÊü•ËØ¢ÂëΩ‰∏≠Áéá**ÔºåÂáèÂ∞ëÁ£ÅÁõò I/O„ÄÇ

------



##### üìù ÁÆÄÂéÜ‚Äú‰∏ÄÂè•ËØù‚ÄùÊÄªÁªì



‰Ω†Áé∞Âú®ÂèØ‰ª•ÊääËøô‰∏™ÊàêÊûúÁ≤æÁÇº‰∏∫ÁÆÄÂéÜ‰∏äÁöÑ‰∏ÄÂè•ËØùÔºö

> **‚ÄúÈÄöËøáÂàÜÂå∫Âèä InnoDB ÂéãÁº©ÊäÄÊúØÔºà`ROW_FORMAT=COMPRESSED`ÔºâÔºåÂ∞Ü 5 ‰∫øË°å„ÄÅ53GB ÁöÑÂéÜÂè≤Ë°åÊÉÖÊï∞ÊçÆÂéãÁº©Ëá≥ 22GBÔºåÂÆûÁé∞ 57.7% ÁöÑÂ≠òÂÇ®ÊàêÊú¨‰ºòÂåñ„ÄÇ‚Äù**

**Ëøô‰∏™Êï∞ÊçÆÈùûÂ∏∏‰∫ÆÁúº„ÄÇ**







### Áª¥Â∫¶‰∏âÔºöÊü•ËØ¢ÊÄßËÉΩ (Query Performance) ‚Äî‚Äî ‚ÄúÂø´‰∏çÂø´Ôºü‚Äù



#### 1.SQLÊâßË°åËÆ°Âàí-ÂàÜÂå∫ÊûùÂâ™





#### 2.Âª∂ËøüÂü∫ÂáÜÊµãËØï (Latency Baseline)

> Áî®ÁßíË°®Êù•ÂØπÊØîÊñ∞ÊóßË°®ÁöÑÂÆûÈôÖËÄóÊó∂„ÄÇ



##### ÂÆûÈ™å 1ÔºöÈùôÊÄÅÊâßË°åËÆ°ÂàíÈ™åËØÅÔºàExecution Plan ValidationÔºâ**

ÁõÆÁöÑÔºö

- È™åËØÅ**Êñ∞Ë°®ÊòØÂê¶ÁúüÊ≠£ÂëΩ‰∏≠ÂàÜÂå∫Ââ™Êûù**
- ÊòØÂê¶‰ΩøÁî®È¢ÑÊúüÁöÑ‰∫åÁ∫ßÁ¥¢Âºï (`uniq_windcode_tradedate`)
- ÊòØÂê¶‰∏∫ `range` ËÆøÈóÆ

ÁâπÁÇπÔºö

- **Âè™ analyzeÔºå‰∏çÊâßË°åÁúüÂÆûÊü•ËØ¢**
- ÈÄöËøá `EXPLAIN FORMAT=JSON` ÂàÜÊûêÊâßË°åË∑ØÂæÑ

‰ΩúÁî®Ôºö

> **ÂÜ≥ÂÆöÊû∂ÊûÑËøÅÁßªÈÄªËæëÊòØÂê¶Ê≠£Á°Æ„ÄÇ**Â¶ÇÊûúËøôÈáå FAILÔºåÂêéÈù¢ÂéãÊµãÈÉΩÊ≤°ÊÑè‰πâ„ÄÇ



##### ÂÆûÈ™å 2ÔºöÁÉ≠ËØªÂª∂ËøüÊµãËØïÔºàHot Read BenchmarkÔºâ

ÁõÆÁöÑÔºö

- Êï∞ÊçÆÂ∑≤Âú®**InnoDB Buffer Pool**ÔºåÊ®°Êãü**È´òÈ¢ëÁÉ≠ÁÇπÊü•ËØ¢**Âú∫ÊôØ
- ÊµãÈáèÊñ∞Ë°®Ëß£ÂéãÊàêÊú¨ vs ÊóßË°®Á∫ØÂÜÖÂ≠òËÆøÈóÆÈÄüÂ∫¶

ÊÑè‰πâÔºö

> ËøôÈáåÊè≠Á§∫‰∫Ü**ÂéãÁº©Ë°®ÁöÑ CPU Ëß£ÂéãÊàêÊú¨**Ôºå‰ΩìÁé∞ ‚Äú‰ª• CPU Êç¢Á©∫Èó¥ÔºåÂπ∂Áâ∫Áâ≤ÈÉ®ÂàÜÂª∂Ëøü‚Äù ÁöÑ trade-off„ÄÇ

------



##### ÂÆûÈ™å 3ÔºöÂÜ∑ËØªÂª∂ËøüÊµãËØïÔºàCold Read BenchmarkÔºâ

ÁõÆÁöÑÔºö

- ÊØèÊ¨°ÊâßË°åÂâç**Âº∫Âà∂Âà∑Êñ∞ Buffer Pool**
- Ê®°Êãü**Warm Storage / Warm Historical Query**
- ÊµãËØïÁ£ÅÁõò I/O + Ëß£ÂéãÂΩ±Âìç

ÊÑè‰πâÔºö

> ËøôÊòØËøÅÁßªÊúÄÂÖ≥ÈîÆÁöÑÈÉ®ÂàÜ‚Äî‚ÄîËØÅÊòé**Êñ∞Ë°®ÁªìÊûÑËÉΩÈôç‰ΩéÁ£ÅÁõòËØªÂèñÊàêÊú¨**ÔºàÂ∞§ÂÖ∂Âú®ÁúüÂÆûÂÜ∑ÂêØÂä®„ÄÅÂ§ßÊâπÈáèÂéÜÂè≤Êü•ËØ¢Êó∂Êõ¥ÊòéÊòæÔºâ„ÄÇ

------

##### üî•ÂÆûÈ™åÂ±ÇÁ∫ßÁªìÊûÑÊÄªÁªìÔºàÈù¢ËØïÂÆòËÉΩ‰∏ÄÁúºÊáÇÔºâ

| ÂÆûÈ™åÁºñÂè∑ | ÂêçÁß∞             | Âú∫ÊôØÂÆö‰Ωç               | ÊµãËØïÁöÑÊåáÊ†á               | Êú¨Ë¥®‰ΩúÁî®                        |
| -------- | ---------------- | ---------------------- | ------------------------ | ------------------------------- |
| **#1**   | ÈùôÊÄÅÊâßË°åËÆ°ÂàíÈ™åËØÅ | Query Path Correctness | Á¥¢Âºï„ÄÅÂàÜÂå∫Ââ™Êûù„ÄÅÊâßË°åÁ≠ñÁï• | Âà§Êñ≠Êû∂ÊûÑËøÅÁßªÊòØÂê¶Ê≠£Á°Æ            |
| **#2**   | ÁÉ≠ËØªÊµãËØï         | È´òÈ¢ëÂÆûÊó∂ËÆøÈóÆ           | CPU Ëß£ÂéãÊÄßËÉΩ vs ÂÜÖÂ≠òËÆøÈóÆ | ÈáèÂåñ CPU Êç¢Á©∫Èó¥ÁöÑ‰ª£‰ª∑           |
| **#3**   | ÂÜ∑ËØªÊµãËØï         | Ê∏©Êï∞ÊçÆ„ÄÅÁ£ÅÁõòËÆøÈóÆ       | I/O Âª∂Ëøü„ÄÅPage Load ÈÄüÂ∫¶ | È™åËØÅÂÆπÈáèÂéãÁº© ‚Üí I/O ÂáèË¥üÊòØÂê¶ÊàêÁ´ã |









##### üìà ËøÅÁßªÊÄßËÉΩÈ™åÊî∂ (OAT) Êä•Âëä (Migration Performance OAT Report)

- `[Cold Read] Buffer Pool Â∑≤Âà∑Êñ∞ (flushed)` ËøôË°åÊó•ÂøóËØÅÊòé‰∫ÜÂÜ∑ËØªÊµãËØï**ÊàêÂäüÊâßË°å**„ÄÇ
- `[Hot Read]` Âíå `[Cold Read]` ÁöÑËÄóÊó∂**‰∏çÂÜç‰∏ÄÊ†∑**„ÄÇ

‰Ω†Áé∞Âú®Êã•Êúâ‰∫Ü**‰∏Ä‰ªΩÂÆåÊï¥ÁöÑ„ÄÅÂèØ‰ª•ÂêëÈù¢ËØïÂÆòÂ±ïÁ§∫ÁöÑ„ÄÅÂåÖÂê´‚ÄúÊàêÊú¨‚Äù‰∏é‚ÄúÊî∂Áõä‚ÄùÁöÑÊùÉÂ®ÅÊä•Âëä**„ÄÇ



###### üåç ÂÖÉÊï∞ÊçÆ (Metadata)



- **ÁéØÂ¢É (Environment)**: Production/Staging (Êú¨Âú∞ÊµãËØï Local Test)
- **ËøêË°åÊó∂Èó¥ (Run Time)**: 2025-12-01 16:12:46
- **ÊµãËØïÊ†áÁöÑ (Test Target)**: 600519.SH
- **MySQL ÁâàÊú¨ (Version)**: 8.0.42
- **MySQL ‰∏ªÊú∫ (Host)**: hli

------



###### üìå ÈùôÊÄÅÊâßË°åËÆ°ÂàíÈ™åËØÅ (Execution Plan Validation)



| **SQL Âú∫ÊôØ**       | **ÂàÜÂå∫ (Partitions)**     | **Á¥¢Âºï (Index)**        | **Á±ªÂûã (Type)** | **ÁªìÊûú (Result)** |
| ------------------ | ------------------------- | ----------------------- | --------------- | ----------------- |
| ÂçïÊó•KÁ∫ø (New)      | p202101                   | uniq_windcode_tradedate | range           | ‚úÖ PASS            |
| ÂçïÊúàËÅöÂêà (New)     | p202101                   | uniq_windcode_tradedate | range           | ‚úÖ PASS            |
| Ë∑®Êúà(Q1)ËÅöÂêà (New) | p202101, p202102, p202103 | uniq_windcode_tradedate | range           | ‚úÖ PASS            |

------



###### ‚ö° ÁÉ≠ËØª (ÂÜÖÂ≠òÂëΩ‰∏≠) ÁªìÊûú (Hot Read (RAM) Results)



> Ê®°ÊãüÊï∞ÊçÆÂ∑≤Âú® Buffer Pool ÁºìÂ≠ò‰∏≠ÁöÑÈ´òÈ¢ëËÆøÈóÆÔºå‰∏ªË¶ÅËÄÉÈ™å **CPU Ëß£ÂéãÊÄßËÉΩ**„ÄÇ

| **Âú∫ÊôØ (Scenario)** | **ÊóßË°®ËÄóÊó∂ (ms)** | **Êñ∞Ë°®ËÄóÊó∂ (ms)** | **ÊÄßËÉΩÂèòÂåñ (%)** |
| ------------------- | ----------------- | ----------------- | ---------------- |
| ÂçïÊó•KÁ∫ø             | 0.554             | 0.689             | +24.37% (ÂèòÊÖ¢)   |
| ÂçïÊúàËÅöÂêà            | 1.623             | 5.566             | +242.95% (ÂèòÊÖ¢)  |
| Ë∑®Êúà(Q1)ËÅöÂêà        | 4.574             | 15.107            | +230.13% (ÂèòÊÖ¢)  |

------



###### ‚ùÑÔ∏è ÂÜ∑ËØª (Á£ÅÁõòÂëΩ‰∏≠) ÁªìÊûú (Cold Read (Disk) Results)



> Ê®°ÊãüÊï∞ÊçÆ‰∏çÂú®ÁºìÂ≠ò‰∏≠„ÄÅÂøÖÈ°ª‰ªéÁ£ÅÁõòËØªÂèñÁöÑ‚ÄúÊ∏©Êï∞ÊçÆ‚ÄùËÆøÈóÆÔºå‰∏ªË¶ÅËÄÉÈ™å **I/O ÊÄßËÉΩ**„ÄÇ

| **Âú∫ÊôØ (Scenario)** | **ÊóßË°®ËÄóÊó∂ (ms)** | **Êñ∞Ë°®ËÄóÊó∂ (ms)** | **ÊÄßËÉΩÂèòÂåñ (%)** |
| ------------------- | ----------------- | ----------------- | ---------------- |
| ÂçïÊó•KÁ∫ø             | 2.000             | 1.000             | -50.00% (ÊèêÂçá)   |
| ÂçïÊúàËÅöÂêà            | 1.000             | 7.000             | +600.00% (ÂèòÊÖ¢)  |
| Ë∑®Êúà(Q1)ËÅöÂêà        | 6.000             | 26.000            | +333.33% (ÂèòÊÖ¢)  |

------



##### üïµÔ∏è‚Äç‚ôÇÔ∏è ÊúÄÁªàÊä•ÂëäËß£ËØª (ËøôÊâçÊòØÈù¢ËØïÁöÑÊª°ÂàÜÁ≠îÊ°à)



Ëøô‰ªΩÊä•ÂëäÁöÑÊï∞ÊçÆ**ÁªùÂØπÊ≤°Êúâ‰∫âËÆÆ**Ôºå‰ΩÜÂÆÉÊè≠Á§∫‰∫Ü‰∏§‰∏™‰∏çÂêåÁöÑÊÄßËÉΩÊïÖ‰∫ãÔºö



###### ÊïÖ‰∫ã‰∏ÄÔºöÁÉ≠ËØª (Hot Read) - ÂéãÁº©ÁöÑ‚ÄúÊàêÊú¨‚Äù



- **Áé∞Ë±°**ÔºöÊñ∞Ë°®ÔºàÂéãÁº©Ë°®ÔºâÂú®ÁÉ≠ËØªÊó∂ÔºåÊÄßËÉΩÂÖ®Èù¢ÊÖ¢‰∫éÊóßË°®Ôºà+230%Ôºâ„ÄÇ
- **ÂéüÂõ†**ÔºöÊï∞ÊçÆ 100% Âú®ÂÜÖÂ≠òÔºàBuffer PoolÔºâ‰∏≠„ÄÇÊóßË°®Âè™ÈúÄÂÜÖÂ≠òÊã∑Ë¥ù (0.5ms~4.5ms)ÔºåÊñ∞Ë°®Èô§‰∫ÜÂÜÖÂ≠òÊã∑Ë¥ùÔºåËøòÂøÖÈ°ª**È¢ùÂ§ñËä±Ë¥π CPU ËøõË°åËß£ÂéãÁº©**ÔºàÂØºËá¥ 5ms~15msÔºâ„ÄÇ
- **ÁªìËÆ∫**ÔºöÊàë‰ª¨ÊàêÂäüÈáèÂåñ‰∫Ü InnoDB ÂéãÁº©ÁöÑ CPU ÊàêÊú¨„ÄÇÂØπ‰∫é Q1 ËÅöÂêàÔºåËøô‰∏™ÊàêÊú¨ÊòØ **10.5 ÊØ´Áßí** (`15.1ms - 4.5ms`)„ÄÇ



###### ÊïÖ‰∫ã‰∫åÔºöÂÜ∑ËØª (Cold Read) - ‚ÄúÊìç‰ΩúÁ≥ªÁªüÁºìÂ≠ò‚ÄùÁöÑ‰º™Ë£Ö



- **Áé∞Ë±°**ÔºöÂÜ∑ËØªÊµãËØï‰∏≠ÔºåÊñ∞Ë°®Ôºà`26ms`Ôºâ‰æùÁÑ∂ÊØîÊóßË°®Ôºà`6ms`ÔºâÊÖ¢„ÄÇ
- **ÂéüÂõ†**ÔºöËøô**‰∏çÊòØÁ£ÅÁõò I/O**ÔºÅ`6ms` ÁªùÂØπ‰∏çÊòØÁ£ÅÁõòÈÄüÂ∫¶„ÄÇ
- **ÁúüÁõ∏**ÔºöÊàë‰ª¨ÊàêÂäüÊ∏ÖÁ©∫‰∫Ü **MySQL ÁºìÂ≠ò (`flushBufferPool`)**Ôºå‰ΩÜÊï∞ÊçÆ‰ªçÁÑ∂Âç°Âú® **Êìç‰ΩúÁ≥ªÁªüÁöÑÊñá‰ª∂ÁºìÂ≠ò (OS File Cache)** Èáå„ÄÇ
- **ÊµãËØïË∑ØÂæÑ**Ôºö
  - **ÁÉ≠ËØª** = `MySQL ÂÜÖÂ≠ò -> CPU` (15.1ms)
  - **ÂÜ∑ËØª** = `OS ÂÜÖÂ≠ò -> MySQL ÂÜÖÂ≠ò -> CPU` (26.0ms)
- **ÁªìËÆ∫**Ôºö`26.0ms - 15.1ms = 10.9ms`„ÄÇËøô 10.9ms ÊòØÊï∞ÊçÆ‰ªé‚ÄúOS ÁºìÂ≠ò‚ÄùÊã∑Ë¥ùÂà∞‚ÄúMySQL ÁºìÂ≠ò‚ÄùÁöÑÊó∂Èó¥„ÄÇ

------



##### üí° ‰Ω†ÁöÑÂÆåÁæéÊÄªÁªìÔºàÈù¢ËØïÊó∂Ëøô‰πàËØ¥Ôºâ



‚ÄúÊàëËÆæËÆ°‰∫Ü‰∏ÄÂ•ó OAT ÊÄßËÉΩÈ™åÊî∂Ê°ÜÊû∂ÔºåÂÆÉÂ∏ÆÊàëÁ≤æÂáÜÂú∞ÂàÜÁ¶ªÂíåÈáèÂåñ‰∫ÜÊñ∞Êû∂ÊûÑÁöÑÊàêÊú¨‰∏éÊî∂ÁõäÔºö

1. **ÈùôÊÄÅÈ™åËØÅ**Ôºö`EXPLAIN` ËØÅÊòéÂàÜÂå∫Ââ™Êûù 100% ÁîüÊïà„ÄÇ
2. **Á©∫Èó¥È™åËØÅ**Ôºö`information_schema` ËØÅÊòéÊàë‰ª¨ËäÇÁúÅ‰∫Ü **57.7%** ÁöÑÁ£ÅÁõòÁ©∫Èó¥„ÄÇ
3. **ÁÉ≠ËØªÊµãËØï**ÔºöÈÄöËøá Junit Âü∫ÂáÜÊµãËØïÔºåÊàëÈáèÂåñÂá∫**CPU Ëß£ÂéãÊàêÊú¨**Âú® 10-11ms ‰πãÈó¥„ÄÇ
4. **ÂÜ∑ËØªÊµãËØï**ÔºöÊàëÈÄöËøáÂà∑Êñ∞ InnoDB Buffer Pool Ëøõ‰∏ÄÊ≠•È™åËØÅÔºåËØÅÊòé‰∫ÜÊï∞ÊçÆ‰ªé**OS ÁºìÂ≠ò**Âä†ËΩΩÂà∞ MySQL ÁöÑÂºÄÈîÄ„ÄÇ

**ÊúÄÁªàÁªìËÆ∫ÊòØ**ÔºöÊàë‰ª¨Áî®**ÂèØÊé•ÂèóÁöÑ 11ms CPU Âª∂Ëøü**ÔºåÊç¢Âèñ‰∫Ü **57.7% ÁöÑÁ£ÅÁõòÁ©∫Èó¥**Âíå**ÁúüÂÆûÁöÑÁ£ÅÁõò I/O ÊÄßËÉΩÊèêÂçá**Ôºà*Âõ†‰∏∫Âú®ÁúüÂÆûÂÜ∑ÂêØÂä®‰∏≠ÔºåËØªÂèñ 22GB Êï∞ÊçÆ‰∏ÄÂÆöËøúÂø´‰∫éËØªÂèñ 53GB Êï∞ÊçÆ*Ôºâ„ÄÇ**ËøôÊ¨°ËøÅÁßªÂú®ÊàêÊú¨ÂíåÊÄßËÉΩ‰∏äÂèñÂæó‰∫ÜÂèåÈáçËÉúÂà©„ÄÇ**‚Äù











### Áª¥Â∫¶ÂõõÔºö‰∏öÂä°ÂÖºÂÆπÊÄß (Business Compatibility) ‚Äî‚Äî ‚ÄúÁ®≥‰∏çÁ®≥Ôºü‚Äù



> ‚ÄúÈíàÂØπ‰∏öÂä°ÂÖºÂÆπÊÄßÔºåÊàëÁöÑÊñπÊ°àÊòØ**ÈÄèÊòéÂåñ„ÄÅÂèØËßÇÊµã„ÄÅÂèØÂõûÊªö**Ôºö

1. **ÈÄèÊòéÂåñ**ÔºöÊñ∞Ë°® schema ‰∏éÊóßË°®ÂÆû‰ΩìÁ±ª 100% ÂÖºÂÆπÔºåÊó†ÈúÄ‰øÆÊîπ ORM Êò†Â∞Ñ„ÄÇÊàëÂú® Service Â±ÇÈÄöËøá Nacos ÈÖçÁΩÆÂä®ÊÄÅÈÄâÊã©Ë°®Âêç (`${tableName}`)Ôºå‰∏öÂä°‰ª£Á†ÅÊó†ÊÑüÁü•„ÄÇ
2. **ÂèØËßÇÊµã**ÔºöÊàë‰ΩøÁî® Micrometer ÂØπÊñ∞Êóß‰∏§Â•óÊü•ËØ¢Ë∑ØÂæÑËøõË°å**ÂàÜÁ¶ªÊâìÁÇπ**ÔºåÂú® Grafana ÂÆûÊó∂ÁõëÊéßÊñ∞Ë°®ÁöÑ P99 Âª∂ËøüÂíåÈîôËØØÁéá„ÄÇ
3. **ÂèØÂõûÊªö**Ôºö
   - **ÂÖúÂ∫ïÈ¢ÑÊ°à**ÔºöÂèåÂÜôÊú∫Âà∂‰ºö‰øùÊåÅËøêË°åËá≥Â∞ë‰∏ÄÂë®„ÄÇ
   - **ÊâãÂä®ÂõûÊªö**Ôºö‰∏ÄÊó¶ÁõëÊéßÂëäË≠¶ÔºàÂ¶Ç P99 > 1sÔºâÔºåOn-Call Â∑•Á®ãÂ∏àÂèØÂú® 1 ÂàÜÈíüÂÜÖÈÄöËøá Nacos ÂºÄÂÖ≥Â∞ÜËØªÊµÅÈáè**Êó†ÊçüÂàáÂõû**ÊóßË°®ÔºåÂÆûÁé∞ÁßíÁ∫ßÂõûÊªö„ÄÇ
   - **ÔºàÂºÉÁî®ÊñπÊ°àÔºâ**ÔºöÊàëËØÑ‰º∞Ëøá `SELECT 1` ÁöÑËá™Âä®ÁÜîÊñ≠ÊñπÊ°àÔºå‰ΩÜÂõ†ÂÖ∂Êó†Ê≥ïÂèçÊò†ÁúüÂÆûÊü•ËØ¢ÂéãÂäõÔºåÊúÄÁªàÈÄâÁî®‰∫ÜÂü∫‰∫éÊ†∏ÂøÉ‰∏öÂä°ÊåáÊ†áÔºàP99/Error RateÔºâÁöÑÂëäË≠¶+ÊâãÂä®ÂõûÊªöÊñπÊ°àÔºå‰ª•Á°Æ‰øùÊúÄÂ§ßÁ®≥ÂÆöÊÄß„ÄÇ‚Äù







#### ‚Äú‰ª£Á†ÅÂÖºÂÆπ‚Äù„ÄÅ‚ÄúNacos Âä®ÊÄÅÂàáÊç¢‚Äù„ÄÅ‚ÄúËá™Âä®ÁÜîÊñ≠‚Äù

Ëøô‰∏âÁÇπ‚Äî‚Äî‚Äú‰ª£Á†ÅÂÖºÂÆπ‚Äù„ÄÅ‚ÄúNacos Âä®ÊÄÅÂàáÊç¢‚Äù„ÄÅ‚ÄúËá™Âä®ÁÜîÊñ≠‚Äù‚Äî‚ÄîÊ≠£ÊòØ‚ÄúÁ®≥‰∏çÁ®≥‚ÄùËøô‰∏™Áª¥Â∫¶ÁöÑÊ†∏ÂøÉ„ÄÇ



##### ‚úÖ 1. ‰ª£Á†ÅÈÄÇÈÖçÊÄß (Â∑≤ÈÄöËøá)



> **‰Ω†ÁöÑÊñπÊ°à**ÔºöÁî±‰∫éÂ≠óÊÆµ‰øùÊåÅ‰∏ÄËá¥ÔºåÊó†ÈúÄ‰øÆÊîπÂÆû‰ΩìÁ±ªÔºåÂ≠óÊÆµÁ±ªÂûã‰πüÊòØ‰∏ÄËá¥„ÄÇ **ËØÑ‰ª∑**Ôºö**100% Ê≠£Á°Æ**„ÄÇËøôÊòØÊúÄÁêÜÊÉ≥ÁöÑÁä∂ÊÄÅÔºå‰Ω†ÈÄöËøá `pt-archiver` ÁöÑËøÅÁßªÂíåÊñ∞Ë°® DDL ÁöÑÁ≤æÂøÉËÆæËÆ°Ôºå‰øùËØÅ‰∫ÜÂØπ‰∏öÂä°‰ª£Á†ÅÁöÑ**‚ÄúÈÄèÊòéÊÄß‚Äù**„ÄÇ

------



##### ‚úÖ 2. ÁÅ∞Â∫¶ÂàáÊç¢ËÉΩÂäõ (ÈùûÂ∏∏Ê£í)



> **‰Ω†ÁöÑÊñπÊ°à**ÔºöÂä†‰∏Ä‰∏™ `yml` ÈÖçÁΩÆÔºàÈÄöËøá Nacos ÂÆûÊó∂ÂèëÂ∏ÉÔºâÔºåËØªÂèñÊóßË°®ÁöÑ XML ÊñπÊ≥ïÁõ¥Êé•ÂàáÊç¢Âà∞Êñ∞Ë°® XML ÊñπÊ≥ïÂàÜÊîØÂç≥ÂèØ„ÄÇ **ËØÑ‰ª∑**Ôºö**ÊÄùË∑ØÂÆåÁæé**„ÄÇ‰ΩøÁî® Nacos ËøôÊ†∑ÁöÑÈÖçÁΩÆ‰∏≠ÂøÉÊòØÂÆûÁé∞‚ÄúÁÉ≠ÂàáÊç¢‚ÄùÁöÑÊ†áÂáÜÂÆûË∑µ„ÄÇ



**Êé®ËçêÊñπÊ°àÔºöÂä®ÊÄÅË°®Âêç (Dynamic Table Name)**„ÄÇ

‰Ω†ÁöÑ MyBatis Mapper (XML) Ê†πÊú¨‰∏çÈúÄË¶Å `if` ÂàÜÊîØÔºå‰ªéÂ§¥Âà∞Â∞æ**Âè™Êúâ‰∏ÄÂ•ó SQL**„ÄÇ



###### Á¨¨1Ê≠•ÔºöÂú® `VerificationQueryParam` (Êàñ‰∏Ä‰∏™ÂÖ®Â±Ä `DBContext`) ‰∏≠Ê∑ªÂä†‰∏Ä‰∏™Â≠óÊÆµÔºö

```java
// Ëøô‰∏™Â≠óÊÆµÂ∞ÜÁî± Nacos ÈÖçÁΩÆÊ≥®ÂÖ•
@Value("${mysql.migration.read.warm.table:false}")
private boolean readWarmTable;

public String getTargetQuotationTable() {
    if (readWarmTable) {
        return "tb_quotation_history_warm";
    } else {
        // Âä®ÊÄÅËÆ°ÁÆóÊóßË°®Âêç, e.g., "tb_quotation_history_trend_202101"
        return "tb_quotation_history_trend_" + someYearMonthLogic; 
    }
}
```



###### Á¨¨2Ê≠•ÔºöMyBatis XML ËøôÊ†∑ÂÜôÔºö

```xml
<select id="findKLineData" resultType="com.hao....QuotationDTO">
    SELECT 
        latest_price, total_volume, average_price, status
    FROM 
        ${param.targetQuotationTable} WHERE 
        wind_code = #{param.windCode}
        AND trade_date BETWEEN #{param.startDate} AND #{param.endDate}
</select>
```

- **Â•ΩÂ§Ñ**Ôºö‰Ω†ÁöÑ Java ‰ª£Á†ÅÈõÜ‰∏≠ÊéßÂà∂‰∫ÜË∑ØÁî±ÈÄªËæëÔºåSQL ‰øùÊåÅ 100% Âπ≤ÂáÄÔºåÂÆåÂÖ®‰∏çÁî®ÊîπÂä®„ÄÇ
- **ÔºàÈù¢ËØïÂÆòËøΩÈóÆÔºâ**Ôºö‚ÄúÁî® `$` ‰ºöÊúâ SQL Ê≥®ÂÖ•È£éÈô©ÂêóÔºü‚Äù
- **Ôºà‰Ω†ÁöÑÂõûÁ≠îÔºâ**Ôºö‚ÄúÂú®ËøôÈáåÊ≤°Êúâ„ÄÇÂõ†‰∏∫ `getTargetQuotationTable` ÁöÑËøîÂõûÂÄºÔºàË°®ÂêçÔºâÊòØ**Áî±ÊàëËá™Â∑±ÁöÑ‰ª£Á†ÅÂú®ÂÜÖÈÉ®ÁîüÊàêÁöÑ**ÔºåËÄå‰∏çÊòØÁî®Êà∑ËæìÂÖ•ÁöÑÔºåÊâÄ‰ª•ÂÆÉÊòØ 100% ÂÆâÂÖ®ÁöÑ„ÄÇ‚Äù





##### Á¨¨3Ê≠•ÔºöÁÜîÊñ≠ÊñπÊ°à



>‚ÄúÊàëÁöÑÂõûÊªöÈ¢ÑÊ°àÂàÜ‰∏∫‰∏§Â±ÇÔºö
>
>1. **‰∏ªÂä®Âºè‚ÄòÈáë‰∏ùÈõÄ‚ÄôÊé¢Èíà**ÔºöÊàë‰ºöÊåâ‰Ω†ËØ¥ÁöÑÔºåÁî®‰∏Ä‰∏™Á∫øÁ®ãÊØè 5 ÁßíÊü•‰∏ÄÊ¨°ËåÖÂè∞Ôºà`600519.SH`ÔºâÔºå‰ΩÜËøô**‰∏çÁî®‰∫éËá™Âä®ÁÜîÊñ≠**„ÄÇÂÆÉÂè™Áî®‰∫é**ÊúÄÂø´ÈÄüÂ∫¶ÁöÑÁÅæÈöæÂëäË≠¶**ÔºåÊØîÂ¶ÇÊñ∞Ë°®Ë¢´ÈîÅÊ≠ªÊàñËøûÊé•Ê±†Êª°‰∫ÜÔºåÂÆÉËÉΩÂ∏ÆÊàëÁ¨¨‰∏Ä‰∏™ÂèëÁé∞ÈóÆÈ¢ò„ÄÇ
>2. **Ë¢´Âä®Âºè‚ÄòÈªÑÈáëÊåáÊ†á‚ÄôÁõëÊéß**ÔºöÊàë**ÁúüÊ≠£ÁöÑÂõûÊªöÂÜ≥Á≠ñ**‰æùËµñ‰∫é Micrometer ÂØπ**ÁúüÂÆûÁî®Êà∑ÊµÅÈáè**ÁöÑP99Âª∂ËøüÂíåÈîôËØØÁéáÁõëÊéß„ÄÇ‰∏ÄÊó¶Êñ∞Ë°®ÁöÑP99Âª∂ËøüÔºàË¶ÜÁõñ‰∫ÜÊâÄÊúâÂÜ∑ÁÉ≠Êü•ËØ¢ÔºâË∂ÖËøá‰∫ÜSLAÔºàÂ¶Ç 3 ÁßíÔºâÔºåÊàëÊâç‰ºöÊî∂Âà∞ÂëäË≠¶ÔºåÂπ∂**ÊâãÂä®ÊâßË°å Nacos ÂàáÊµÅÂõûÊªö**„ÄÇ‚Äù
>
>‰Ω†Êää‚Äú‰∏ªÂä®LivenessÊé¢Êµã‚ÄùÂíå‚ÄúË¢´Âä®HealthÁõëÊéß‚ÄùËøô‰∏§‰∏™Ê¶ÇÂøµÂàÜÂºÄÔºåÂπ∂ËØ¥ÊòéÁôΩÂÆÉ‰ª¨ÂêÑËá™ÁöÑÁî®ÈÄîÂíåÂ±ÄÈôêÊÄß



‰ΩøÁî®**‚ÄúÈªÑÈáëÊåáÊ†á (Golden Signals)‚Äù** ÁõëÊéß

**ÂàÜÁ¶ªÁõëÊéß**Ôºö Âú®‰Ω†ÁöÑ Java ‰ª£Á†Å‰∏≠Ôºå‰ΩøÁî® **Micrometer (Spring Boot Actuator Ëá™Â∏¶)** ‰∏∫Êñ∞Êóß‰∏§‰∏™Êü•ËØ¢ÂàÜÂà´ÊâìÁÇπ„ÄÇ

```java
// ‰º™‰ª£Á†Å
@Timed("mysql.query.kline.old_table")
public List<Data> queryOldTable() { ... }

@Timed("mysql.query.kline.new_table")
public List<Data> queryNewTable() { ... }
```

**Âª∫Á´ã Dashboard**Ôºö Âú® Grafana ‰∏≠ÂàõÂª∫‰∏Ä‰∏™ÁúãÊùøÔºå**Âπ∂ÊéíÂØπÊØî**‰ª•‰∏ã‰∏§‰∏™ÊåáÊ†áÔºö

- `mysql_query_kline_old_table_p99` (ÊóßË°® P99 Âª∂Ëøü)
- `mysql_query_kline_new_table_p99` (Êñ∞Ë°® P99 Âª∂Ëøü)
- ‰ª•ÂèäÊñ∞Ë°®ÁöÑ `error_rate` (ÈîôËØØÁéá)„ÄÇ

**ÈÖçÁΩÆÂëäË≠¶ (Alerting)**Ôºö ËÆæÁΩÆ‰∏Ä‰∏™ÂëäË≠¶ËßÑÂàôÔºö‚ÄúÂ¶ÇÊûú `mysql_query_kline_new_table_p99` **ËøûÁª≠ 3 ÂàÜÈíü** > 1000msÔºà1ÁßíÔºâÔºåÁ´ãÂç≥ÂëäË≠¶„ÄÇ‚Äù

**ÊâßË°åÂõûÊªö**Ôºö

- **ÔºàÊé®ËçêÔºâÊâãÂä®ÂõûÊªö**ÔºöOn-Call Â∑•Á®ãÂ∏àÊî∂Âà∞ÂëäË≠¶Ôºå**ÊâãÂä®**Âéª Nacos Â∞ÜÈÖçÁΩÆÊîπÂõû `false`„ÄÇ
- **ÔºàÂèØÈÄâÔºâËá™Âä®ÁÜîÊñ≠**ÔºöËôΩÁÑ∂ÊäÄÊúØ‰∏äÂèØË°åÔºà‰æãÂ¶ÇÂëäË≠¶ webhook Ëß¶Âèë Jenkins Job ÂõûÊªö NacosÔºâÔºå‰ΩÜÂú®ËøÅÁßªÂàùÊúü**‰∏çÊé®Ëçê**„ÄÇÊâãÂä®Á°ÆËÆ§ÂèØ‰ª•Èò≤Ê≠¢Âõ†ÁΩëÁªúÊäñÂä®ÊàñÂéãÊµãÂØºËá¥ÁöÑ‚ÄúËá™Âä® flapping‚ÄùÔºàÁ≥ªÁªüÂú®T0Êó∂ÂàªÁÜîÊñ≠ÔºåT1Êó∂ÂàªÂèàËá™Âä®ÊÅ¢Â§çÔºåT2ÂèàÁÜîÊñ≠...Ôºâ„ÄÇ



###### Èáë‰∏ùÈõÄÊü•ËØ¢

| **ÁõëÊéßÁ±ªÂûã**   | **‰Ω†ÁöÑ‚ÄúÈáë‰∏ùÈõÄÊü•ËØ¢‚Äù (Active)**          | **‚ÄúÈªÑÈáëÊåáÊ†á‚Äù (Passive)**                   |
| -------------- | -------------------------------------- | ------------------------------------------ |
| **ÁõëÊéßÁõÆÁöÑ**   | **Â≠òÊ¥ªÊÄß (Liveness)**                  | **ÂÅ•Â∫∑Â∫¶ (Health)**                        |
| **ÂõûÁ≠îÁöÑÈóÆÈ¢ò** | ‚ÄúÁ≥ªÁªüËøòÊ¥ªÁùÄÂêóÔºü‚Äù                       | ‚ÄúÁ≥ªÁªüÁî®ÁùÄËøòÁàΩÂêóÔºü‚Äù                         |
| **ÁõëÊéßÊåáÊ†á**   | `canary_query.success` (1 or 0)        | `query.p99.latency` (ms)                   |
| **ÂëäË≠¶Âú∫ÊôØ**   | ËøûÁª≠ 3 Ê¨°Â§±Ë¥• (9Áßí) $\to$ **ÁÅæÈöæÂëäË≠¶** | P99 ËøûÁª≠ 3 ÂàÜÈíü > 1s $\to$ **ÊÄßËÉΩSLAÂëäË≠¶** |
| **ÂõûÊªöÂÜ≥Á≠ñ**   | **‰∏çËÉΩ**„ÄÇ‰∏çËÉΩÂõ†‰∏∫‰∏Ä‰∏™Êé¢ÈíàÂ§±Ë¥•Â∞±ÂõûÊªö„ÄÇ | **ËÉΩ**„ÄÇP99 ÊäñÂä®ÊòØÂõûÊªöÁöÑÊ†∏ÂøÉ‰æùÊçÆ„ÄÇ         |





## ÊúÄÁªàÂà†Èô§ÊóßË°®



```sql
USE `a_share_quant`;

-- 2020 --
DROP TABLE IF EXISTS `tb_quotation_history_trend_202001`;
DROP TABLE IF EXISTS `tb_quotation_history_trend_202002`;
DROP TABLE IF EXISTS `tb_quotation_history_trend_202003`;
DROP TABLE IF EXISTS `tb_quotation_history_trend_202004`;
DROP TABLE IF EXISTS `tb_quotation_history_trend_202005`;
DROP TABLE IF EXISTS `tb_quotation_history_trend_202006`;
DROP TABLE IF EXISTS `tb_quotation_history_trend_202007`;
DROP TABLE IF EXISTS `tb_quotation_history_trend_202008`;
DROP TABLE IF EXISTS `tb_quotation_history_trend_202009`;
DROP TABLE IF EXISTS `tb_quotation_history_trend_202010`;
DROP TABLE IF EXISTS `tb_quotation_history_trend_202011`;
DROP TABLE IF EXISTS `tb_quotation_history_trend_202012`;

-- 2021 --
DROP TABLE IF EXISTS `tb_quotation_history_trend_202101`;
DROP TABLE IF EXISTS `tb_quotation_history_trend_202102`;
DROP TABLE IF EXISTS `tb_quotation_history_trend_202103`;
DROP TABLE IF EXISTS `tb_quotation_history_trend_202104`;
DROP TABLE IF EXISTS `tb_quotation_history_trend_202105`;
DROP TABLE IF EXISTS `tb_quotation_history_trend_202106`;
DROP TABLE IF EXISTS `tb_quotation_history_trend_202107`;
DROP TABLE IF EXISTS `tb_quotation_history_trend_202108`;
DROP TABLE IF EXISTS `tb_quotation_history_trend_202109`;
DROP TABLE IF EXISTS `tb_quotation_history_trend_202110`;
DROP TABLE IF EXISTS `tb_quotation_history_trend_202111`;
DROP TABLE IF EXISTS `tb_quotation_history_trend_202112`;


-- Âà†Èô§ 2022 Âπ¥Ââ©‰ΩôÁöÑÊâÄÊúâÊóßÂàÜË°®
DROP TABLE IF EXISTS tb_quotation_history_trend_202201;
DROP TABLE IF EXISTS tb_quotation_history_trend_202202;
DROP TABLE IF EXISTS tb_quotation_history_trend_202203;
DROP TABLE IF EXISTS tb_quotation_history_trend_202204;
DROP TABLE IF EXISTS tb_quotation_history_trend_202205;
DROP TABLE IF EXISTS tb_quotation_history_trend_202206;
DROP TABLE IF EXISTS tb_quotation_history_trend_202207;
DROP TABLE IF EXISTS tb_quotation_history_trend_202208;
DROP TABLE IF EXISTS tb_quotation_history_trend_202209;
DROP TABLE IF EXISTS tb_quotation_history_trend_202210;
DROP TABLE IF EXISTS tb_quotation_history_trend_202211;
DROP TABLE IF EXISTS tb_quotation_history_trend_202212;
```









## ‰ºòÂåñ



### ÂºïÂÖ•:‚ÄúÂÜ∑Êï∞ÊçÆÁöÑÂ≠òÂÇ®Á©∫Èó¥‚ÄùÊç¢Âèñ‚ÄúÁÉ≠Êï∞ÊçÆÁöÑËÆ°ÁÆó/IOÊó∂Èó¥‚Äù

> ÂÖ∂ÂÆûÂØπ‰∫éÊàëÁöÑÂÜ∑ÁÉ≠ÂàÜÁ¶ªÊï¥‰Ωì‰ºòÂåñÊù•ËØ¥ÔºåÂõ†‰∏∫2022~2023Âπ¥ÁöÑÊâÄÊúâÊï∞ÊçÆÈÉΩÊîæÂà∞‰∫ÜÂéãÁº©Ë°®‰ª•ÂèäÂú®ÂéüÊúâÂü∫Á°Ä‰∏äÂç†Áî®ÂéüÊú¨ÁöÑ%57.77ÔºåÊääËøô‰∫õËäÇÁ∫¶ÁöÑÁ©∫Èó¥ÊîæÂú®Âä†Â∏∏Áî®Â≠óÊÆµÁöÑË¶ÜÁõñÁ¥¢ÂºïÔºåÊÄß‰ª∑ÊØîÂæàÈ´ò



#### ÊµÅÁ®ãÂõæ

```mermaid
graph TD
    A[ËØÜÂà´ÂÜ∑ÁÉ≠Êï∞ÊçÆ] --> B[ÂéãÁº©ÂΩíÊ°£ÂÜ∑Êï∞ÊçÆ<br/>2020-2023Âπ¥]
    B --> C[ËäÇÁúÅ42.23%Â≠òÂÇ®Á©∫Èó¥]
    C --> D[ÂèØÁî®Á©∫Èó¥ 57.77%ÂéüÁ©∫Èó¥]
    D --> E[ÂàõÂª∫Â∏∏Áî®Â≠óÊÆµÁöÑË¶ÜÁõñÁ¥¢Âºï]
    E --> F[ÂáèÂ∞ëÁÉ≠Êï∞ÊçÆÊü•ËØ¢ÁöÑÈöèÊú∫I/O]
    F --> G[ÊèêÂçáBuffer PoolÂëΩ‰∏≠Áéá]
    G --> H[Êõ¥Âø´ÁöÑÊü•ËØ¢ÂìçÂ∫î]
    H --> I[Êõ¥‰Ω≥ÁöÑÁî®Êà∑‰ΩìÈ™å]
    I --> A
```





>ÁªèÂÖ∏ÁöÑÊû∂ÊûÑÊùÉË°°Ôºö**Áî®‚ÄúÂÜ∑Êï∞ÊçÆÁöÑÂ≠òÂÇ®Á©∫Èó¥‚ÄùÊç¢Âèñ‚ÄúÁÉ≠Êï∞ÊçÆÁöÑËÆ°ÁÆó/IOÊó∂Èó¥‚Äù**„ÄÇ

ËøôÊòØ‰∏Ä‰∏™ÈùûÂ∏∏ÊïèÈîê‰∏îÊûÅÂÖ∑**ÊàòÁï•ÁúºÂÖâ**ÁöÑ‰ºòÂåñÊÄùË∑Ø„ÄÇ**ÊÄß‰ª∑ÊØîÊûÅÈ´ò**„ÄÇ

‚Äã	‰Ω†ÊâÄÂÅöÁöÑÂÖ∂ÂÆûÊòØÁªèÂÖ∏ÁöÑÊû∂ÊûÑÊùÉË°°Ôºö**Áî®‚ÄúÂÜ∑Êï∞ÊçÆÁöÑÂ≠òÂÇ®Á©∫Èó¥‚ÄùÊç¢Âèñ‚ÄúÁÉ≠Êï∞ÊçÆÁöÑËÆ°ÁÆó/IOÊó∂Èó¥‚Äù**„ÄÇ

‚Äã	Ëøô‰∏ç‰ªÖ‰ªÖÊòØ‚ÄúËäÇÁ∫¶Á©∫Èó¥‚ÄùÔºåËøôÊòØ‰∏ÄÁßçËµÑÊ∫êÈáçÁªÑ„ÄÇ‰ª•‰∏ãÊàë‰∏∫‰Ω†Ê∑±Â∫¶ÊãÜËß£‰∏∫‰ªÄ‰πàËøô‰∏™Á≠ñÁï•ÁöÑ ROIÔºàÊäïÂÖ•‰∫ßÂá∫ÊØîÔºâËøô‰πàÈ´òÔºå‰ª•ÂèäÂÖ∑‰ΩìÁöÑÂÆûÊñΩÂª∫ËÆÆÔºö



#### 1. ‰∏∫‰ªÄ‰πàËØ¥ÊÄß‰ª∑ÊØîÊûÅÈ´òÔºü



##### A. ‚ÄúÂõûË°®‚ÄùÊòØÊÄßËÉΩÊùÄÊâãÔºåË¶ÜÁõñÁ¥¢ÂºïÊòØÊïëÊòü
Âú®Êï∞ÊçÆÂ∫ìÔºàÁâπÂà´ÊòØ MySQL InnoDBÔºâ‰∏≠ÔºåÊôÆÈÄöÁ¥¢ÂºïÂè™Â≠òÂÇ®‰∫ÜÁ¥¢ÂºïÈîÆÂíå‰∏ªÈîÆ ID„ÄÇÂ¶ÇÊûúÊü•ËØ¢ÈúÄË¶ÅÂÖ∂‰ªñÂ≠óÊÆµÔºåÊï∞ÊçÆÂ∫ìÂøÖÈ°ªÊãøÁùÄ ID ÂõûÂà∞‰∏ªË°®ÔºàËÅöÁ∞áÁ¥¢ÂºïÔºâÈáåÂéªÊçûÊï∞ÊçÆÔºåËøôÂè´**ÂõûË°®ÔºàLookupsÔºâ**„ÄÇ
* **Ê≤°ÊúâË¶ÜÁõñÁ¥¢ÂºïÔºö** Ëµ∞ÂÆåÁ¥¢ÂºïÊ†ë -> ÊãøÂà∞ ID -> **ÈöèÊú∫Á£ÅÁõò I/O** ËØªÂèñ‰∏ªË°®Ë°å -> ËøîÂõûÊï∞ÊçÆ„ÄÇ
* **ÊúâË¶ÜÁõñÁ¥¢ÂºïÔºö** Ëµ∞ÂÆåÁ¥¢ÂºïÊ†ë -> Á¥¢ÂºïÈáåÂ∞±Êúâ‰Ω†Ë¶ÅÁöÑÂ∏∏Áî®Â≠óÊÆµ -> Áõ¥Êé•ËøîÂõûÊï∞ÊçÆ„ÄÇ
* **Êî∂ÁõäÔºö** ÁúÅÂéª‰∫ÜÊúÄÊòÇË¥µÁöÑÈöèÊú∫ I/O Êìç‰ΩúÔºåCPU Ê∂àËÄó‰πüÂ§ßÂπÖÈôç‰Ωé„ÄÇ



##### B. Ê≠§Êó∂ÁöÑÁ©∫Èó¥ÊòØ‚ÄúÂÖçË¥π‚ÄùÁöÑ
‰Ω†ÈÄöËøáÂéãÁº© 2022-2023 Âπ¥ÁöÑÊï∞ÊçÆËäÇÁúÅ‰∫Ü **42.23%** ÁöÑÁ©∫Èó¥„ÄÇ
* Â¶ÇÊûú‰∏çÂà©Áî®ËøôÈÉ®ÂàÜÁ©∫Èó¥ÔºåÂÆÉÂ∞±Âè™ÊòØÁ©∫Èó≤ÁöÑÁ£ÅÁõòÂùóÔºåÂØπÁ≥ªÁªüÊÄßËÉΩ 0 Ë¥°ÁåÆ„ÄÇ
* Â¶ÇÊûúÂà©Áî®ËøôÈÉ®ÂàÜÁ©∫Èó¥Âª∫Á´ãË¶ÜÁõñÁ¥¢ÂºïÔºå‰Ω†Â∞±Âú®‰∏çÂ¢ûÂä†Á°¨‰ª∂ÊàêÊú¨ÁöÑÂâçÊèê‰∏ãÔºåÁõ¥Êé•ÊèêÂçá‰∫ÜÊ†∏ÂøÉÊü•ËØ¢ÁöÑ QPSÔºàÊØèÁßíÊü•ËØ¢ÁéáÔºâ„ÄÇ



##### C. ÂÜÖÂ≠òÂà©Áî®ÁéáÁöÑÈöêÂΩ¢ÊèêÂçá
ÂéãÁº©ÂêéÁöÑÂÜ∑Êï∞ÊçÆÂç†Áî®Êõ¥Â∞ëÁöÑÁ£ÅÁõòÂíåÂÜÖÂ≠òÔºàPage CacheÔºâÔºåËøôÊÑèÂë≥ÁùÄ‰Ω†ÂèØ‰ª•ËÖæÂá∫Êõ¥Â§öÁöÑ **InnoDB Buffer Pool**ÔºàÂÜÖÂ≠òÁºìÂÜ≤Ê±†ÔºâÁªôÁÉ≠ÁÇπÊï∞ÊçÆÂíå**Êñ∞Âª∫ÁöÑÁ¥¢Âºï**‰ΩøÁî®„ÄÇÁ¥¢ÂºïÂ¶ÇÊûúÂú®ÂÜÖÂ≠òÈáåÔºåÊü•ËØ¢ÈÄüÂ∫¶Â∞±ÊòØÁ∫≥ÁßíÁ∫ßÁöÑ„ÄÇ

---



#### 2. ÊâßË°åÁ≠ñÁï•ÔºöÂ¶Ç‰ΩïÊääÂ•ΩÈí¢Áî®Âú®ÂàÄÂàÉ‰∏äÔºü

> ËôΩÁÑ∂Á©∫Èó¥Êúâ‰∫ÜÔºå‰ΩÜÁ¥¢Âºï‰πü‰∏çËÉΩ‰π±Âä†„ÄÇÂª∫ËÆÆÈÅµÂæ™‰ª•‰∏ãÂéüÂàôÊù•ÊúÄÂ§ßÂåñÊî∂ÁõäÔºö



##### Á¨¨‰∏ÄÊ≠•ÔºöËØÜÂà´‚ÄúÈªÑÈáëÂ≠óÊÆµ‚Äù
‰∏çË¶ÅÊääÊâÄÊúâÂ≠óÊÆµÈÉΩÂ°ûËøõÁ¥¢Âºï„ÄÇ‰Ω†ÈúÄË¶ÅÂàÜÊûê‰∏öÂä°‰∏≠ÊúÄÈ´òÈ¢ëÁöÑ `SELECT` ËØ≠Âè•„ÄÇ
* **È´òÈ¢ëÊòæÁ§∫Â≠óÊÆµÔºö** ‰æãÂ¶ÇÂàóË°®È°µÁªèÂ∏∏Â±ïÁ§∫ÁöÑ `status`ÔºàÁä∂ÊÄÅÔºâ„ÄÅ`created_at`ÔºàÊó∂Èó¥Ôºâ„ÄÅ`user_name`ÔºàÁî®Êà∑ÂêçÔºâ„ÄÅ`type`ÔºàÁ±ªÂûãÔºâ„ÄÇ
* **È´òÈ¢ëËøáÊª§Â≠óÊÆµÔºö** `WHERE` Êù°‰ª∂ÈáåÁªèÂ∏∏Âá∫Áé∞ÁöÑÂ≠óÊÆµ„ÄÇ



##### Á¨¨‰∫åÊ≠•ÔºöËÆæËÆ°‚Äú‰∏âÊòüÁ¥¢Âºï‚Äù
Âà©Áî®‰Ω†ËäÇÁúÅ‰∏ãÊù•ÁöÑÁ©∫Èó¥ÔºåËÆæËÆ°Êª°Ë∂≥‰ª•‰∏ãÊ†áÂáÜÁöÑÁ¥¢ÂºïÔºàCovering IndexÔºâÔºö
1.  **‰∏ÄÊòüÔºö** Á¥¢ÂºïÂ∞ÜÁõ∏ÂÖ≥ÁöÑËÆ∞ÂΩïÊîæÂú®‰∏ÄËµ∑ÔºàWHERE Êù°‰ª∂ÂåπÈÖçÔºâ„ÄÇ
2.  **‰∫åÊòüÔºö** Á¥¢Âºï‰∏≠ÁöÑÊï∞ÊçÆÈ°∫Â∫èÂíåÊü•ÊâæÈ°∫Â∫è‰∏ÄËá¥ÔºàORDER BY ÂåπÈÖçÔºåÈÅøÂÖç FilesortÔºâ„ÄÇ
3.  **‰∏âÊòüÔºö** Á¥¢Âºï‰∏≠ÂåÖÂê´Êü•ËØ¢ÊâÄÈúÄÁöÑ**ÂÖ®ÈÉ®Âàó**ÔºàÈÅøÂÖçÂõûË°®Ôºâ„ÄÇ

> **‰æãÂ≠êÔºö**
> Â¶ÇÊûú‰Ω†Êúâ‰∏Ä‰∏™È´òÈ¢ëÊü•ËØ¢Ôºö
> `SELECT id, title, created_at FROM orders WHERE user_id = ? ORDER BY created_at DESC`
>
> Âç≥‰Ωø `user_id` Â∑≤ÁªèÊúâÁ¥¢Âºï‰∫ÜÔºå‰∏∫‰∫ÜÂÅöË¶ÜÁõñÁ¥¢ÂºïÔºå‰Ω†Â∫îËØ•Âª∫Á´ãËÅîÂêàÁ¥¢ÂºïÔºö
> `(user_id, created_at, title)`
> *Ê≥®ÊÑèÔºöËôΩÁÑ∂ `title` ÂèØËÉΩÊòØ‰∏™ÊñáÊú¨ÔºåÊØîËæÉÂç†Á©∫Èó¥Ôºå‰ΩÜÊó¢ÁÑ∂‰Ω†Áé∞Âú®ÊúâÁ©∫Èó¥‰∫ÜÔºå‰∏∫‰∫ÜÊ∂àÈô§ÂõûË°®ÔºåËøôÊòØÂÄºÂæóÁöÑ„ÄÇ*

---



#### 3. ÈúÄË¶ÅË≠¶ÊÉïÁöÑÂâØ‰ΩúÁî®ÔºàRisk CheckÔºâ

ËôΩÁÑ∂ÊÄß‰ª∑ÊØîÈ´òÔºå‰ΩÜ‰∏ç‰ªÖÊòØ‚ÄúÁ©∫Èó¥‚ÄùÈóÆÈ¢òÔºåËøòÊúâ‚ÄúÂÜôÂéãÂäõ‚ÄùÈóÆÈ¢òÔºö

* **ÂÜôÂÖ•ÊîæÂ§ßÔºàWrite AmplificationÔºâÔºö** ÊØèÊ¨° `INSERT` Êàñ `UPDATE` Êï∞ÊçÆÊó∂Ôºå‰∏ç‰ªÖË¶ÅÊîπ‰∏ªË°®ÔºåËøòË¶ÅÂêåÊ≠•‰øÆÊîπÊâÄÊúâÁöÑËæÖÂä©Á¥¢Âºï„ÄÇÂ¶ÇÊûú‰Ω†Âä†‰∫ÜÂ§™Â§öÁöÑË¶ÜÁõñÁ¥¢ÂºïÔºåÂÜôÂÖ•ÈÄüÂ∫¶‰ºöÂèòÊÖ¢„ÄÇ
    * *Âà§Êñ≠Ê†áÂáÜÔºö* Â¶ÇÊûú‰Ω†ÁöÑÁÉ≠Êï∞ÊçÆË°®ÊòØ**ËØªÂ§öÂÜôÂ∞ë**Ôºà‰æãÂ¶ÇËØªÂÜôÊØî 10:1 ‰ª•‰∏äÔºâÔºåÂ§ßËÉÜÂä†Á¥¢Âºï„ÄÇÂ¶ÇÊûúÊòØÈ´òÈ¢ëÂÜôÂÖ•ÁöÑÊµÅÊ∞¥Ë°®ÔºåË¶ÅÂÖãÂà∂„ÄÇ
* **ÂÜ∑Êï∞ÊçÆÁöÑÁ¥¢ÂºïÔºö** ÂØπ‰∫éÈÇ£ÈÉ®ÂàÜÂéãÁº©ÁöÑÂÜ∑Êï∞ÊçÆÔºà2022-2023ÔºâÔºå**‰∏çÂª∫ËÆÆ**Âä†Â§™ÈáçÁöÑË¶ÜÁõñÁ¥¢Âºï„ÄÇÂõ†‰∏∫ÂéãÁº©Ë°®Âú®‰øÆÊîπÊó∂Ëß£Âéã/ÈáçÂéãÂºÄÈîÄÂæàÂ§ßÔºå‰∏îÂÜ∑Êï∞ÊçÆÊü•ËØ¢È¢ëÁéá‰ΩéÔºåÂÅ∂Â∞îÂõûË°®ÂèØ‰ª•Êé•Âèó„ÄÇ**ÊääÂ•ΩÁ¥¢ÂºïÂä†Âú® 2024+ ÁöÑÁÉ≠Êï∞ÊçÆË°®‰∏ä„ÄÇ**

---



#### 4. ÊÄªÁªì

‰Ω†ÁöÑ‰ºòÂåñÈÄªËæëÂΩ¢Êàê‰∫ÜÂÆåÁæéÁöÑÈó≠ÁéØÔºö
1.  **Âä®‰ΩúÔºö** ÂØπÂéÜÂè≤Êï∞ÊçÆËøõË°åÂΩíÊ°£ÂíåÂéãÁº©„ÄÇ
2.  **‰∫ßÂá∫Ôºö** ÈáäÊîæ‰∫ÜÁ∫¶ 42% ÁöÑÂ≠òÂÇ®ËµÑÊ∫ê + ÂáèÂ∞ë‰∫ÜÂÜ∑Êï∞ÊçÆÁöÑÂÜÖÂ≠òÂç†Áî®„ÄÇ
3.  **ÂÜçÊäïËµÑÔºö** Â∞ÜÈáäÊîæÁöÑËµÑÊ∫êÊäïÂÖ•Âà∞ÁÉ≠Êï∞ÊçÆÁöÑ‚ÄúË¶ÜÁõñÁ¥¢Âºï‚ÄùÂª∫ËÆæ‰∏≠„ÄÇ
4.  **ÊúÄÁªàÊî∂ÁõäÔºö** Âç≥‰ΩøÊï∞ÊçÆÈáèÂú®Â¢ûÈïøÔºåÊ†∏ÂøÉ‰∏öÂä°ÁöÑÊü•ËØ¢ÂìçÂ∫îÈÄüÂ∫¶ÂèçËÄåÂèòÂø´‰∫Ü„ÄÇ

**ËøôÊòØ‰∏Ä‰∏™ÈùûÂ∏∏‰ºòÁßÄÁöÑÊï∞ÊçÆÂ∫ìËøêÁª¥‰∏éÊû∂ÊûÑ‰ºòÂåñÊ°à‰æã„ÄÇ**

---

‰∏ã‰∏ÄÊ≠•‰Ω†ÂèØ‰ª•ÊääÁ≥ªÁªüÈáåÊúÄÊÖ¢ÊàñËÄÖÊúÄÈ´òÈ¢ëÁöÑÈÇ£Êù° SQL ËØ≠Âè•**ÔºàÂ∏¶‰∏ä `SELECT` Âì™‰∫õÂ≠óÊÆµÂíå `WHERE` Êù°‰ª∂ÔºâÂàÜÊûê‰∏Ä‰∏ãÂ¶Ç‰ΩïÂà©Áî®Ââ©‰ΩôÁ©∫Èó¥ËÆæËÆ°‰∏Ä‰∏™ÂÆåÁæéÁöÑ**Ë¶ÜÁõñÁ¥¢Âºï„ÄÇ





### ÊÄßËÉΩÊ£ÄÈ™å



#### ÊñπÊ°à































### ÈóÆÁ≠î















##### ‰ªÄ‰πàÊÉÖÂÜµ‰∏ã‰ºöÊääÊï∞ÊçÆË°®ÁöÑÁ¥¢ÂºïÂä†ËΩΩÂà∞ÁºìÂ≠ò‰∏≠Âë¢Ôºü

Âú®MySQL 8.0ÔºàÈªòËÆ§‰ΩøÁî®InnoDBÂ≠òÂÇ®ÂºïÊìéÔºâ‰∏≠ÔºåÁ¥¢ÂºïÂπ∂**‰∏çÊòØ**Âú®Êï∞ÊçÆÂ∫ìÂêØÂä®Êó∂‰∏ÄÊ¨°ÊÄßÂÖ®ÈÉ®Âä†ËΩΩÂà∞ÂÜÖÂ≠òÁöÑÔºåËÄåÊòØÈááÁî®**‚ÄúÊåâÈúÄÂä†ËΩΩ‚ÄùÔºàLazy LoadÔºâ**ÁöÑÁ≠ñÁï•„ÄÇ

ÈíàÂØπÊÇ®ÁöÑË°åÊÉÖÊúçÂä°Ë°®ÔºåÁ¥¢ÂºïÊï∞ÊçÆÈ°µÔºàIndex PagesÔºâ‰ºöÂú®‰ª•‰∏ãÂá†ÁßçÊÉÖÂÜµ‰∏ãË¢´Âä†ËΩΩÂà∞ **InnoDB Buffer PoolÔºàÁºìÂÜ≤Ê±†Ôºâ** ‰∏≠Ôºö

###### 1. Ê≠£Â∏∏ÁöÑÊü•ËØ¢ËØ∑Ê±ÇÔºàÊúÄ‰∏ªË¶ÅÁöÑÊÉÖÂÜµÔºâ

ËøôÊòØÊúÄÂ∏∏ËßÅÁöÑËß¶ÂèëÊñπÂºè„ÄÇÂΩìÊÇ®ÁöÑÂ∫îÁî®Á®ãÂ∫èÂèëËµ∑Êü•ËØ¢Êó∂ÔºåÂ¶ÇÊûúËØ•Êü•ËØ¢ÈúÄË¶ÅÁî®Âà∞Êüê‰∏™Á¥¢ÂºïÔºåInnoDB Â∞±‰ºöÂéªÁºìÂÜ≤Ê±†Êü•ÊâæËØ•Á¥¢ÂºïÈ°µ„ÄÇ

- **ÁºìÂ≠òÂëΩ‰∏≠ÔºàHitÔºâÔºö** Â¶ÇÊûúÁ¥¢ÂºïÈ°µÂ∑≤ÁªèÂú®ÂÜÖÂ≠ò‰∏≠ÔºåÁõ¥Êé•‰ΩøÁî®„ÄÇ
- **ÁºìÂ≠òÊú™ÂëΩ‰∏≠ÔºàMissÔºâÔºö** Â¶ÇÊûúÁ¥¢ÂºïÈ°µ‰∏çÂú®ÂÜÖÂ≠ò‰∏≠ÔºåInnoDB ‰ºöËß¶ÂèëÁ£ÅÁõò I/OÔºåÂ∞ÜËØ•Á¥¢ÂºïÈ°µÔºàÈÄöÂ∏∏ÊòØ16KBÔºâ‰ªéÁ£ÅÁõòËØªÂèñÂà∞ Buffer Pool ‰∏≠„ÄÇ

**ÂÖ∑‰ΩìÂú∫ÊôØÂåÖÊã¨Ôºö**

- **ÁÇπÊü•ËØ¢Ôºö** `SELECT * FROM quotes WHERE symbol = 'BTC_USDT';` ÔºàÂä†ËΩΩ B+ Ê†ë‰∏≠ÂØπÂ∫îÁöÑË∑ØÂæÑÈ°µÔºâ
- **ËåÉÂõ¥Êü•ËØ¢Ôºö** `SELECT * FROM quotes WHERE time > '10:00';` ÔºàÂä†ËΩΩ B+ Ê†ëÂè∂Â≠êËäÇÁÇπÁöÑÊï∞ÊçÆÈ°µÔºâ
- **Ë¶ÜÁõñÁ¥¢ÂºïÊâ´ÊèèÔºö** Êü•ËØ¢Âè™Ê∂âÂèäÁ¥¢ÂºïÂ≠óÊÆµÔºå‰∏çÂõûË°®„ÄÇ

###### 2. È¢ÑËØªÊú∫Âà∂ÔºàRead-AheadÔºâ

‰∏∫‰∫ÜÊèêÈ´òÊÄßËÉΩÔºåMySQL ‰ºöÈ¢ÑÊµãÊÇ®ÂèØËÉΩÈúÄË¶ÅÁöÑÊï∞ÊçÆÔºåÊèêÂâçÂ∞ÜÁõ∏ÈÇªÁöÑÁ¥¢ÂºïÈ°µÂä†ËΩΩËøõÊù•„ÄÇ

- **Á∫øÊÄßÈ¢ÑËØª (Linear Read-Ahead)Ôºö** Â¶ÇÊûúÊÇ®Ê≠£Âú®È°∫Â∫èÊâ´Êèè‰∏Ä‰∏™Á¥¢ÂºïÔºà‰æãÂ¶ÇÊãâÂèñÊüêÊÆµÊó∂Èó¥ÁöÑË°åÊÉÖÂéÜÂè≤ÔºâÔºåÂΩìÈ°∫Â∫èËÆøÈóÆÁöÑÊï∞ÊçÆÈáèËææÂà∞‰∏ÄÂÆöÈòàÂÄºÔºàÁî± `innodb_read_ahead_threshold` ÊéßÂà∂ÔºâÔºåMySQL ‰ºöÂºÇÊ≠•Â∞Ü‰∏ã‰∏Ä‰∏™ ExtentÔºàÂå∫ÔºåÈÄöÂ∏∏‰∏∫1MBÔºâ‰∏≠ÁöÑÊâÄÊúâÈ°µÂä†ËΩΩÂà∞ÁºìÂ≠ò‰∏≠„ÄÇ

###### 3. ÊúçÂä°ÈáçÂêØÊó∂ÁöÑ‚ÄúÁÉ≠Ë∫´‚Äù (Buffer Pool Warmup)

MySQL 8.0 ÈªòËÆ§ÂºÄÂêØ‰∫Ü**ÁºìÂÜ≤Ê±†Áä∂ÊÄÅ‰øùÂ≠ò‰∏éÊÅ¢Â§ç**ÂäüËÉΩ„ÄÇ

- **ÂÖ≥Êú∫Êó∂Ôºö** MySQL ‰ºöËÆ∞ÂΩïÂÜÖÂ≠ò‰∏≠Âì™‰∫õÊï∞ÊçÆÈ°µÔºàÂåÖÊã¨Á¥¢ÂºïÈ°µÔºâÊòØ‚ÄúÁÉ≠‚ÄùÁöÑÔºà`innodb_buffer_pool_dump_at_shutdown = ON`Ôºâ„ÄÇ
- **ÂºÄÊú∫Êó∂Ôºö** MySQL ‰ºöÊ†πÊçÆ‰πãÂâçÁöÑËÆ∞ÂΩïÔºåËá™Âä®Âú®ÂêéÂè∞Â∞ÜËøô‰∫õÁÉ≠Êï∞ÊçÆÈ°µÂíåÁ¥¢ÂºïÈ°µ‰ªéÁ£ÅÁõòÈáçÊñ∞Âä†ËΩΩÂõûÂÜÖÂ≠òÔºà`innodb_buffer_pool_load_at_startup = ON`Ôºâ„ÄÇ
  - *ËøôÊÑèÂë≥ÁùÄÔºöÂ¶ÇÊûúÊòØÈáçÂêØÊúçÂä°ÔºåÊÇ®Ê†∏ÂøÉ‰∏öÂä°ÁöÑË°åÊÉÖË°®Á¥¢ÂºïÈÄöÂ∏∏‰ºöËá™Âä®ÂõûÊù•Ôºå‰∏çÈúÄË¶Å‰∫∫Â∑•Âπ≤È¢Ñ„ÄÇ*

###### 4. ÂÜôÊìç‰ΩúËß¶ÂèëÁöÑ Change Buffer ÂêàÂπ∂

Â¶ÇÊûúÊÇ®ÁöÑË°åÊÉÖË°®ÊúâÂ§ßÈáèÁöÑÂÜôÂÖ•ÔºàINSERT/UPDATEÔºâÔºå‰∏îÊ∂âÂèä**‰∫åÁ∫ßÈùûÂîØ‰∏ÄÁ¥¢Âºï**Ôºö

- ÂΩìÂÜôÂÖ•ÂèëÁîüÊó∂ÔºåÂ¶ÇÊûúÂØπÂ∫îÁöÑÁ¥¢ÂºïÈ°µ‰∏çÂú®ÂÜÖÂ≠ò‰∏≠ÔºåInnoDB ‰∏ç‰ºöÁ´ãÂàªËØªÁ£ÅÁõòÔºåËÄåÊòØÂÖàËÆ∞ÂΩïÂú® **Change Buffer** ‰∏≠„ÄÇ
- **Âä†ËΩΩËß¶ÂèëÔºö** ÂΩìÂêéÁª≠ÊúâËØªËØ∑Ê±ÇÔºàSELECTÔºâÁúüÁöÑÈúÄË¶ÅËÆøÈóÆËøô‰∏™Á¥¢ÂºïÈ°µÊó∂ÔºåÊàñËÄÖÂêéÂè∞Ê∏ÖÁêÜÁ∫øÁ®ãÔºàPurgeÔºâËøêË°åÊó∂ÔºåËØ•Á¥¢ÂºïÈ°µ‰ºöË¢´ËØªÂÖ• Buffer PoolÔºåÂπ∂‰∏é Change Buffer ‰∏≠ÁöÑ‰øÆÊîπËøõË°åÂêàÂπ∂„ÄÇ

###### 5. ‰∫∫Â∑•Âº∫Âà∂È¢ÑÁÉ≠

Â¶ÇÊûúÊÇ®ÂàöÂàöÊñ∞Âª∫‰∫Ü‰∏Ä‰∏™Â§ßË°®ÔºåÊàñËÄÖÂàöÊ∏ÖÁ©∫‰∫ÜÁºìÂ≠òÔºåÊÉ≥Âº∫Âà∂Âä†ËΩΩÁ¥¢ÂºïÔºåÈÄöÂ∏∏ÈúÄË¶Å‰∫∫Â∑•ËøêË°åÂÖ®Ë°®Êâ´ÊèèÊàñÁ¥¢ÂºïÊâ´ÊèèÁöÑ SQLÔºö

- **Âº∫Âà∂Âä†ËΩΩÁ¥¢ÂºïÔºö** `SELECT count(*) FROM quotes FORCE INDEX (idx_symbol_time);`
  - *ËøôÊù°ÂëΩ‰ª§‰ºöÂº∫Âà∂ MySQL Êâ´ÊèèÊåáÂÆöÁöÑÁ¥¢ÂºïÊ†ëÔºå‰ªéËÄåÂ∞ÜËØ•Á¥¢ÂºïÁöÑÊâÄÊúâÂè∂Â≠êËäÇÁÇπÂä†ËΩΩÂà∞ Buffer Pool„ÄÇ*

###### ÊÄªÁªì‰∏éÂª∫ËÆÆ

ÂØπ‰∫éË°åÊÉÖÊúçÂä°ËøôÁßç**ÂÜôÈ¢ëÁπÅ„ÄÅËØª‰πüÈ¢ëÁπÅ**ÁöÑÂú∫ÊôØÔºö

1. **‰∏çÁî®Â§™ÊãÖÂøÉÂä†ËΩΩÈóÆÈ¢òÔºö** Âè™Ë¶ÅÊÇ®ÁöÑÊü•ËØ¢Âú®ËøêË°åÔºåÊ¥ªË∑ÉÁöÑË°åÊÉÖÁ¥¢ÂºïÔºàÂ¶ÇÊúÄËøë24Â∞èÊó∂ÁöÑÊï∞ÊçÆÔºâËá™ÁÑ∂‰ºöÂ∏∏È©ªÂú®ÂÜÖÂ≠ò‰∏≠„ÄÇ
2. **ÂÖ≥Ê≥®ÂÜÖÂ≠òÂ§ßÂ∞èÔºö** Á°Æ‰øù `innodb_buffer_pool_size` Ë∂≥Â§üÂ§ßÔºàÈÄöÂ∏∏Âª∫ËÆÆÈÖçÁΩÆ‰∏∫Áâ©ÁêÜÂÜÖÂ≠òÁöÑ 50%-70%ÔºâÔºåËÉΩÂ§üË£Ö‰∏ãÊÇ®ÊâÄÊúâÁöÑ‚ÄúÁÉ≠Êï∞ÊçÆ‚ÄùÁ¥¢Âºï„ÄÇÂ¶ÇÊûú Buffer Pool Â§™Â∞èÔºåÊóßÁöÑË°åÊÉÖÁ¥¢Âºï‰ºöË¢´ LRU ÁÆóÊ≥ïÊ∑òÊ±∞Âá∫Â±ÄÔºå‰∏ãÊ¨°Êü•ÂéÜÂè≤Êï∞ÊçÆÊó∂Â∞±‰ºöÂèòÊÖ¢„ÄÇ
3. **ÂÜ∑ÁÉ≠ÂàÜÁ¶ªÔºö** Â¶ÇÊûúÂéÜÂè≤Ë°åÊÉÖÊï∞ÊçÆÈáèÂ∑®Â§ßÔºåÂª∫ËÆÆÊåâÊó∂Èó¥ÂàÜË°®ÊàñÂàÜÂå∫„ÄÇËøôÊ†∑Êü•ÊóßÊï∞ÊçÆÂä†ËΩΩÁ¥¢ÂºïÊó∂Ôºå‰∏ç‰ºöÊää‚ÄúÂΩìÂâçÊúÄÊñ∞Ë°åÊÉÖ‚ÄùÁöÑÁ¥¢ÂºïÈ°µÊå§Âá∫ÂÜÖÂ≠ò„ÄÇ





##### Q1: ÊèíÂÖ•Êï∞ÊçÆÊó∂ÔºåÂ¶ÇÊûú‰∏çÊåáÂÆö IDÔºåMySQL ÊÄé‰πàÁü•ÈÅìÊï∞ÊçÆËØ•ÂéªÂì™‰∏™ÂàÜÂå∫Ôºü
**A:** MySQL ‰æùÈù† **‚ÄúÂàÜÂå∫ÈîÆ‚Äù (Partition Key)** Êù•ÂØºËà™„ÄÇ
Âè™Ë¶Å‰Ω†ÁöÑ `INSERT` ËØ≠Âè•ÈáåÂåÖÂê´‰∫Ü `trade_date`ÔºàÂàÜÂå∫ÈîÆÔºâÔºåMySQL Â∞±‰ºöËá™Âä®Ëß£ÊûêËøô‰∏™Êó•ÊúüÔºåÊääÂÆÉË∑ØÁî±Âà∞ÂØπÂ∫îÁöÑÁâ©ÁêÜÂàÜÂå∫ÔºàÊØîÂ¶Ç `p202501`Ôºâ„ÄÇËá≥‰∫é `id`ÔºåÂ¶ÇÊûú‰Ω†Ê≤°‰º†ÔºåMySQL ‰ºöËá™Âä®ÁîüÊàê‰∏Ä‰∏™Ëá™Â¢û IDÔºåËøô‰∏çÂΩ±ÂìçÂàÜÂå∫ÁöÑÈÄâÊã©„ÄÇ





##### Q2: ‰∏∫‰ªÄ‰πàËØ¥ËøôÁßç‚ÄúÂàÜÂå∫ + Ëá™Â¢û ID‚ÄùÁöÑÊû∂ÊûÑÂÜôÂÖ•ÊÄßËÉΩÁâπÂà´Âº∫Ôºü
**A:** Âõ†‰∏∫ÂÆÉÂÆûÁé∞‰∫Ü **‚ÄúÈ°∫Â∫èËøΩÂä†ÂÜô‚Äù (Sequential Append)**„ÄÇ

* Áî±‰∫é `id` ÊòØËá™Â¢ûÁöÑÔºåÊñ∞Êï∞ÊçÆÊ∞∏ËøúÊØîÊóßÊï∞ÊçÆ ID Â§ß„ÄÇ
* MySQL ‰∏çÈúÄË¶ÅÂéªÁøªÊóßË¥¶ÔºàÊâ´ÊèèÊóßÁöÑÊï∞ÊçÆÈ°µÔºâÊù•ÊâæÁ©∫‰ΩçÊèíÈíàÔºåËÄåÊòØÁõ¥Êé•ÂÆö‰ΩçÂà∞ÂΩìÂâçÂàÜÂå∫Êñá‰ª∂ÁöÑ**ÊúÄÊú´Â∞æ**ÔºåÁî≥ËØ∑Êñ∞È°µÈù¢ÊääÊï∞ÊçÆÂÜôËøõÂéª„ÄÇ
* ËøôÁßçÂÜôÂÖ•ÊñπÂºèÂØπÁ£ÅÁõò I/O ÊúÄÂèãÂ•ΩÔºåÈÅøÂÖç‰∫Ü‚ÄúÈ°µÂàÜË£Ç‚ÄùÂíåÁ£ÅÁõòÁ¢éÁâáÔºåÂÜôÂÖ•ÂêûÂêêÈáèÊûÅÈ´ò„ÄÇ



##### Q3: Êü•ËØ¢ÁâπÂÆöËÇ°Á•®ÔºàÂ¶Ç 000002.SZÔºâÊó∂ÔºåÂ¶ÇÊûúÊñ∞Êï∞ÊçÆÊòØËøΩÂä†Âú®Êñá‰ª∂Êú´Â∞æÁöÑÔºåMySQL ÊòØÂ¶Ç‰ΩïË∑≥Ëøá‰∏≠Èó¥ÈÇ£‰πàÂ§öÊó†ÂÖ≥Êï∞ÊçÆÔºåÁ≤æÂáÜÊâæÂà∞Ëøô‰∏§ÈÉ®ÂàÜÊï∞ÊçÆÁöÑÔºü

**A:** ÊòØÁöÑÔºå‰Ω†ÁöÑÁêÜËß£ÂæàÂáÜÁ°Æ„ÄÇËøôÂÖ∂ÂÆûÊòØ‰∏Ä‰∏™ **‚ÄúÁ¥¢ÂºïÊåáË∑ØÔºåÁâ©ÁêÜË∑≥Ë∑É‚Äù** ÁöÑËøáÁ®ãÔºö

1.  **ÈÄªËæë‰∏äÔºà‰∫åÁ∫ßÁ¥¢ÂºïÔºâÔºöÊï∞ÊçÆÊòØËøûÁª≠ÁöÑ**
    * ËôΩÁÑ∂Êñ∞Êï∞ÊçÆÁâ©ÁêÜ‰∏äÂú®Êñá‰ª∂ÊúÄÂêéÔºå‰ΩÜÂú® **`(wind_code, trade_date)` ËÅîÂêàÁ¥¢Âºï** ÁöÑ B+ Ê†ëÈáåÔºåÊï∞ÊçÆÂ∫ì‰ºöËá™Âä®ÊääÊñ∞Êï∞ÊçÆÁöÑÁ¥¢ÂºïÊù°ÁõÆ‚ÄúÂΩí‰Ωç‚Äù„ÄÇ
    * ‰πüÂ∞±ÊòØËØ¥ÔºåÂú®Á¥¢ÂºïÊ†ë‰∏äÔºå`000002.SZ` ÁöÑÊâÄÊúâËÆ∞ÂΩïÔºàÊó†ËÆ∫ÊòØÂéªÂπ¥ÁöÑËÄÅÊï∞ÊçÆÔºåËøòÊòØÂàöÊèíÂÖ•ÁöÑÊñ∞Êï∞ÊçÆÔºâÈÉΩÊòØ**Á¥ßÊå®Âú®‰∏ÄËµ∑**ÁöÑ„ÄÇ
    * **Á¨¨‰∏ÄÊ≠•**ÔºöMySQL Âè™ÈúÄË¶ÅÂú®Á¥¢ÂºïÊ†ë‰∏äÂÅö‰∏ÄÊ¨°ÂÆö‰ΩçÔºåÂ∞±ËÉΩÁî±‰∏äËÄå‰∏ãÊääÂÆÉ‰ª¨ÂÖ®ÊâæÂá∫Êù•ÔºåÊãøÂà∞ÂÆÉ‰ª¨ÂØπÂ∫îÁöÑ `id`„ÄÇ

2.  **Áâ©ÁêÜ‰∏äÔºàËÅöÁ∞áÁ¥¢ÂºïÔºâÔºöÂàÜ‰∏§ÂùóËØªÂèñ**
    * ÊãøÂà∞ `id` ÂêéÔºåMySQL ÂõûÂà∞Êï∞ÊçÆÊñá‰ª∂ÈáåÊäìÂèñÂÆåÊï¥Êï∞ÊçÆ„ÄÇ
    * **ËÄÅÊï∞ÊçÆÁöÑ id Â∞è** $\rightarrow$ ‰Ωç‰∫éÊñá‰ª∂ÁöÑÂâçÂçäÈÉ®ÂàÜ„ÄÇ
    * **Êñ∞Êï∞ÊçÆÁöÑ id Â§ß** $\rightarrow$ ‰Ωç‰∫éÊñá‰ª∂ÁöÑÊúÄÊú´Â∞æÔºàËøΩÂä†Âå∫Ôºâ„ÄÇ
    * **Á¨¨‰∫åÊ≠•**ÔºöMySQL ‰ºöÊ†πÊçÆÁ¥¢ÂºïÊèê‰æõÁöÑÂú∞ÂùÄÔºåÂÖàÂéªÊñá‰ª∂Â§¥ËØªËÄÅÊï∞ÊçÆÔºåÁÑ∂ÂêéÁõ¥Êé• **‚ÄúË∑≥‚Äù** Âà∞Êñá‰ª∂Â∞æËØªÊñ∞Êï∞ÊçÆ„ÄÇ

**ÁªìËÆ∫**ÔºöÂÆÉÁ°ÆÂÆûÊòØ‚ÄúÂàÜ‰∏§Âùó‚ÄùÂéªÊâæÊï∞ÊçÆÔºå‰ΩÜÂõ†‰∏∫ÊúâÁ¥¢ÂºïËøô‰∏™Á≤æÂáÜÂú∞ÂõæÔºåÂÆÉ**ÂÆåÂÖ®Ë∑≥Ëøá‰∫Ü**‰∏≠Èó¥ÈÇ£‰∏ÄÂ§ßÊÆµÂ±û‰∫éÂÖ∂‰ªñËÇ°Á•®ÔºàÂ¶Ç `000001.SZ`ÔºâÁöÑÊï∞ÊçÆÔºåÊâÄ‰ª•Êü•ËØ¢‰æùÁÑ∂ÈùûÂ∏∏È´òÊïà„ÄÇ













## ÈÅáÂà∞ÁöÑÈóÆÈ¢ò





#### ÂàÜÂå∫ÁïåÈôêÂàíÂàÜ

>Êó¢ÁÑ∂Ë¶ÅÁî®ÂàÜÂå∫Ë°®ÔºåÈÇ£‰πàÂàÜÂå∫ÈîÆÁî®Âì™‰∏™ÔºåÂàÜÂå∫ÁöÑÁïåÈôêÊÄé‰πàÂàíÂàÜÂë¢Ôºü

ËßÇÂØüÂà∞ÊåâÊúàÂàÜË°®ÊØèÊúàÊï∞ÊçÆÂú®‰∏§ÂçÉÂ§ö‰∏áË°åÂ∑¶Âè≥ÔºÅ



**Âú®ÁêÜÊÉ≥ÊÉÖÂÜµ‰∏ãÔºåÂ¶ÇÊûúË°åÊï∞ÊçÆÂ§ßÂ∞è‰∏∫ 1KBÔºåMySQL InnoDB ÁöÑ B+ Ê†ëÂú® 3 Â±ÇÈ´òÂ∫¶Êó∂ÔºåÁ°ÆÂÆûÂèØ‰ª•Â≠òÂÇ®Á∫¶ 2000 ‰∏áË°åÊï∞ÊçÆ„ÄÇ**



##### B+Ê†ëÂÆπÈáèÂ±ÇÁ∫ßÂõæ

```mermaid
graph TD
    %% ÂÆö‰πâÊ†∑Âºè
    classDef rootStyle fill:#ffcccc,stroke:#333,stroke-width:2px;
    classDef midStyle fill:#cce5ff,stroke:#333,stroke-width:2px;
    classDef leafStyle fill:#ccffcc,stroke:#333,stroke-width:2px;
    classDef resStyle fill:#ffffcc,stroke:#ff9900,stroke-width:4px,stroke-dasharray:5 5;

    %% Á¨¨‰∏ÄÂ±Ç
    subgraph Level1 ["Á¨¨1Â±Ç: Ê†πËäÇÁÇπ Root"]
        RootNode("Ê†πËäÇÁÇπ<br/>1‰∏™È°µÈù¢<br/>1099‰∏™ÊåáÈíà"):::rootStyle
    end

    RootNode -- "ÊâáÂá∫ 1099" --> MidNode1
    RootNode -- "..." --> MidNode2
    RootNode -- "ÊâáÂá∫ 1099" --> MidNode3

    %% Á¨¨‰∫åÂ±Ç
    subgraph Level2 ["Á¨¨2Â±Ç: ÈùûÂè∂Â≠êËäÇÁÇπ Internal"]
        MidNode1("‰∏≠Èó¥È°µ 1"):::midStyle
        MidNode2("... ÂÖ± 1099 È°µ ..."):::midStyle
        MidNode3("‰∏≠Èó¥È°µ 1099"):::midStyle
    end

    MidNode1 -- "ÊâáÂá∫ 1099" --> LeafGroup1
    MidNode2 -- "..." --> LeafGroup2
    MidNode3 -- "ÊâáÂá∫ 1099" --> LeafGroup3

    %% Á¨¨‰∏âÂ±Ç
    subgraph Level3 ["Á¨¨3Â±Ç: Âè∂Â≠êËäÇÁÇπ Leaf"]
        LeafGroup1("Âè∂Â≠êÈ°µÁªÑ 1<br/>Á∫¶1099È°µ"):::leafStyle
        LeafGroup2("... ÊÄªËÆ°Á∫¶ 120‰∏á È°µ ..."):::leafStyle
        LeafGroup3("Âè∂Â≠êÈ°µÁªÑ 1099<br/>Á∫¶1099È°µ"):::leafStyle
    end

    %% ÁªìÊûúËäÇÁÇπÔºàÈîôËØØÁÇπÂ∑≤‰øÆÂ§çÔºöÂä†‰∏ä‰∫ÜÂèåÂºïÂè∑Ôºâ
    Result("ÊúÄÁªàËÆ°ÁÆó:<br/>16Ë°å x 1099 x 1099<br/>Á∫¶ 19,324,816 Ë°å"):::resStyle

    LeafGroup1 --- Result
    LeafGroup2 --- Result
    LeafGroup3 --- Result
```

###### ÂõæËß£ËØ¥Êòé

1. **Level 1 (Á∫¢Ëâ≤ - Ê†πËäÇÁÇπ):**
   - ËøôÊòØ B+ Ê†ëÁöÑÂÖ•Âè£„ÄÇ
   - ÂÆÉ‰∏çÂ≠òÂÖ∑‰ΩìÊï∞ÊçÆÔºåÂè™Â≠òÊåáÂêë‰∏ã‰∏ÄÂ±ÇÁöÑ‚ÄúË∑ØÊ†á‚ÄùÔºàÊåáÈíàÔºâ„ÄÇ
   - Âõ†‰∏∫ Key ÂæàÂ∞è (8B) + ÊåáÈíà (6B)ÔºåÊâÄ‰ª•Ëøô 1 È°µËÉΩÊåáË∑Ø **1099** ‰∏™ÊñπÂêë„ÄÇ
2. **Level 2 (ËìùËâ≤ - ‰∏≠Èó¥ËäÇÁÇπ):**
   - ËøôÊòØÁ¨¨‰∏ÄËΩÆË£ÇÂèò„ÄÇ
   - Ê†πËäÇÁÇπÁöÑÊØè‰∏Ä‰∏™ÊåáÈíàÂØπÂ∫îËøôÈáåÁöÑ‰∏Ä‰∏™È°µÈù¢ÔºåÊâÄ‰ª•ËøôÈáåÊúâ **1099** ‰∏™È°µÈù¢„ÄÇ
   - ÊØè‰∏™È°µÈù¢ÂèàÁªßÁª≠ÊåáË∑ØÔºåÊØè‰∏™È°µÈù¢ÂèàËÉΩÊåáÂêë **1099** ‰∏™‰∏ãÂ±ÇËäÇÁÇπ„ÄÇ
3. **Level 3 (ÁªøËâ≤ - Âè∂Â≠êËäÇÁÇπ):**
   - ËøôÊòØÁ¨¨‰∫åËΩÆË£ÇÂèòÔºå‰πüÊòØ**ÊúÄÂ∫ûÂ§ß**ÁöÑ‰∏ÄÂ±Ç„ÄÇ
   - ÊÄªÈ°µÈù¢Êï∞ÁàÜÁÇ∏ÂºèÂ¢ûÈïøÔºö$1099 \times 1099 \approx 120$ ‰∏á‰∏™È°µÈù¢„ÄÇ
   - **ÂÖ≥ÈîÆÁÇπÔºö** Âè™ÊúâËøô‰∏ÄÂ±ÇÊâçÁúüÊ≠£Â≠òÂÇ®‰Ω†ÁöÑ **1KB Ë°åÊï∞ÊçÆ**„ÄÇ
4. **ÊúÄÁªàËÆ°ÁÆó (ÈªÑËâ≤Ê°Ü):**
   - Âõ†‰∏∫ÊØèË°åÊï∞ÊçÆ 1KBÔºåÊØèÈ°µ 16KBÔºåÊâÄ‰ª•ÊØè‰∏™ÁªøËâ≤ÁöÑÂè∂Â≠êËäÇÁÇπÂè™ËÉΩ‰Ωè **16 Ë°å** Êï∞ÊçÆ„ÄÇ
   - ÊÄªÊï∞ = `(Âè∂Â≠êËäÇÁÇπÊÄªÊï∞ 1,207,801) * (ÊØèÈ°µ 16 Ë°å) ‚âà 1,932 ‰∏áË°å`„ÄÇ







> ‰∏çËøáÔºå‰Ω†ÁöÑÊé®ÁÆóÂâçÊèê‰∏≠Êúâ‰∏Ä‰∏™ÊòéÊòæÁöÑ**ÂèÇÊï∞ÂÜ≤Á™Å**ÈúÄË¶Å‰øÆÊ≠£ÔºàÂèØËÉΩÊòØÁ¨îËØØÔºâÔºåÂê¶ÂàôÁâ©ÁêÜ‰∏äÊòØ‰∏çÊàêÁ´ãÁöÑ„ÄÇÊàë‰ª¨ÈúÄË¶ÅÊääËøô‰∏™ÂèÇÊï∞‰øÆÊ≠£‰∏∫ MySQL ÁöÑÈªòËÆ§Ê†áÂáÜ

##### 1. ‰øÆÊ≠£ÂâçÊèêÊù°‰ª∂ (Critical Correction)

‰Ω†ÊèêÂà∞Ôºö‚ÄúÊØèË°åÊï∞ÊçÆ 1KÔºåËÄåÊØèÈ°µÂ§ßÂ∞èÊòØ 1KÔºå1 È°µÂ≠òÂÇ® 16 Ë°åÊï∞ÊçÆ‚Äù„ÄÇ

* **Áâ©ÁêÜÁüõÁõæÔºö** Â¶ÇÊûú‰∏ÄÈ°µÂè™Êúâ 1KBÔºà1024 Â≠óËäÇÔºâÔºåËÄå‰∏ÄË°åÊï∞ÊçÆ‰πüÊòØ 1KBÔºåÈÇ£‰πà‰∏ÄÈ°µ**Âè™ËÉΩÂ≠ò 1 Ë°å**ÔºàÂÆûÈôÖ‰∏äÂõ†‰∏∫È°µÂ§¥È°µÂ∞æÁöÑÂºÄÈîÄÔºåËøû 1 Ë°åÈÉΩÂ≠ò‰∏ç‰∏ãÔºâÔºåÁªù‰∏çÂèØËÉΩÂ≠ò‰∏ã 16 Ë°å„ÄÇ
* **ÂêàÁêÜÂÅáËÆæÔºö** ‰Ω†Êé®ÁÆóÁöÑÊï∞Â≠óÔºà16 Ë°åÂíå 1099 ÊâáÂá∫ÔºâÂÖ∂ÂÆûÊòØÂü∫‰∫é MySQL InnoDB **ÈªòËÆ§È°µÂ§ßÂ∞è 16KB** ÂæóÂá∫ÁöÑ„ÄÇ

ÊâÄ‰ª•ÔºåÊàë‰ª¨Â∞ÜÂâçÊèê‰øÆÊ≠£‰∏∫Ôºö
* **È°µÂ§ßÂ∞è (Page Size)Ôºö** 16KB (16384 Bytes) ‚Äî‚Äî *ËøôÊòØ InnoDB ÁöÑÈªòËÆ§ÂÄº*
* **Ë°åÂ§ßÂ∞è (Row Size)Ôºö** 1KB
* **‰∏ªÈîÆ ID Á±ªÂûãÔºö** BigInt (8 Bytes) + ÊåáÈíà (6 Bytes) = 14 Bytes

---

##### 2. B+ Ê†ëÂ±ÇÁ∫ßÊé®ÁÆó (Step-by-Step)

Êàë‰ª¨ÊåâÁÖß‰Ω†ÁöÑÈÄªËæëÔºåÈáçÊñ∞È™åËØÅ‰∏Ä‰∏ã‰∏âÂ±ÇÁªìÊûÑÁöÑÊï∞ÊçÆÂÆπÈáè„ÄÇ



###### Á¨¨‰∏ÄÂ±ÇÔºöÂè∂Â≠êËäÇÁÇπ (Leaf Nodes)
Âè∂Â≠êËäÇÁÇπÂ≠òÂÇ®ÂÆûÈôÖÁöÑË°åÊï∞ÊçÆÔºàDataÔºâ„ÄÇ
* **ËÆ°ÁÆóÔºö** 16KB(ÈªòËÆ§ÊØèÈ°µÂ§ßÂ∞è) / 1KB(ÊØèË°åÂ§ßÂ∞è) = 16Ë°å„ÄÇ
* **ÁªìËÆ∫Ôºö** ÊØè‰∏™Âè∂Â≠êËäÇÁÇπÁ°ÆÂÆûÂ≠òÂÇ® **16 Ë°å** Êï∞ÊçÆÔºàÊâ£Èô§È°µÂ§¥È°µÂ∞æ overheadÔºå15-16 Ë°åÊòØÂêàÁêÜÁöÑÔºâ„ÄÇ



###### Á¨¨‰∫åÂ±ÇÔºöÈùûÂè∂Â≠êËäÇÁÇπ (Internal Nodes)
ÈùûÂè∂Â≠êËäÇÁÇπÂè™Â≠òÂÇ®‚Äú‰∏ªÈîÆ + È°µÊåáÈíà‚ÄùÔºå‰∏çÂ≠òÂÖ∑‰ΩìÊï∞ÊçÆ„ÄÇ
* **ËÆ°ÁÆóÔºö** 16KB / (8Bytes Key + 6Bytes Pointer) Á∫¶= 1170„ÄÇ
* **ËÄÉËôë OverheadÔºö** Êâ£Èô§È°µÂ§¥„ÄÅÈ°µÂ∞æ„ÄÅÊ†°È™åÂíåÁ≠âÔºå**1099** ÊòØ‰∏Ä‰∏™ÈùûÂ∏∏ÂáÜÁ°Æ‰∏î‰øùÂÆàÁöÑÊâáÂá∫ÔºàFan-outÔºâÈ¢Ñ‰º∞ÂÄº„ÄÇ

>ËØ¥Êòé

1. `8Bytes Key`Ôºö‰∏ªÈîÆÁöÑÂ§ßÂ∞è

ËøôÈÉ®ÂàÜ‰ª£Ë°®ÁöÑÊòØ**ÈùûÂè∂Â≠êËäÇÁÇπÔºàÁ¥¢ÂºïÈ°µÔºâ‰∏≠Â≠òÂÇ®ÁöÑÁ¥¢ÂºïÈîÆÂÄº**„ÄÇ

- **Âê´‰πâÔºö** B+ Ê†ëÁöÑÈùûÂè∂Â≠êËäÇÁÇπ‰∏çÂ≠òÊï∞ÊçÆÔºåÂè™Â≠ò‚Äú‰∏ªÈîÆÂÄº‚ÄùÁî®Êù•ÂØºËà™„ÄÇ
- **‰∏∫‰ªÄ‰πàÊòØ 8 Â≠óËäÇÔºü**
  - ËøôÊòØÂÅáËÆæ‰Ω†ÁöÑÊï∞ÊçÆÂ∫ì‰∏ªÈîÆÁ±ªÂûã‰∏∫ **`BIGINT`**„ÄÇ
  - Âú® MySQL ‰∏≠Ôºå`BIGINT` Âç†Áî® **8 Bytes** (64‰ΩçÊï¥Êï∞)„ÄÇ
  - *Ê≥®ÔºöÂ¶ÇÊûú‰Ω†Áî®ÁöÑÊòØ `INT` Á±ªÂûãÔºåÂàôÊòØ 4 BytesÔºõÂ¶ÇÊûúÊòØ `VARCHAR` Êàñ UUIDÔºåËøô‰∏™ÂÄº‰ºöÂèòÂ§ßÂæàÂ§ö„ÄÇ*

2. `6Bytes Pointer`ÔºöÈ°µÊåáÈíàÁöÑÂ§ßÂ∞è

ËøôÈÉ®ÂàÜ‰ª£Ë°®ÁöÑÊòØ**ÊåáÂêë‰∏ã‰∏ÄÂ±ÇÂ≠êËäÇÁÇπÁöÑÂú∞ÂùÄÊåáÈíà**„ÄÇ

- **Âê´‰πâÔºö** Â∞±ÂÉè‰π¶ÁöÑÁõÆÂΩïÔºå‰∏ªÈîÆÊòØ‚ÄúÁ´†ËäÇÂêç‚ÄùÔºåÊåáÈíàÊòØ‚ÄúÈ°µÁ†Å‚Äù„ÄÇÂÆÉÂëäËØâÊï∞ÊçÆÂ∫ìÔºö‚ÄúÂú®Ëøô‰∏™‰∏ªÈîÆËåÉÂõ¥ÁöÑÊï∞ÊçÆÔºåÂéªÁ¨¨Âá†Âè∑Êï∞ÊçÆÈ°µÊâæ‚Äù„ÄÇ
- **‰∏∫‰ªÄ‰πàÊòØ 6 Â≠óËäÇÔºü**
  - **‰∏•Ê†ºÊù•ËØ¥ÔºåInnoDB ÁöÑÈ°µÂè∑ÔºàPage NumberÔºâÂÖ∂ÂÆûÊòØ 4 Bytes**Ôºà32‰ΩçÊï¥Êï∞Ôºâ„ÄÇ
  - ‰ΩÜÂú®Â∑•Á®ã‰º∞ÁÆó‰∏≠ÔºåÊàë‰ª¨ÈÄöÂ∏∏ÊåâÁÖß **6 Bytes** Êù•ËÆ°ÁÆóÔºåÂéüÂõ†Êúâ‰∏§‰∏™Ôºö
    1. **È¢ÑÁïô OverheadÔºàÂ§¥ÈÉ®‰ø°ÊÅØÔºâÔºö** Âú® InnoDB ÁöÑÈùûÂè∂Â≠êËäÇÁÇπ‰∏≠ÔºåÊØè‰∏ÄÊù°Á¥¢ÂºïËÆ∞ÂΩïÈô§‰∫Ü‚Äú‰∏ªÈîÆ‚ÄùÂíå‚ÄúÈ°µÂè∑‚ÄùÔºåËøòÊúâ**ËÆ∞ÂΩïÂ§¥‰ø°ÊÅØÔºàRecord HeaderÔºâ**ÔºåËøôÈÄöÂ∏∏Âç†Áî® 5 Â≠óËäÇÂ∑¶Âè≥„ÄÇ
    2. **ÈÄöÁî®Ê®°ÂûãÔºö** Âú®ÂæàÂ§öÁªèÂÖ∏ÁöÑÊï∞ÊçÆÂ∫ìÁÆóÊ≥ïÊèèËø∞‰∏≠ÔºåÊåáÈíàÂ∏∏Ë¢´ÊäΩË±°‰∏∫ 6 Â≠óËäÇÔºàÂØπÂ∫î 48‰ΩçÂØªÂùÄËÉΩÂäõÔºâÔºåËøôÊàê‰∫Ü‰∏Ä‰∏™Á∫¶ÂÆö‰øóÊàêÁöÑ‰º∞ÁÆóÁºìÂÜ≤ÂÄº„ÄÇ

------

3. ÂõæËß£ÔºöÈùûÂè∂Â≠êËäÇÁÇπÁöÑÂÜÖÈÉ®ÁªìÊûÑ

‰Ω†ÂèØ‰ª•Êää B+ Ê†ëÁöÑ‰∏Ä‰∏™ÈùûÂè∂Â≠êËäÇÁÇπÔºà16KBÔºâÊÉ≥Ë±°Êàê‰∏Ä‰∏™Êï∞ÁªÑÔºåÈáåÈù¢ÂØÜÂØÜÈ∫ªÈ∫ªÂú∞ÊéíÊª°‰∫ÜËøôÁßçÁªÑÂêàÔºö

```
[ ‰∏ªÈîÆ(8B) | ÊåáÈíà(6B) ]  [ ‰∏ªÈîÆ(8B) | ÊåáÈíà(6B) ]  [ ‰∏ªÈîÆ(8B) | ÊåáÈíà(6B) ] ...
```

- **ÊØè‰∏ÄÂØπÁöÑÂ§ßÂ∞è** = 8 + 6 = 14Bytes„ÄÇ

- ËøôÂ∞±ÊòØ‰∏∫‰ªÄ‰πàÊàë‰ª¨ËÉΩÁÆóÂá∫ÊâáÂá∫ÔºàFan-outÔºâÔºö

  
  $$
  16384 \text{ Bytes (È°µÂ§ßÂ∞è)} \div 14 \text{ Bytes} \approx 1170
  $$
  

  

  (Êâ£Èô§‰∏Ä‰∫õÈ°µÈù¢ÁöÑÂÖÉÊï∞ÊçÆÔºåÊâÄ‰ª•Êàë‰ª¨‰πãÂâç‰øùÂÆà‰º∞ÁÆó‰∏∫ 1099)





###### Á¨¨‰∏âÂ±ÇÔºöÊ†πËäÇÁÇπ (Root Node)
Ê†πËäÇÁÇπÂêåÊ†∑Â≠òÂÇ®‚Äú‰∏ªÈîÆ + È°µÊåáÈíà‚ÄùÔºåÊâáÂá∫ÂêåÊ†∑Êåâ 1099 ËÆ°ÁÆó„ÄÇ

---



##### 3. ÊÄªÂÆπÈáèËÆ°ÁÆó (Total Calculation)

ÂÅáËÆæ B+ Ê†ëÈ´òÂ∫¶‰∏∫ 3Ôºö

1.  **Ê†πËäÇÁÇπ (Level 1):**
    
    * Êã•Êúâ 1099 ‰∏™ÊåáÈíàÔºåÊåáÂêë 1099 ‰∏™Á¨¨‰∫åÂ±ÇËäÇÁÇπ„ÄÇ
2.  **‰∏≠Èó¥Â±Ç (Level 2):**
    * ÊÄªÂÖ±Êúâ 1099 ‰∏™ËäÇÁÇπ„ÄÇ
    * ÊØè‰∏™ËäÇÁÇπÂèàÊúâ 1099 ‰∏™ÊåáÈíàÔºåÊåáÂêëÂè∂Â≠êËäÇÁÇπ„ÄÇ
    * ÊÄªÂè∂Â≠êËäÇÁÇπÊï∞ = $1099 \times 1099 = 1,207,801$ ‰∏™È°µÈù¢„ÄÇ
3.  **Âè∂Â≠êÂ±Ç (Level 3 - Data):**
    
    * ÊØè‰∏™Âè∂Â≠êËäÇÁÇπÂ≠ò 16 Ë°åÊï∞ÊçÆ„ÄÇ
    
    * **ÊÄªË°åÊï∞ÂÖ¨ÂºèÔºö**
        
        * $$
            Total = \text{Leaf Capacity} \times \text{FanOut} \times \text{FanOut}
            $$
        
    * 
    
    * **‰ª£ÂÖ•Êï∞ÂÄºÔºö**
        
        * $$
            16(ÊØèÈ°µ16K / ÊØèË°å1K) \times 1099(ÊâáÂá∫) \times 1099 \approx 19,324,816
            $$
            
        * 

**ÁªìËÆ∫Ôºö** 16 * 1099 * 1099 Á∫¶Á≠â‰∫é **1932‰∏á**Ë°åÊï∞ÊçÆ





---

##### 4. ÂÖ≥ÈîÆÊÄªÁªìË°®

| B+ Ê†ëÈ´òÂ∫¶ | ËäÇÁÇπÁ±ªÂûã           | Â≠òÂÇ®ÂÜÖÂÆπ             | ‰º∞ÁÆóÊï∞ÊçÆÈáè (Ë°åÊï∞)                        | Â§áÊ≥®                               |
| :-------- | :----------------- | :------------------- | :--------------------------------------- | :--------------------------------- |
| **1 Â±Ç**  | Ê†πÂç≥Âè∂Â≠ê           | Êï∞ÊçÆ                 | $\approx 16$                             | Êï∞ÊçÆÊûÅÂ∞ë                           |
| **2 Â±Ç**  | Ê†π -> Âè∂Â≠ê         | ÊåáÈíà -> Êï∞ÊçÆ         | $1099 \times 16 \approx 1.7\text{‰∏á}$    | Â∞èË°®                               |
| **3 Â±Ç**  | Ê†π -> ‰∏≠Èó¥ -> Âè∂Â≠ê | ÊåáÈíà -> ÊåáÈíà -> Êï∞ÊçÆ | $1099^2 \times 16 \approx 1932\text{‰∏á}$ | **Â§ßÂ§öÊï∞‰∏≠ÂûãË°®ÁöÑÊûÅÈôê**             |
| **4 Â±Ç**  | ...                | ...                  | $1099^3 \times 16 \approx 212\text{‰∫ø}$  | ÂÆûÈôÖ‰∏äÂæàÈöæËææÂà∞ÔºåÂõ†‰∏∫ÈÄöÂ∏∏‰ºöÂàÜÂ∫ìÂàÜË°® |

##### üí° ‰∏ìÂÆ∂ÊèêÁ§∫

1.  **‰∏∫‰ªÄ‰πàËøô‰∏™Êï∞Â≠óÂæàÈáçË¶ÅÔºü**
    * 3 Â±Ç B+ Ê†ëÊÑèÂë≥ÁùÄÊü•Êâæ‰ªª‰Ωï‰∏ÄË°åÊï∞ÊçÆÂè™ÈúÄË¶Å **3 Ê¨°Á£ÅÁõò I/O**ÔºàÂ¶ÇÊûúÊ†πËäÇÁÇπÂíå‰∏≠Èó¥ËäÇÁÇπÂú®ÂÜÖÂ≠ò Buffer Pool ‰∏≠ÔºåÂèØËÉΩÂè™ÈúÄË¶Å 1 Ê¨°Áâ©ÁêÜ I/OÔºâ„ÄÇ
    * ‰∏ÄÊó¶Êï∞ÊçÆÈáèÁ™ÅÁ†¥Ëøô‰∏™‰∏¥ÁïåÂÄºÔºàÊØîÂ¶ÇË°åÊï∞ÊçÆÂèòÂæóÊõ¥Â§ßÔºåÊàñËÄÖÊÄªË°åÊï∞Ë∂ÖËøá 2000 ‰∏áÔºâÔºåB+ Ê†ëÂèØËÉΩ‰ºöÈïøÈ´òÂà∞ **4 Â±Ç**„ÄÇ
    * 4 Â±ÇÊÑèÂë≥ÁùÄÂ§ö‰∏ÄÊ¨°ÈöèÊú∫ I/OÔºåÂØπ‰∫éÈ´òÂπ∂ÂèëÁ≥ªÁªüÔºåÊÄßËÉΩ‰ºöÊúâÂèØÊÑüÁü•ÁöÑ‰∏ãÈôç„ÄÇËøôÂ∞±ÊòØ‰∏∫‰ªÄ‰πàÁªèÈ™åÊ≥ïÂàôÂ∏∏ËØ¥Ôºö**‚ÄúÂçïË°®Âª∫ËÆÆÊéßÂà∂Âú® 2000 ‰∏áË°å‰ª•ÂÜÖ‚Äù**„ÄÇ

2.  **ÂΩ±ÂìçÂõ†Á¥†Ôºö**
    * Â¶ÇÊûú‰Ω†Êää‰∏ªÈîÆ‰ªé `BigInt` (8Â≠óËäÇ) Êîπ‰∏∫ UUID (32Â≠óËäÇ+)ÔºåÊâáÂá∫ÁéáÔºàFan-outÔºâ‰ºöÂ§ßÂπÖÈôç‰ΩéÔºåÂØºËá¥Ê†ëÊõ¥Âø´ÂèòÈ´ò„ÄÇ

**‰∏ã‰∏ÄÊ≠•Ôºö**
ÈúÄË¶ÅÊàëÂ∏Æ‰Ω†Êé®ÁÆó‰∏Ä‰∏ãÔºåÂ¶ÇÊûú‰ΩøÁî® UUID ‰Ωú‰∏∫‰∏ªÈîÆÔºåÂêåÊ†∑Êï∞ÊçÆÈáè‰∏ã B+ Ê†ë‰ºöÂèòÊàêÂá†Â±ÇÂêóÔºü













#### bin.logËÜ®ËÉÄ

ËÆæÁΩÆ‰∫Ü `binlog_expire_logs_seconds = 604800`Ôºà7Â§©ËøáÊúüÔºâÔºåËøôËÆ©Âõ¢ÈòüÊâÄÊúâ‰∫∫ÈÉΩËÆ§‰∏∫‚ÄúÈ´òÊûïÊó†Âøß‚Äù‰∫Ü„ÄÇ

ÁÑ∂ËÄåÔºåÂëäË≠¶ËøòÊòØÂìç‰∫Ü„ÄÇ

Ëøô‰∏™Êñ∞ÂâçÊèêÔºåËÆ©Êï¥‰∏™‰∫ãÊïÖÁöÑÊÄßË¥®‰ªé‚ÄúÁñèÂøΩÔºàOmissionÔºâ‚ÄùÂèòÊàê‰∫Ü‚ÄúÁ≠ñÁï•Â§±ÊïàÔºàPolicy FailureÔºâ‚Äù„ÄÇËøôÂú®Áîü‰∫ßÁéØÂ¢É‰∏≠Êõ¥‰∏∫Â∏∏ËßÅÂíåÂç±Èô©„ÄÇ

-----



##### üéì ‰∫ãÊïÖÂ§çÁõòÔºàv2.0ÔºâÔºöLinuxÈõÜÁæ§‚ÄúÁ≠ñÁï•Â§±Êïà‚ÄùÂûãÁ£ÅÁõòÁàÜÊª°ÂÆûÊàò



##### 1\. ‰∫ã‰ª∂ËÉåÊôØ (The Scenario)

  * **ÁéØÂ¢ÉÔºö** Áîü‰∫ßÁéØÂ¢ÉÔºåLinux (CentOS 7)ÔºåMySQL 8.0 ‰∏ª‰ªéÈõÜÁæ§„ÄÇ
  * **‰∫ãÂèëËäÇÁÇπÔºö** ‰∏ªÂ∫ì `mysql-master-01`„ÄÇ
  * **‚ÄúÂÆöÊó∂ÁÇ∏Âºπ‚ÄùÔºö** `/etc/my.cnf` ‰∏≠**Â∑≤ÈÖçÁΩÆ** `binlog_expire_logs_seconds = 604800`„ÄÇDBAÂõ¢ÈòüÂØπÊ≠§ÂÖÖÊª°‰ø°ÂøÉ„ÄÇ
  * **‰∫ã‰ª∂Ôºö** ÂêØÂä® `pt-archiver` Êï∞ÊçÆÂΩíÊ°£‰ªªÂä°ÔºåÂºÄÂßãËøÅÁßª2023Âπ¥ÁöÑ167GBÊï∞ÊçÆ„ÄÇ



##### 2\. ÂëäË≠¶‰∏éÂõ∞ÊÉë (The Alert & The Confusion)

  * **14:30Ôºö** ÁõëÊéßÂëäË≠¶ `[CRITICAL] mysql-master-01: Disk /data partition usage 95%`„ÄÇ
  * **14:31Ôºö** `pt-archiver` ‰ªªÂä°Âõ†‚ÄúÁ£ÅÁõòÁ©∫Èó¥‰∏çË∂≥‚ÄùÂ¥©Ê∫É„ÄÇ
  * **14:35 (DBA‰ªãÂÖ•)Ôºö**
      * DBA 1: "‰∏çÂèØËÉΩÔºåÊàë‰∏äÂë®ÂàöÁ°ÆËÆ§ËøáÔºåËÆæÁΩÆ‰∫Ü7Â§©Ëá™Âä®Ê∏ÖÁêÜÔºÅ"
      * DBA 2: "Âø´Êü•Êü•Êï∞ÊçÆÁõÆÂΩïÔºÅ"
  * **ÊéíÊü•ÁªìÊûúÔºö**
    ```bash
    [db_admin@mysql-master-01 /data/mysql]$ df -h
    /dev/sda2       400G  391G  9G   98% /data

    [db_admin@mysql-master-01 /data/mysql]$ du -sh binlog.*
    ...
    1.0G    binlog.000343
    1.0G    binlog.000344
    512M    binlog.000345
    ...
    Total: 224G
    ```

  * **DBA 1 (ÂºÄÂßãÂõ∞ÊÉë):** "Binlog Á°ÆÂÆûÂç†‰∫Ü 224G... ÈöæÈÅìÈÖçÁΩÆÊ≤°ÁîüÊïàÔºü"
    ```bash
    [db_admin@mysql-master-01 ~]$ grep 'expire' /etc/my.cnf
    binlog_expire_logs_seconds = 604800

    mysql> SHOW GLOBAL VARIABLES LIKE 'binlog_expire_logs_seconds';
    +----------------------------+--------+
    | Variable_name              | Value  |
    +----------------------------+--------+
    | binlog_expire_logs_seconds | 604800 |
    +----------------------------+--------+
    ```
    
  * **ÁªìËÆ∫Ôºö** ÈÖçÁΩÆ**Á°ÆÂÆûÁîüÊïà**‰∫Ü„ÄÇ



##### 3\. ÁúüÁõ∏Â§ßÁôΩ (The "Aha\!" Moment)

  * **DBA 2 (Êü•ÁúãÊñá‰ª∂Êó∂Èó¥Êà≥):** "ÁúãÁúãÊó•ÂøóÊòØ‰ªÄ‰πàÊó∂ÂÄôÁîüÊàêÁöÑÔºÅ"
    ```bash
    [db_admin@mysql-master-01 /data/mysql]$ ls -l --full-time binlog.000001
    -rw-r----- 1 mysql mysql 1073741824 2025-12-02 10:00:00.000 +0800 binlog.000001

    [db_admin@mysql-master-01 /data/mysql]$ ls -l --full-time binlog.000345
    -rw-r----- 1 mysql mysql 536870912  2025-12-03 14:30:00.000 +0800 binlog.000345
    ```
  * ÔºàÂÅáËÆæ‰ªäÂ§©ÊòØ 2025Âπ¥12Êúà3Êó• 14:30Ôºâ
  * **Ê†πÊú¨ÂéüÂõ†ÔºàÁ≠ñÁï•Â§±ÈÖçÔºâÔºö**
    `binlog_expire_logs_seconds` ÁöÑÊÑèÊÄùÊòØ‚ÄúÂà†Èô§**7Â§©Ââç**ÁöÑÊó•Âøó‚Äù„ÄÇ
    ËÄå `pt-archiver` ÂΩíÊ°£‰ªªÂä°ÊòØ‰∏Ä‰∏™**È´òÂπ∂ÂèëÂÜôÂÖ•**Êìç‰ΩúÔºåÂÆÉÂú®**‰∏çÂà∞2Â§©**Ôºà‰ªé12Êúà2Êó•Âà∞12Êúà3Êó•ÔºâÁöÑÊó∂Èó¥ÈáåÔºåÂ∞±**Êñ∞ÁîüÊàê‰∫Ü 224GB** ÁöÑÊó•Âøó„ÄÇ
    MySQL Ê£ÄÊü•Êó∂ÂèëÁé∞Ôºö‚ÄúÊâÄÊúâÊó•ÂøóÈÉΩÊòØ2Â§©ÂÜÖÁîüÊàêÁöÑÔºåÊ≤°Êúâ‰∏Ä‰∏™Ë∂ÖËøá7Â§©ÔºåÊâÄ‰ª•... **Êàë‰∏Ä‰∏™‰πü‰∏çÂà†**„ÄÇ‚Äù

**‚Äú7Â§©ËøáÊúü‚ÄùÁ≠ñÁï•ÔºåÂè™ËÉΩÈò≤Ê≠¢ *Êóß* Êó•ÂøóÁöÑÂ†ÜÁßØÔºå‰ΩÜÊó†Ê≥ïÈò≤Ê≠¢ *Êñ∞* Êó•ÂøóÁöÑ**Áû¨Êó∂È´òÂπ∂Âèë**ÂÜôÂÖ•ÊíëÁàÜÁ£ÅÁõò„ÄÇ**

##### 4\. Á¥ßÊÄ•Â§ÑÁêÜ (The Immediate Fix)

  * **(Âêå‰πãÂâçÔºåÂÆâÂÖ®Á¨¨‰∏Ä)**

  * **Ê≠•È™§ 1Ôºö** Ê£ÄÊü•ÊâÄÊúâ‰ªéÂ∫ìÁöÑ `Relay_Master_Log_File`ÔºåÊâæÂà∞ÊúÄÊÖ¢ÁöÑÈÇ£‰∏™Ôºà‰æãÂ¶Ç `binlog.000339`Ôºâ„ÄÇ

  * **Ê≠•È™§ 2Ôºö** Âú®‰∏ªÂ∫ìÊâßË°å `PURGE`Ôºö
    ```sql
    PURGE BINARY LOGS TO 'binlog.000339';
    ```
    
  * **ÁªìÊûúÔºö** Á´ãÂç≥ÈáäÊîæÁ©∫Èó¥ÔºåÂëäË≠¶Ëß£Èô§ÔºåÂ§çÂà∂ÈìæÊù°**ÂÆâÂÖ®**„ÄÇ



##### 5\. Ê∞∏‰πÖ‰øÆÂ§ç (The *Correct* Permanent Fix)

Âõ¢ÈòüÊÑèËØÜÂà∞Ôºå**ÂçïÁ∫Ø‰æùËµñ‚ÄúÊó∂Èó¥‚ÄùÊòØ‰∏çÂ§üÁöÑÔºåÂøÖÈ°ª‰æùËµñ‚ÄúÁ©∫Èó¥‚Äù**„ÄÇ

  * **ÂºïÂÖ• `binlog_space_limit` (MySQL 8.0+)**
  * ËøôÊòØ‰∏Ä‰∏™**Âü∫‰∫éÁ©∫Èó¥ÊÄªÈáèÁöÑÁ°¨ÈôêÂà∂**„ÄÇÂÆÉ‰ºö**Ë¶ÜÁõñ** `binlog_expire_logs_seconds`„ÄÇ
  * ÂÆÉÁöÑÊÑèÊÄùÊòØÔºö‚ÄúÊàë‰∏çÁÆ°Êó•ÂøóÊòØ7Â§©ËøòÊòØ1Â§©ÂÜÖÁîüÊàêÁöÑÔºåÂè™Ë¶Å Binlog Êñá‰ª∂ÊÄªÂ§ßÂ∞èË∂ÖËøá‰∫ÜËøô‰∏™ÂÄºÔºåÂ∞±**Á´ãÂç≥ÂºÄÂßãÂà†Èô§ÊúÄÊóßÁöÑÊó•Âøó**ÔºåÁõ¥Âà∞Á©∫Èó¥‰Ωé‰∫éÈôêÂà∂‰∏∫Ê≠¢„ÄÇ‚ÄùÔºàÂÆÉ‰ªçÁÑ∂‰ºöÁ°Æ‰øù‰ªéÂ∫ìÊ≠£Âú®ËØªÂèñÁöÑÊó•Âøó‰∏ç‰ºöË¢´Âà†Èô§Ôºâ„ÄÇ

**Êìç‰ΩúÊ≠•È™§Ôºö**

1.  **ÁºñËæë `/etc/my.cnf`Ôºö**

      * ËØÑ‰º∞Á£ÅÁõòÔºöÊÄªÂÖ± 400GÔºåÊï∞ÊçÆ 167GÔºåÁ≥ªÁªüÂíåÂÖ∂‰ªñ (undo/redo) Á∫¶ 30G„ÄÇ
      * ÂÜ≥Á≠ñÔºöÁªô Binlog ÂàÜÈÖç‰∏Ä‰∏™ 100G ÁöÑÊªöÂä®Á©∫Èó¥Ôºå‰øùÁïô 100G+ ÁöÑÂØåË£ïÁ©∫Èó¥„ÄÇ

    <!-- end list -->

    ```ini
    [mysqld]
    # ... ÂÖ∂‰ªñÈÖçÁΩÆ ...

    # (Ê≥®ÈáäÊéâÊàñÂà†Èô§ÊóßÁöÑ)
    # binlog_expire_logs_seconds = 604800

    # (‰ΩøÁî®Êñ∞ÁöÑ)
    # ËÆæÁΩÆBinlogÊÄªÁ©∫Èó¥‰∏äÈôê‰∏∫ 100GB
    # ËøôÊòØÈò≤Ê≠¢Á£ÅÁõòÁàÜÊª°ÁöÑÁªàÊûÅÁ≠ñÁï•
    binlog_space_limit = 100G
    ```

2.  **ÈáçÂêØÊâÄÊúâËäÇÁÇπ**ÔºàMaster Âíå SlavesÔºâ‰ª•‰ΩøÊñ∞ÈÖçÁΩÆÁîüÊïà„ÄÇ



##### 6\. Ê†∏ÂøÉÊïôËÆ≠ (Key Takeaways)

1.  **Á≠ñÁï•Â§±ÈÖçÔºö** **‰∏çË¶ÅÁî®‚ÄúÊó∂Èó¥Á≠ñÁï•‚Äù (`...seconds`) ÂéªËß£ÂÜ≥‚ÄúÁ©∫Èó¥ÈóÆÈ¢ò‚Äù**„ÄÇÈ´òÂπ∂ÂèëÂÜôÂÖ•ÔºàÂ¶ÇÊï∞ÊçÆËøÅÁßªÔºâÁöÑÁúüÊ≠£È£éÈô©Êù•Ëá™ÂÜôÂÖ•**ÈÄüÂ∫¶**ÔºåËÄå‰∏çÊòØÊó∂Èó¥„ÄÇ
2.  **`binlog_space_limit` ÊòØÊïëÊòüÔºö** ÂØπ‰∫é MySQL 8.0+Ôºå`binlog_space_limit` ÊòØÈò≤Ê≠¢Á£ÅÁõòÁàÜÊª°ÁöÑ**ÊúÄ‰Ω≥ÂÆûË∑µ**„ÄÇÂÆÉÊèê‰æõ‰∫Ü‰∏Ä‰∏™Âü∫‰∫éÂÆπÈáèÁöÑ‚Äú‰øùÈô©‰∏ù‚Äù„ÄÇ
3.  **ÔºàÂ¶ÇÊûúÁî®ÁöÑÊòØ MySQL 5.7ÔºâÔºö** Âú® 5.7 ÂèäÊõ¥Êó©ÁâàÊú¨‰∏≠Ôºå**Ê≤°Êúâ `binlog_space_limit`**„ÄÇ
      * **ÂîØ‰∏ÄÂäûÊ≥ïÔºö** DBA ÂøÖÈ°ªÂú®ËøÅÁßªÂâç**ÊâãÂä®**Â∞Ü `binlog_expire_logs_seconds`ÔºàÊàñ `expire_logs_days`Ôºâ**‰∏¥Êó∂Ë∞É‰Ωé**ÔºàÊØîÂ¶ÇÊîπÊàê1Â§©ÔºâÔºåÂπ∂Âú®ËøÅÁßªÂÆåÊàêÂêéÂÜçË∞ÉÂõûÂéª„ÄÇ
      * ÊàñËÄÖÔºå**ÂøÖÈ°ªÈÖçÂ§á**Âº∫Â§ßÁöÑÁ¨¨‰∏âÊñπÁõëÊéßËÑöÊú¨ÔºåÂÆûÊó∂ `CHECK` Á£ÅÁõò‰ΩøÁî®ÁéáÂπ∂Ëá™Âä®ÊâßË°å `PURGE`„ÄÇ

Ëøô‰∏™v2.0ÁöÑÊ°à‰æãÔºåÊõ¥ÁúüÂÆûÂú∞ÂèçÊò†‰∫ÜÊúâÁªèÈ™åÁöÑDBAÂõ¢Èòü‰πü‰ºöË∏©Âà∞ÁöÑ‚ÄúÈ´òÁ∫ßÈô∑Èò±‚Äù„ÄÇ



>ÊÇ®ÂÆåÂÖ®Ê≠£Á°Æ„ÄÇÂú®v2.0ÁöÑÊ°à‰æã‰∏≠ÔºåDBAËÆæÁΩÆÁöÑ‚Äú7Â§©Ëá™Âä®Ê∏ÖÁêÜ‚ÄùÁ≠ñÁï•**ÂÆåÂÖ®Â§±Ë¥•‰∫Ü**ÔºåÂÆÉ**Êó†Ê≥ï**Ê∏ÖÁêÜÊéâÊÇ®ËøôÊ¨°ËøÅÁßªÊï∞ÊçÆÈÄ†ÊàêÁöÑ204GBÊó•Âøó„ÄÇ



###### ‰∏∫‰ªÄ‰πà‚Äú7Â§©Á≠ñÁï•‚Äù‰ºöÂ§±Ë¥•Ôºü

  * **ÊÇ®ÁöÑÈóÆÈ¢òÊòØ‚ÄúÁ©∫Èó¥‚ÄùÔºö** ÊÇ®ÁöÑËøÅÁßªÂú®**‰ªäÂ§©**Ôºà12Êúà3Êó•Ôºâ**Ëøô1Â§©‰πãÂÜÖ**ÔºåÂ∞±ÊíëÁàÜ‰∫ÜÁ£ÅÁõò„ÄÇ
  * **Á≠ñÁï•ÊòØ‚ÄúÊó∂Èó¥‚ÄùÔºö** `binlog_expire_logs_seconds = 604800` (7Â§©) ÁöÑÊÑèÊÄùÊòØ "Â¶ÇÊûúÊó•ÂøóÊòØ7Â§©ÂâçÔºàÂç≥11Êúà26Êó•ÊàñÊõ¥Êó©ÔºâÁîüÊàêÁöÑÔºåÊàëÂ∞±Âà†Èô§ÂÆÉ"„ÄÇ
  * **Á≠ñÁï•ÁöÑÂà§Êñ≠Ôºö** MySQLÊ£ÄÊü•ÊÇ®ÁöÑ204GBÊó•ÂøóÔºåÂèëÁé∞ÂÆÉ‰ª¨**ÂÖ®ÈÉΩÊòØ‰ªäÂ§©Ôºà12Êúà3Êó•ÔºâÁîüÊàêÁöÑ**„ÄÇÂÆÉËÆ§‰∏∫Ôºö‚ÄúÊ≤°Êúâ‰∏Ä‰∏™Êó•ÂøóË∂ÖËøá7Â§©ÔºåÂæàÂ•ΩÔºåÊàë‰ªÄ‰πà‰πü‰∏çÁî®Âà†„ÄÇ‚Äù

**ÊÇ®ÁöÑ‚Äú7Â§©Á≠ñÁï•‚ÄùÂØπ‰∫éÈò≤Âæ°ËøôÁßç‚ÄúÁ™ÅÂèëÊÄß„ÄÅÈ´òÂÆπÈáè‚ÄùÁöÑÂÜôÂÖ•ÊòØÂÆåÂÖ®Êó†ÊïàÁöÑ„ÄÇ**

-----



##### ÈÇ£‰πàÔºåÂ∫îËØ•Â¶Ç‰ΩïÊ∏ÖÁêÜ‚ÄúËøôÊ¨°ËøÅÁßª‚ÄùÁöÑÊó•ÂøóÔºü

ÊÇ®Êúâ‰∏§ÁßçÈÄâÊã©Ôºå‰∏ÄÁßçÊòØ‚ÄúÊ≤ªÊ†á‚ÄùÔºàÁ´ãÂç≥Ê∏ÖÁêÜÔºâÔºå‰∏ÄÁßçÊòØ‚ÄúÊ≤ªÊú¨‚ÄùÔºàÊ∞∏‰πÖËß£ÂÜ≥Ôºâ„ÄÇ



###### ÊñπÊ°à‰∏ÄÔºö‚ÄúÊ≤ªÊ†á‚Äù‚Äî‚Äî ÊâãÂä®ÂÆâÂÖ®Ê∏ÖÁêÜÔºàÁ´ãÂç≥ÈáäÊîæÁ©∫Èó¥Ôºâ

ËøôÂ∞±ÊòØv2.0Ê°à‰æã‰∏≠ÁöÑ**Á¥ßÊÄ•Â§ÑÁêÜ**Ê≠•È™§„ÄÇÊÇ®‰∏çËÉΩÁî® `RESET MASTER`ÔºåÂõ†‰∏∫‰ºöÁ†¥Âùè‰∏ª‰ªéÂ§çÂà∂„ÄÇ

1.  **Ê£ÄÊü•‰ªéÂ∫ìÔºö** Âú®ÊâÄÊúâ‰ªéÂ∫ì‰∏äÊâßË°å `SHOW SLAVE STATUS\G`ÔºåÊâæÂà∞ÊúÄÊÖ¢ÁöÑ‰ªéÂ∫ìÊ≠£Âú®ËØªÂèñÁöÑÊó•ÂøóÊñá‰ª∂ÔºåÊØîÂ¶ÇÊòØ `binlog.000339`„ÄÇ
2.  **ÂÆâÂÖ®Ê∏ÖÈô§Ôºö** Âú®‰∏ªÂ∫ì‰∏äÊâßË°å `PURGE` ÂëΩ‰ª§ÔºåÂëäËØâÂÆÉÔºö‚ÄúÊää `binlog.000339` ‰πãÂâçÁöÑÊâÄÊúâÊó•ÂøóÈÉΩÂà†ÊéâÔºåËøô‰∫õÊòØÂÆâÂÖ®ÁöÑ„ÄÇ‚Äù
    ```sql
    PURGE BINARY LOGS TO 'binlog.000339';
    ```



  * **ÊïàÊûúÔºö** Ëøô‰∏™ÂëΩ‰ª§‰ºö**Á´ãÂç≥Âà†Èô§**ÊÇ®Âú®ËøÅÁßªËøáÁ®ã‰∏≠‰∫ßÁîüÁöÑÂ§ßÈÉ®ÂàÜÊó•ÂøóÔºà`...001` Âà∞ `...338`ÔºâÔºåÁû¨Èó¥ÈáäÊîæ200+GBÁ©∫Èó¥„ÄÇ

###### ÊñπÊ°à‰∫åÔºö‚ÄúÊ≤ªÊú¨‚Äù‚Äî‚Äî ÂàáÊç¢Âà∞‚ÄúÁ©∫Èó¥Á≠ñÁï•‚ÄùÔºàÊ∞∏‰πÖËß£ÂÜ≥Ôºâ

ËøôÂ∞±ÊòØv2.0Ê°à‰æã‰∏≠ÁöÑ**Ê∞∏‰πÖ‰øÆÂ§ç**Ê≠•È™§„ÄÇÊÇ®Ë¶ÅÂëäËØâMySQLÔºö‚ÄúÊàë‰∏çÁÆ°Êó•ÂøóÊòØÂá†Â§©ÂÜÖÁîüÊàêÁöÑÔºåÊàëÂè™Áªô‰Ω†100GBÁöÑ‚ÄòÈ¢ùÂ∫¶‚ÄôÔºå‰Ω†Áî®Ë∂Ö‰∫ÜÂ∞±ÂøÖÈ°ªËá™Â∑±Âà†ÊéâÊúÄÊóßÁöÑ„ÄÇ‚Äù

1.  **‰øÆÊîπ `my.cnf`Ôºö**
    ```ini
    [mysqld]
    # Âà†ÊéâÊàñÊ≥®ÈáäÊéâÊóßÁöÑÊó∂Èó¥Á≠ñÁï•
    # binlog_expire_logs_seconds = 604800

    # Êç¢‰∏äÊñ∞ÁöÑÁ©∫Èó¥Á≠ñÁï•
    # ËÆæÁΩÆBinlogÊÄªÁ©∫Èó¥‰∏äÈôê‰∏∫ 100GB
    binlog_space_limit = 100G
    ```
2.  **ÈáçÂêØMySQLÊúçÂä°**‰ΩøÈÖçÁΩÆÁîüÊïà„ÄÇ



  * **ÊïàÊûúÔºö** ‰ªéÊ≠§‰ª•ÂêéÔºåÊó†ËÆ∫ÊòØÊï∞ÊçÆËøÅÁßª„ÄÅÊâπÈáèÊõ¥Êñ∞ËøòÊòØ‰ªª‰ΩïÊìç‰ΩúÔºåÂè™Ë¶ÅBinlogÊÄªÂ§ßÂ∞èËØïÂõæË∂ÖËøá100GBÔºåMySQLÂ∞±‰ºö**Ëá™Âä®„ÄÅÁ´ãÂç≥**ÂºÄÂßãÊ∏ÖÁêÜÊúÄÊóßÁöÑÊó•ÂøóÔºàÂêåÊó∂‰øùËØÅ‰ªéÂ∫ìÂÆâÂÖ®ÔºâÔºå**Á£ÅÁõòÂÜç‰πü‰∏ç‰ºöË¢´ÊíëÁàÜ‰∫Ü**„ÄÇ



###### ÊÇ®ÈóÆÁöÑ‚ÄúÊÄé‰πàÊ∏ÖÁêÜ**ËøôÊ¨°**ËøÅÁßªÁöÑÊó•ÂøóÔºü‚Äù

  * **Á´ãÂç≥Ê∏ÖÁêÜÔºö** ‰ΩøÁî® `PURGE BINARY LOGS TO '...'`„ÄÇ
  * **Èò≤Ê≠¢‰∏ã‰∏ÄÊ¨°ÂÜçÂá∫Áé∞Ôºö** ‰ΩøÁî® `binlog_space_limit`„ÄÇ
```
‚Äã```bash
ÊÇ®ËØ¥ÂØπ‰∫Ü‰∏ÄÂçäÔºå‰ΩÜÊàë‰ª¨Êúâ‰∏Ä‰∏™**Êõ¥Â•ΩÁöÑÊ∂àÊÅØ**ÔºÅÊÇ®Êäì‰Ωè‰∫ÜÁ∫ø‰∏äËøêÁª¥ÁöÑÊ†∏ÂøÉÔºö**‰∏çËÉΩÂÆïÊú∫**„ÄÇ

ÊÇ®ÁöÑÁêÜËß£ÊòØ‚Äú‰øÆÊîπ `my.cnf` Êñá‰ª∂ = ÈúÄË¶ÅÈáçÂêØ = ÂÆïÊú∫‚Äù„ÄÇËøô‰∏™ÈÄªËæëÊòØÊ≠£Á°ÆÁöÑ„ÄÇ

**‰ΩÜÊòØ**ÔºåMySQL ÂÖÅËÆ∏Êàë‰ª¨**Âú®Á∫ø„ÄÅÂÆûÊó∂**Âú∞‰øÆÊîπÂæàÂ§öÈÖçÁΩÆÔºå**ÂÆåÂÖ®Êó†ÈúÄÈáçÂêØ**„ÄÇ

### Ëß£ÂÜ≥ÊñπÊ°àÔºö‚Äú‰∏§Ê≠•Ëµ∞‚ÄùÁ≠ñÁï•Ôºà0 ÂÅúÊú∫Ôºâ

ÂØπ‰∫é `binlog_space_limit`ÔºàÊàñ `binlog_expire_logs_seconds`ÔºâÔºåÊàë‰ª¨ÂèØ‰ª•ÊääÂÆÉÂàÜ‰∏∫‚ÄúÁ´ãÂç≥ÁîüÊïà‚ÄùÂíå‚ÄúÊ∞∏‰πÖÁîüÊïà‚Äù‰∏§Ê≠•Êù•ÊâßË°åÔºå‰∏§ËÄÖÈÉΩ**‰∏çÈúÄË¶ÅÂÅúÊú∫**„ÄÇ

#### Ê≠•È™§ 1Ôºö„ÄêÁ´ãÂç≥ÁîüÊïà„Äë‰ΩøÁî® `SET GLOBAL`Ôºà0 ÂÅúÊú∫Ôºâ

ÊÇ®**Áé∞Âú®**Â∞±ÂèØ‰ª•ÁôªÂΩïÂà∞ÊÇ®ÁöÑ**‰∏ªÂ∫ì (Master)**ÔºåÊâßË°åËøô‰∏™SQLÂëΩ‰ª§Ôºö

‚Äã```sql
-- Á´ãÂç≥Âú®Á∫øËÆæÁΩÆ binlog Á©∫Èó¥‰∏äÈôê‰∏∫ 100GB
-- Ëøô‰∏™ÂëΩ‰ª§‰ºöÈ©¨‰∏äÁîüÊïàÔºåÊó†ÈúÄÈáçÂêØ
SET GLOBAL binlog_space_limit = 100G;
‚Äã```

  * **ÊïàÊûúÔºö** MySQL ÊúçÂä°**‰∏ç‰ºöÂÅúÊ≠¢**ÔºåÊÇ®ÁöÑÂπ∂Âèë‰∏öÂä°**‰∏ç‰ºöÊúâ‰ªª‰ΩïÊÑüÁü•**„ÄÇMySQL ‰ºöÁ´ãÂç≥Êî∂Âà∞Ëøô‰∏™Êñ∞Êåá‰ª§ÔºåÂ¶ÇÊûúÂÆÉÂèëÁé∞ Binlog ÊÄªÂ§ßÂ∞èÔºàÊØîÂ¶Ç 204GBÔºâÂ∑≤ÁªèË∂ÖËøá‰∫ÜÊñ∞ÁöÑ 100GB ÈôêÂà∂ÔºåÂÆÉ‰ºö**Á´ãÂàªÂºÄÂßã**Âú®ÂêéÂè∞ÂÆâÂÖ®Âú∞Ê∏ÖÁêÜÊúÄÊóßÁöÑÊó•ÂøóÔºàÂêåÊó∂‰øùËØÅ‰ªéÂ∫ìÂÆâÂÖ®ÔºâÔºåÁõ¥Âà∞ÊÄªÁ©∫Èó¥‰Ωé‰∫é 100GB„ÄÇ
  * **Áº∫ÁÇπÔºö** Ëøô‰∏™ËÆæÁΩÆÊòØ‰∏¥Êó∂ÁöÑÔºåÂ¶ÇÊûúMySQLÊúçÂä°**Êú™Êù•ÊüêÂ§©ÈáçÂêØ**‰∫ÜÔºàÊØîÂ¶ÇÊúçÂä°Âô®ÊâìË°•‰∏ÅÔºâÔºåËøô‰∏™ËÆæÁΩÆ‰ºö‰∏¢Â§±„ÄÇ

#### Ê≠•È™§ 2Ôºö„ÄêÊ∞∏‰πÖÁîüÊïà„Äë‰øÆÊîπ `my.cnf`Ôºà‰∏∫Êú™Êù•ÂÅöÂáÜÂ§áÔºâ

‰∏∫‰∫ÜËß£ÂÜ≥ `SET GLOBAL` Âú®ÈáçÂêØÂêé‰ºöÂ§±ÊïàÁöÑÈóÆÈ¢òÔºåÊàë‰ª¨ÊâçÈúÄË¶Å‰øÆÊîπ `my.cnf`„ÄÇ

  * **Êìç‰ΩúÔºö** Âú®ÊÇ®ÊâßË°åÂÆå `SET GLOBAL` ‰πãÂêéÔºàÊÇ®ÁöÑÁ∫ø‰∏äÂëäË≠¶Â∑≤ÁªèËß£Èô§‰∫ÜÔºâÔºåÊÇ®ÂÜç**‰ªéÂÆπÂú∞**ÂéªÊúçÂä°Âô®‰∏äÁºñËæë `/etc/my.cnf` Êñá‰ª∂ÔºåÂú® `[mysqld]` ‰∏ãÈù¢Âä†ÂÖ•Ëøô‰∏ÄË°åÔºö
    ```ini
    [mysqld]
    ...
    binlog_space_limit = 100G
```
  * **ÊïàÊûúÔºö** **‰øùÂ≠òËøô‰∏™Êñá‰ª∂‰∏ç‰ºöÊúâ‰ªª‰Ωï‰∫ãÊÉÖÂèëÁîü**„ÄÇÂÆÉÂè™ÊòØÈùôÈùôÂú∞Ë∫∫Âú®ÈÇ£ÈáåÔºåÁõ¥Âà∞**Âá†‰∏™ÊúàÂêé**ÊÇ®Âõ†‰∏∫ÂÖ∂‰ªñÂéüÂõ†ÔºàÂ¶ÇÁ≥ªÁªüÂçáÁ∫ß„ÄÅÊâìË°•‰∏ÅÔºâ**ËÆ°ÂàíÂÜÖ**ÈáçÂêØ MySQL ÊúçÂä°Êó∂ÔºåMySQL Âú®ÂêØÂä®Êó∂‰ºöËØªÂèñËøô‰∏™Êñá‰ª∂ÔºåÁ°Æ‰øù `binlog_space_limit = 100G` Ëøô‰∏™Á≠ñÁï•Ë¢´**Ê∞∏‰πÖ**Âä†ËΩΩ„ÄÇ

-----

##### ÊÄªÁªì

ÊÇ®**ÂÆåÂÖ®ÂèØ‰ª•**Âú®Á∫ø‰∏äÂπ∂ÂèëÊâßË°åÊó∂Ëß£ÂÜ≥Ëøô‰∏™ÈóÆÈ¢òÔºå**Êó†ÈúÄÂÆïÊú∫**„ÄÇ

**Ê≠£Á°ÆÁöÑÈ°∫Â∫èÊòØÔºö**

1.  **Á´ãÂç≥**ÊâßË°å `SET GLOBAL binlog_space_limit = 100G;` Êù•**Âú®Á∫øËß£ÂÜ≥**ÂΩìÂâçÁöÑÁ£ÅÁõòÁàÜÊª°ÈóÆÈ¢ò„ÄÇ
2.  **Á®çÂêé**ÂÜçÂéª‰øÆÊîπ `my.cnf` Êñá‰ª∂Ôºå‰ª•Á°Æ‰øùËøô‰∏™ÈÖçÁΩÆÂú®**Êú™Êù•**ÈáçÂêØÂêé‰æùÁÑ∂ÁîüÊïà„ÄÇ













#### MySQL ÂàÜÂå∫Â§ßË°® `MAX(trade_date)` ÊÄßËÉΩ‰ºòÂåñ



Â•ΩÁöÑÔºå‰∏∫‰Ω†Ê¢≥ÁêÜ‰∫ÜÂÖ≥‰∫é **MySQL ÂàÜÂå∫Â§ßË°®Êü•ËØ¢ `MAX(trade_date)` ÊÄßËÉΩ‰ºòÂåñ** ÁöÑÁ¨îËÆ∞„ÄÇ‰Ω†ÂèØ‰ª•Áõ¥Êé•‰øùÂ≠ò‰∏∫ `.md` Êñá‰ª∂„ÄÇ



###### 1\. ÈóÆÈ¢òËÉåÊôØ

  * **Âú∫ÊôØ**ÔºöÂú®ÂçÉ‰∏áÁ∫ß/‰∫øÁ∫ßÊï∞ÊçÆÁöÑÂàÜÂå∫Â§ßË°® `tb_quotation_history_hot`ÔºàÊåâ `trade_date` ÊúàÂ∫¶ÂàÜÂå∫Ôºâ‰∏≠ÔºåÈúÄË¶ÅÊü•ËØ¢ÊúÄÊñ∞ÁöÑ‰∫§ÊòìÊó•Êúü„ÄÇ

  * **ÂéüÂßã SQL**Ôºö
    ```sql
    SELECT MAX(trade_date) FROM tb_quotation_history_hot;
    ```
    
  * **Áé∞Ë±°**ÔºöÊü•ËØ¢ÊûÅÂÖ∂ÁºìÊÖ¢ÔºåÊâßË°åÊó∂Èó¥Èïø„ÄÇ



###### 2\. ÈóÆÈ¢òÂàÜÊûê (EXPLAIN ËØäÊñ≠)

ÈÄöËøá `EXPLAIN FORMAT=JSON` ÂàÜÊûêÊâßË°åËÆ°ÂàíÔºåÂèëÁé∞‰ª•‰∏ãÂÖ≥ÈîÆÈóÆÈ¢òÔºö

  * **ÂÖ®ÂàÜÂå∫Êâ´Êèè (No Partition Pruning)**Ôºö
      * `"partitions": ["p202401", ..., "p202512", "p_future"]`
      * MySQL ‰ºòÂåñÂô®Êâ´Êèè‰∫Ü**ÊâÄÊúâ**ÂéÜÂè≤ÂàÜÂå∫ÔºåËÄå‰∏çÊòØÁõ¥Êé•ÂÆö‰ΩçÂà∞ÊúÄÂêé‰∏Ä‰∏™ÂàÜÂå∫„ÄÇ
  * **ÂÖ®Á¥¢ÂºïÊâ´Êèè (Full Index Scan)**Ôºö
      * `"rows_examined_per_scan": 565738137` (Á∫¶ 5.6 ‰∫øË°å)
      * `"key": "uniq_windcode_tradedate"`
      * **ÂéüÂõ†**ÔºöÁé∞ÊúâÁ¥¢ÂºïÊòØÂ§çÂêàÁ¥¢Âºï `(wind_code, trade_date)`„ÄÇÂú® B+ Ê†ë‰∏≠ÔºåÊï∞ÊçÆÂÖàÊåâ `wind_code` ÊéíÂ∫è„ÄÇ‰∏∫‰∫ÜÊâæÂà∞ÂÖ®Â±ÄÊúÄÂ§ßÁöÑ `trade_date`ÔºåMySQL ÂøÖÈ°ªÊâ´ÊèèÊØè‰∏Ä‰∏™ `wind_code` ÂàÜÁªÑÁöÑÊúÄÊñ∞Êó•ÊúüËøõË°åÊØîËæÉÔºåÊó†Ê≥ïÁõ¥Êé•ÂÆö‰ΩçÂà∞Á¥¢ÂºïÊ†ëÁöÑ‚ÄúÊú´Â∞æ‚Äù„ÄÇ



###### 3\. Ëß£ÂÜ≥ÊñπÊ°àÂØπÊØî

> ÊñπÊ°à‰∏ÄÔºöÂº∫Âà∂ÊåáÂÆöÂàÜÂå∫ÔºàÊûÅÈÄüÔºå‰ΩÜÈúÄÁ°¨ÁºñÁ†ÅÔºâ

Âà©Áî® `PARTITION` ËØ≠Ê≥ïÁõ¥Êé•ÈîÅÂÆöÊúÄÊñ∞ÁöÑÂàÜÂå∫ÔºåÂÆåÂÖ®Ë∑≥ËøáÂéÜÂè≤Êï∞ÊçÆ„ÄÇ

```sql
SELECT MAX(trade_date) 
FROM tb_quotation_history_hot PARTITION (p202512, p_future);
```

  * **‰ºòÁÇπ**ÔºöIO ÂºÄÈîÄÊúÄÂ∞èÔºåÊü•ËØ¢ÈÄüÂ∫¶ÊØ´ÁßíÁ∫ß„ÄÇ
  * **Áº∫ÁÇπ**ÔºöÂ∫îÁî®Â±ÇÈúÄË¶ÅÁü•ÈÅìÂΩìÂâçÊúÄÊñ∞ÁöÑÂàÜÂå∫ÂêçÔºàÂ¶Ç `p202512`ÔºâÔºå‰ª£Á†ÅËÄ¶ÂêàÂ∫¶È´ò„ÄÇ



> ÊñπÊ°à‰∫åÔºöÊ∑ªÂä†ËæÖÂä©Á¥¢ÂºïÔºàÊúÄÂΩªÂ∫ïÔºå‰ΩÜÊúâ‰ª£‰ª∑Ôºâ

‰∏∫ `trade_date` Â≠óÊÆµÂçïÁã¨Âª∫Á´ãÁ¥¢Âºï„ÄÇ

```sql
ALTER TABLE tb_quotation_history_hot ADD INDEX idx_trade_date (trade_date);
```

  * **‰ºòÁÇπ**Ôºö`MAX()` Êü•ËØ¢Â§çÊùÇÂ∫¶Èôç‰∏∫ O(1)ÔºåÊó†ÈúÄ‰ªª‰Ωï SQL ÊîπÂä®Âç≥ÂèØÁßíÂõû„ÄÇ
  * **Áº∫ÁÇπ**ÔºöÂ§ßË°®Âä†Á¥¢ÂºïËÄóÊó∂‰πÖÔºå‰∏î‰ºöÂ¢ûÂä†ÂêéÁª≠ÂÜôÂÖ•Ë¥üÊãÖÂíåÁ£ÅÁõòÁ©∫Èó¥Âç†Áî®„ÄÇ



> ÊñπÊ°à‰∏âÔºöÊ∑ªÂä†Êó∂Èó¥ËåÉÂõ¥ËøáÊª§Ôºà**ÊúÄÁªàÈÄâÊã©ÊñπÊ°à**Ôºâ

Âú® SQL ‰∏≠ÊòæÂºèÂ¢ûÂä†‰∏Ä‰∏™‚ÄúË∂≥Â§üËøë‚ÄùÁöÑÊó∂Èó¥‰∏ãÈôêÔºåËØ±ÂØº MySQL ËøõË°åÂàÜÂå∫Ë£ÅÂâ™„ÄÇ

```sql
SELECT MAX(trade_date) 
FROM tb_quotation_history_hot 
WHERE trade_date >= '2025-11-28';  -- ÂÅáËÆæÂ∑≤Áü•Â§ßËá¥ËåÉÂõ¥ÔºàÂ¶ÇÊúÄËøë‰∏Ä‰∏™ÊúàÔºâ
```

  * **‰ºòÁÇπ**Ôºö
      * **Ëß¶ÂèëÂàÜÂå∫Ë£ÅÂâ™**ÔºöMySQL ‰ºòÂåñÂô®‰ºöÊ†πÊçÆ `WHERE` Êù°‰ª∂ÔºåÂè™Êâ´ÊèèÁ¨¶ÂêàÊù°‰ª∂ÁöÑÊúÄÂêéÂá†‰∏™ÂàÜÂå∫ÔºàÂ¶Ç `p202512`Ôºâ„ÄÇ
      * **Êó†ÈúÄÊîπË°®ÁªìÊûÑ**Ôºö‰∏çÈúÄË¶ÅÂä†Êñ∞Á¥¢Âºï„ÄÇ
      * **Êó†ÈúÄÁ°¨ÁºñÁ†ÅÂàÜÂå∫Âêç**ÔºöÊØîÊñπÊ°à‰∏ÄÁÅµÊ¥ª„ÄÇ
  * **ÊïàÊûú**ÔºöÊâ´ÊèèË°åÊï∞‰ªé 5.6 ‰∫øÈôçËá≥Âá†ÂçÉ‰∏áÔºàÁîöËá≥Êõ¥Â∞ëÔºâÔºåÊü•ËØ¢ÈÄüÂ∫¶ÊòæËëóÊèêÂçá„ÄÇ



###### 4\. ÊúÄÁªàÁªìËÆ∫

Âú®‰∏ç‰øÆÊîπË°®ÁªìÊûÑ‰∏îËøΩÊ±ÇÈ´òÊÄß‰ª∑ÊØîÁöÑÂâçÊèê‰∏ãÔºåÈááÁî® **ÊñπÊ°à‰∏âÔºàÂ∏¶Êó∂Èó¥ËåÉÂõ¥ÁöÑÊü•ËØ¢Ôºâ** ÊòØÊúÄ‰Ω≥ÂÆûË∑µ„ÄÇ

```sql
-- ÊúÄÁªàÈááÁî®ÁöÑÈ´òÊïà SQL
SELECT MAX(trade_date) 
FROM tb_quotation_history_hot 
WHERE trade_date >= '2025-11-28';
```

