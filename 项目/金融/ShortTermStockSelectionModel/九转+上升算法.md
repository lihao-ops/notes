反转信号
===





核心算法
---



### 一、九转序列





> 九转序列算法

```java
[#1~#14] = 连续递减的14个交易日的收盘价

//N赋值:到最后交易的周期
N:=CURRBARSCOUNT;

//B赋值:收盘价&lt4日前的收盘价
B:=C&ltREF(C,4);

//T1赋值: 条件连续成立次数
T1:= BARSLASTCOUNT(B);

//A_B1赋值:(T1>9) AND T1关于9的模=1
A_B1:=(T1>9) AND MOD(T1,9)=1;

//A_B2赋值:(T1>9) AND T1关于9的模=2
A_B2:=(T1>9) AND MOD(T1,9)=2;

//A_B8赋值:(T1>9) AND T1关于9的模=8
A_B8:=(T1>9) AND MOD(T1,9)=8;

//A_B9赋值:(T1>9) AND T1关于9的模=0
A_B9:=(T1>9) AND MOD(T1,9)=0;

//B1赋值:(N=6 AND 5日后的(未作平滑处理)统计6日中满足B的天数=6) OR (N=7 AND 6日后的(未作平滑处理)统计7日中满足B的天数=7) OR (N=8 AND 7日后的(未作平滑处理)统计8日中满足B的天数=8) OR (N>=9 AND 8日后的(未作平滑处理)统计9日中满足B的天数=9)
B1:=(N=6 AND REFXV(COUNT(B,6),5)=6) OR (N=7 AND REFXV(COUNT(B,7),6)=7) OR (N=8 AND REFXV(COUNT(B,8),7)=8) OR (N>=9 AND REFXV(COUNT(B,9),8)=9);
//当满足条件B1AND(1日前的B=0ORA_B1)时,在最低价位置书写数字,画洋红色
DRAWNUMBER(B1 AND (REF(B,1)=0 OR A_B1),L,1),COLORMAGENTA;


//赋值:(N=5 AND 4日后的(未作平滑处理)统计6日中满足B的天数=6) OR (N=6 AND 5日后的(未作平滑处理)统计7日中满足B的天数=7) OR (N=7 AND 6日后的(未作平滑处理)统计8日中满足B的天数=8) OR (N>=8 AND 7日后的(未作平滑处理)统计9日中满足B的天数=9)
B2:=(N=5 AND REFXV(COUNT(B,6),4)=6) OR (N=6 AND REFXV(COUNT(B,7),5)=7) OR (N=7 AND REFXV(COUNT(B,8),6)=8) OR (N>=8 AND REFXV(COUNT(B,9),7)=9);
//当满足条件B2AND(2日前的B=0ORA_B2)时,在最低价位置书写数字,画洋红色
DRAWNUMBER(B2 AND(REF(B,2)=0 OR A_B2),L,2),COLORMAGENTA;


//B8赋值:(N=1 AND 统计8日中满足B的天数=8) OR (N>=2 AND 1日后的(未作平滑处理)统计9日中满足B的天数=9)
//#8 &lt #12 and #7 &lt #11 and #6 &lt #10 and #5 &lt #9 and #4 &lt #8 and #3 &lt #7 and #2 &lt #6 and #1 &lt #5 and (#9>=#13)
B8:=(N=1 AND COUNT(B,8)=8) OR (N>=2 AND REFXV(COUNT(B,9),1)=9);
//当满足条件B8AND(8日前的B=0ORA_B8)时,在最低价位置书写数字,画洋红色
DRAWNUMBER(B8 AND (REF(B,8)=0 OR A_B8),L,8),COLORMAGENTA;

//B9赋值:(N>=1 AND 统计9日中满足B的天数=9)
//#9 &lt #13 and #8 &lt #12 and #7 &lt #11 and #6 &lt #10 and #5 &lt #9 and #4 &lt #8 and #3 &lt #7 and #2 &lt #6 and #1 &lt #5 and (#10>=#14)
B9:=(N>=1 AND COUNT(B,9)=9);
//当满足条件B9AND(9日前的B=0ORA_B9)时,在最低价位置书写数字,画棕色
DRAWNUMBER(B9 AND (REF(B,9)=0 OR A_B9),L,9),COLORBROWN;




//S赋值:收盘价>4日前的收盘价
S:=C>REF(C,4);

//T2赋值: 条件连续成立次数
T2:= BARSLASTCOUNT(S);

//A_S1赋值:(T2>9) AND T2关于9的模=1
A_S1:=(T2>9) AND MOD(T2,9)=1;

//A_S2赋值:(T2>9) AND T2关于9的模=2
A_S2:=(T2>9) AND MOD(T2,9)=2;

//A_S8赋值:(T2>9) AND T2关于9的模=8
A_S8:=(T2>9) AND MOD(T2,9)=8;

//A_S9赋值:(T2>9) AND T2关于9的模=0
A_S9:=(T2>9) AND MOD(T2,9)=0;

//S1赋值:(N=6 AND 5日后的(未作平滑处理)统计6日中满足S的天数=6) OR (N=7 AND 6日后的(未作平滑处理)统计7日中满足S的天数=7) OR (N=8 AND 7日后的(未作平滑处理)统计8日中满足S的天数=8) OR (N>=9 AND 8日后的(未作平滑处理)统计9日中满足S的天数=9)
S1:=(N=6 AND REFXV(COUNT(S,6),5)=6) OR (N=7 AND REFXV(COUNT(S,7),6)=7) OR (N=8 AND REFXV(COUNT(S,8),7)=8) OR (N>=9 AND REFXV(COUNT(S,9),8)=9);
//当满足条件S1AND(1日前的S=0ORA_S1)时,在最高价位置书写数字,画洋红色,显示在位置之上
DRAWNUMBER(S1 AND (REF(S,1)=0 OR A_S1),H,1),COLORMAGENTA,DRAWABOVE;

//S2赋值:(N=5 AND 4日后的(未作平滑处理)统计6日中满足S的天数=6) OR (N=6 AND 5日后的(未作平滑处理)统计7日中满足S的天数=7) OR (N=7 AND 6日后的(未作平滑处理)统计8日中满足S的天数=8) OR (N>=8 AND 7日后的(未作平滑处理)统计9日中满足S的天数=9)
S2:=(N=5 AND REFXV(COUNT(S,6),4)=6) OR (N=6 AND REFXV(COUNT(S,7),5)=7) OR (N=7 AND REFXV(COUNT(S,8),6)=8) OR (N>=8 AND REFXV(COUNT(S,9),7)=9);
//当满足条件S2AND(2日前的S=0ORA_S2)时,在最高价位置书写数字,画洋红色,显示在位置之上
DRAWNUMBER(S2 AND (REF(S,2)=0 OR A_S2),H,2),COLORMAGENTA,DRAWABOVE;


//S8赋值:(N=1 AND 统计8日中满足S的天数=8) OR (N>=2 AND 1日后的(未作平滑处理)统计9日中满足S的天数=9)
S8:=(N=1 AND COUNT(S,8)=8) OR (N>=2 AND REFXV(COUNT(S,9),1)=9);
//当满足条件S8AND(8日前的S=0ORA_S8)时,在最高价位置书写数字,画洋红色,显示在位置之上
DRAWNUMBER(S8 AND (REF(S,8)=0 OR A_S8),H,8),COLORMAGENTA,DRAWABOVE;

//S9赋值:(N>=1 AND 统计9日中满足S的天数=9)
S9:=(N>=1 AND COUNT(S,9)=9);
//当满足条件S9AND(9日前的S=0ORA_S9)时,在最高价位置书写数字,画绿色,显示在位置之上
DRAWNUMBER(S9 AND (REF(S,9)=0 OR A_S9),H,9),COLORGREEN,DRAWABOVE;

```









### 二、上升通道



```java
4.3 算法说明
1. 筛选股票算法：
a) 均线筛选法：
 根据日线计算
 判断条件：MA5>MA10>MA20
 连续5根K线满足判断条件时，提示为上升通道股
 盘中实时计算，触发条件即提示
b) MACD筛选法：
 判断条件：MACD 指标 DEA线和DIFF线连续N天同时在零轴以上
 周期：N取20
 计算方法：DIFF = EMA（CLOSE,12) – EMA（CLOSE,26）
DEA = EMA(DIFF,9)
 判断条件算法：BARSLAST(REF(DIFF > 0 and DEA > 0)) 
（判断最后一根k线的DIFF和DEA的值大于0）
c)  BOLL筛选法：
说明：目前筛选用a）均线筛选法和b）MACD筛选法，取并集

2. 通道持续时间是指：连续符合条件的K线数（显示整数）
上升通道时间的算法：以均线筛选法优先，如果满足均线筛选法，则上升通道的时间为满足均线上升通道的时间；如果不满足均线筛选法，则考虑是否满足MACD筛选法，若满足，则上升通道的时间为满足MACD上升通道的时间。

3. 阻力位价格：
a) LLV(LOW，N) + [HHV(HIGH，N) – LLV(LOW，N)] * 1.618 
b) （N取20）
4. 支撑位价格：日线的MA10
5. 距阻力位幅度：（阻力位 - 最新价）/最新价*100%
6. 距支撑位幅度：（最新价 - 支撑位）/最新价*100%

4.4 说明
4.4.1 帮助文本
【模块介绍】上升通道用于筛选沪深A股处于上升通道的个股，向用户展示该个股处于上升通道的形态持续时间，短线支撑位，短线阻力位，距支撑位幅度，距阻力位幅度
【风险揭示】上升通道仅是提供决策参考的信息，用户不可都视为买卖时机建议，用户依此投资决策产生的盈亏，公司不承担任何责任
【计算方法】通道维持时间指连续符合条件的个股周期；短线支撑位指在上升通道个股短线股价支撑价位，距支撑位幅度 = （最新价 – 短线支撑位）/最新价*100%；短线阻力位是指在上升通道个股短线股价阻力价位，距阻力位幅度 = （阻力位-最新价）/最新价*100%
```





说明：

上升通道提供a,b,c三种算法条件，也就是三种满足其一即可入选当前股票进入上升通道



#### 1.均线筛选法

> a) 均线筛选法

- 根据日线计算

- 判断条件：

  - $$
    MA5(5日均线) > MA10 > MA20
    $$

- 连续5根K线满足判断条件时，提示为上升通道股

- 盘中实时计算，触发条件即提示









































