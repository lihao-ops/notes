接口响应空值则重赋随机值
===



```java
import java.lang.reflect.Field;
import java.lang.reflect.ParameterizedType;
import java.lang.reflect.Type;
import java.util.*;
import java.util.concurrent.ThreadLocalRandom;

/**
 * @author LiHao
 * @description: 空值附加默认值处理工具类
 * @Date 2024-09-12 14:49:34
 */
public class DefaultValueUtil {

    /**
     * 为给定对象提供默认值，递归地为其字段填充随机值。
     * 
     * @param body           需要处理的对象
     * @param allowedPackages 允许处理的包列表
     * @return 处理后的对象
     */
    public static Object provideDefaultValue(Object body, List<String> allowedPackages) {
        if (body == null) {
            // 处理 null 的 body，生成一个随机值
            return generateRandomValueForType(Object.class);
        }

        Class<?> clazz = body.getClass();

        // 检查返回对象是否属于指定的包
        if (!isClassInAllowedPackages(clazz, allowedPackages)) {
            // 如果不在指定的包内，直接返回，不做处理
            return body;
        }

        try {
            // 获取所有字段
            Field[] fields = clazz.getDeclaredFields();
            for (Field field : fields) {
                // 允许访问私有字段
                field.setAccessible(true);
                // 获取字段的值
                Object value = field.get(body);

                // 如果字段为空值（null、空字符串、空集合），则为它赋随机值
                if (isFieldEmpty(value)) {
                    // 根据字段类型生成随机值
                    Object randomValue = generateRandomValueForType(field.getType(), getGenericType(field, 0), getGenericType(field, 1));
                    // 设置随机值到字段中
                    field.set(body, randomValue);
                }
            }
        } catch (IllegalAccessException e) {
            e.printStackTrace();
        }
        return body;
    }

    /**
     * 判断类是否属于指定的包
     *
     * @param clazz           返回对象类
     * @param allowedPackages 指定包List
     * @return 是否属于
     */
    private static boolean isClassInAllowedPackages(Class<?> clazz, List<String> allowedPackages) {
        String classPackage = clazz.getPackage().getName();
        for (String allowedPackage : allowedPackages) {
            if (classPackage.startsWith(allowedPackage)) {
                // 如果类的包路径匹配到允许的包，返回 true
                return true;
            }
        }
        // 如果类不在允许的包内，返回 false
        return false;
    }

    /**
     * 检查字段是否为空值
     *
     * @param value 字段的值
     * @return 如果值为null、空字符串、空列表、空Map，则返回true
     */
    private static boolean isFieldEmpty(Object value) {
        // 检查是否为null
        if (value == null) {
            return true;
        }
        // 检查是否为空字符串
        else if (value instanceof String && ((String) value).isEmpty()) {
            return true;
        }
        // 检查是否为空List
        else if (value instanceof List && ((List<?>) value).isEmpty()) {
            return true;
        }
        // 检查是否为空Set
        else if (value instanceof Set && ((Set<?>) value).isEmpty()) {
            return true;
        }
        // 检查是否为空Map
        else if (value instanceof Map && ((Map<?, ?>) value).isEmpty()) {
            return true;
        }
        return false;
    }

    /**
     * 根据字段类型生成随机值
     *
     * @param type         字段的类型
     * @param genericTypes 泛型类型（如List、Map的元素类型）
     * @return 随机生成的值
     */
    private static Object generateRandomValueForType(Class<?> type, Class<?>... genericTypes) {
        // 如果是String类型，生成随机字符串
        if (type == String.class) {
            return generateRandomString();
            // 如果是int类型，生成随机整数
        } else if (type == int.class || type == Integer.class || type == Object.class) {
            return ThreadLocalRandom.current().nextInt(1000);
            // 如果是long类型，生成随机long
        } else if (type == long.class || type == Long.class) {
            return ThreadLocalRandom.current().nextLong();
            // 如果是double类型，生成随机double
        } else if (type == double.class || type == Double.class) {
            return ThreadLocalRandom.current().nextDouble();
            // 如果是float类型，生成随机float
        } else if (type == float.class || type == Float.class) {
            return ThreadLocalRandom.current().nextFloat();
            // 如果是boolean类型，生成随机boolean
        } else if (type == boolean.class || type == Boolean.class) {
            return ThreadLocalRandom.current().nextBoolean();
            // 如果是char类型，生成随机字符
        } else if (type == char.class || type == Character.class) {
            return (char) (ThreadLocalRandom.current().nextInt(26) + 'a');
            // 如果是byte类型，生成随机byte
        } else if (type == byte.class || type == Byte.class) {
            return (byte) ThreadLocalRandom.current().nextInt(256);
            // 如果是short类型，生成随机short
        } else if (type == short.class || type == Short.class) {
            return (short) ThreadLocalRandom.current().nextInt(Short.MAX_VALUE);
            // 如果是List类型，生成随机List
        } else if (type == List.class) {
            // 使用泛型类型生成对应类型的随机List
            return generateRandomList(genericTypes.length > 0 ? genericTypes[0] : Object.class);
            // 如果是Set类型，生成随机Set
        } else if (type == Set.class) {
            // 使用泛型类型生成对应类型的随机Set
            return generateRandomSet(genericTypes.length > 0 ? genericTypes[0] : Object.class);
            // 如果是Map类型，生成随机Map
        } else if (type == Map.class) {
            // 使用泛型类型生成对应类型的随机Map
            return generateRandomMap(genericTypes.length > 0 ? genericTypes[0] : Object.class,
                    genericTypes.length > 1 ? genericTypes[1] : Object.class);
        }
        return null;
    }

    /**
     * 生成随机字符串
     *
     * @return 随机字符串
     */
    private static String generateRandomString() {
        // 随机生成长度为5到12个字符的字符串
        int length = ThreadLocalRandom.current().nextInt(8) + 5;
        StringBuilder sb = new StringBuilder(length);
        // 逐字符生成随机字母
        for (int i = 0; i < length; i++) {
            sb.append((char) (ThreadLocalRandom.current().nextInt(26) + 'a'));
        }
        return sb.toString();
    }

    /**
     * 生成随机 List
     *
     * @param elementType 列表元素的类型
     * @return 随机生成的 List
     */
    private static List<?> generateRandomList(Class<?> elementType) {
        // 随机生成列表大小（1到5个元素）
        int size = ThreadLocalRandom.current().nextInt(5) + 1;
        List<Object> randomList = new ArrayList<>();
        // 根据元素类型，生成随机元素并添加到列表中
        for (int i = 0; i < size; i++) {
            randomList.add(generateRandomValueForType(elementType));
        }
        return randomList;
    }

    /**
     * 生成随机 Set
     *
     * @param elementType 集合元素的类型
     * @return 随机生成的 Set
     */
    private static Set<?> generateRandomSet(Class<?> elementType) {
        // 随机生成集合大小（1到5个元素）
        int size = ThreadLocalRandom.current().nextInt(5) + 1;
        Set<Object> randomSet = new HashSet<>();
        // 根据元素类型，生成随机元素并添加到集合中
        for (int i = 0; i < size; i++) {
            randomSet.add(generateRandomValueForType(elementType));
        }
        return randomSet;
    }

    /**
     * 生成随机 Map
     *
     * @param keyType   键的类型
     * @param valueType 值的类型
     * @return 随机生成的 Map
     */
    private static Map<?, ?> generateRandomMap(Class<?> keyType, Class<?> valueType) {
        // 随机生成Map大小（1到5对键值对）
        int size = ThreadLocalRandom.current().nextInt(5) + 1;
        Map<Object, Object> randomMap = new HashMap<>();
        // 根据键和值的类型，生成随机键值对并添加到Map中
        for (int i = 0; i < size; i++) {
            Object randomKey = generateRandomValueForType(keyType);
            Object randomValue = generateRandomValueForType(valueType);
            randomMap.put(randomKey, randomValue);
        }
        return randomMap;
    }

    /**
     * 获取字段的泛型类型
     *
     * @param field 字段
     * @param index 泛型的索引（0表示第一个泛型参数，1表示第二个）
     * @return 返回泛型类型，如果没有泛型则返回Object.class
     */
    private static Class<?> getGenericType(Field field, int index) {
        // 获取字段的泛型类型
        Type genericType = field.getGenericType();
        if (genericType instanceof ParameterizedType) {
            // 如果字段带有泛型，获取泛型参数列表
            Type[] typeArguments = ((ParameterizedType) genericType).getActualTypeArguments();
            if (index < typeArguments.length && typeArguments[index] instanceof Class) {
                // 返回指定索引的泛型类型
                return (Class<?>) typeArguments[index];
            }
        }
        // 如果字段没有泛型，返回Object类
        return Object.class;
    }

}
```

`DefaultValueUtil` 类的主要功能是自动为 Java 对象的字段生成默认值，特别是在以下情况下：

1. **处理空字段**：当对象字段为空（`null`、空字符串、空集合等）时，为这些字段生成随机的默认值，以确保对象在使用时不会引发空指针异常。

2. **支持各种数据类型**：
   - **基本数据类型**：支持 `String`、`int`、`long`、`double`、`float`、`boolean` 等基本数据类型的随机值生成。
   - **集合类型**：处理 `List`、`Set` 和 `Map` 等集合类型，根据泛型类型生成相应的随机元素。例如，为 `List<String>` 生成随机字符串，为 `Map<Integer, String>` 生成随机键值对。
   - **自定义对象**：对于泛型不明确的自定义对象，将其当作 `Integer` 类型处理，生成随机整数。

3. **包路径过滤**：允许对指定包路径下的类进行处理，确保只对这些包中的类进行默认值赋值操作，不影响其他包中的类。

4. **注释和字段处理**：详细注释了每个方法的功能，保证了代码的可读性和可维护性。

### 主要功能总结：
- 自动检测并填充对象的空字段，生成随机值。
- 支持处理基本数据类型、集合类型及其泛型。
- 包路径过滤，确保只处理指定包中的类。
- 通过反射获取字段的泛型类型，精确生成符合要求的随机值。

这个类适用于需要自动填充数据或在测试时生成具有随机数据的对象的场景。