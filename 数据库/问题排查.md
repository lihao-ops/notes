#### MySQL 8.0 重启后连接异常解决方案

##### 问题描述

数据库客户端版本为MySQL 8.0，服务为旧版本MySQL版本为5，DBA重启MySQL服务后出现连接异常：

```
Caused by: com.mysql.jdbc.exceptions.jdbc4.MySQLNonTransientConnectionException: Could not create connection to database server. Attempted reconnect 3 times. Giving up.

Caused by: java.sql.SQLException: Unknown character set index for field '255' received from server.
```

##### 环境配置

- Java版本：1.8
- MySQL Connector版本：5.1.30
- 数据库：MySQL 8.0

##### 问题原因

重启MySQL服务后，服务器加载了新的配置，导致字符集索引发生变化：

- **重启前**：MySQL使用兼容老版本JDBC驱动的字符集配置
- **重启后**：MySQL加载新配置，使用字符集索引255（utf8mb4_0900_ai_ci）
- **根本原因**：老版本JDBC驱动（5.1.30）无法识别新的字符集索引

##### 解决方案

###### 方案1：修改数据库配置（推荐）

在MySQL配置文件（my.cnf）中添加：

```ini
[mysqld]
character-set-server=utf8mb4
collation-server=utf8mb4_unicode_ci

# MySQL 8.0之前默认使用 utf8mb4_general_ci
default_collation_for_utf8mb4=utf8mb4_general_ci
```

然后重启MySQL服务，使用兼容老版本驱动的字符集索引。



> 为什么能解决？

- **MySQL 8.0之前**：utf8mb4_general_ci 对应的字符集索引是老版本JDBC驱动能够识别的
- **MySQL 8.0之后**：默认改为 utf8mb4_0900_ai_ci，对应字符集索引255，老版本JDBC驱动无法识别



###### 方案2：升级JDBC驱动（可选）

将MySQL Connector版本从5.1.30升级到8.0以上版本，以支持新的字符集索引。



##### 最终结果

采用方案1修改数据库配置后，异常成功解决！