# Speed系统



## 一、引言

​         

### 1.目的

本文说明**SPEED**行情系统对外提供接口服务所使用的数据通讯协议。  



### 2.参考资料

行情指标定义说明文档 <<**MDL.SPEED.****指标接口说明.doc**>>





## 二、基本概念



### 1.Speed行情数据基本概念

​	从行情客户端展示的角度来看，行情数据分成两种：**实时指标数据**和**历史数据**。



### 2.实时指标数据

​	实时指标数据就是在终端中的报价列表及个股行情展示中看到的特定指标所对应的最新值。如最新价、最高价、最低价，成交量，涨跌、涨跌幅，换手率。有些指标是根据实时指标计算的指标也通过SPEED系统发布，如市盈率TTM、市净率、流通市值、总市值等；

实时指标使用编号来进行标识，如最新交易日期为1，最新交易时间为2，最新价的编号为3等；通过代码(WindCode)加指标编号可以唯一确定指标。



### 3.历史数据

​	历史数据则包括当日走势、当日成交明细、历史日K线、分钟K线、资金流向趋势等。这些数据都是在当前最后一次更新以前发生的变化所累积的时间序列数据或者序号序列数据；  



### 4.组织形式

> 从以下的C++数据结构示例描述中可以了解这两类数据的组织形式

```c++
const unsigned int MAX_FIELDS_NUM = 640;

struct IntraDayTrendDataItem
{
unsigned int Time;
Int64 Price;
Int64 Volume;
}
typedef vector<IntraDayTrendDataItem> IntraDayTrendData;

class Instrument
{
private:
Int64 rq_values[MAX_FIELDS_NUM];     // 实时指标
IntraDayTrendData intraday_trend;    // 当日走势数据
}
```

​	SPEED行情系统就是根据实时指标数据和历史数据的划分来采集、组织、整理、发布数据的。在后台的部署结构也是按照实时和历史的逻辑来进行的。负责实时行情数据发布的服务器称为 SPEED TICK SERVER，简称为TICK；负责提供历史数据的服务器称为SPEED HIS SERVER，简称为HIS。

​	SPEED行情系统的接口也是通过实时和历史这两种接口形式来获取行情数据的。

​	对于实时指标数据，客户端通过订阅(*Subscribe*)的方式来得到最新数据并在服务器端产生订阅记录，如果这些订阅的指标有变化后服务器会自动推送(*Push*)到客户端，客户端不需要主动再去申请；在SPEED系统中，客户端获取最新指标数据并且订阅是由一个请求完成的。如果只需要获得最新指标但不需要订阅，可以使用单独的数据快照请求；

​	当客户端由于界面切换等原因不再需要显示某些已订阅的指标时，客户端需要负责主动向服务器发出退订(*Unsubscribe*)请求，之后服务器就不再推送这些指标值的变化给客户端。

​	对于历史数据，客户端向TICK服务器发出请求，TICK服务器根据请求的代码按照市场分类将请求转发给对应的HIS服务器并得到数据后再发送回给客户端。

​	客户端在得到了一次历史数据后，可以根据接收到的由订阅产生的推送数据进行累计叠加，并更新内存中缓存的历史数据，如走势，K线等；还可以根据需求重新请求完整的历史数据；

​	客户端只需要与TICK服务器建立**一个**TCP连接就可以同时请求订阅实时指标数据和请求历史数据。所有历史数据的请求都会由TICK服务器路由到对应的HIS服务器，并将HIS服务器返回的数据再回传到客户端。