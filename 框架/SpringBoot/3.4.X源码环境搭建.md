SpringBoot 3.4.X源码环境搭建
===



一、前置环境
---

- JDK17
- git2.39.2.windows.1
- IDEA2024.1
- Gradle 8.12.1



二、环境搭建
---

### 1.拉取源码

#### 1.1从SpringBoot官网进入github

> 官网地址：https://spring.io/projects/spring-boot

![image-20250128132506399](https://notes-1307435281.cos.ap-shanghai.myqcloud.com/note/master/202501281325925.png)





#### 1.2拉取对应3.4.x分支代码

> 注意：不要拉取主分支的全部代码，而是对应版本分支代码。

![image-20250128121416547](https://notes-1307435281.cos.ap-shanghai.myqcloud.com/note/master/202501281322179.png)



#### 1.3复制git链接

> 本次复制的链接地址：https://github.com/spring-projects/spring-boot.git

![image-20250128134007549](https://notes-1307435281.cos.ap-shanghai.myqcloud.com/note/master/202501281340791.png)







##### 1.3.1 设置代理端口

>由于github需要进行代理访问，请设置代理地址

```bash
git config --global http.proxy http://127.0.0.1:7890
git config --global https.proxy https://127.0.0.1:7890
```



>设置成功

```bash
$ git config --global --get http.proxy
http://127.0.0.1:7890

$ git config --global --get https.proxy
https://127.0.0.1:7890
```





##### 1.3.2 执行命令

>由于上述命令默认都是主分支命令，故此需要指定当前项目分支下载

```bash
git clone -b 3.4.x https://github.com/spring-projects/spring-boot.git
```





##### 1.3.3 解除路径较长限制

>Spring Boot 源码中有一些文件，超过了 Windows 的限制

```bash
$ git clone -b 3.4.x https://github.com/spring-projects/spring-boot.git
```

```bash
Cloning into 'spring-boot'...
remote: Enumerating objects: 931744, done.
remote: Counting objects: 100% (689/689), done.
remote: Compressing objects: 100% (235/235), done.
remote: Total 931744 (delta 521), reused 454 (delta 454), pack-reused 931055 (from 4)
Receiving objects: 100% (931744/931744), 178.08 MiB | 2.62 MiB/s, done.
Resolving deltas: 100% (421038/421038), done.
fatal: cannot create directory at 'spring-boot-project/spring-boot-tools/spring-boot-buildpack-platform/src/test/resources/org/springframework/boot/buildpack/platform/docker/configuration/with-context/contexts/meta/ea1b2003cc8155cb8af43960c89a4c1e28777d6fd848ff3422cf375329c2626d': Filename too long
warning: Clone succeeded, but checkout failed.
You can inspect what was checked out with 'git status'
and retry with 'git restore --source=HEAD :/'
```

由于 Git 在 Windows 系统上默认的文件路径长度限制（260 个字符）导致的。Spring Boot 源码中有一些文件，超过了 Windows 的限制，因此出现了 `Filename too long` 错误。



### 2.启用长路径支持（推荐）

#### 步骤1:LongPathsEnabled=1

- Windows 10 及以上版本支持长路径（超过 260 个字符），但需要手动启用：

  1. 打开注册表编辑器（按 `Win + R`，输入 `regedit`，回车）。

  2. 导航到以下路径：

     ```bash
     HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\FileSystem
     ```

  3. 找到 `LongPathsEnabled`，将其值从 `0` 改为 `1`。

     - 如果不存在 `LongPathsEnabled`，右键空白处，选择 `新建 > DWORD (32-bit) 值`，命名为 `LongPathsEnabled`，并将其值设置为 `1`。

  4. 重启电脑。

  5. 重新尝试克隆仓库。

![image-20250128135905180](https://notes-1307435281.cos.ap-shanghai.myqcloud.com/note/master/202501281359465.png)





#### 步骤2:通过组策略启用长路径

> 1.打开本地组策略编辑器

1. **按 `Win + R`** 组合键，输入 `gpedit.msc`，然后 **按 Enter** 键。
2. 这将打开 **本地组策略编辑器**。

------

> 2.找到长路径选项

1. 在左侧依次展开：

   ```
   计算机配置 -> 管理模板 -> 系统 -> 文件系统
   ```

2. 在右侧找到 **“启用 Win32 长路径”**。

------

> 3.启用长路径

1. **双击** “启用 Win32 长路径” 选项。
2. 选择 **“已启用”**，然后点击 **“应用” -> “确定”**。

------



> 4.重启电脑

- **重启 Windows** 使更改生效。



#### 步骤3:git工具启动长路径支持

已经确认 **“启用 Win32 长路径”** 选项已启用，但克隆 Spring Boot 代码仍然报 **文件名过长** 的错误，可能是 **设置未生效或 Git 仍然没有正确支持长路径**。

>即使 Windows 允许长路径，Git 仍然需要额外开启支持

```bash
git config --global core.longpaths true
```

>检查Git是否正确配置

```bash
git config --global --get core.longpaths
```

```bash
#如果输出 true，说明 Git 已正确启用长路径支持。
true
```



#### 步骤4:确保 `core.longpaths` 在 Git Bash 内部生效

> 如果你是在 **Git Bash** 里克隆，可以用下面的命令检查 Git Bash 内部的 `core.longpaths` 变量：

```sh
git config --system --get core.longpaths
```

> 如果输出 **为空**，手动设置：

```sh
git config --system core.longpaths true
```

> 然后重新克隆

```sh
git clone -b 3.4.x https://github.com/spring-projects/spring-boot.git
```







#### 步骤5:增加Git传输Buffer大小

```sh
Administrator@DESKTOP-DNPQNO5 MINGW64 /d/项目暂存/SpringBootSouceCode
$ git clone -b 3.4.x https://github.com/spring-projects/spring-boot.git
Cloning into 'spring-boot'...
remote: Enumerating objects: 932679, done.
remote: Counting objects: 100% (106/106), done.
remote: Compressing objects: 100% (78/78), done.
error: RPC failed; curl 18 transfer closed with outstanding read data remaining
error: 19043 bytes of body are still expected
fetch-pack: unexpected disconnect while reading sideband packet
fatal: early EOF
fatal: fetch-pack: invalid index-pack output
```



>Git默认的HTTP传输Buffer可能过小，尝试增加Buffer限制

```sh
git config --global http.postBuffer 524288000
git config --global http.maxRequestBuffer 1048576000
```

然后重新git clone即可

![image-20250201034704749](https://notes-1307435281.cos.ap-shanghai.myqcloud.com/note/master/202502010347822.png)

由此可见`git clone` 这次成功了，Spring Boot 3.4.x 分支的源码已经完整克隆到本地指定目录。



#### 步骤6解除与官方远程仓库的绑定

>由于Spring Boot 的源码默认绑定了官方仓库 `https://github.com/spring-projects/spring-boot.git`，故此需要解除绑定

1.进入克隆的SpringBoot目录

```sh
cd spring-boot
```

2.解除与官方远程仓库绑定

```sh
git remote remove origin
```



![image-20250201035118691](https://notes-1307435281.cos.ap-shanghai.myqcloud.com/note/master/202502010351748.png)



#### 步骤7:确认.git文件是在你需要上传的指定文件夹下

>确认.git对应的文件在你需要上传的文件夹下

否则，先删除再在指定目录下`git init`





### 3.创建自己的GitHub仓库

1. 打开 [GitHub](https://github.com)。

2. 进入你的账户，创建一个新的仓库：

   - **仓库名**：`SpringBootSouceCode`
   - **选择公开或私有**
   - **不要勾选 "Initialize this repository with a README"**（避免冲突）

3. 创建后，复制 GitHub 提供的仓库地址，例如：

   ```arduino
   https://github.com/lihao-ops/SpringBootSouceCode.git
   ```

![image-20250201033200247](https://notes-1307435281.cos.ap-shanghai.myqcloud.com/note/master/202502010332396.png)



#### 步骤1:关联远程仓库地址

```sh
git remote add origin https://github.com/lihao-ops/SpringBootSouceCode.git
```

```bash
git remote add origin https://github.com/lihao-ops/xxl-job.git
```



#### 步骤2:添加并提交代码

>在当前需要提交的根目录下执行(此步骤并不是直接就推送到指定Github仓库，而是暂存)

```sh
git add .
git commit -m "Initial commit: Spring Boot 3.4.x source code"
```



#### 步骤3:推送代码

>推送代码

```sh
Administrator@DESKTOP-DNPQNO5 MINGW64 /d/项目暂存/SpringBootSouceCode (main)
$ git push -u origin main
```

```sh
remote: Invalid username or password.
fatal: Authentication failed for 'https://github.com/lihao-ops/SpringBootSouceCode.git/'
```



> 推送失败处理

```sh
$ git push --set-upstream origin main
```

```sh
Enumerating objects: 15027, done.
Counting objects: 100% (15027/15027), done.
Delta compression using up to 8 threads
Compressing objects: 100% (7752/7752), done.
Writing objects: 100% (15027/15027), 8.70 MiB | 287.50 MiB/s, done.
Total 15027 (delta 5138), reused 15027 (delta 5138), pack-reused 0
remote: Resolving deltas: 100% (5138/5138), done.
To https://github.com/lihao-ops/SpringBootSouceCode.git
 * [new branch]      main -> main
branch 'main' set up to track 'origin/main'.
```



#### 步骤4:成功添加

![image-20250201041345330](https://notes-1307435281.cos.ap-shanghai.myqcloud.com/note/master/202502010413402.png)

>随后在Github指定分支中查看代码是否已上传

![image-20250201041441403](https://notes-1307435281.cos.ap-shanghai.myqcloud.com/note/master/202502010414349.png)



#### 步骤5:处理GitHub认证

```sh
git remote set-url origin https://<你的GitHub用户名>:<你的PAT令牌>@github.com/lihao-ops/SpringBootSouceCode.git
```



>配置成功

```sh
Administrator@DESKTOP-DNPQNO5 MINGW64 /d/项目暂存/SpringBootSouceCode (main)
$ git push -u origin main
Everything up-to-date
branch 'main' set up to track 'origin/main'.
```



> 后续使用即可

修改代码并提交（`git commit`）。

使用 `git push` 将新的更改推送到远程仓库。



三、构建源码
---

>至此提供构建源码的基本环境基本准备无误

### 1. **打开源码项目**

1. 启动 **IntelliJ IDEA**。
2. 选择 **File** > **Open**，然后选择 **D:\项目暂存\SpringBootSouceCode\spring-boot** 这个文件夹。
3. 点击 **OK** 打开项目。

![image-20250211193601631](https://notes-1307435281.cos.ap-shanghai.myqcloud.com/note/master/202502111936967.png)

### 2. **配置 Gradle 构建工具**

Spring Boot 3.4.x 使用 **Gradle** 构建工具，你需要确保 IntelliJ IDEA 正确识别并使用 Gradle。

1. 在 IDEA 中，打开 **File** > **Settings**（或者按 `Ctrl+Alt+S`）。
2. 在左侧菜单中选择 **Build, Execution, Deployment** > **Build Tools** > **Gradle**。
3. 确保 **Use Gradle from** 选项选择的是 **Wrapper**，这会使用项目中已经存在的 Gradle 配置。

![image-20250211194031033](https://notes-1307435281.cos.ap-shanghai.myqcloud.com/note/master/202502111940147.png)





>相关4个文件配置阿里云代理地址

![image-20250211193651486](https://notes-1307435281.cos.ap-shanghai.myqcloud.com/note/master/202502111936581.png)





![image-20250211193715598](https://notes-1307435281.cos.ap-shanghai.myqcloud.com/note/master/202502111937668.png)







![image-20250211193726105](https://notes-1307435281.cos.ap-shanghai.myqcloud.com/note/master/202502111937220.png)





![image-20250211193737970](https://notes-1307435281.cos.ap-shanghai.myqcloud.com/note/master/202502111937082.png)





![image-20250211193755803](https://notes-1307435281.cos.ap-shanghai.myqcloud.com/note/master/202502111937918.png)







### 3. **同步 Gradle 项目**

1. 在打开的项目中，找到 **右侧的 Gradle 工具窗口**（如果没有显示，可以通过点击右侧的 Gradle 图标来展开）。
2. 在 Gradle 工具窗口中，点击 **Refresh** 按钮，确保 IDEA 下载并同步所需的依赖项。

![image-20250211193809925](https://notes-1307435281.cos.ap-shanghai.myqcloud.com/note/master/202502111938037.png)





### 4. **编译和构建项目**

Spring Boot 源码项目使用 Gradle 来管理依赖和构建流程。你可以直接使用 Gradle 来编译项目：

1. 在 **Gradle 工具窗口** 中，找到 **Tasks** > **build**，双击 **build** 来构建项目。这个过程会编译并打包项目，确保没有构建错误。
   - 如果没有看到 Gradle 工具窗口，可以在右侧点击 **Gradle** 图标来打开。
2. 你也可以选择 **Build** > **Build Project**（或者按 `Ctrl+F9`）来构建整个项目，确保没有任何编译错误。

>上述代理配置生效，目前已使用aliyun代理地址加速下载

![image-20250211194152116](https://notes-1307435281.cos.ap-shanghai.myqcloud.com/note/master/202502111941407.png)





### 5. **配置 Spring Boot 启动类**

1. 在项目的 `spring-boot-project` 文件夹下，你会找到 Spring Boot 的核心代码。你可以使用默认的启动类来运行项目。一般来说，Spring Boot 相关的启动类会包含 `@SpringBootApplication` 注解，你可以在源码中找到类似的类，如：
   - `org.springframework.boot.SpringApplication`：作为启动类。
2. 在 IDEA 中，打开 **Run/Debug Configurations**（点击右上角的运行按钮旁边的下拉菜单，选择 **Edit Configurations...**）。
3. 在弹出的窗口中，点击左上角的 **+** 按钮，选择 **Spring Boot**。
4. 配置主类为 Spring Boot 启动类，通常是 `org.springframework.boot.SpringApplication`，确保选择正确的类。



### 6. **运行项目**

1. 配置好启动类后，点击 **Run** 按钮（绿色播放按钮）开始运行 Spring Boot 3.4.x 应用。
2. 如果项目没有配置主类，你也可以手动运行 Spring Boot 启动类（例如 `SpringApplication.run()`）。



### 7. **调试项目（可选）**

1. 如果你需要调试应用，可以在 **Run/Debug Configurations** 中选择 **Debug** 来启动调试模式。
2. 设置断点，然后在调试模式下运行，调试 Spring Boot 的源码。



### 8. **执行测试**

Spring Boot 源码包含大量的单元测试和集成测试，你可以使用 **Gradle** 来执行这些测试。

1. 在 **Gradle 工具窗口** 中，找到 **Tasks** > **verification** > **test**，双击 **test** 来运行单元测试。
2. 你也可以通过 **Run** > **Run 'Tests'** 来直接运行测试。









